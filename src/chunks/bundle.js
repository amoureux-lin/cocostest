System.register([], function(_export, _context) { return { execute: function () {
System.register("chunks:///_virtual/AgoraRTC_N-production.js",["./cjs-loader.mjs"],(function(e,t){var n;return{setters:[function(e){n=e.default}],execute:function(){function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function a(e){var t="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return o(e,arguments,u(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)})(e)}function o(e,t,n){return(o=s()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i}).apply(null,arguments)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){d(a,r,i,o,s,"next",e)}function s(e){d(a,r,i,o,s,"throw",e)}o(void 0)}))}}function l(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */l=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var a=t&&t.prototype instanceof E?t:E,o=Object.create(a.prototype),s=new k(r||[]);return i(o,"_invoke",{value:I(e,n,s)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",f="executing",_="completed",v={};function E(){}function m(){}function S(){}var g={};u(g,o,(function(){return this}));var T=Object.getPrototypeOf,b=T&&T(T(N([])));b&&b!==n&&r.call(b,o)&&(g=b);var R=S.prototype=E.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function n(i,a,o,s){var c=p(e[i],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}var a;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}})}function I(t,n,r){var i=h;return function(a,o){if(i===f)throw new Error("Generator is already running");if(i===_){if("throw"===a)throw o;return{value:e,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=_,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var u=p(t,n,r);if("normal"===u.type){if(i=r.done?_:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=_,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(i,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function N(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=S,i(R,"constructor",{value:S,configurable:!0}),i(S,"constructor",{value:m,configurable:!0}),m.displayName=u(S,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,u(e,c,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},C(y.prototype),u(y.prototype,s,(function(){return this})),t.AsyncIterator=y,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new y(d(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(R),u(R,c,"Generator"),u(R,o,(function(){return this})),u(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=N,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:N(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,a=void 0,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?a:String(a)),r)}var i,a}function v(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}e("default",void 0);var E=e("__cjsMetaURL",t.meta.url);n.define(E,(function(t,n,o,s,c){var u,d;u=this,d=function(){var e,t,n,o,s,c,u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch(e){return!0}},_=!f((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),E=_,m=Function.prototype,S=m.call,g=E&&m.bind.bind(S,S),T=E?g:function(e){return function(){return S.apply(e,arguments)}},b=T({}.isPrototypeOf),R=function(e){return e&&e.Math===Math&&e},C=R("object"==typeof globalThis&&globalThis)||R("object"==typeof window&&window)||R("object"==typeof self&&self)||R("object"==typeof u&&u)||R("object"==typeof u&&u)||function(){return this}()||Function("return this")(),y=_,I=Function.prototype,A=I.apply,w=I.call,O="object"==typeof Reflect&&Reflect.apply||(y?w.bind(A):function(){return w.apply(A,arguments)}),k=T,N=k({}.toString),D=k("".slice),P=function(e){return D(N(e),8,-1)},L=P,x=T,M=function(e){if("Function"===L(e))return x(e)},U="object"==typeof document&&document.all,V=void 0===U&&void 0!==U?function(e){return"function"==typeof e||e===U}:function(e){return"function"==typeof e},F={},B=!f((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),j=_,G=Function.prototype.call,W=j?G.bind(G):function(){return G.apply(G,arguments)},H={},K={}.propertyIsEnumerable,Y=Object.getOwnPropertyDescriptor,q=Y&&!K.call({1:2},1);H.f=q?function(e){var t=Y(this,e);return!!t&&t.enumerable}:K;var z,X,J=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Q=f,Z=P,$=Object,ee=T("".split),te=Q((function(){return!$("z").propertyIsEnumerable(0)}))?function(e){return"String"===Z(e)?ee(e,""):$(e)}:$,ne=function(e){return null==e},re=ne,ie=TypeError,ae=function(e){if(re(e))throw new ie("Can't call method on "+e);return e},oe=te,se=ae,ce=function(e){return oe(se(e))},ue=V,de=function(e){return"object"==typeof e?null!==e:ue(e)},pe={},le=pe,he=C,fe=V,_e=function(e){return fe(e)?e:void 0},ve=function(e,t){return arguments.length<2?_e(le[e])||_e(he[e]):le[e]&&le[e][t]||he[e]&&he[e][t]},Ee=C.navigator,me=Ee&&Ee.userAgent,Se=me?String(me):"",ge=C,Te=Se,be=ge.process,Re=ge.Deno,Ce=be&&be.versions||Re&&Re.version,ye=Ce&&Ce.v8;ye&&(X=(z=ye.split("."))[0]>0&&z[0]<4?1:+(z[0]+z[1])),!X&&Te&&(!(z=Te.match(/Edge\/(\d+)/))||z[1]>=74)&&(z=Te.match(/Chrome\/(\d+)/))&&(X=+z[1]);var Ie=X,Ae=Ie,we=f,Oe=C.String,ke=!!Object.getOwnPropertySymbols&&!we((function(){var e=Symbol("symbol detection");return!Oe(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ae&&Ae<41})),Ne=ke&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,De=ve,Pe=V,Le=b,xe=Object,Me=Ne?function(e){return"symbol"==typeof e}:function(e){var t=De("Symbol");return Pe(t)&&Le(t.prototype,xe(e))},Ue=String,Ve=function(e){try{return Ue(e)}catch(e){return"Object"}},Fe=V,Be=Ve,je=TypeError,Ge=function(e){if(Fe(e))return e;throw new je(Be(e)+" is not a function")},We=Ge,He=ne,Ke=function(e,t){var n=e[t];return He(n)?void 0:We(n)},Ye=W,qe=V,ze=de,Xe=TypeError,Je={exports:{}},Qe=C,Ze=Object.defineProperty,$e=C,et="__core-js_shared__",tt=Je.exports=$e[et]||function(e,t){try{Ze(Qe,e,{value:t,configurable:!0,writable:!0})}catch(n){Qe[e]=t}return t}(et,{});(tt.versions||(tt.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var nt=Je.exports,rt=nt,it=function(e,t){return rt[e]||(rt[e]=t||{})},at=ae,ot=Object,st=function(e){return ot(at(e))},ct=st,ut=T({}.hasOwnProperty),dt=Object.hasOwn||function(e,t){return ut(ct(e),t)},pt=T,lt=0,ht=Math.random(),ft=pt(1..toString),_t=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ft(++lt+ht,36)},vt=it,Et=dt,mt=_t,St=ke,gt=Ne,Tt=C.Symbol,bt=vt("wks"),Rt=gt?Tt.for||Tt:Tt&&Tt.withoutSetter||mt,Ct=function(e){return Et(bt,e)||(bt[e]=St&&Et(Tt,e)?Tt[e]:Rt("Symbol."+e)),bt[e]},yt=W,It=de,At=Me,wt=Ke,Ot=TypeError,kt=Ct("toPrimitive"),Nt=function(e,t){if(!It(e)||At(e))return e;var n,r=wt(e,kt);if(r){if(void 0===t&&(t="default"),n=yt(r,e,t),!It(n)||At(n))return n;throw new Ot("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&qe(n=e.toString)&&!ze(r=Ye(n,e)))return r;if(qe(n=e.valueOf)&&!ze(r=Ye(n,e)))return r;if("string"!==t&&qe(n=e.toString)&&!ze(r=Ye(n,e)))return r;throw new Xe("Can't convert object to primitive value")}(e,t)},Dt=Me,Pt=function(e){var t=Nt(e,"string");return Dt(t)?t:t+""},Lt=de,xt=C.document,Mt=Lt(xt)&&Lt(xt.createElement),Ut=function(e){return Mt?xt.createElement(e):{}},Vt=Ut,Ft=!B&&!f((function(){return 7!==Object.defineProperty(Vt("div"),"a",{get:function(){return 7}}).a})),Bt=B,jt=W,Gt=H,Wt=J,Ht=ce,Kt=Pt,Yt=dt,qt=Ft,zt=Object.getOwnPropertyDescriptor;F.f=Bt?zt:function(e,t){if(e=Ht(e),t=Kt(t),qt)try{return zt(e,t)}catch(e){}if(Yt(e,t))return Wt(!jt(Gt.f,e,t),e[t])};var Xt=f,Jt=V,Qt=/#|\.prototype\./,Zt=function(e,t){var n=en[$t(e)];return n===nn||n!==tn&&(Jt(t)?Xt(t):!!t)},$t=Zt.normalize=function(e){return String(e).replace(Qt,".").toLowerCase()},en=Zt.data={},tn=Zt.NATIVE="N",nn=Zt.POLYFILL="P",rn=Zt,an=Ge,on=_,sn=M(M.bind),cn=function(e,t){return an(e),void 0===t?e:on?sn(e,t):function(){return e.apply(t,arguments)}},un={},dn=B&&f((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),pn=de,ln=String,hn=TypeError,fn=function(e){if(pn(e))return e;throw new hn(ln(e)+" is not an object")},_n=B,vn=Ft,En=dn,mn=fn,Sn=Pt,gn=TypeError,Tn=Object.defineProperty,bn=Object.getOwnPropertyDescriptor,Rn="enumerable",Cn="configurable",yn="writable";un.f=_n?En?function(e,t,n){if(mn(e),t=Sn(t),mn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&yn in n&&!n[yn]){var r=bn(e,t);r&&r[yn]&&(e[t]=n.value,n={configurable:Cn in n?n[Cn]:r[Cn],enumerable:Rn in n?n[Rn]:r[Rn],writable:!1})}return Tn(e,t,n)}:Tn:function(e,t,n){if(mn(e),t=Sn(t),mn(n),vn)try{return Tn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new gn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var In=un,An=J,wn=B?function(e,t,n){return In.f(e,t,An(1,n))}:function(e,t,n){return e[t]=n,e},On=C,kn=O,Nn=M,Dn=V,Pn=F.f,Ln=rn,xn=pe,Mn=cn,Un=wn,Vn=dt,Fn=function(e){var t=function t(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return kn(e,this,arguments)};return t.prototype=e.prototype,t},Bn=function(e,t){var n,r,i,a,o,s,c,u,d,p=e.target,l=e.global,h=e.stat,f=e.proto,_=l?On:h?On[p]:On[p]&&On[p].prototype,v=l?xn:xn[p]||Un(xn,p,{})[p],E=v.prototype;for(a in t)r=!(n=Ln(l?a:p+(h?".":"#")+a,e.forced))&&_&&Vn(_,a),s=v[a],r&&(c=e.dontCallGetSet?(d=Pn(_,a))&&d.value:_[a]),o=r&&c?c:t[a],(n||f||typeof s!=typeof o)&&(u=e.bind&&r?Mn(o,On):e.wrap&&r?Fn(o):f&&Dn(o)?Nn(o):o,(e.sham||o&&o.sham||s&&s.sham)&&Un(u,"sham",!0),Un(v,a,u),f&&(Vn(xn,i=p+"Prototype")||Un(xn,i,{}),Un(xn[i],a,o),e.real&&E&&(n||!E[a])&&Un(E,a,o)))},jn=Math.ceil,Gn=Math.floor,Wn=Math.trunc||function(e){var t=+e;return(t>0?Gn:jn)(t)},Hn=function(e){var t=+e;return t!=t||0===t?0:Wn(t)},Kn=Hn,Yn=Math.max,qn=Math.min,zn=function(e,t){var n=Kn(e);return n<0?Yn(n+t,0):qn(n,t)},Xn=Hn,Jn=Math.min,Qn=function(e){var t=Xn(e);return t>0?Jn(t,9007199254740991):0},Zn=Qn,$n=function(e){return Zn(e.length)},er=ce,tr=zn,nr=$n,rr=function(e){return function(t,n,r){var i=er(t),a=nr(i);if(0===a)return!e&&-1;var o,s=tr(r,a);if(e&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},ir={includes:rr(!0),indexOf:rr(!1)},ar=ir.includes;Bn({target:"Array",proto:!0,forced:f((function(){return!Array(1).includes()}))},{includes:function(e){return ar(this,e,arguments.length>1?arguments[1]:void 0)}});var or=C,sr=pe,cr=function(e,t){var n=sr[e+"Prototype"],r=n&&n[t];if(r)return r;var i=or[e],a=i&&i.prototype;return a&&a[t]},ur=cr("Array","includes"),dr=de,pr=P,lr=Ct("match"),hr=function(e){var t;return dr(e)&&(void 0!==(t=e[lr])?!!t:"RegExp"===pr(e))},fr=hr,_r=TypeError,vr={};vr[Ct("toStringTag")]="z";var Er="[object z]"===String(vr),mr=Er,Sr=V,gr=P,Tr=Ct("toStringTag"),br=Object,Rr="Arguments"===gr(function(){return arguments}()),Cr=mr?gr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=br(e),Tr))?n:Rr?gr(t):"Object"===(r=gr(t))&&Sr(t.callee)?"Arguments":r},yr=Cr,Ir=String,Ar=function(e){if("Symbol"===yr(e))throw new TypeError("Cannot convert a Symbol value to a string");return Ir(e)},wr=Ct("match"),Or=Bn,kr=function(e){if(fr(e))throw new _r("The method doesn't accept regular expressions");return e},Nr=ae,Dr=Ar,Pr=T("".indexOf);Or({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[wr]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Pr(Dr(Nr(this)),Dr(kr(e)),arguments.length>1?arguments[1]:void 0)}});var Lr=cr("String","includes"),xr=b,Mr=ur,Ur=Lr,Vr=Array.prototype,Fr=String.prototype,Br=d((function(e){var t=e.includes;return e===Vr||xr(Vr,e)&&t===Vr.includes?Mr:"string"==typeof e||e===Fr||xr(Fr,e)&&t===Fr.includes?Ur:t})),jr=Ge,Gr=st,Wr=te,Hr=$n,Kr=TypeError,Yr="Reduce of empty array with no initial value",qr=function(e){return function(t,n,r,i){var a=Gr(t),o=Wr(a),s=Hr(a);if(jr(n),0===s&&r<2)throw new Kr(Yr);var c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in o){i=o[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw new Kr(Yr)}for(;e?c>=0:s>c;c+=u)c in o&&(i=n(i,o[c],c,a));return i}},zr={left:qr(!1),right:qr(!0)},Xr=f,Jr=function(e,t){var n=[][e];return!!n&&Xr((function(){n.call(null,t||function(){return 1},1)}))},Qr=C,Zr=Se,$r=P,ei=function(e){return Zr.slice(0,e.length)===e},ti=ei("Bun/")?"BUN":ei("Cloudflare-Workers")?"CLOUDFLARE":ei("Deno/")?"DENO":ei("Node.js/")?"NODE":Qr.Bun&&"string"==typeof Bun.version?"BUN":Qr.Deno&&"object"==typeof Deno.version?"DENO":"process"===$r(Qr.process)?"NODE":Qr.window&&Qr.document?"BROWSER":"REST",ni="NODE"===ti,ri=zr.left;Bn({target:"Array",proto:!0,forced:!ni&&Ie>79&&Ie<83||!Jr("reduce")},{reduce:function(e){var t=arguments.length;return ri(this,e,t,t>1?arguments[1]:void 0)}});var ii=cr("Array","reduce"),ai=b,oi=ii,si=Array.prototype,ci=function(e){var t=e.reduce;return e===si||ai(si,e)&&t===si.reduce?oi:t},ui=d(ci),di=P,pi=Array.isArray||function(e){return"Array"===di(e)},li=Bn,hi=pi,fi=T([].reverse),_i=[1,2];li({target:"Array",proto:!0,forced:String(_i)===String(_i.reverse())},{reverse:function(){return hi(this)&&(this.length=this.length),fi(this)}});var vi=cr("Array","reverse"),Ei=b,mi=vi,Si=Array.prototype,gi=function(e){var t=e.reverse;return e===Si||Ei(Si,e)&&t===Si.reverse?mi:t},Ti=d(gi),bi=_t,Ri=it("keys"),Ci=function(e){return Ri[e]||(Ri[e]=bi(e))},yi=!f((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Ii=dt,Ai=V,wi=st,Oi=yi,ki=Ci("IE_PROTO"),Ni=Object,Di=Ni.prototype,Pi=Oi?Ni.getPrototypeOf:function(e){var t=wi(e);if(Ii(t,ki))return t[ki];var n=t.constructor;return Ai(n)&&t instanceof n?n.prototype:t instanceof Ni?Di:null},Li=T,xi=Ge,Mi=de,Ui=String,Vi=TypeError,Fi=de,Bi=ae,ji=function(e){if(function(e){return Mi(e)||null===e}(e))return e;throw new Vi("Can't set "+Ui(e)+" as a prototype")},Gi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return Li(xi(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Bi(n),ji(r),Fi(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),Wi={},Hi={},Ki=dt,Yi=ce,qi=ir.indexOf,zi=Hi,Xi=T([].push),Ji=function(e,t){var n,r=Yi(e),i=0,a=[];for(n in r)!Ki(zi,n)&&Ki(r,n)&&Xi(a,n);for(;t.length>i;)Ki(r,n=t[i++])&&(~qi(a,n)||Xi(a,n));return a},Qi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zi=Ji,$i=Qi.concat("length","prototype");Wi.f=Object.getOwnPropertyNames||function(e){return Zi(e,$i)};var ea={};ea.f=Object.getOwnPropertySymbols;var ta=ve,na=Wi,ra=ea,ia=fn,aa=T([].concat),oa=ta("Reflect","ownKeys")||function(e){var t=na.f(ia(e)),n=ra.f;return n?aa(t,n(e)):t},sa=dt,ca=oa,ua=F,da=un,pa={},la=Ji,ha=Qi,fa=Object.keys||function(e){return la(e,ha)},_a=B,va=dn,Ea=un,ma=fn,Sa=ce,ga=fa;pa.f=_a&&!va?Object.defineProperties:function(e,t){ma(e);for(var n,r=Sa(t),i=ga(t),a=i.length,o=0;a>o;)Ea.f(e,n=i[o++],r[n]);return e};var Ta,ba=ve("document","documentElement"),Ra=fn,Ca=pa,ya=Qi,Ia=Hi,Aa=ba,wa=Ut,Oa="prototype",ka="script",Na=Ci("IE_PROTO"),Da=function(){},Pa=function(e){return"<script>"+e+"</"+ka+">"},La=function(e){e.write(Pa("")),e.close();var t=e.parentWindow.Object;return e=null,t},xa=function(){try{Ta=new ActiveXObject("htmlfile")}catch(e){}var e,t;xa="undefined"!=typeof document?document.domain&&Ta?La(Ta):((t=wa("iframe")).style.display="none",Aa.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Pa("document.F=Object")),e.close(),e.F):La(Ta);for(var n=ya.length;n--;)delete xa[Oa][ya[n]];return xa()};Ia[Na]=!0;var Ma=Object.create||function(e,t){var n;return null!==e?(Da[Oa]=Ra(e),n=new Da,Da[Oa]=null,n[Na]=e):n=xa(),void 0===t?n:Ca.f(n,t)},Ua=de,Va=wn,Fa=Error,Ba=T("".replace),ja=String(new Fa("zxcasd").stack),Ga=/\n\s*at [^:]*:[^\n]*/,Wa=Ga.test(ja),Ha=J,Ka=!f((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Ha(1,7)),7!==e.stack)})),Ya=wn,qa=Ka,za=Error.captureStackTrace,Xa={},Ja=Xa,Qa=Ct("iterator"),Za=Array.prototype,$a=function(e){return void 0!==e&&(Ja.Array===e||Za[Qa]===e)},eo=Cr,to=Ke,no=ne,ro=Xa,io=Ct("iterator"),ao=function(e){if(!no(e))return to(e,io)||to(e,"@@iterator")||ro[eo(e)]},oo=W,so=Ge,co=fn,uo=Ve,po=ao,lo=TypeError,ho=function(e,t){var n=arguments.length<2?po(e):t;if(so(n))return co(oo(n,e));throw new lo(uo(e)+" is not iterable")},fo=W,_o=fn,vo=Ke,Eo=function(e,t,n){var r,i;_o(e);try{if(!(r=vo(e,"return"))){if("throw"===t)throw n;return n}r=fo(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return _o(r),n},mo=cn,So=W,go=fn,To=Ve,bo=$a,Ro=$n,Co=b,yo=ho,Io=ao,Ao=Eo,wo=TypeError,Oo=function(e,t){this.stopped=e,this.result=t},ko=Oo.prototype,No=function(e,t,n){var r,i,a,o,s,c,u,d=n&&n.that,p=!(!n||!n.AS_ENTRIES),l=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),_=mo(t,d),v=function(e){return r&&Ao(r,"normal",e),new Oo(!0,e)},E=function(e){return p?(go(e),f?_(e[0],e[1],v):_(e[0],e[1])):f?_(e,v):_(e)};if(l)r=e.iterator;else if(h)r=e;else{if(!(i=Io(e)))throw new wo(To(e)+" is not iterable");if(bo(i)){for(a=0,o=Ro(e);o>a;a++)if((s=E(e[a]))&&Co(ko,s))return s;return new Oo(!1)}r=yo(e,i)}for(c=l?e.next:r.next;!(u=So(c,r)).done;){try{s=E(u.value)}catch(e){Ao(r,"throw",e)}if("object"==typeof s&&s&&Co(ko,s))return s}return new Oo(!1)},Do=Ar,Po=Bn,Lo=b,xo=Pi,Mo=Gi,Uo=Ma,Vo=wn,Fo=J,Bo=function(e,t){Ua(t)&&"cause"in t&&Va(e,"cause",t.cause)},jo=function(e,t,n,r){qa&&(za?za(e,t):Ya(e,"stack",function(e,t){if(Wa&&"string"==typeof e&&!Fa.prepareStackTrace)for(;t--;)e=Ba(e,Ga,"");return e}(n,r)))},Go=No,Wo=function(e,t){return void 0===e?arguments.length<2?"":t:Do(e)},Ho=Ct("toStringTag"),Ko=Error,Yo=[].push,qo=function e(t,n){var r,i=Lo(zo,this);Mo?r=Mo(new Ko,i?xo(this):zo):(r=i?this:Uo(zo),Vo(r,Ho,"Error")),void 0!==n&&Vo(r,"message",Wo(n)),jo(r,e,r.stack,1),arguments.length>2&&Bo(r,arguments[2]);var a=[];return Go(t,Yo,{that:a}),Vo(r,"errors",a),r};Mo?Mo(qo,Ko):function(e,t,n){for(var r=ca(t),i=da.f,a=ua.f,o=0;o<r.length;o++){var s=r[o];sa(e,s)||n&&sa(n,s)||i(e,s,a(t,s))}}(qo,Ko,{name:!0});var zo=qo.prototype=Uo(Ko.prototype,{constructor:Fo(1,qo),message:Fo(1,""),name:Fo(1,"AggregateError")});Po({global:!0,constructor:!0,arity:2},{AggregateError:qo});var Xo,Jo,Qo,Zo=V,$o=C.WeakMap,es=Zo($o)&&/native code/.test(String($o)),ts=C,ns=de,rs=wn,is=dt,as=nt,os=Ci,ss=Hi,cs="Object already initialized",us=ts.TypeError,ds=ts.WeakMap;if(es||as.state){var ps=as.state||(as.state=new ds);ps.get=ps.get,ps.has=ps.has,ps.set=ps.set,Xo=function(e,t){if(ps.has(e))throw new us(cs);return t.facade=e,ps.set(e,t),t},Jo=function(e){return ps.get(e)||{}},Qo=function(e){return ps.has(e)}}else{var ls=os("state");ss[ls]=!0,Xo=function(e,t){if(is(e,ls))throw new us(cs);return t.facade=e,rs(e,ls,t),t},Jo=function(e){return is(e,ls)?e[ls]:{}},Qo=function(e){return is(e,ls)}}var hs,fs,_s,vs={set:Xo,get:Jo,has:Qo,enforce:function(e){return Qo(e)?Jo(e):Xo(e,{})},getterFor:function(e){return function(t){var n;if(!ns(t)||(n=Jo(t)).type!==e)throw new us("Incompatible receiver, "+e+" required");return n}}},Es=B,ms=dt,Ss=Function.prototype,gs=Es&&Object.getOwnPropertyDescriptor,Ts=ms(Ss,"name"),bs={EXISTS:Ts,PROPER:Ts&&"something"===function(){}.name,CONFIGURABLE:Ts&&(!Es||Es&&gs(Ss,"name").configurable)},Rs=wn,Cs=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Rs(e,t,n),e},ys=f,Is=V,As=de,ws=Ma,Os=Pi,ks=Cs,Ns=Ct("iterator"),Ds=!1;[].keys&&("next"in(_s=[].keys())?(fs=Os(Os(_s)))!==Object.prototype&&(hs=fs):Ds=!0);var Ps=!As(hs)||ys((function(){var e={};return hs[Ns].call(e)!==e}));Is((hs=Ps?{}:ws(hs))[Ns])||ks(hs,Ns,(function(){return this}));var Ls={IteratorPrototype:hs,BUGGY_SAFARI_ITERATORS:Ds},xs=Cr,Ms=Er?{}.toString:function(){return"[object "+xs(this)+"]"},Us=Er,Vs=un.f,Fs=wn,Bs=dt,js=Ms,Gs=Ct("toStringTag"),Ws=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(Bs(i,Gs)||Vs(i,Gs,{configurable:!0,value:t}),r&&!Us&&Fs(i,"toString",js))},Hs=Ls.IteratorPrototype,Ks=Ma,Ys=J,qs=Ws,zs=Xa,Xs=function(){return this},Js=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Ks(Hs,{next:Ys(+!r,n)}),qs(e,i,!1,!0),zs[i]=Xs,e},Qs=Bn,Zs=W,$s=Js,ec=Pi,tc=Ws,nc=Cs,rc=Xa,ic=bs.PROPER,ac=Ls.BUGGY_SAFARI_ITERATORS,oc=Ct("iterator"),sc="keys",cc="values",uc="entries",dc=function(){return this},pc=function(e,t,n,r,i,a,o){$s(n,t,r);var s,c,u,d=function(e){if(e===i&&_)return _;if(!ac&&e&&e in h)return h[e];switch(e){case sc:case cc:case uc:return function(){return new n(this,e)}}return function(){return new n(this)}},p=t+" Iterator",l=!1,h=e.prototype,f=h[oc]||h["@@iterator"]||i&&h[i],_=!ac&&f||d(i),v="Array"===t&&h.entries||f;if(v&&(s=ec(v.call(new e)))!==Object.prototype&&s.next&&(tc(s,p,!0,!0),rc[p]=dc),ic&&i===cc&&f&&f.name!==cc&&(l=!0,_=function(){return Zs(f,this)}),i)if(c={values:d(cc),keys:a?_:d(sc),entries:d(uc)},o)for(u in c)(ac||l||!(u in h))&&nc(h,u,c[u]);else Qs({target:t,proto:!0,forced:ac||l},c);return o&&h[oc]!==_&&nc(h,oc,_,{name:i}),rc[t]=_,c},lc=function(e,t){return{value:e,done:t}},hc=ce,fc=Xa,_c=vs,vc=pc,Ec=lc,mc="Array Iterator",Sc=_c.set,gc=_c.getterFor(mc);vc(Array,"Array",(function(e,t){Sc(this,{type:mc,target:hc(e),index:0,kind:t})}),(function(){var e=gc(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Ec(void 0,!0);switch(e.kind){case"keys":return Ec(n,!1);case"values":return Ec(t[n],!1)}return Ec([n,t[n]],!1)}),"values"),fc.Arguments=fc.Array;var Tc=un,bc=function(e,t,n){return Tc.f(e,t,n)},Rc=ve,Cc=bc,yc=B,Ic=Ct("species"),Ac=b,wc=TypeError,Oc=function(e,t){if(Ac(t,e))return e;throw new wc("Incorrect invocation")},kc=V,Nc=nt,Dc=T(Function.toString);kc(Nc.inspectSource)||(Nc.inspectSource=function(e){return Dc(e)});var Pc=Nc.inspectSource,Lc=T,xc=f,Mc=V,Uc=Cr,Vc=Pc,Fc=function(){},Bc=ve("Reflect","construct"),jc=/^\s*(?:class|function)\b/,Gc=Lc(jc.exec),Wc=!jc.test(Fc),Hc=function(e){if(!Mc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},Kc=function(e){if(!Mc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Wc||!!Gc(jc,Vc(e))}catch(e){return!0}};Kc.sham=!0;var Yc,qc,zc,Xc,Jc=!Bc||xc((function(){var e;return Hc(Hc.call)||!Hc(Object)||!Hc((function(){e=!0}))||e}))?Kc:Hc,Qc=Jc,Zc=Ve,$c=TypeError,eu=fn,tu=ne,nu=Ct("species"),ru=function(e,t){var n,r=eu(e).constructor;return void 0===r||tu(n=eu(r)[nu])?t:function(e){if(Qc(e))return e;throw new $c(Zc(e)+" is not a constructor")}(n)},iu=T([].slice),au=TypeError,ou=function(e,t){if(e<t)throw new au("Not enough arguments");return e},su=/(?:ipad|iphone|ipod).*applewebkit/i.test(Se),cu=C,uu=O,du=cn,pu=V,lu=dt,hu=f,fu=ba,_u=iu,vu=Ut,Eu=ou,mu=su,Su=ni,gu=cu.setImmediate,Tu=cu.clearImmediate,bu=cu.process,Ru=cu.Dispatch,Cu=cu.Function,yu=cu.MessageChannel,Iu=cu.String,Au=0,wu={},Ou="onreadystatechange";hu((function(){Yc=cu.location}));var ku=function(e){if(lu(wu,e)){var t=wu[e];delete wu[e],t()}},Nu=function(e){return function(){ku(e)}},Du=function(e){ku(e.data)},Pu=function(e){cu.postMessage(Iu(e),Yc.protocol+"//"+Yc.host)};gu&&Tu||(gu=function(e){Eu(arguments.length,1);var t=pu(e)?e:Cu(e),n=_u(arguments,1);return wu[++Au]=function(){uu(t,void 0,n)},qc(Au),Au},Tu=function(e){delete wu[e]},Su?qc=function(e){bu.nextTick(Nu(e))}:Ru&&Ru.now?qc=function(e){Ru.now(Nu(e))}:yu&&!mu?(Xc=(zc=new yu).port2,zc.port1.onmessage=Du,qc=du(Xc.postMessage,Xc)):cu.addEventListener&&pu(cu.postMessage)&&!cu.importScripts&&Yc&&"file:"!==Yc.protocol&&!hu(Pu)?(qc=Pu,cu.addEventListener("message",Du,!1)):qc=Ou in vu("script")?function(e){fu.appendChild(vu("script"))[Ou]=function(){fu.removeChild(this),ku(e)}}:function(e){setTimeout(Nu(e),0)});var Lu={set:gu,clear:Tu},xu=C,Mu=B,Uu=Object.getOwnPropertyDescriptor,Vu=function(e){if(!Mu)return xu[e];var t=Uu(xu,e);return t&&t.value},Fu=function(){this.head=null,this.tail=null};Fu.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Bu,ju,Gu,Wu,Hu,Ku=Fu,Yu=/ipad|iphone|ipod/i.test(Se)&&"undefined"!=typeof Pebble,qu=/web0s(?!.*chrome)/i.test(Se),zu=C,Xu=Vu,Ju=cn,Qu=Lu.set,Zu=Ku,$u=su,ed=Yu,td=qu,nd=ni,rd=zu.MutationObserver||zu.WebKitMutationObserver,id=zu.document,ad=zu.process,od=zu.Promise,sd=Xu("queueMicrotask");if(!sd){var cd=new Zu,ud=function(){var e,t;for(nd&&(e=ad.domain)&&e.exit();t=cd.get();)try{t()}catch(e){throw cd.head&&Bu(),e}e&&e.enter()};$u||nd||td||!rd||!id?!ed&&od&&od.resolve?((Wu=od.resolve(void 0)).constructor=od,Hu=Ju(Wu.then,Wu),Bu=function(){Hu(ud)}):nd?Bu=function(){ad.nextTick(ud)}:(Qu=Ju(Qu,zu),Bu=function(){Qu(ud)}):(ju=!0,Gu=id.createTextNode(""),new rd(ud).observe(Gu,{characterData:!0}),Bu=function(){Gu.data=ju=!ju}),sd=function(e){cd.head||Bu(),cd.add(e)}}var dd=sd,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ld=C.Promise,hd=C,fd=ld,_d=V,vd=rn,Ed=Pc,md=Ct,Sd=ti,gd=Ie,Td=fd&&fd.prototype,bd=md("species"),Rd=!1,Cd=_d(hd.PromiseRejectionEvent),yd={CONSTRUCTOR:vd("Promise",(function(){var e=Ed(fd),t=e!==String(fd);if(!t&&66===gd)return!0;if(!Td.catch||!Td.finally)return!0;if(!gd||gd<51||!/native code/.test(e)){var n=new fd((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[bd]=r,!(Rd=n.then((function(){}))instanceof r))return!0}return!(t||"BROWSER"!==Sd&&"DENO"!==Sd||Cd)})),REJECTION_EVENT:Cd,SUBCLASSING:Rd},Id={},Ad=Ge,wd=TypeError,Od=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new wd("Bad Promise constructor");t=e,n=r})),this.resolve=Ad(t),this.reject=Ad(n)};Id.f=function(e){return new Od(e)};var kd,Nd,Dd=Bn,Pd=ni,Ld=C,xd=W,Md=Cs,Ud=Ws,Vd=Ge,Fd=V,Bd=de,jd=Oc,Gd=ru,Wd=Lu.set,Hd=dd,Kd=pd,Yd=Ku,qd=vs,zd=ld,Xd=Id,Jd="Promise",Qd=yd.CONSTRUCTOR,Zd=yd.REJECTION_EVENT,$d=qd.getterFor(Jd),ep=qd.set,tp=zd&&zd.prototype,np=zd,rp=tp,ip=Ld.TypeError,ap=Ld.document,op=Ld.process,sp=Xd.f,cp=sp,up=!!(ap&&ap.createEvent&&Ld.dispatchEvent),dp="unhandledrejection",pp=function(e){var t;return!(!Bd(e)||!Fd(t=e.then))&&t},lp=function(e,t){var n,r,i,a=t.value,o=1===t.state,s=o?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(o||(2===t.rejection&&Ep(t),t.rejection=1),!0===s?n=a:(d&&d.enter(),n=s(a),d&&(d.exit(),i=!0)),n===e.promise?u(new ip("Promise-chain cycle")):(r=pp(n))?xd(r,n,c,u):c(n)):u(a)}catch(e){d&&!i&&d.exit(),u(e)}},hp=function(e,t){e.notified||(e.notified=!0,Hd((function(){for(var n,r=e.reactions;n=r.get();)lp(n,e);e.notified=!1,t&&!e.rejection&&_p(e)})))},fp=function(e,t,n){var r,i;up?((r=ap.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ld.dispatchEvent(r)):r={promise:t,reason:n},!Zd&&(i=Ld["on"+e])?i(r):e===dp&&function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}("Unhandled promise rejection",n)},_p=function(e){xd(Wd,Ld,(function(){var t,n=e.facade,r=e.value;if(vp(e)&&(t=Kd((function(){Pd?op.emit("unhandledRejection",r,n):fp(dp,n,r)})),e.rejection=Pd||vp(e)?2:1,t.error))throw t.value}))},vp=function(e){return 1!==e.rejection&&!e.parent},Ep=function(e){xd(Wd,Ld,(function(){var t=e.facade;Pd?op.emit("rejectionHandled",t):fp("rejectionhandled",t,e.value)}))},mp=function(e,t,n){return function(r){e(t,r,n)}},Sp=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,hp(e,!0))},gp=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw new ip("Promise can't be resolved itself");var i=pp(n);i?Hd((function(){var r={done:!1};try{xd(i,n,mp(e,r,t),mp(Sp,r,t))}catch(e){Sp(r,e,t)}})):(t.value=n,t.state=1,hp(t,!1))}catch(n){Sp({done:!1},n,t)}}};Qd&&(rp=(np=function(e){jd(this,rp),Vd(e),xd(kd,this);var t=$d(this);try{e(mp(gp,t),mp(Sp,t))}catch(e){Sp(t,e)}}).prototype,(kd=function(e){ep(this,{type:Jd,done:!1,notified:!1,parent:!1,reactions:new Yd,rejection:!1,state:0,value:null})}).prototype=Md(rp,"then",(function(e,t){var n=$d(this),r=sp(Gd(this,np));return n.parent=!0,r.ok=!Fd(e)||e,r.fail=Fd(t)&&t,r.domain=Pd?op.domain:void 0,0===n.state?n.reactions.add(r):Hd((function(){lp(r,n)})),r.promise})),Nd=function(){var e=new kd,t=$d(e);this.promise=e,this.resolve=mp(gp,t),this.reject=mp(Sp,t)},Xd.f=sp=function(e){return e===np||void 0===e?new Nd(e):cp(e)}),Dd({global:!0,constructor:!0,wrap:!0,forced:Qd},{Promise:np}),Ud(np,Jd,!1,!0),function(e){var t=Rc(e);yc&&t&&!t[Ic]&&Cc(t,Ic,{configurable:!0,get:function(){return this}})}(Jd);var Tp=Ct("iterator"),bp=!1;try{var Rp=0,Cp={next:function(){return{done:!!Rp++}},return:function(){bp=!0}};Cp[Tp]=function(){return this},Array.from(Cp,(function(){throw 2}))}catch(e){}var yp=ld,Ip=yd.CONSTRUCTOR||!function(e,t){try{if(!t&&!bp)return!1}catch(e){return!1}var n=!1;try{var r={};r[Tp]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}((function(e){yp.all(e).then(void 0,(function(){}))})),Ap=W,wp=Ge,Op=Id,kp=pd,Np=No;Bn({target:"Promise",stat:!0,forced:Ip},{all:function(e){var t=this,n=Op.f(t),r=n.resolve,i=n.reject,a=kp((function(){var n=wp(t.resolve),a=[],o=0,s=1;Np(e,(function(e){var c=o++,u=!1;s++,Ap(n,t,e).then((function(e){u||(u=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Dp=Bn,Pp=yd.CONSTRUCTOR;ld&&ld.prototype,Dp({target:"Promise",proto:!0,forced:Pp,real:!0},{catch:function(e){return this.then(void 0,e)}});var Lp=W,xp=Ge,Mp=Id,Up=pd,Vp=No;Bn({target:"Promise",stat:!0,forced:Ip},{race:function(e){var t=this,n=Mp.f(t),r=n.reject,i=Up((function(){var i=xp(t.resolve);Vp(e,(function(e){Lp(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Fp=Id;Bn({target:"Promise",stat:!0,forced:yd.CONSTRUCTOR},{reject:function(e){var t=Fp.f(this);return(0,t.reject)(e),t.promise}});var Bp=fn,jp=de,Gp=Id,Wp=function(e,t){if(Bp(e),jp(t)&&t.constructor===e)return t;var n=Gp.f(e);return(0,n.resolve)(t),n.promise},Hp=Bn,Kp=ld,Yp=yd.CONSTRUCTOR,qp=Wp,zp=ve("Promise"),Xp=!Yp;Hp({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return qp(Xp&&this===zp?Kp:this,e)}});var Jp=W,Qp=Ge,Zp=Id,$p=pd,el=No;Bn({target:"Promise",stat:!0,forced:Ip},{allSettled:function(e){var t=this,n=Zp.f(t),r=n.resolve,i=n.reject,a=$p((function(){var n=Qp(t.resolve),i=[],a=0,o=1;el(e,(function(e){var s=a++,c=!1;o++,Jp(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--o||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--o||r(i))}))})),--o||r(i)}));return a.error&&i(a.value),n.promise}});var tl=W,nl=Ge,rl=ve,il=Id,al=pd,ol=No,sl="No one promise resolved";Bn({target:"Promise",stat:!0,forced:Ip},{any:function(e){var t=this,n=rl("AggregateError"),r=il.f(t),i=r.resolve,a=r.reject,o=al((function(){var r=nl(t.resolve),o=[],s=0,c=1,u=!1;ol(e,(function(e){var d=s++,p=!1;c++,tl(r,t,e).then((function(e){p||u||(u=!0,i(e))}),(function(e){p||u||(p=!0,o[d]=e,--c||a(new n(o,sl)))}))})),--c||a(new n(o,sl))}));return o.error&&a(o.value),r.promise}});var cl=Bn,ul=O,dl=iu,pl=Id,ll=Ge,hl=pd,fl=C.Promise,_l=!1;cl({target:"Promise",stat:!0,forced:!fl||!fl.try||hl((function(){fl.try((function(e){_l=8===e}),8)})).error||!_l},{try:function(e){var t=arguments.length>1?dl(arguments,1):[],n=pl.f(this),r=hl((function(){return ul(ll(e),void 0,t)}));return(r.error?n.reject:n.resolve)(r.value),n.promise}});var vl=Id;Bn({target:"Promise",stat:!0},{withResolvers:function(){var e=vl.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var El=Bn,ml=ld,Sl=f,gl=ve,Tl=V,bl=ru,Rl=Wp,Cl=ml&&ml.prototype;El({target:"Promise",proto:!0,real:!0,forced:!!ml&&Sl((function(){Cl.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=bl(this,gl("Promise")),n=Tl(e);return this.then(n?function(n){return Rl(t,e()).then((function(){return n}))}:e,n?function(n){return Rl(t,e()).then((function(){throw n}))}:e)}});var yl=T,Il=Hn,Al=Ar,wl=ae,Ol=yl("".charAt),kl=yl("".charCodeAt),Nl=yl("".slice),Dl=function(e){return function(t,n){var r,i,a=Al(wl(t)),o=Il(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=kl(a,o))<55296||r>56319||o+1===s||(i=kl(a,o+1))<56320||i>57343?e?Ol(a,o):r:e?Nl(a,o,o+2):i-56320+(r-55296<<10)+65536}},Pl={codeAt:Dl(!1),charAt:Dl(!0)},Ll=Pl.charAt,xl=Ar,Ml=vs,Ul=pc,Vl=lc,Fl="String Iterator",Bl=Ml.set,jl=Ml.getterFor(Fl);Ul(String,"String",(function(e){Bl(this,{type:Fl,string:xl(e),index:0})}),(function(){var e,t=jl(this),n=t.string,r=t.index;return r>=n.length?Vl(void 0,!0):(e=Ll(n,r),t.index+=e.length,Vl(e,!1))}));var Gl=pe.Promise,Wl=C,Hl=Ws,Kl=Xa;for(var Yl in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})Hl(Wl[Yl],Yl),Kl[Yl]=Kl.Array;var ql=Gl,zl=d(ql),Xl=cr("Array","values"),Jl=Cr,Ql=dt,Zl=b,$l=Xl,eh=Array.prototype,th={DOMTokenList:!0,NodeList:!0},nh=d((function(e){var t=e.values;return e===eh||Zl(eh,e)&&t===eh.values||Ql(th,Jl(e))?$l:t})),rh=Ve,ih=TypeError,ah=iu,oh=Math.floor,sh=function e(t,n){var r=t.length;if(r<8)for(var i,a,o=1;o<r;){for(a=o,i=t[o];a&&n(t[a-1],i)>0;)t[a]=t[--a];a!==o++&&(t[a]=i)}else for(var s=oh(r/2),c=e(ah(t,0,s),n),u=e(ah(t,s),n),d=c.length,p=u.length,l=0,h=0;l<d||h<p;)t[l+h]=l<d&&h<p?n(c[l],u[h])<=0?c[l++]:u[h++]:l<d?c[l++]:u[h++];return t},ch=Se.match(/firefox\/(\d+)/i),uh=!!ch&&+ch[1],dh=/MSIE|Trident/.test(Se),ph=Se.match(/AppleWebKit\/(\d+)\./),lh=!!ph&&+ph[1],hh=Bn,fh=T,_h=Ge,vh=st,Eh=$n,mh=function(e,t){if(!delete e[t])throw new ih("Cannot delete property "+rh(t)+" of "+rh(e))},Sh=Ar,gh=f,Th=sh,bh=Jr,Rh=uh,Ch=dh,yh=Ie,Ih=lh,Ah=[],wh=fh(Ah.sort),Oh=fh(Ah.push),kh=gh((function(){Ah.sort(void 0)})),Nh=gh((function(){Ah.sort(null)})),Dh=bh("sort"),Ph=!gh((function(){if(yh)return yh<70;if(!(Rh&&Rh>3)){if(Ch)return!0;if(Ih)return Ih<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Ah.push({k:t+r,v:n})}for(Ah.sort((function(e,t){return t.v-e.v})),r=0;r<Ah.length;r++)t=Ah[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));hh({target:"Array",proto:!0,forced:kh||!Nh||!Dh||!Ph},{sort:function(e){void 0!==e&&_h(e);var t=vh(this);if(Ph)return void 0===e?wh(t):wh(t,e);var n,r,i=[],a=Eh(t);for(r=0;r<a;r++)r in t&&Oh(i,t[r]);for(Th(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Sh(t)>Sh(n)?1:-1}}(e)),n=Eh(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)mh(t,r++);return t}});var Lh=cr("Array","sort"),xh=b,Mh=Lh,Uh=Array.prototype,Vh=d((function(e){var t=e.sort;return e===Uh||xh(Uh,e)&&t===Uh.sort?Mh:t})),Fh=Bn,Bh=T,jh=zn,Gh=RangeError,Wh=String.fromCharCode,Hh=String.fromCodePoint,Kh=Bh([].join);Fh({target:"String",stat:!0,arity:1,forced:!!Hh&&1!==Hh.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],jh(t,1114111)!==t)throw new Gh(t+" is not a valid code point");n[i]=t<65536?Wh(t):Wh(55296+((t-=65536)>>10),t%1024+56320)}return Kh(n,"")}});var Yh=f,qh=Ct("iterator"),zh=!Yh((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[qh]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://тест").host||"#%D0%B1"!==new URL("https://a#б").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host})),Xh=Cs,Jh=Bn,Qh=C,Zh=Vu,$h=ve,ef=W,tf=T,nf=B,rf=zh,af=Cs,of=bc,sf=Ws,cf=Js,uf=vs,df=Oc,pf=V,lf=dt,hf=cn,ff=Cr,_f=fn,vf=de,Ef=Ar,mf=Ma,Sf=J,gf=ho,Tf=ao,bf=lc,Rf=ou,Cf=sh,yf=Ct("iterator"),If="URLSearchParams",Af=If+"Iterator",wf=uf.set,Of=uf.getterFor(If),kf=uf.getterFor(Af),Nf=Zh("fetch"),Df=Zh("Request"),Pf=Zh("Headers"),Lf=Df&&Df.prototype,xf=Pf&&Pf.prototype,Mf=Qh.TypeError,Uf=Qh.encodeURIComponent,Vf=String.fromCharCode,Ff=$h("String","fromCodePoint"),Bf=parseInt,jf=tf("".charAt),Gf=tf([].join),Wf=tf([].push),Hf=tf("".replace),Kf=tf([].shift),Yf=tf([].splice),qf=tf("".split),zf=tf("".slice),Xf=tf(/./.exec),Jf=/\+/g,Qf=/^[0-9a-f]+$/i,Zf=function(e,t){var n=zf(e,t,t+2);return Xf(Qf,n)?Bf(n,16):NaN},$f=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},e_=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},t_=function(e){for(var t=(e=Hf(e,Jf," ")).length,n="",r=0;r<t;){var i=jf(e,r);if("%"===i){if("%"===jf(e,r+1)||r+3>t){n+="%",r++;continue}var a=Zf(e,r+1);if(a!=a){n+=i,r++;continue}r+=2;var o=$f(a);if(0===o)i=Vf(a);else{if(1===o||o>4){n+="�",r++;continue}for(var s=[a],c=1;c<o&&!(3+ ++r>t||"%"!==jf(e,r));){var u=Zf(e,r+1);if(u!=u){r+=3;break}if(u>191||u<128)break;Wf(s,u),r+=2,c++}if(s.length!==o){n+="�";continue}var d=e_(s);null===d?n+="�":i=Ff(d)}}n+=i,r++}return n},n_=/[!'()~]|%20/g,r_={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},i_=function(e){return r_[e]},a_=function(e){return Hf(Uf(e),n_,i_)},o_=cf((function(e,t){wf(this,{type:Af,target:Of(e).entries,index:0,kind:t})}),If,(function(){var e=kf(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,bf(void 0,!0);var r=t[n];switch(e.kind){case"keys":return bf(r.key,!1);case"values":return bf(r.value,!1)}return bf([r.key,r.value],!1)}),!0),s_=function(e){this.entries=[],this.url=null,void 0!==e&&(vf(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===jf(e,0)?zf(e,1):e:Ef(e)))};s_.prototype={type:If,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,c=this.entries,u=Tf(e);if(u)for(n=(t=gf(e,u)).next;!(r=ef(n,t)).done;){if(a=(i=gf(_f(r.value))).next,(o=ef(a,i)).done||(s=ef(a,i)).done||!ef(a,i).done)throw new Mf("Expected sequence with length 2");Wf(c,{key:Ef(o.value),value:Ef(s.value)})}else for(var d in e)lf(e,d)&&Wf(c,{key:d,value:Ef(e[d])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=qf(e,"&"),a=0;a<i.length;)(t=i[a++]).length&&(n=qf(t,"="),Wf(r,{key:t_(Kf(n)),value:t_(Gf(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Wf(n,a_(e.key)+"="+a_(e.value));return Gf(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var c_=function(){df(this,u_);var e=wf(this,new s_(arguments.length>0?arguments[0]:void 0));nf||(this.size=e.entries.length)},u_=c_.prototype;if(function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:Xh(e,r,t[r],n)}(u_,{append:function(e,t){var n=Of(this);Rf(arguments.length,2),Wf(n.entries,{key:Ef(e),value:Ef(t)}),nf||this.length++,n.updateURL()},delete:function(e){for(var t=Of(this),n=Rf(arguments.length,1),r=t.entries,i=Ef(e),a=n<2?void 0:arguments[1],o=void 0===a?a:Ef(a),s=0;s<r.length;){var c=r[s];if(c.key!==i||void 0!==o&&c.value!==o)s++;else if(Yf(r,s,1),void 0!==o)break}nf||(this.size=r.length),t.updateURL()},get:function(e){var t=Of(this).entries;Rf(arguments.length,1);for(var n=Ef(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Of(this).entries;Rf(arguments.length,1);for(var n=Ef(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Wf(r,t[i].value);return r},has:function(e){for(var t=Of(this).entries,n=Rf(arguments.length,1),r=Ef(e),i=n<2?void 0:arguments[1],a=void 0===i?i:Ef(i),o=0;o<t.length;){var s=t[o++];if(s.key===r&&(void 0===a||s.value===a))return!0}return!1},set:function(e,t){var n=Of(this);Rf(arguments.length,1);for(var r,i=n.entries,a=!1,o=Ef(e),s=Ef(t),c=0;c<i.length;c++)(r=i[c]).key===o&&(a?Yf(i,c--,1):(a=!0,r.value=s));a||Wf(i,{key:o,value:s}),nf||(this.size=i.length),n.updateURL()},sort:function(){var e=Of(this);Cf(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Of(this).entries,r=hf(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new o_(this,"keys")},values:function(){return new o_(this,"values")},entries:function(){return new o_(this,"entries")}},{enumerable:!0}),af(u_,yf,u_.entries,{name:"entries"}),af(u_,"toString",(function(){return Of(this).serialize()}),{enumerable:!0}),nf&&of(u_,"size",{get:function(){return Of(this).entries.length},configurable:!0,enumerable:!0}),sf(c_,If),Jh({global:!0,constructor:!0,forced:!rf},{URLSearchParams:c_}),!rf&&pf(Pf)){var d_=tf(xf.has),p_=tf(xf.set),l_=function(e){if(vf(e)){var t,n=e.body;if(ff(n)===If)return t=e.headers?new Pf(e.headers):new Pf,d_(t,"content-type")||p_(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),mf(e,{body:Sf(0,Ef(n)),headers:Sf(0,t)})}return e};if(pf(Nf)&&Jh({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Nf(e,arguments.length>1?l_(arguments[1]):{})}}),pf(Df)){var h_=function(e){return df(this,Lf),new Df(e,arguments.length>1?l_(arguments[1]):{})};Lf.constructor=h_,h_.prototype=Lf,Jh({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:h_})}}var f_,__={URLSearchParams:c_,getState:Of},v_=pe.URLSearchParams,E_=B,m_=T,S_=W,g_=f,T_=fa,b_=ea,R_=H,C_=st,y_=te,I_=Object.assign,A_=Object.defineProperty,w_=m_([].concat),O_=!I_||g_((function(){if(E_&&1!==I_({b:1},I_(A_({},"a",{enumerable:!0,get:function(){A_(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!==I_({},e)[n]||T_(I_({},t)).join("")!==r}))?function(e,t){for(var n=C_(e),r=arguments.length,i=1,a=b_.f,o=R_.f;r>i;)for(var s,c=y_(arguments[i++]),u=a?w_(T_(c),a(c)):T_(c),d=u.length,p=0;d>p;)s=u[p++],E_&&!S_(o,c,s)||(n[s]=c[s]);return n}:I_,k_=fn,N_=Eo,D_=B,P_=un,L_=J,x_=function(e,t,n){D_?P_.f(e,t,L_(0,n)):e[t]=n},M_=cn,U_=W,V_=st,F_=function(e,t,n,r){try{return r?t(k_(n)[0],n[1]):t(n)}catch(t){N_(e,"throw",t)}},B_=$a,j_=Jc,G_=$n,W_=x_,H_=ho,K_=ao,Y_=Array,q_=T,z_=2147483647,X_=/[^\0-\u007E]/,J_=/[.\u3002\uFF0E\uFF61]/g,Q_="Overflow: input needs wider integers to process",Z_=RangeError,$_=q_(J_.exec),ev=Math.floor,tv=String.fromCharCode,nv=q_("".charCodeAt),rv=q_([].join),iv=q_([].push),av=q_("".replace),ov=q_("".split),sv=q_("".toLowerCase),cv=function(e){return e+22+75*(e<26)},uv=function(e,t,n){var r=0;for(e=n?ev(e/700):e>>1,e+=ev(e/t);e>455;)e=ev(e/35),r+=36;return ev(r+36*e/(e+38))},dv=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=nv(e,n++);if(i>=55296&&i<=56319&&n<r){var a=nv(e,n++);56320==(64512&a)?iv(t,((1023&i)<<10)+(1023&a)+65536):(iv(t,i),n--)}else iv(t,i)}return t}(e)).length,a=128,o=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&iv(r,tv(n));var c=r.length,u=c;for(c&&iv(r,"-");u<i;){var d=z_;for(t=0;t<e.length;t++)(n=e[t])>=a&&n<d&&(d=n);var p=u+1;if(d-a>ev((z_-o)/p))throw new Z_(Q_);for(o+=(d-a)*p,a=d,t=0;t<e.length;t++){if((n=e[t])<a&&++o>z_)throw new Z_(Q_);if(n===a){for(var l=o,h=36;;){var f=h<=s?1:h>=s+26?26:h-s;if(l<f)break;var _=l-f,v=36-f;iv(r,tv(cv(f+_%v))),l=ev(_/v),h+=36}iv(r,tv(cv(l))),s=uv(o,p,u===c),o=0,u++}}o++,a++}return rv(r,"")},pv=Bn,lv=B,hv=zh,fv=C,_v=cn,vv=T,Ev=Cs,mv=bc,Sv=Oc,gv=dt,Tv=O_,bv=function(e){var t=V_(e),n=j_(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=M_(i,r>2?arguments[2]:void 0));var o,s,c,u,d,p,l=K_(t),h=0;if(!l||this===Y_&&B_(l))for(o=G_(t),s=n?new this(o):Y_(o);o>h;h++)p=a?i(t[h],h):t[h],W_(s,h,p);else for(s=n?new this:[],d=(u=H_(t,l)).next;!(c=U_(d,u)).done;h++)p=a?F_(u,i,[c.value,h],!0):c.value,W_(s,h,p);return s.length=h,s},Rv=iu,Cv=Pl.codeAt,yv=Ar,Iv=Ws,Av=ou,wv=__,Ov=vs,kv=Ov.set,Nv=Ov.getterFor("URL"),Dv=wv.URLSearchParams,Pv=wv.getState,Lv=fv.URL,xv=fv.TypeError,Mv=fv.parseInt,Uv=Math.floor,Vv=Math.pow,Fv=vv("".charAt),Bv=vv(/./.exec),jv=vv([].join),Gv=vv(1..toString),Wv=vv([].pop),Hv=vv([].push),Kv=vv("".replace),Yv=vv([].shift),qv=vv("".split),zv=vv("".slice),Xv=vv("".toLowerCase),Jv=vv([].unshift),Qv="Invalid scheme",Zv="Invalid host",$v="Invalid port",eE=/[a-z]/i,tE=/[\d+-.a-z]/i,nE=/\d/,rE=/^0x/i,iE=/^[0-7]+$/,aE=/^\d+$/,oE=/^[\da-f]+$/i,sE=/[\0\t\n\r #%/:<>?@[\\\]^|]/,cE=/[\0\t\n\r #/:<>?@[\\\]^|]/,uE=/^[\u0000-\u0020]+/,dE=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,pE=/[\t\n\r]/g,lE=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)Jv(t,e%256),e=Uv(e/256);return jv(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n?r:t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=Gv(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},hE={},fE=Tv({},hE,{" ":1,'"':1,"<":1,">":1,"`":1}),_E=Tv({},fE,{"#":1,"?":1,"{":1,"}":1}),vE=Tv({},_E,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),EE=function(e,t){var n=Cv(e,0);return n>32&&n<127&&!gv(t,e)?e:encodeURIComponent(e)},mE={ftp:21,file:null,http:80,https:443,ws:80,wss:443},SE=function(e,t){var n;return 2===e.length&&Bv(eE,Fv(e,0))&&(":"===(n=Fv(e,1))||!t&&"|"===n)},gE=function(e){var t;return e.length>1&&SE(zv(e,0,2))&&(2===e.length||"/"===(t=Fv(e,2))||"\\"===t||"?"===t||"#"===t)},TE=function(e){return"."===e||"%2e"===Xv(e)},bE={},RE={},CE={},yE={},IE={},AE={},wE={},OE={},kE={},NE={},DE={},PE={},LE={},xE={},ME={},UE={},VE={},FE={},BE={},jE={},GE={},WE=function e(t,n,r){var i,a,o,s=yv(t);if(n){if(a=this.parse(s))throw new xv(a);this.searchParams=null}else{if(void 0!==r&&(i=new e(r,!0)),a=this.parse(s,null,i))throw new xv(a);(o=Pv(new Dv)).bindURL(this),this.searchParams=o}};WE.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,c=this,u=t||bE,d=0,p="",l=!1,h=!1,f=!1;for(e=yv(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Kv(e,uE,""),e=Kv(e,dE,"$1")),e=Kv(e,pE,""),r=bv(e);d<=r.length;){switch(i=r[d],u){case bE:if(!i||!Bv(eE,i)){if(t)return Qv;u=CE;continue}p+=Xv(i),u=RE;break;case RE:if(i&&(Bv(tE,i)||"+"===i||"-"===i||"."===i))p+=Xv(i);else{if(":"!==i){if(t)return Qv;p="",u=CE,d=0;continue}if(t&&(c.isSpecial()!==gv(mE,p)||"file"===p&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=p,t)return void(c.isSpecial()&&mE[c.scheme]===c.port&&(c.port=null));p="","file"===c.scheme?u=xE:c.isSpecial()&&n&&n.scheme===c.scheme?u=yE:c.isSpecial()?u=OE:"/"===r[d+1]?(u=IE,d++):(c.cannotBeABaseURL=!0,Hv(c.path,""),u=BE)}break;case CE:if(!n||n.cannotBeABaseURL&&"#"!==i)return Qv;if(n.cannotBeABaseURL&&"#"===i){c.scheme=n.scheme,c.path=Rv(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=GE;break}u="file"===n.scheme?xE:AE;continue;case yE:if("/"!==i||"/"!==r[d+1]){u=AE;continue}u=kE,d++;break;case IE:if("/"===i){u=NE;break}u=FE;continue;case AE:if(c.scheme=n.scheme,i===f_)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Rv(n.path),c.query=n.query;else if("/"===i||"\\"===i&&c.isSpecial())u=wE;else if("?"===i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Rv(n.path),c.query="",u=jE;else{if("#"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Rv(n.path),c.path.length--,u=FE;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Rv(n.path),c.query=n.query,c.fragment="",u=GE}break;case wE:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=FE;continue}u=NE}else u=kE;break;case OE:if(u=kE,"/"!==i||"/"!==Fv(p,d+1))continue;d++;break;case kE:if("/"!==i&&"\\"!==i){u=NE;continue}break;case NE:if("@"===i){l&&(p="%40"+p),l=!0,a=bv(p);for(var _=0;_<a.length;_++){var v=a[_];if(":"!==v||f){var E=EE(v,vE);f?c.password+=E:c.username+=E}else f=!0}p=""}else if(i===f_||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(l&&""===p)return"Invalid authority";d-=bv(p).length+1,p="",u=DE}else p+=i;break;case DE:case PE:if(t&&"file"===c.scheme){u=UE;continue}if(":"!==i||h){if(i===f_||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===p)return Zv;if(t&&""===p&&(c.includesCredentials()||null!==c.port))return;if(o=c.parseHost(p))return o;if(p="",u=VE,t)return;continue}"["===i?h=!0:"]"===i&&(h=!1),p+=i}else{if(""===p)return Zv;if(o=c.parseHost(p))return o;if(p="",u=LE,t===PE)return}break;case LE:if(!Bv(nE,i)){if(i===f_||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==p){var m=Mv(p,10);if(m>65535)return $v;c.port=c.isSpecial()&&m===mE[c.scheme]?null:m,p=""}if(t)return;u=VE;continue}return $v}p+=i;break;case xE:if(c.scheme="file","/"===i||"\\"===i)u=ME;else{if(!n||"file"!==n.scheme){u=FE;continue}switch(i){case f_:c.host=n.host,c.path=Rv(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=Rv(n.path),c.query="",u=jE;break;case"#":c.host=n.host,c.path=Rv(n.path),c.query=n.query,c.fragment="",u=GE;break;default:gE(jv(Rv(r,d),""))||(c.host=n.host,c.path=Rv(n.path),c.shortenPath()),u=FE;continue}}break;case ME:if("/"===i||"\\"===i){u=UE;break}n&&"file"===n.scheme&&!gE(jv(Rv(r,d),""))&&(SE(n.path[0],!0)?Hv(c.path,n.path[0]):c.host=n.host),u=FE;continue;case UE:if(i===f_||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&SE(p))u=FE;else if(""===p){if(c.host="",t)return;u=VE}else{if(o=c.parseHost(p))return o;if("localhost"===c.host&&(c.host=""),t)return;p="",u=VE}continue}p+=i;break;case VE:if(c.isSpecial()){if(u=FE,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==f_&&(u=FE,"/"!==i))continue}else c.fragment="",u=GE;else c.query="",u=jE;break;case FE:if(i===f_||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=Xv(s=p))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||Hv(c.path,"")):TE(p)?"/"===i||"\\"===i&&c.isSpecial()||Hv(c.path,""):("file"===c.scheme&&!c.path.length&&SE(p)&&(c.host&&(c.host=""),p=Fv(p,0)+":"),Hv(c.path,p)),p="","file"===c.scheme&&(i===f_||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)Yv(c.path);"?"===i?(c.query="",u=jE):"#"===i&&(c.fragment="",u=GE)}else p+=EE(i,_E);break;case BE:"?"===i?(c.query="",u=jE):"#"===i?(c.fragment="",u=GE):i!==f_&&(c.path[0]+=EE(i,hE));break;case jE:t||"#"!==i?i!==f_&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":EE(i,hE)):(c.fragment="",u=GE);break;case GE:i!==f_&&(c.fragment+=EE(i,fE))}d++}},parseHost:function(e){var t,n,r;if("["===Fv(e,0)){if("]"!==Fv(e,e.length-1))return Zv;if(!(t=function(e){var t,n,r,i,a,o,s,c=[0,0,0,0,0,0,0,0],u=0,d=null,p=0,l=function(){return Fv(e,p)};if(":"===l()){if(":"!==Fv(e,1))return;p+=2,d=++u}for(;l();){if(8===u)return;if(":"!==l()){for(t=n=0;n<4&&Bv(oE,l());)t=16*t+Mv(l(),16),p++,n++;if("."===l()){if(0===n)return;if(p-=n,u>6)return;for(r=0;l();){if(i=null,r>0){if(!("."===l()&&r<4))return;p++}if(!Bv(nE,l()))return;for(;Bv(nE,l());){if(a=Mv(l(),10),null===i)i=a;else{if(0===i)return;i=10*i+a}if(i>255)return;p++}c[u]=256*c[u]+i,2!=++r&&4!==r||u++}if(4!==r)return;break}if(":"===l()){if(p++,!l())return}else if(l())return;c[u++]=t}else{if(null!==d)return;p++,d=++u}}if(null!==d)for(o=u-d,u=7;0!==u&&o>0;)s=c[u],c[u--]=c[d+o-1],c[d+--o]=s;else if(8!==u)return;return c}(zv(e,1,-1))))return Zv;this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=ov(av(sv(e),J_,"."),".");for(t=0;t<i.length;t++)n=i[t],iv(r,$_(X_,n)?"xn--"+dv(n):n);return rv(r,".")}(e),Bv(sE,e))return Zv;if(null===(t=function(e){var t,n,r,i,a,o,s,c=qv(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=c[r]))return e;if(a=10,i.length>1&&"0"===Fv(i,0)&&(a=Bv(rE,i)?16:8,i=zv(i,8===a?1:2)),""===i)o=0;else{if(!Bv(10===a?aE:8===a?iE:oE,i))return e;o=Mv(i,a)}Hv(n,o)}for(r=0;r<t;r++)if(o=n[r],r===t-1){if(o>=Vv(256,5-t))return null}else if(o>255)return null;for(s=Wv(n),r=0;r<n.length;r++)s+=n[r]*Vv(256,3-r);return s}(e)))return Zv;this.host=t}else{if(Bv(cE,e))return Zv;for(t="",n=bv(e),r=0;r<n.length;r++)t+=EE(n[r],hE);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return gv(mE,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&SE(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=lE(i),null!==a&&(u+=":"+a)):"file"===t&&(u+="//"),u+=e.cannotBeABaseURL?o[0]:o.length?"/"+jv(o,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw new xv(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new HE(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+lE(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(yv(e)+":",bE)},getUsername:function(){return this.username},setUsername:function(e){var t=bv(yv(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=EE(t[n],vE)}},getPassword:function(){return this.password},setPassword:function(e){var t=bv(yv(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=EE(t[n],vE)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?lE(e):lE(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,DE)},getHostname:function(){var e=this.host;return null===e?"":lE(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,PE)},getPort:function(){var e=this.port;return null===e?"":yv(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=yv(e))?this.port=null:this.parse(e,LE))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+jv(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,VE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=yv(e))?this.query=null:("?"===Fv(e,0)&&(e=zv(e,1)),this.query="",this.parse(e,jE)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=yv(e))?("#"===Fv(e,0)&&(e=zv(e,1)),this.fragment="",this.parse(e,GE)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var HE=function(e){var t=Sv(this,KE),n=Av(arguments.length,1)>1?arguments[1]:void 0,r=kv(t,new WE(e,!1,n));lv||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},KE=HE.prototype,YE=function(e,t){return{get:function(){return Nv(this)[e]()},set:t&&function(e){return Nv(this)[t](e)},configurable:!0,enumerable:!0}};if(lv&&(mv(KE,"href",YE("serialize","setHref")),mv(KE,"origin",YE("getOrigin")),mv(KE,"protocol",YE("getProtocol","setProtocol")),mv(KE,"username",YE("getUsername","setUsername")),mv(KE,"password",YE("getPassword","setPassword")),mv(KE,"host",YE("getHost","setHost")),mv(KE,"hostname",YE("getHostname","setHostname")),mv(KE,"port",YE("getPort","setPort")),mv(KE,"pathname",YE("getPathname","setPathname")),mv(KE,"search",YE("getSearch","setSearch")),mv(KE,"searchParams",YE("getSearchParams")),mv(KE,"hash",YE("getHash","setHash"))),Ev(KE,"toJSON",(function(){return Nv(this).serialize()}),{enumerable:!0}),Ev(KE,"toString",(function(){return Nv(this).serialize()}),{enumerable:!0}),Lv){var qE=Lv.createObjectURL,zE=Lv.revokeObjectURL;qE&&Ev(HE,"createObjectURL",_v(qE,Lv)),zE&&Ev(HE,"revokeObjectURL",_v(zE,Lv))}Iv(HE,"URL"),pv({global:!0,constructor:!0,forced:!hv,sham:!lv},{URL:HE});var XE=Bn,JE=f,QE=ou,ZE=Ar,$E=zh,em=ve("URL"),tm=$E&&JE((function(){em.canParse()})),nm=JE((function(){return 1!==em.canParse.length}));XE({target:"URL",stat:!0,forced:!tm||nm},{canParse:function(e){var t=QE(arguments.length,1),n=ZE(e),r=t<2||void 0===arguments[1]?void 0:ZE(arguments[1]);try{return!!new em(n,r)}catch(e){return!1}}});var rm=Bn,im=ou,am=Ar,om=zh,sm=ve("URL");rm({target:"URL",stat:!0,forced:!om},{parse:function(e){var t=im(arguments.length,1),n=am(e),r=t<2||void 0===arguments[1]?void 0:am(arguments[1]);try{return new sm(n,r)}catch(e){return null}}});var cm=d(pe.URL),um=!0,dm=!0;function pm(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function lm(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function hm(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(um=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function fm(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(dm=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function _m(){if("object"==typeof window){if(um)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function vm(e,t){dm&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Em(e){return"[object Object]"===Object.prototype.toString.call(e)}function mm(e){var t;return Em(e)?ui(t=Object.keys(e)).call(t,(function(t,n){var r,i=Em(e[n]),a=i?mm(e[n]):e[n],o=i&&!Object.keys(a).length;return void 0===a||o?t:Object.assign(t,((r={})[n]=a,r))}),{}):e}function Sm(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?Sm(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){Sm(e,e.get(t),n)}))})))}function gm(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&Sm(e,n,i)}))})),i}var Tm=_m;function bm(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),(a={})[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var s,c=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s))return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){var n;return Br(n=e.label.toLowerCase()).call(n,t)}))}));return!n&&t.length&&Br(s).call(s,"back")&&(n=t[t.length-1]),n&&(e.video.deviceId=o.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),Tm("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return Tm("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return o(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return zl.reject(a(e))}))}))}}}}function Rm(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Cm(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else lm(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function ym(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Im(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=arguments[0],r=arguments[1],i=arguments[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var s=function(e){r(o(a(e)))};return t.apply(this,[s,n])}return new zl((function(n,r){t.apply(e,[function(e){n(o(a(e)))},r])})).then(r,i)}}}function Am(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return gm(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),lm(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return gm(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(n?r=!0:n=e),e.track===a})),r||t&&n?zl.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():zl.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function wm(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}function Om(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return wm(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(e){return e.track===t}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[n.id];if(o)o.addTrack(t),zl.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n,r=e.RTCPeerConnection.prototype[t],i=((n={})[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(n){var r=s(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))},n);e.RTCPeerConnection.prototype[t]=i[t]}));var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function km(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n,r=e.RTCPeerConnection.prototype[t],i=((n={})[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)},n);e.RTCPeerConnection.prototype[t]=i[t]}))}function Nm(e,t){lm(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Dm=Object.freeze({__proto__:null,fixNegotiationNeeded:Nm,shimAddTrackRemoveTrack:Om,shimAddTrackRemoveTrackWithNative:wm,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:ym,shimGetStats:Im,shimGetUserMedia:bm,shimMediaStream:Rm,shimOnTrack:Cm,shimPeerConnection:km,shimSenderReceiverGetStats:Am});function Pm(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){vm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},r&&r.prototype.getSettings){var o=r.prototype.getSettings;r.prototype.getSettings=function(){var e=o.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function Lm(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function xm(e,t){if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n,r=e.RTCPeerConnection.prototype[t],i=((n={})[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)},n);e.RTCPeerConnection.prototype[t]=i[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=arguments[0],i=arguments[1],a=arguments[2];return r.apply(this,[e||null]).then((function(e){if(t.version<53&&!i)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,a)}}}function Mm(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):zl.resolve(new Map)}}}function Um(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),lm(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Vm(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;vm("removeStream","removeTrack"),this.getSenders().forEach((function(n){var r;n.track&&Br(r=e.getTracks()).call(r,n.track)&&t.removeTrack(n)}))})}function Fm(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Bm(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=[].concat(e)).length>0;n&&e.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,a=i.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(a).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}}function jm(e){if("object"==typeof e&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function Gm(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?zl.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function Wm(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?zl.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}var Hm=Object.freeze({__proto__:null,shimAddTransceiver:Bm,shimCreateAnswer:Wm,shimCreateOffer:Gm,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,zl.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:jm,shimGetUserMedia:Pm,shimOnTrack:Lm,shimPeerConnection:xm,shimRTCDataChannel:Fm,shimReceiverGetStats:Um,shimRemoveStream:Vm,shimSenderGetStats:Mm});function Km(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n,r=this;this._localStreams||(this._localStreams=[]),Br(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){var t;n._localStreams?Br(t=n._localStreams).call(t,e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){Br(r).call(r,e.track)&&t.removeTrack(e)}))}})}}function Ym(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){var n;if(t._remoteStreams||(t._remoteStreams=[]),!Br(n=t._remoteStreams).call(n,e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function qm(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),zl.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),zl.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),zl.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),zl.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),zl.resolve()):r},t.addIceCandidate=s}}function zm(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(Xm(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function Xm(e){return e&&void 0!==e.video?Object.assign({},e,{video:mm(e.video)}):e}function Jm(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(vm("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function Qm(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Zm(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $m(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var eS=Object.freeze({__proto__:null,shimAudioContext:$m,shimCallbacksAPI:qm,shimConstraints:Xm,shimCreateOfferLegacy:Zm,shimGetUserMedia:zm,shimLocalStreamsAPI:Km,shimRTCIceServerUrls:Jm,shimRemoteStreamsAPI:Ym,shimTrackEventTransceiver:Qm}),tS="\t\n\v\f\r                　\u2028\u2029\ufeff",nS=ae,rS=Ar,iS=tS,aS=T("".replace),oS=RegExp("^["+iS+"]+"),sS=RegExp("(^|[^"+iS+"])["+iS+"]+$"),cS=function(e){return function(t){var n=rS(nS(t));return 1&e&&(n=aS(n,oS,"")),2&e&&(n=aS(n,sS,"$1")),n}},uS={start:cS(1),end:cS(2),trim:cS(3)},dS=bs.PROPER,pS=f,lS=tS,hS=uS.trim;Bn({target:"String",proto:!0,forced:function(e){return pS((function(){return!!lS[e]()||"​᠎"!=="​᠎"[e]()||dS&&lS[e].name!==e}))}("trim")},{trim:function(){return hS(this)}});var fS=cr("String","trim"),_S=b,vS=fS,ES=String.prototype,mS=d((function(e){var t=e.trim;return"string"==typeof e||e===ES||_S(ES,e)&&t===ES.trim?vS:t})),SS={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){var t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substring(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){var t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){var t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(var i=3;i<r.length;i++){var a=r[i],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))}));var u=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((function(e){u.forEach((function(t){e.rtcpFeedback.find((function(e){return e.type===t.type&&e.parameter===t.parameter}))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var i=0;return n.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substring(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substring(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};var o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){var s=o[0].substring(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t}(SS);var gS=SS.exports,TS=d(gS),bS=function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:TS},[gS]);function RS(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=TS.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,lm(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function CS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||lm(e,"icecandidate",(function(e){if(e.candidate){var t=TS.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function yS(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=TS.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=TS.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=TS.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var c,u=r(arguments[0]),d=i(u),p=a(arguments[0],u);c=0===d&&0===p?Number.POSITIVE_INFINITY:0===d||0===p?Math.max(d,p):Math.min(d,p);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return c}}),this._sctp=l}return o.apply(this,arguments)}}}function IS(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},lm(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function AS(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function wS(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==mS(e).call(e)})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}}function OS(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?zl.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),zl.resolve())})}}function kS(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return n.apply(e,[t])}))})}}var NS=Object.freeze({__proto__:null,removeExtmapAllowMixed:wS,shimAddIceCandidateNullOrEmpty:OS,shimConnectionState:AS,shimMaxMessageSize:yS,shimParameterlessSetLocalDescription:kS,shimRTCIceCandidate:RS,shimRTCIceCandidateRelayProtocol:CS,shimSendThrowTypeError:IS});!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=_m,i=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=pm(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=pm(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=pm(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(t),a={browserDetails:i,commonShim:NS,extractVersion:pm,disableLog:hm,disableWarnings:fm,sdp:bS};switch(i.browser){case"chrome":if(!Dm||!km||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),a;if(null===i.version)return r("Chrome shim can not determine version, not shimming."),a;r("adapter.js shimming chrome."),a.browserShim=Dm,OS(t,i),kS(t),bm(t,i),Rm(t),km(t,i),Cm(t),Om(t,i),ym(t),Im(t),Am(t),Nm(t,i),RS(t),CS(t),AS(t),yS(t,i),IS(t),wS(t,i);break;case"firefox":if(!Hm||!xm||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),a;r("adapter.js shimming firefox."),a.browserShim=Hm,OS(t,i),kS(t),Pm(t,i),xm(t,i),Lm(t),Vm(t),Mm(t),Um(t),Fm(t),Bm(t),jm(t),Gm(t),Wm(t),RS(t),AS(t),yS(t,i),IS(t);break;case"safari":if(!eS||!n.shimSafari)return r("Safari shim is not included in this adapter release."),a;r("adapter.js shimming safari."),a.browserShim=eS,OS(t,i),kS(t),Jm(t),Zm(t),qm(t),Km(t),Ym(t),Qm(t),zm(t),$m(t),RS(t),CS(t),yS(t,i),IS(t),wS(t,i);break;default:r("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var DS=C;Bn({global:!0,forced:DS.globalThis!==DS},{globalThis:DS});var PS=d(C),LS={exports:{}};!function(e,t){!function(n,r){var i="function",a="undefined",o="object",s="string",c="major",u="model",d="name",p="type",l="vendor",h="version",f="architecture",_="console",v="mobile",E="tablet",m="smarttv",S="wearable",g="embedded",T="Amazon",b="Apple",R="ASUS",C="BlackBerry",y="Browser",I="Chrome",A="Firefox",w="Google",O="Huawei",k="LG",N="Microsoft",D="Motorola",P="Opera",L="Samsung",x="Sharp",M="Sony",U="Xiaomi",V="Zebra",F="Facebook",B="Chromium OS",j="Mac OS",G=" Browser",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},H=function(e,t){return typeof e===s&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},Y=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,500)},q=function(e,t){for(var n,a,s,c,u,d,p=0;p<t.length&&!u;){var l=t[p],h=t[p+1];for(n=a=0;n<l.length&&!u&&l[n];)if(u=l[n++].exec(e))for(s=0;s<h.length;s++)d=u[++a],typeof(c=h[s])===o&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):r:this[c[0]]=d?c[1].call(this,d,c[2]):r:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):r):this[c]=d||r;p+=2}},z=function(e,t){for(var n in t)if(typeof t[n]===o&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(H(t[n][i],e))return"?"===n?r:n}else if(H(t[n],e))return"?"===n?r:n;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,h],[/opios[\/ ]+([\w\.]+)/i],[h,[d,P+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[h,[d,P+" GX"]],[/\bopr\/([\w\.]+)/i],[h,[d,P]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[h,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[h,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,h],[/quark(?:pc)?\/([-\w\.]+)/i],[h,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[h,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[d,"UC"+y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[h,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[h,[d,"Smart Lenovo "+y]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+y],h],[/\bfocus\/([\w\.]+)/i],[h,[d,A+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[d,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[d,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[d,"MIUI"+G]],[/fxios\/([\w\.-]+)/i],[h,[d,A]],[/\bqihoobrowser\/?([\w\.]*)/i],[h,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],h],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+G],h],[/samsungbrowser\/([\w\.]+)/i],[h,[d,L+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[h,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,h],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[h,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,F],h],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[d,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,I+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[d,"Android "+y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[h,z,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],h],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[d,A+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[h,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,K]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[l,L],[p,E]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[l,L],[p,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[l,b],[p,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[l,b],[p,E]],[/(macintosh);/i],[u,[l,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[l,x],[p,v]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[l,"Honor"],[p,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[l,O],[p,E]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[l,O],[p,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[l,U],[p,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[l,U],[p,E]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[l,"OPPO"],[p,v]],[/\b(opd2\d{3}a?) bui/i],[u,[l,"OPPO"],[p,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[l,"Vivo"],[p,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[l,"Realme"],[p,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[l,D],[p,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[l,D],[p,E]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[l,k],[p,E]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[l,k],[p,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[l,"Lenovo"],[p,E]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[l,"Nokia"],[p,v]],[/(pixel c)\b/i],[u,[l,w],[p,E]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[l,w],[p,v]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[l,M],[p,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[l,M],[p,E]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[l,"OnePlus"],[p,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[l,T],[p,E]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[l,T],[p,v]],[/(playbook);[-\w\),; ]+(rim)/i],[u,l,[p,E]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[l,C],[p,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[l,R],[p,E]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[l,R],[p,v]],[/(nexus 9)/i],[u,[l,"HTC"],[p,E]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l,[u,/_/g," "],[p,v]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[l,"TCL"],[p,E]],[/(itel) ((\w+))/i],[[l,K],u,[p,z,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[l,"Acer"],[p,E]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[l,"Meizu"],[p,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[l,"Ulefone"],[p,v]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[l,"Energizer"],[p,v]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[l,"Cat"],[p,v]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[l,"Smartfren"],[p,v]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[l,"Nothing"],[p,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,u,[p,v]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,u,[p,E]],[/(surface duo)/i],[u,[l,N],[p,E]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[l,"Fairphone"],[p,v]],[/(u304aa)/i],[u,[l,"AT&T"],[p,v]],[/\bsie-(\w*)/i],[u,[l,"Siemens"],[p,v]],[/\b(rct\w+) b/i],[u,[l,"RCA"],[p,E]],[/\b(venue[\d ]{2,7}) b/i],[u,[l,"Dell"],[p,E]],[/\b(q(?:mv|ta)\w+) b/i],[u,[l,"Verizon"],[p,E]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[l,"Barnes & Noble"],[p,E]],[/\b(tm\d{3}\w+) b/i],[u,[l,"NuVision"],[p,E]],[/\b(k88) b/i],[u,[l,"ZTE"],[p,E]],[/\b(nx\d{3}j) b/i],[u,[l,"ZTE"],[p,v]],[/\b(gen\d{3}) b.+49h/i],[u,[l,"Swiss"],[p,v]],[/\b(zur\d{3}) b/i],[u,[l,"Swiss"],[p,E]],[/\b((zeki)?tb.*\b) b/i],[u,[l,"Zeki"],[p,E]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],u,[p,E]],[/\b(ns-?\w{0,9}) b/i],[u,[l,"Insignia"],[p,E]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[l,"NextBook"],[p,E]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],u,[p,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],u,[p,v]],[/\b(ph-1) /i],[u,[l,"Essential"],[p,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[l,"Envizen"],[p,E]],[/\b(trio[-\w\. ]+) b/i],[u,[l,"MachSpeed"],[p,E]],[/\btu_(1491) b/i],[u,[l,"Rotor"],[p,E]],[/(shield[\w ]+) b/i],[u,[l,"Nvidia"],[p,E]],[/(sprint) (\w+)/i],[l,u,[p,v]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[l,N],[p,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[l,V],[p,E]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[l,V],[p,v]],[/smart-tv.+(samsung)/i],[l,[p,m]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[l,L],[p,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,k],[p,m]],[/(apple) ?tv/i],[l,[u,b+" TV"],[p,m]],[/crkey/i],[[u,I+"cast"],[l,w],[p,m]],[/droid.+aft(\w+)( bui|\))/i],[u,[l,T],[p,m]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[l,x],[p,m]],[/(bravia[\w ]+)( bui|\))/i],[u,[l,M],[p,m]],[/(mitv-\w{5}) bui/i],[u,[l,U],[p,m]],[/Hbbtv.*(technisat) (.*);/i],[l,u,[p,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l,Y],[u,Y],[p,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,u,[p,_]],[/droid.+; (shield) bui/i],[u,[l,"Nvidia"],[p,_]],[/(playstation [345portablevi]+)/i],[u,[l,M],[p,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[l,N],[p,_]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[l,L],[p,S]],[/((pebble))app/i],[l,u,[p,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[l,b],[p,S]],[/droid.+; (glass) \d/i],[u,[l,w],[p,S]],[/droid.+; (wt63?0{2,3})\)/i],[u,[l,V],[p,S]],[/droid.+; (glass) \d/i],[u,[l,w],[p,S]],[/(pico) (4|neo3(?: link|pro)?)/i],[l,u,[p,S]],[/; (quest( \d| pro)?)/i],[u,[l,F],[p,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[p,g]],[/(aeobc)\b/i],[u,[l,T],[p,g]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[p,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[p,E]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,E]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,v]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,h],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,h],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[h,z,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,z,X],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,j],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,h],[/\(bb(10);/i],[h,[d,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[d,A+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[d,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,B],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,h],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,h]]},Q=function e(t,_){if(typeof t===o&&(_=t,t=r),!(this instanceof e))return new e(t,_).getResult();var m=typeof n!==a&&n.navigator?n.navigator:r,S=t||(m&&m.userAgent?m.userAgent:""),g=m&&m.userAgentData?m.userAgentData:r,T=_?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(J,_):J,b=m&&m.userAgent==S;return this.getBrowser=function(){var e={};return e[d]=r,e[h]=r,q.call(e,S,T.browser),e[c]=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[h]),b&&m&&m.brave&&typeof m.brave.isBrave==i&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[f]=r,q.call(e,S,T.cpu),e},this.getDevice=function(){var e={};return e[l]=r,e[u]=r,e[p]=r,q.call(e,S,T.device),b&&!e[p]&&g&&g.mobile&&(e[p]=v),b&&"Macintosh"==e[u]&&m&&typeof m.standalone!==a&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[u]="iPad",e[p]=E),e},this.getEngine=function(){var e={};return e[d]=r,e[h]=r,q.call(e,S,T.engine),e},this.getOS=function(){var e={};return e[d]=r,e[h]=r,q.call(e,S,T.os),b&&!e[d]&&g&&g.platform&&"Unknown"!=g.platform&&(e[d]=g.platform.replace(/chrome os/i,B).replace(/macos/i,j)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return S},this.setUA=function(e){return S=typeof e===s&&e.length>500?Y(e,500):e,this},this.setUA(S),this};Q.VERSION="0.7.40",Q.BROWSER=W([d,h,c]),Q.CPU=W([f]),Q.DEVICE=W([u,l,p,_,v,m,E,S,g]),Q.ENGINE=Q.OS=W([d,h]),e.exports&&(t=e.exports=Q),t.UAParser=Q;var Z=typeof n!==a&&(n.jQuery||n.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:u)}(LS,LS.exports);var xS=d(LS.exports),MS=Lu.clear;Bn({global:!0,bind:!0,enumerable:!0,forced:C.clearImmediate!==MS},{clearImmediate:MS});var US=C,VS=O,FS=V,BS=ti,jS=Se,GS=iu,WS=ou,HS=US.Function,KS=/MSIE .\./.test(jS)||"BUN"===BS&&function(){var e=US.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),YS=Bn,qS=C,zS=Lu.set,XS=qS.setImmediate?function(e,t){var n=t?2:1;return KS?function(r,i){var a=WS(arguments.length,1)>n,o=FS(r)?r:HS(r),s=a?GS(arguments,n):[],c=a?function(){VS(o,this,s)}:o;return t?e(c,i):e(c)}:e}(zS,!1):zS;YS({global:!0,bind:!0,enumerable:!0,forced:qS.setImmediate!==XS},{setImmediate:XS});var JS=d(pe.setImmediate),QS=C,ZS=dd,$S=Ge,eg=ou,tg=B;Bn({global:!0,enumerable:!0,dontCallGetSet:!0,forced:f((function(){return tg&&1!==Object.getOwnPropertyDescriptor(QS,"queueMicrotask").value.length}))},{queueMicrotask:function(e){eg(arguments.length,1),ZS($S(e))}});var ng=d(pe.queueMicrotask);function rg(e,t){return function(){return e.apply(t,arguments)}}var ig,ag=Object.prototype.toString,og=Object.getPrototypeOf,sg=Symbol.iterator,cg=Symbol.toStringTag,ug=(ig=Object.create(null),function(e){var t=ag.call(e);return ig[t]||(ig[t]=t.slice(8,-1).toLowerCase())}),dg=function(e){return e=e.toLowerCase(),function(t){return ug(t)===e}},pg=function(e){return function(t){return typeof t===e}},lg=Array.isArray,hg=pg("undefined"),fg=dg("ArrayBuffer"),_g=pg("string"),vg=pg("function"),Eg=pg("number"),mg=function(e){return null!==e&&"object"==typeof e},Sg=function(e){if("object"!==ug(e))return!1;var t=og(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||cg in e||sg in e)},gg=dg("Date"),Tg=dg("File"),bg=dg("Blob"),Rg=dg("FileList"),Cg=dg("URLSearchParams"),yg=["ReadableStream","Request","Response","Headers"].map(dg),Ig=yg[0],Ag=yg[1],wg=yg[2],Og=yg[3];function kg(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.allOwnKeys,o=void 0!==a&&a;if(null!=e)if("object"!=typeof e&&(e=[e]),lg(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{var s,c=o?Object.getOwnPropertyNames(e):Object.keys(e),u=c.length;for(n=0;n<u;n++)s=c[n],t.call(null,e[s],s,e)}}function Ng(e,t){t=t.toLowerCase();for(var n,r=Object.keys(e),i=r.length;i-- >0;)if(t===(n=r[i]).toLowerCase())return n;return null}var Dg,Pg,Lg,xg,Mg,Ug=void 0!==PS?PS:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Vg=function(e){return!hg(e)&&e!==Ug},Fg=(Dg="undefined"!=typeof Uint8Array&&og(Uint8Array),function(e){return Dg&&e instanceof Dg}),Bg=dg("HTMLFormElement"),jg=function(e){var t=Object.prototype.hasOwnProperty;return function(e,n){return t.call(e,n)}}(),Gg=dg("RegExp"),Wg=function(e,t){var n=Object.getOwnPropertyDescriptors(e),r={};kg(n,(function(n,i){var a;!1!==(a=t(n,i,e))&&(r[i]=a||n)})),Object.defineProperties(e,r)},Hg=dg("AsyncFunction"),Kg=(Pg="function"==typeof JS,Lg=vg(Ug.postMessage),Pg?JS:Lg?(xg="axios@".concat(Math.random()),Mg=[],Ug.addEventListener("message",(function(e){var t=e.source,n=e.data;t===Ug&&n===xg&&Mg.length&&Mg.shift()()}),!1),function(e){Mg.push(e),Ug.postMessage(xg,"*")}):function(e){return setTimeout(e)}),Yg=void 0!==ng?ng.bind(Ug):"undefined"!=typeof process&&process.nextTick||Kg,qg={isArray:lg,isArrayBuffer:fg,isBuffer:function(e){return null!==e&&!hg(e)&&null!==e.constructor&&!hg(e.constructor)&&vg(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:function(e){var t;return e&&("function"==typeof FormData&&e instanceof FormData||vg(e.append)&&("formdata"===(t=ug(e))||"object"===t&&vg(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&fg(e.buffer)},isString:_g,isNumber:Eg,isBoolean:function(e){return!0===e||!1===e},isObject:mg,isPlainObject:Sg,isReadableStream:Ig,isRequest:Ag,isResponse:wg,isHeaders:Og,isUndefined:hg,isDate:gg,isFile:Tg,isBlob:bg,isRegExp:Gg,isFunction:vg,isStream:function(e){return mg(e)&&vg(e.pipe)},isURLSearchParams:Cg,isTypedArray:Fg,isFileList:Rg,forEach:kg,merge:function e(){for(var t=Vg(this)&&this||{},n=t.caseless,r={},i=function(t,i){var a=n&&Ng(r,i)||i;Sg(r[a])&&Sg(t)?r[a]=e(r[a],t):Sg(t)?r[a]=e({},t):lg(t)?r[a]=t.slice():r[a]=t},a=0,o=arguments.length;a<o;a++)arguments[a]&&kg(arguments[a],i);return r},extend:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.allOwnKeys;return kg(t,(function(t,r){n&&vg(t)?e[r]=rg(t,n):e[r]=t}),{allOwnKeys:i}),e},trim:function(e){return mS(e)?mS(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n,r){var i,a,o,s={};if(t=t||{},null==e)return t;do{for(a=(i=Object.getOwnPropertyNames(e)).length;a-- >0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&og(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ug,kindOfTest:dg,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;if(lg(e))return e;var t=e.length;if(!Eg(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},forEachEntry:function(e,t){for(var n,r=(e&&e[sg]).call(e);(n=r.next())&&!n.done;){var i=n.value;t.call(e,i[0],i[1])}},matchAll:function(e,t){for(var n,r=[];null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Bg,hasOwnProperty:jg,hasOwnProp:jg,reduceDescriptors:Wg,freezeMethods:function(e){Wg(e,(function(t,n){if(vg(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;var r=e[n];vg(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:function(e,t){var n={},r=function(e){e.forEach((function(e){n[e]=!0}))};return lg(e)?r(e):r(String(e).split(t)),n},toCamelCase:function(e){return e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))},noop:function(){},toFiniteNumber:function(e,t){return null!=e&&Number.isFinite(e=+e)?e:t},findKey:Ng,global:Ug,isContextDefined:Vg,isSpecCompliantForm:function(e){return!!(e&&vg(e.append)&&"FormData"===e[cg]&&e[sg])},toJSONObject:function(e){var t=new Array(10);return function e(n,r){if(mg(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[r]=n;var i=lg(n)?[]:{};return kg(n,(function(t,n){var a=e(t,r+1);!hg(a)&&(i[n]=a)})),t[r]=void 0,i}}return n}(e,0)},isAsyncFn:Hg,isThenable:function(e){return e&&(mg(e)||vg(e))&&vg(e.then)&&vg(e.catch)},setImmediate:Kg,asap:Yg,isIterable:function(e){return null!=e&&vg(e[sg])}};function zg(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}qg.inherits(zg,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:qg.toJSONObject(this.config),code:this.code,status:this.status}}});var Xg=zg.prototype,Jg={};function Qg(e){return qg.isPlainObject(e)||qg.isArray(e)}function Zg(e){return qg.endsWith(e,"[]")?e.slice(0,-2):e}function $g(e,t,n){return e?e.concat(t).map((function(e,t){return e=Zg(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(e){Jg[e]={value:e}})),Object.defineProperties(zg,Jg),Object.defineProperty(Xg,"isAxiosError",{value:!0}),zg.from=function(e,t,n,r,i,a){var o=Object.create(Xg);return qg.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(function(e){return"isAxiosError"!==e})),zg.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};var eT=qg.toFlatObject(qg,{},null,(function(e){return/^is[A-Z]/.test(e)}));function tT(e,t,n){if(!qg.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;var r=(n=qg.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!qg.isUndefined(t[e])}))).metaTokens,i=n.visitor||u,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&qg.isSpecCompliantForm(t);if(!qg.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(qg.isDate(e))return e.toISOString();if(!s&&qg.isBlob(e))throw new zg("Blob is not supported. Use a Buffer instead.");return qg.isArrayBuffer(e)||qg.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){var s=e;if(e&&!i&&"object"==typeof e)if(qg.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(qg.isArray(e)&&function(e){return qg.isArray(e)&&!e.some(Qg)}(e)||(qg.isFileList(e)||qg.endsWith(n,"[]"))&&(s=qg.toArray(e)))return n=Zg(n),s.forEach((function(e,r){!qg.isUndefined(e)&&null!==e&&t.append(!0===o?$g([n],r,a):null===o?n:n+"[]",c(e))})),!1;return!!Qg(e)||(t.append($g(i,n,a),c(e)),!1)}var d=[],p=Object.assign(eT,{defaultVisitor:u,convertValue:c,isVisitable:Qg});if(!qg.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!qg.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),qg.forEach(n,(function(n,a){!0===(!(qg.isUndefined(n)||null===n)&&i.call(t,n,qg.isString(a)?mS(a).call(a):a,r,p))&&e(n,r?r.concat(a):[a])})),d.pop()}}(e),t}function nT(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function rT(e,t){this._pairs=[],e&&tT(e,this,t)}var iT=rT.prototype;function aT(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function oT(e,t,n){if(!t)return e;var r=n&&n.encode||aT;qg.isFunction(n)&&(n={serialize:n});var i,a=n&&n.serialize;if(i=a?a(t,n):qg.isURLSearchParams(t)?t.toString():new rT(t,n).toString(r)){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}iT.append=function(e,t){this._pairs.push([e,t])},iT.toString=function(e){var t=e?function(t){return e.call(this,t,nT)}:nT;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var sT=function(){function e(){this.handlers=[]}var t=e.prototype;return t.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},t.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},t.clear=function(){this.handlers&&(this.handlers=[])},t.forEach=function(e){qg.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e}(),cT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},uT={exports:{}},dT=Bn,pT=B,lT=un.f;dT({target:"Object",stat:!0,forced:Object.defineProperty!==lT,sham:!pT},{defineProperty:lT});var hT=pe.Object,fT=uT.exports=function(e,t,n){return hT.defineProperty(e,t,n)};hT.defineProperty.sham&&(fT.sham=!0);var _T=d(uT.exports),vT=TypeError,ET=pi,mT=Jc,ST=de,gT=Ct("species"),TT=Array,bT=function(e,t){return new(function(e){var t;return ET(e)&&(t=e.constructor,(mT(t)&&(t===TT||ET(t.prototype))||ST(t)&&null===(t=t[gT]))&&(t=void 0)),void 0===t?TT:t}(e))(0===t?0:t)},RT=f,CT=Ie,yT=Ct("species"),IT=function(e){return CT>=51||!RT((function(){var t=[];return(t.constructor={})[yT]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},AT=Bn,wT=f,OT=pi,kT=de,NT=st,DT=$n,PT=function(e){if(e>9007199254740991)throw vT("Maximum allowed index exceeded");return e},LT=x_,xT=bT,MT=IT,UT=Ie,VT=Ct("isConcatSpreadable"),FT=UT>=51||!wT((function(){var e=[];return e[VT]=!1,e.concat()[0]!==e})),BT=function(e){if(!kT(e))return!1;var t=e[VT];return void 0!==t?!!t:OT(e)};AT({target:"Array",proto:!0,arity:1,forced:!FT||!MT("concat")},{concat:function(e){var t,n,r,i,a,o=NT(this),s=xT(o,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(BT(a=-1===t?o:arguments[t]))for(i=DT(a),PT(c+i),n=0;n<i;n++,c++)n in a&&LT(s,c,a[n]);else PT(c+1),LT(s,c++,a);return s.length=c,s}});var jT={},GT=P,WT=ce,HT=Wi.f,KT=iu,YT="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];jT.f=function(e){return YT&&"Window"===GT(e)?function(e){try{return HT(e)}catch(e){return KT(YT)}}(e):HT(WT(e))};var qT={},zT=Ct;qT.f=zT;var XT=pe,JT=dt,QT=qT,ZT=un.f,$T=function(e){var t=XT.Symbol||(XT.Symbol={});JT(t,e)||ZT(t,e,{value:QT.f(e)})},eb=W,tb=ve,nb=Ct,rb=Cs,ib=function(){var e=tb("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=nb("toPrimitive");t&&!t[r]&&rb(t,r,(function(e){return eb(n,this)}),{arity:1})},ab=cn,ob=te,sb=st,cb=$n,ub=bT,db=T([].push),pb=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,a=6===e,o=7===e,s=5===e||a;return function(c,u,d,p){for(var l,h,f=sb(c),_=ob(f),v=cb(_),E=ab(u,d),m=0,S=p||ub,g=t?S(c,v):n||o?S(c,0):void 0;v>m;m++)if((s||m in _)&&(h=E(l=_[m],m,f),e))if(t)g[m]=h;else if(h)switch(e){case 3:return!0;case 5:return l;case 6:return m;case 2:db(g,l)}else switch(e){case 4:return!1;case 7:db(g,l)}return a?-1:r||i?i:g}},lb={forEach:pb(0),map:pb(1),filter:pb(2),some:pb(3),every:pb(4),find:pb(5),findIndex:pb(6),filterReject:pb(7)},hb=Bn,fb=C,_b=W,vb=T,Eb=B,mb=ke,Sb=f,gb=dt,Tb=b,bb=fn,Rb=ce,Cb=Pt,yb=Ar,Ib=J,Ab=Ma,wb=fa,Ob=Wi,kb=jT,Nb=ea,Db=F,Pb=un,Lb=pa,xb=H,Mb=Cs,Ub=bc,Vb=it,Fb=Hi,Bb=_t,jb=Ct,Gb=qT,Wb=$T,Hb=ib,Kb=Ws,Yb=vs,qb=lb.forEach,zb=Ci("hidden"),Xb="Symbol",Jb="prototype",Qb=Yb.set,Zb=Yb.getterFor(Xb),$b=Object[Jb],eR=fb.Symbol,tR=eR&&eR[Jb],nR=fb.RangeError,rR=fb.TypeError,iR=fb.QObject,aR=Db.f,oR=Pb.f,sR=kb.f,cR=xb.f,uR=vb([].push),dR=Vb("symbols"),pR=Vb("op-symbols"),lR=Vb("wks"),hR=!iR||!iR[Jb]||!iR[Jb].findChild,fR=function(e,t,n){var r=aR($b,t);r&&delete $b[t],oR(e,t,n),r&&e!==$b&&oR($b,t,r)},_R=Eb&&Sb((function(){return 7!==Ab(oR({},"a",{get:function(){return oR(this,"a",{value:7}).a}})).a}))?fR:oR,vR=function(e,t){var n=dR[e]=Ab(tR);return Qb(n,{type:Xb,tag:e,description:t}),Eb||(n.description=t),n},ER=function e(t,n,r){t===$b&&e(pR,n,r),bb(t);var i=Cb(n);return bb(r),gb(dR,i)?(r.enumerable?(gb(t,zb)&&t[zb][i]&&(t[zb][i]=!1),r=Ab(r,{enumerable:Ib(0,!1)})):(gb(t,zb)||oR(t,zb,Ib(1,Ab(null))),t[zb][i]=!0),_R(t,i,r)):oR(t,i,r)},mR=function(e,t){bb(e);var n=Rb(t),r=wb(n).concat(bR(n));return qb(r,(function(t){Eb&&!_b(SR,n,t)||ER(e,t,n[t])})),e},SR=function(e){var t=Cb(e),n=_b(cR,this,t);return!(this===$b&&gb(dR,t)&&!gb(pR,t))&&(!(n||!gb(this,t)||!gb(dR,t)||gb(this,zb)&&this[zb][t])||n)},gR=function(e,t){var n=Rb(e),r=Cb(t);if(n!==$b||!gb(dR,r)||gb(pR,r)){var i=aR(n,r);return!i||!gb(dR,r)||gb(n,zb)&&n[zb][r]||(i.enumerable=!0),i}},TR=function(e){var t=sR(Rb(e)),n=[];return qb(t,(function(e){gb(dR,e)||gb(Fb,e)||uR(n,e)})),n},bR=function(e){var t=e===$b,n=sR(t?pR:Rb(e)),r=[];return qb(n,(function(e){!gb(dR,e)||t&&!gb($b,e)||uR(r,dR[e])})),r};mb||(Mb(tR=(eR=function(){if(Tb(tR,this))throw new rR("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?yb(arguments[0]):void 0,t=Bb(e),n=function e(n){var r=void 0===this?fb:this;r===$b&&_b(e,pR,n),gb(r,zb)&&gb(r[zb],t)&&(r[zb][t]=!1);var i=Ib(1,n);try{_R(r,t,i)}catch(n){if(!(n instanceof nR))throw n;fR(r,t,i)}};return Eb&&hR&&_R($b,t,{configurable:!0,set:n}),vR(t,e)})[Jb],"toString",(function(){return Zb(this).tag})),Mb(eR,"withoutSetter",(function(e){return vR(Bb(e),e)})),xb.f=SR,Pb.f=ER,Lb.f=mR,Db.f=gR,Ob.f=kb.f=TR,Nb.f=bR,Gb.f=function(e){return vR(jb(e),e)},Eb&&Ub(tR,"description",{configurable:!0,get:function(){return Zb(this).description}})),hb({global:!0,constructor:!0,wrap:!0,forced:!mb,sham:!mb},{Symbol:eR}),qb(wb(lR),(function(e){Wb(e)})),hb({target:Xb,stat:!0,forced:!mb},{useSetter:function(){hR=!0},useSimple:function(){hR=!1}}),hb({target:"Object",stat:!0,forced:!mb,sham:!Eb},{create:function(e,t){return void 0===t?Ab(e):mR(Ab(e),t)},defineProperty:ER,defineProperties:mR,getOwnPropertyDescriptor:gR}),hb({target:"Object",stat:!0,forced:!mb},{getOwnPropertyNames:TR}),Hb(),Kb(eR,Xb),Fb[zb]=!0;var RR=ke&&!!Symbol.for&&!!Symbol.keyFor,CR=Bn,yR=ve,IR=dt,AR=Ar,wR=it,OR=RR,kR=wR("string-to-symbol-registry"),NR=wR("symbol-to-string-registry");CR({target:"Symbol",stat:!0,forced:!OR},{for:function(e){var t=AR(e);if(IR(kR,t))return kR[t];var n=yR("Symbol")(t);return kR[t]=n,NR[n]=t,n}});var DR=Bn,PR=dt,LR=Me,xR=Ve,MR=RR,UR=it("symbol-to-string-registry");DR({target:"Symbol",stat:!0,forced:!MR},{keyFor:function(e){if(!LR(e))throw new TypeError(xR(e)+" is not a symbol");if(PR(UR,e))return UR[e]}});var VR=pi,FR=V,BR=P,jR=Ar,GR=T([].push),WR=Bn,HR=ve,KR=O,YR=W,qR=T,zR=f,XR=V,JR=Me,QR=iu,ZR=function(e){if(FR(e))return e;if(VR(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?GR(n,i):"number"!=typeof i&&"Number"!==BR(i)&&"String"!==BR(i)||GR(n,jR(i))}var a=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if(VR(this))return t;for(var r=0;r<a;r++)if(n[r]===e)return t}}},$R=ke,eC=String,tC=HR("JSON","stringify"),nC=qR(/./.exec),rC=qR("".charAt),iC=qR("".charCodeAt),aC=qR("".replace),oC=qR(1..toString),sC=/[\uD800-\uDFFF]/g,cC=/^[\uD800-\uDBFF]$/,uC=/^[\uDC00-\uDFFF]$/,dC=!$R||zR((function(){var e=HR("Symbol")("stringify detection");return"[null]"!==tC([e])||"{}"!==tC({a:e})||"{}"!==tC(Object(e))})),pC=zR((function(){return'"\\udf06\\ud834"'!==tC("\udf06\ud834")||'"\\udead"'!==tC("\udead")})),lC=function(e,t){var n=QR(arguments),r=ZR(t);if(XR(r)||void 0!==e&&!JR(e))return n[1]=function(e,t){if(XR(r)&&(t=YR(r,this,eC(e),t)),!JR(t))return t},KR(tC,null,n)},hC=function(e,t,n){var r=rC(n,t-1),i=rC(n,t+1);return nC(cC,e)&&!nC(uC,i)||nC(uC,e)&&!nC(cC,r)?"\\u"+oC(iC(e,0),16):e};tC&&WR({target:"JSON",stat:!0,arity:3,forced:dC||pC},{stringify:function(e,t,n){var r=QR(arguments),i=KR(dC?lC:tC,null,r);return pC&&"string"==typeof i?aC(i,sC,hC):i}});var fC=ea,_C=st;Bn({target:"Object",stat:!0,forced:!ke||f((function(){fC.f(1)}))},{getOwnPropertySymbols:function(e){var t=fC.f;return t?t(_C(e)):[]}}),$T("asyncIterator"),$T("hasInstance"),$T("isConcatSpreadable"),$T("iterator"),$T("match"),$T("matchAll"),$T("replace"),$T("search"),$T("species"),$T("split");var vC=ib;$T("toPrimitive"),vC();var EC=ve,mC=Ws;$T("toStringTag"),mC(EC("Symbol"),"Symbol"),$T("unscopables"),Ws(C.JSON,"JSON",!0);var SC=pe.Symbol,gC=Ct,TC=un.f,bC=gC("metadata"),RC=Function.prototype;void 0===RC[bC]&&TC(RC,bC,{value:null}),$T("asyncDispose"),$T("dispose"),$T("metadata");var CC=SC,yC=T,IC=ve("Symbol"),AC=IC.keyFor,wC=yC(IC.prototype.valueOf),OC=IC.isRegisteredSymbol||function(e){try{return void 0!==AC(wC(e))}catch(e){return!1}};Bn({target:"Symbol",stat:!0},{isRegisteredSymbol:OC});for(var kC=it,NC=ve,DC=T,PC=Me,LC=Ct,xC=NC("Symbol"),MC=xC.isWellKnownSymbol,UC=NC("Object","getOwnPropertyNames"),VC=DC(xC.prototype.valueOf),FC=kC("wks"),BC=0,jC=UC(xC),GC=jC.length;BC<GC;BC++)try{var WC=jC[BC];PC(xC[WC])&&LC(WC)}catch(e){}var HC=function(e){if(MC&&MC(e))return!0;try{for(var t=VC(e),n=0,r=UC(FC),i=r.length;n<i;n++)if(FC[r[n]]==t)return!0}catch(e){}return!1};Bn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:HC}),$T("customMatcher"),$T("observable"),Bn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:OC}),Bn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:HC}),$T("matcher"),$T("metadataKey"),$T("patternMatch"),$T("replaceAll");var KC=d(CC),YC=d(qT.f("iterator"));function qC(e){return(qC="function"==typeof KC&&"symbol"==typeof YC?function(e){return typeof e}:function(e){return e&&"function"==typeof KC&&e.constructor===KC&&e!==KC.prototype?"symbol":typeof e})(e)}var zC=d(qT.f("toPrimitive"));function XC(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=qC(e)||!e)return e;var n=e[zC];if(void 0!==n){var r=n.call(e,t);if("object"!=qC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==qC(t)?t:t+""}(t))in e?_T(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var JC=d(v_),QC={isBrowser:!0,classes:{URLSearchParams:void 0!==JC?JC:rT,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ZC="undefined"!=typeof window&&"undefined"!=typeof document,$C="object"==typeof navigator&&navigator||void 0,ey=ZC&&(!$C||["ReactNative","NativeScript","NS"].indexOf($C.product)<0),ty="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ny=ZC&&window.location.href||"http://localhost";function ry(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ry(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ry(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ay=iy(iy({},Object.freeze({__proto__:null,hasBrowserEnv:ZC,hasStandardBrowserEnv:ey,hasStandardBrowserWebWorkerEnv:ty,navigator:$C,origin:ny})),QC),oy=fn,sy=W,cy=dt,uy=b,dy=function(){var e=oy(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},py=RegExp.prototype,ly=function(e){var t=e.flags;return void 0!==t||"flags"in py||cy(e,"flags")||!uy(py,e)?t:sy(dy,e)},hy=Pl.charAt,fy=W,_y=fn,vy=V,Ey=P,my=/./.exec,Sy=TypeError,gy=Bn,Ty=W,by=M,Ry=Js,Cy=lc,yy=ae,Iy=Qn,Ay=Ar,wy=fn,Oy=de,ky=P,Ny=hr,Dy=ly,Py=Ke,Ly=f,xy=ru,My=vs,Uy=Ct("matchAll"),Vy="RegExp String",Fy=Vy+" Iterator",By=My.set,jy=My.getterFor(Fy),Gy=TypeError,Wy=by("".indexOf),Hy=by("".matchAll),Ky=!!Hy&&!Ly((function(){Hy("a",/./)})),Yy=Ry((function(e,t,n,r){By(this,{type:Fy,regexp:e,string:t,global:n,unicode:r,done:!1})}),Vy,(function(){var e=jy(this);if(e.done)return Cy(void 0,!0);var t=e.regexp,n=e.string,r=function(e,t){var n=e.exec;if(vy(n)){var r=fy(n,e,t);return null!==r&&_y(r),r}if("RegExp"===Ey(e))return fy(my,e,t);throw new Sy("RegExp#exec called on incompatible receiver")}(t,n);return null===r?(e.done=!0,Cy(void 0,!0)):e.global?(""===Ay(r[0])&&(t.lastIndex=function(e,t,n){return t+(n?hy(e,t).length:1)}(n,Iy(t.lastIndex),e.unicode)),Cy(r,!1)):(e.done=!0,Cy(r,!1))})),qy=function(e){var t,n,r,i=wy(this),a=Ay(e),o=xy(i,RegExp),s=Ay(Dy(i));return t=new o(o===RegExp?i.source:i,s),n=!!~Wy(s,"g"),r=!!~Wy(s,"u"),t.lastIndex=Iy(i.lastIndex),new Yy(t,a,n,r)};gy({target:"String",proto:!0,forced:Ky},{matchAll:function(e){var t,n,r,i,a=yy(this);if(Oy(e)){if(Ny(e)&&(t=Ay(yy(Dy(e))),!~Wy(t,"g")))throw new Gy("`.matchAll` does not allow non-global regexes");if(Ky)return Hy(a,e);if(void 0===(r=Py(e,Uy))&&"RegExp"===ky(e)&&(r=qy),r)return Ty(r,e,a)}else if(Ky)return Hy(a,e);return n=Ay(a),i=new RegExp(e,"g"),Ty(qy,i,n)}});var zy=cr("String","matchAll"),Xy=b,Jy=zy,Qy=String.prototype,Zy=d((function(e){var t=e.matchAll;return"string"==typeof e||e===Qy||Xy(Qy,e)&&t===Qy.matchAll?Jy:t}));function $y(e){function t(e,n,r,i){var a=e[i++];if("__proto__"===a)return!0;var o=Number.isFinite(+a),s=i>=e.length;return a=!a&&qg.isArray(r)?r.length:a,s?(qg.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o):(r[a]&&qg.isObject(r[a])||(r[a]=[]),t(e,n,r[a],i)&&qg.isArray(r[a])&&(r[a]=function(e){var t,n,r={},i=Object.keys(e),a=i.length;for(t=0;t<a;t++)r[n=i[t]]=e[n];return r}(r[a])),!o)}if(qg.isFormData(e)&&qg.isFunction(e.entries)){var n={};return qg.forEachEntry(e,(function(e,r){t(function(e){return Zy(qg).call(qg,/\w+|\[(\w*)]/g,e).map((function(e){return"[]"===e[0]?"":e[1]||e[0]}))}(e),r,n,0)})),n}return null}var eI={transitional:cT,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){var n,r=t.getContentType()||"",i=r.indexOf("application/json")>-1,a=qg.isObject(e);if(a&&qg.isHTMLForm(e)&&(e=new FormData(e)),qg.isFormData(e))return i?JSON.stringify($y(e)):e;if(qg.isArrayBuffer(e)||qg.isBuffer(e)||qg.isStream(e)||qg.isFile(e)||qg.isBlob(e)||qg.isReadableStream(e))return e;if(qg.isArrayBufferView(e))return e.buffer;if(qg.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return tT(e,new ay.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return ay.isNode&&qg.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((n=qg.isFileList(e))||r.indexOf("multipart/form-data")>-1){var o=this.env&&this.env.FormData;return tT(n?{"files[]":e}:e,o&&new o,this.formSerializer)}}return a||i?(t.setContentType("application/json",!1),function(e,t,n){if(qg.isString(e))try{return(0,JSON.parse)(e),mS(qg).call(qg,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||eI.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(qg.isResponse(e)||qg.isReadableStream(e))return e;if(e&&qg.isString(e)&&(n&&!this.responseType||r)){var i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw zg.from(e,zg.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ay.classes.FormData,Blob:ay.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};qg.forEach(["delete","get","head","post","put","patch"],(function(e){eI.headers[e]={}}));var tI=eI,nI=qg.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rI=Symbol("internals");function iI(e){var t;return e&&mS(t=String(e)).call(t).toLowerCase()}function aI(e){return!1===e||null==e?e:qg.isArray(e)?e.map(aI):String(e)}function oI(e,t,n,r,i){return qg.isFunction(r)?r.call(this,t,n):(i&&(t=n),qg.isString(t)?qg.isString(r)?-1!==t.indexOf(r):qg.isRegExp(r)?r.test(t):void 0:void 0)}var sI=function(e,t){function n(e){e&&this.set(e)}var r=n.prototype;return r.set=function(e,t,n){var r=this;function i(e,t,n){var i=iI(t);if(!i)throw new Error("header name must be a non-empty string");var a=qg.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=aI(e))}var a,o=function(e,t){return qg.forEach(e,(function(e,n){return i(e,n,t)}))};if(qg.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(qg.isString(e)&&(e=mS(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(mS(a=e).call(a)))o(function(e){var t,n,r,i={};return e&&e.split("\n").forEach((function(e){var a,o;r=e.indexOf(":"),t=mS(a=e.substring(0,r)).call(a).toLowerCase(),n=mS(o=e.substring(r+1)).call(o),!t||i[t]&&nI[t]||("set-cookie"===t?i[t]?i[t].push(n):i[t]=[n]:i[t]=i[t]?i[t]+", "+n:n)})),i}(e),t);else if(qg.isObject(e)&&qg.isIterable(e)){for(var s,c,u,d={},p=h(e);!(u=p()).done;){var l=u.value;if(!qg.isArray(l))throw TypeError("Object iterator must return a key-value pair");d[c=l[0]]=(s=d[c])?qg.isArray(s)?[].concat(s,[l[1]]):[s,l[1]]:l[1]}o(d,t)}else null!=e&&i(t,e,n);return this},r.get=function(e,t){if(e=iI(e)){var n=qg.findKey(this,e);if(n){var r=this[n];if(!t)return r;if(!0===t)return function(e){for(var t,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;t=r.exec(e);)n[t[1]]=t[2];return n}(r);if(qg.isFunction(t))return t.call(this,r,n);if(qg.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}},r.has=function(e,t){if(e=iI(e)){var n=qg.findKey(this,e);return!(!n||void 0===this[n]||t&&!oI(0,this[n],n,t))}return!1},r.delete=function(e,t){var n=this,r=!1;function i(e){if(e=iI(e)){var i=qg.findKey(n,e);!i||t&&!oI(0,n[i],i,t)||(delete n[i],r=!0)}}return qg.isArray(e)?e.forEach(i):i(e),r},r.clear=function(e){for(var t=Object.keys(this),n=t.length,r=!1;n--;){var i=t[n];e&&!oI(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r},r.normalize=function(e){var t=this,n={};return qg.forEach(this,(function(r,i){var a,o=qg.findKey(n,i);if(o)return t[o]=aI(r),void delete t[i];var s=e?function(e){return mS(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))}(i):mS(a=String(i)).call(a);s!==i&&delete t[i],t[s]=aI(r),n[s]=!0})),this},r.concat=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.constructor).concat.apply(e,[this].concat(n))},r.toJSON=function(e){var t=Object.create(null);return qg.forEach(this,(function(n,r){null!=n&&!1!==n&&(t[r]=e&&qg.isArray(n)?n.join(", "):n)})),t},r[e]=function(){return Object.entries(this.toJSON())[Symbol.iterator]()},r.toString=function(){return Object.entries(this.toJSON()).map((function(e){return e[0]+": "+e[1]})).join("\n")},r.getSetCookie=function(){return this.get("set-cookie")||[]},n.from=function(e){return e instanceof this?e:new this(e)},n.concat=function(e){for(var t=new this(e),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((function(e){return t.set(e)})),t},n.accessor=function(e){var t=(this[rI]=this[rI]={accessors:{}}).accessors,n=this.prototype;function r(e){var r=iI(e);t[r]||(function(e,t){var n=qg.toCamelCase(" "+t);["get","set","has"].forEach((function(r){Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return qg.isArray(e)?e.forEach(r):r(e),this},v(n,[{key:t,get:function(){return"AxiosHeaders"}}]),n}(Symbol.iterator,Symbol.toStringTag);sI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),qg.reduceDescriptors(sI.prototype,(function(e,t){var n=e.value,r=t[0].toUpperCase()+t.slice(1);return{get:function(){return n},set:function(e){this[r]=e}}})),qg.freezeMethods(sI);var cI=sI;function uI(e,t){var n=this||tI,r=t||n,i=cI.from(r.headers),a=r.data;return qg.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function dI(e){return!(!e||!e.__CANCEL__)}function pI(e,t,n){zg.call(this,null==e?"canceled":e,zg.ERR_CANCELED,t,n),this.name="CanceledError"}function lI(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new zg("Request failed with status code "+n.status,[zg.ERR_BAD_REQUEST,zg.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}qg.inherits(pI,zg,{__CANCEL__:!0});var hI=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0,i=function(e,t){e=e||10;var n,r=new Array(e),i=new Array(e),a=0,o=0;return t=void 0!==t?t:1e3,function(s){var c=Date.now(),u=i[o];n||(n=c),r[a]=s,i[a]=c;for(var d=o,p=0;d!==a;)p+=r[d++],d%=e;if((a=(a+1)%e)===o&&(o=(o+1)%e),!(c-n<t)){var l=u&&c-u;return l?Math.round(1e3*p/l):void 0}}}(50,250);return function(e,t){var n,r,i=0,a=1e3/t,o=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=a,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){for(var e=Date.now(),t=e-i,s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t>=a?o(c,e):(n=c,r||(r=setTimeout((function(){r=null,o(n)}),a-t)))},function(){return n&&o(n)}]}((function(n){var a,o=n.loaded,s=n.lengthComputable?n.total:void 0,c=o-r,u=i(c);r=o,e(((a={loaded:o,total:s,progress:s?o/s:void 0,bytes:c,rate:u||void 0,estimated:u&&s&&o<=s?(s-o)/u:void 0,event:n,lengthComputable:null!=s})[t?"download":"upload"]=!0,a))}),n)},fI=function(e,t){var n=null!=e;return[function(r){return t[0]({lengthComputable:n,total:e,loaded:r})},t[1]]},_I=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return qg.asap((function(){return e.apply(void 0,n)}))}},vI=ay.hasStandardBrowserEnv?function(e,t){return function(n){return n=new cm(n,ay.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)}}(new cm(ay.origin),ay.navigator&&/(msie|trident)/i.test(ay.navigator.userAgent)):function(){return!0},EI=ay.hasStandardBrowserEnv?{write:function(e,t,n,r,i,a){var o=[e+"="+encodeURIComponent(t)];qg.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),qg.isString(r)&&o.push("path="+r),qg.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function mI(e,t,n){var r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function SI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var gI=function(e){return e instanceof cI?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SI(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e};function TI(e,t){t=t||{};var n={};function r(e,t,n,r){return qg.isPlainObject(e)&&qg.isPlainObject(t)?qg.merge.call({caseless:r},e,t):qg.isPlainObject(t)?qg.merge({},t):qg.isArray(t)?t.slice():t}function i(e,t,n,i){return qg.isUndefined(t)?qg.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function a(e,t){if(!qg.isUndefined(t))return r(void 0,t)}function o(e,t){return qg.isUndefined(t)?qg.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}var c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:function(e,t,n){return i(gI(e),gI(t),0,!0)}};return qg.forEach(Object.keys(Object.assign({},e,t)),(function(r){var a=c[r]||i,o=a(e[r],t[r],r);qg.isUndefined(o)&&a!==s||(n[r]=o)})),n}var bI=function(e){var t,n=TI({},e),r=n.data,i=n.withXSRFToken,a=n.xsrfHeaderName,o=n.xsrfCookieName,s=n.headers,c=n.auth;if(n.headers=s=cI.from(s),n.url=oT(mI(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),qg.isFormData(r))if(ay.hasStandardBrowserEnv||ay.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(t=s.getContentType())){var u=t?t.split(";").map((function(e){return mS(e).call(e)})).filter(Boolean):[],d=u[0],p=u.slice(1);s.setContentType([d||"multipart/form-data"].concat(p).join("; "))}if(ay.hasStandardBrowserEnv&&(i&&qg.isFunction(i)&&(i=i(n)),i||!1!==i&&vI(n.url))){var l=a&&o&&EI.read(o);l&&s.set(a,l)}return n},RI="undefined"!=typeof XMLHttpRequest&&function(e){return new zl((function(t,n){var r,i,a,o,s,c,u,d=bI(e),p=d.data,l=cI.from(d.headers).normalize(),h=d.responseType,f=d.onUploadProgress,_=d.onDownloadProgress;function v(){c&&c(),u&&u(),d.cancelToken&&d.cancelToken.unsubscribe(a),d.signal&&d.signal.removeEventListener("abort",a)}var E=new XMLHttpRequest;function m(){if(E){var r=cI.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders());lI((function(e){t(e),v()}),(function(e){n(e),v()}),{data:h&&"text"!==h&&"json"!==h?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:r,config:e,request:E}),E=null}}E.open(d.method.toUpperCase(),d.url,!0),E.timeout=d.timeout,"onloadend"in E?E.onloadend=m:E.onreadystatechange=function(){E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf("file:"))&&setTimeout(m)},E.onabort=function(){E&&(n(new zg("Request aborted",zg.ECONNABORTED,e,E)),E=null)},E.onerror=function(){n(new zg("Network Error",zg.ERR_NETWORK,e,E)),E=null},E.ontimeout=function(){var t=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",r=d.transitional||cT;d.timeoutErrorMessage&&(t=d.timeoutErrorMessage),n(new zg(t,r.clarifyTimeoutError?zg.ETIMEDOUT:zg.ECONNABORTED,e,E)),E=null},void 0===p&&l.setContentType(null),"setRequestHeader"in E&&qg.forEach(l.toJSON(),(function(e,t){E.setRequestHeader(t,e)})),qg.isUndefined(d.withCredentials)||(E.withCredentials=!!d.withCredentials),h&&"json"!==h&&(E.responseType=d.responseType),_&&(s=(r=hI(_,!0))[0],u=r[1],E.addEventListener("progress",s)),f&&E.upload&&(o=(i=hI(f))[0],c=i[1],E.upload.addEventListener("progress",o),E.upload.addEventListener("loadend",c)),(d.cancelToken||d.signal)&&(a=function(t){E&&(n(!t||t.type?new pI(null,e,E):t),E.abort(),E=null)},d.cancelToken&&d.cancelToken.subscribe(a),d.signal&&(d.signal.aborted?a():d.signal.addEventListener("abort",a)));var S=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d.url);S&&-1===ay.protocols.indexOf(S)?n(new zg("Unsupported protocol "+S+":",zg.ERR_BAD_REQUEST,e)):E.send(p||null)}))},CI=function(e,t){var n=(e=e?e.filter(Boolean):[]).length;if(t||n){var r,i=new AbortController,a=function(e){if(!r){r=!0,s();var t=e instanceof Error?e:this.reason;i.abort(t instanceof zg?t:new pI(t instanceof Error?t.message:t))}},o=t&&setTimeout((function(){o=null,a(new zg("timeout ".concat(t," of ms exceeded"),zg.ETIMEDOUT))}),t),s=function(){e&&(o&&clearTimeout(o),o=null,e.forEach((function(e){e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)})),e=null)};e.forEach((function(e){return e.addEventListener("abort",a)}));var c=i.signal;return c.unsubscribe=function(){return qg.asap(s)},c}},yI=d(ql),II=qT.f("asyncIterator"),AI=d(II);function wI(e,t){this.v=e,this.k=t}function OI(e){return function(){return new kI(e.apply(this,arguments))}}function kI(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof wI;yI.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new yI((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function NI(e){return new wI(e,0)}function DI(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new wI(r=new yI((function(n){n(e[t](r))})),1)}}return t[void 0!==KC&&YC||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}kI.prototype["function"==typeof KC&&AI||"@@asyncIterator"]=function(){return this},kI.prototype.next=function(e){return this._invoke("next",e)},kI.prototype.throw=function(e){return this._invoke("throw",e)},kI.prototype.return=function(e){return this._invoke("return",e)};var PI=d(II);function LI(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=PI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new xI(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function xI(e){function t(e){if(Object(e)!==e)return zl.reject(new TypeError(e+" is not an object."));var t=e.done;return zl.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(xI=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?zl.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?zl.reject(e):t(n.apply(this.s,arguments))}},new xI(e)}var MI=l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.byteLength,n&&!(r<n)){e.next=5;break}return e.next=4,t;case 4:return e.abrupt("return",void e.sent);case 5:a=0;case 6:if(!(a<r)){e.next=13;break}return i=a+n,e.next=10,t.slice(a,i);case 10:a=i;case 11:e.next=6;break;case 13:case"end":return e.stop()}}),e)})),UI=function(){var e=OI(l().mark((function e(t,n){var r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=!1,a=!1,e.prev=1,s=LI(VI(t));case 3:return e.next=5,NI(s.next());case 5:if(!(i=!(o=e.sent).done)){e.next=11;break}return c=o.value,e.delegateYield(DI(LI(MI(c,n))),"t0",8);case 8:i=!1,e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(1),a=!0,r=e.t1;case 16:if(e.prev=16,e.prev=17,e.t2=i&&null!=s.return,!e.t2){e.next=22;break}return e.next=22,NI(s.return());case 22:if(e.prev=22,!a){e.next=25;break}throw r;case 25:return e.finish(22);case 26:return e.finish(16);case 27:case"end":return e.stop()}}),e,null,[[1,13,16,27],[17,,22,26]])})));return function(t,n){return e.apply(this,arguments)}}(),VI=function(){var e=OI(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t[PI]){e.next=3;break}return e.delegateYield(DI(LI(t)),"t0",2);case 2:return e.abrupt("return",void e.t0);case 3:n=t.getReader(),e.prev=4;case 5:return e.next=7,NI(n.read());case 7:if(r=e.sent,i=r.done,a=r.value,!i){e.next=12;break}return e.abrupt("break",16);case 12:return e.next=14,a;case 14:e.next=5;break;case 16:return e.prev=16,e.next=19,NI(n.cancel());case 19:return e.finish(16);case 20:case"end":return e.stop()}}),e,null,[[4,,16,20]])})));return function(t){return e.apply(this,arguments)}}(),FI=function(e,t,n,r){var i,a=UI(e,t),o=0,s=function(e){i||(i=!0,r&&r(e))};return new ReadableStream({pull:function(e){return p(l().mark((function t(){var r,i,c,u,d;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.next();case 3:if(r=t.sent,i=r.done,c=r.value,!i){t.next=8;break}return t.abrupt("return",(s(),void e.close()));case 8:u=c.byteLength,n&&(d=o+=u,n(d)),e.enqueue(new Uint8Array(c)),t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(0),s(t.t0),t.t0;case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},cancel:function(e){return s(e),a.return()}},{highWaterMark:2})};function BI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BI(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var GI,WI,HI="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,KI=HI&&"function"==typeof ReadableStream,YI=HI&&("function"==typeof TextEncoder?(GI=new TextEncoder,function(e){return GI.encode(e)}):p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,new Response(t).arrayBuffer();case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})))),qI=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e.apply(void 0,n)}catch(e){return!1}},zI=KI&&qI((function(){var e=!1,t=new Request(ay.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),XI=KI&&qI((function(){return qg.isReadableStream(new Response("").body)})),JI={stream:XI&&function(e){return e.body}};HI&&(WI=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((function(e){!JI[e]&&(JI[e]=qg.isFunction(WI[e])?function(t){return t[e]()}:function(t,n){throw new zg("Response type '".concat(e,"' is not supported"),zg.ERR_NOT_SUPPORT,n)})})));var QI=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=qg.toFiniteNumber(t.getContentLength()),e.abrupt("return",null==r?p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return",0);case 2:if(!qg.isBlob(t)){e.next=4;break}return e.abrupt("return",t.size);case 4:if(!qg.isSpecCompliantForm(t)){e.next=9;break}return n=new Request(ay.origin,{method:"POST",body:t}),e.next=8,n.arrayBuffer();case 8:return e.abrupt("return",e.sent.byteLength);case 9:if(!qg.isArrayBufferView(t)&&!qg.isArrayBuffer(t)){e.next=13;break}e.t0=t.byteLength,e.next=22;break;case 13:if(qg.isURLSearchParams(t)&&(t+=""),!qg.isString(t)){e.next=20;break}return e.next=17,YI(t);case 17:e.t1=e.sent.byteLength,e.next=21;break;case 20:e.t1=void 0;case 21:e.t0=e.t1;case 22:return e.abrupt("return",e.t0);case 23:case"end":return e.stop()}}),e)})))(n):r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ZI={http:null,xhr:RI,fetch:HI&&p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p,h,f,_,v,E,m,S,g,T,b,R,C,y,I,A,w,O,k,N,D,P,L;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=bI(t),r=n.url,i=n.method,a=n.data,o=n.signal,s=n.cancelToken,c=n.timeout,u=n.onDownloadProgress,d=n.onUploadProgress,p=n.responseType,h=n.headers,f=n.withCredentials,_=void 0===f?"same-origin":f,v=n.fetchOptions,p=p?(p+"").toLowerCase():"text",m=CI([o,s&&s.toAbortSignal()],c),S=m&&m.unsubscribe&&function(){m.unsubscribe()},e.prev=4,e.t0=d&&zI&&"get"!==i&&"head"!==i,!e.t0){e.next=11;break}return e.next=9,QI(h,a);case 9:e.t1=g=e.sent,e.t0=0!==e.t1;case 11:if(!e.t0){e.next=14;break}b=new Request(r,{method:"POST",body:a,duplex:"half"}),qg.isFormData(a)&&(T=b.headers.get("content-type"))&&h.setContentType(T),b.body&&(R=fI(g,hI(_I(d))),C=R[0],y=R[1],a=FI(b.body,65536,C,y));case 14:return qg.isString(_)||(_=_?"include":"omit"),I="credentials"in Request.prototype,E=new Request(r,jI(jI({},v),{},{signal:m,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:a,duplex:"half",credentials:I?_:void 0})),e.next=19,fetch(E);case 19:return A=e.sent,w=XI&&("stream"===p||"response"===p),XI&&(u||w&&S)&&(O={},["status","statusText","headers"].forEach((function(e){O[e]=A[e]})),k=qg.toFiniteNumber(A.headers.get("content-length")),N=u&&fI(k,hI(_I(u),!0))||[],D=N[0],P=N[1],A=new Response(FI(A.body,65536,D,(function(){P&&P(),S&&S()})),O)),p=p||"text",e.next=25,JI[qg.findKey(JI,p)||"text"](A,t);case 25:return L=e.sent,!w&&S&&S(),e.next=29,new zl((function(e,n){lI(e,n,{data:L,headers:cI.from(A.headers),status:A.status,statusText:A.statusText,config:t,request:E})}));case 29:return e.abrupt("return",e.sent);case 32:if(e.prev=32,e.t2=e.catch(4),S&&S(),!e.t2||"TypeError"!==e.t2.name||!/Load failed|fetch/i.test(e.t2.message)){e.next=36;break}throw Object.assign(new zg("Network Error",zg.ERR_NETWORK,t,E),{cause:e.t2.cause||e.t2});case 36:throw zg.from(e.t2,e.t2&&e.t2.code,t,E);case 37:case"end":return e.stop()}}),e,null,[[4,32]])})))};qg.forEach(ZI,(function(e,t){if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var $I=function(e){return"- ".concat(e)},eA=function(e){return qg.isFunction(e)||null===e||!1===e},tA=function(e){for(var t,n,r=(e=qg.isArray(e)?e:[e]).length,i={},a=0;a<r;a++){var o=void 0;if(n=t=e[a],!eA(t)&&void 0===(n=ZI[(o=String(t)).toLowerCase()]))throw new zg("Unknown adapter '".concat(o,"'"));if(n)break;i[o||"#"+a]=n}if(!n){var s=Object.entries(i).map((function(e){var t=e[0],n=e[1];return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new zg("There is no suitable adapter to dispatch the request "+(r?s.length>1?"since :\n"+s.map($I).join("\n"):" "+$I(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function nA(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new pI(null,e)}function rA(e){return nA(e),e.headers=cI.from(e.headers),e.data=uI.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tA(e.adapter||tI.adapter)(e).then((function(t){return nA(e),t.data=uI.call(e,e.transformResponse,t),t.headers=cI.from(t.headers),t}),(function(t){return dI(t)||(nA(e),t&&t.response&&(t.response.data=uI.call(e,e.transformResponse,t.response),t.response.headers=cI.from(t.response.headers))),zl.reject(t)}))}var iA="1.9.0",aA={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){aA[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var oA={};aA.transitional=function(e,t,n){function r(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,a){if(!1===e)throw new zg(r(i," has been removed"+(t?" in "+t:"")),zg.ERR_DEPRECATED);return t&&!oA[i]&&(oA[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}},aA.spelling=function(e){return function(t,n){return console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0}};var sA={assertOptions:function(e,t,n){if("object"!=typeof e)throw new zg("options must be an object",zg.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var a=r[i],o=t[a];if(o){var s=e[a],c=void 0===s||o(s,a,e);if(!0!==c)throw new zg("option "+a+" must be "+c,zg.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new zg("Unknown option "+a,zg.ERR_BAD_OPTION)}},validators:aA},cA=sA.validators,uA=function(){function e(e){this.defaults=e||{},this.interceptors={request:new sT,response:new sT}}var t=e.prototype;return t.request=function(){var e=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._request(t,n);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),e.t0 instanceof Error){r={},Error.captureStackTrace?Error.captureStackTrace(r):r=new Error,i=r.stack?r.stack.replace(/^.+\n/,""):"";try{e.t0.stack?i&&!String(e.t0.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.t0.stack+="\n"+i):e.t0.stack=i}catch(e){}}throw e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),t._request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var n=t=TI(this.defaults,t),r=n.transitional,i=n.paramsSerializer,a=n.headers;void 0!==r&&sA.assertOptions(r,{silentJSONParsing:cA.transitional(cA.boolean),forcedJSONParsing:cA.transitional(cA.boolean),clarifyTimeoutError:cA.transitional(cA.boolean)},!1),null!=i&&(qg.isFunction(i)?t.paramsSerializer={serialize:i}:sA.assertOptions(i,{encode:cA.function,serialize:cA.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),sA.assertOptions(t,{baseUrl:cA.spelling("baseURL"),withXsrfToken:cA.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();var o=a&&qg.merge(a.common,a[t.method]);a&&qg.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete a[e]})),t.headers=cI.concat(o,a);var s=[],c=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(c=c&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));var u,d=[];this.interceptors.response.forEach((function(e){d.push(e.fulfilled,e.rejected)}));var p,l=0;if(!c){var h=[rA.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,d),p=h.length,u=zl.resolve(t);l<p;)u=u.then(h[l++],h[l++]);return u}p=s.length;var f=t;for(l=0;l<p;){var _=s[l++],v=s[l++];try{f=_(f)}catch(e){v.call(this,e);break}}try{u=rA.call(this,f)}catch(e){return zl.reject(e)}for(l=0,p=d.length;l<p;)u=u.then(d[l++],d[l++]);return u},t.getUri=function(e){return oT(mI((e=TI(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)},e}();qg.forEach(["delete","get","head","options"],(function(e){uA.prototype[e]=function(t,n){return this.request(TI(n||{},{method:e,url:t,data:(n||{}).data}))}})),qg.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(TI(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}uA.prototype[e]=t(),uA.prototype[e+"Form"]=t(!0)}));var dA=uA,pA=function(){function e(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new zl((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){for(var t=n._listeners.length;t-- >0;)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new zl((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new pI(e,r,i),t(n.reason))}))}var t=e.prototype;return t.throwIfRequested=function(){if(this.reason)throw this.reason},t.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.toAbortSignal=function(){var e=this,t=new AbortController,n=function(e){t.abort(e)};return this.subscribe(n),t.signal.unsubscribe=function(){return e.unsubscribe(n)},t.signal},e.source=function(){var t;return{token:new e((function(e){t=e})),cancel:t}},e}(),lA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lA).forEach((function(e){var t=e[0],n=e[1];lA[n]=t}));var hA=lA,fA=function e(t){var n=new dA(t),r=rg(dA.prototype.request,n);return qg.extend(r,dA.prototype,n,{allOwnKeys:!0}),qg.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(TI(t,n))},r}(tI);fA.Axios=dA,fA.CanceledError=pI,fA.CancelToken=pA,fA.isCancel=dI,fA.VERSION=iA,fA.toFormData=tT,fA.AxiosError=zg,fA.Cancel=fA.CanceledError,fA.all=function(e){return zl.all(e)},fA.spread=function(e){return function(t){return e.apply(null,t)}},fA.isAxiosError=function(e){return qg.isObject(e)&&!0===e.isAxiosError},fA.mergeConfig=TI,fA.AxiosHeaders=cI,fA.formToJSON=function(e){return $y(qg.isHTMLForm(e)?new FormData(e):e)},fA.getAdapter=tA,fA.HttpStatusCode=hA,fA.default=fA;var _A=fA,vA=function(){};function EA(){var e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:vA};return e.promise=new zl((function(t,n){e.resolve=function(n){e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=function(t){e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}var mA=new Map,SA=new Map,gA=new Map,TA=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),bA=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),RA=new xS,CA=RA.getResult(),yA=null;function IA(e){if(!yA){e&&RA.setUA(e);var t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return bA.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return bA.CHROME;case"Safari":case"Mobile Safari":return bA.SAFARI;case"Edge":return bA.EDGE;case"Firefox":return bA.FIREFOX;case"QQ":case"QQBrowser":return bA.QQ;case"Opera":return bA.OPERA;case"WeChat":return bA.WECHAT;default:return e.browser.name||""}}(CA=RA.getResult()),n=AA(CA),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(CA),i=CA.os.version,a=AA(CA,!1),o=CA.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:o};yA={name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:o}}return yA}function AA(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function wA(){return IA().os}function OA(){var e=IA();return"".concat(e.os," ").concat(e.osVersion)}function kA(){var e=IA();return!!("WebKit"===CA.engine.name&&e.os===TA.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==bA.SAFARI||xA()&&e.name!==bA.SAFARI)}function NA(){return IA().name===bA.CHROME}function DA(){return IA().name===bA.SAFARI}function PA(){return IA().name===bA.EDGE}function LA(){return IA().name===bA.FIREFOX}function xA(){return IA().os===TA.IOS}function MA(e){var t=IA();return!(t.name!==bA.CHROME||!t.osVersion)&&Number(t.version)>=e}function UA(e){var t=IA();return!(t.name!==bA.CHROME||!t.osVersion)&&Number(t.version)<e}function VA(e,t,n){var r=IA();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function FA(e){var t=IA();return!(t.name!==bA.EDGE||!t.osVersion)&&Number(t.version)>=e}function BA(e){var t=IA();return!(t.name!==bA.SAFARI||!t.osVersion)&&Number(t.version)>=e}function jA(e,t,n){var r=IA();if(r.os!==TA.IOS||!r.osVersion)return!1;var i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function GA(e,t,n){var r=IA();if(r.name!==bA.SAFARI||!r.osVersion||!r.browserVersion)return!1;var i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function WA(e){var t=IA();return!(t.name!==bA.OPERA||!t.osVersion)&&Number(t.version)>=e}function HA(){var e=IA();if(e.os!==TA.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function KA(){var e=IA();if(e.os!==TA.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])}function YA(){var e=IA();if(e.os!==TA.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 16===Number(t[0])}function qA(){var e=IA();if(e.os!==TA.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function zA(){return DA()&&navigator.maxTouchPoints>0}function XA(){return IA().name===bA.WECHAT}function JA(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function QA(){var e=wA();return function(){var e=IA().deviceType;return"mobile"===e||"tablet"===e}()||e===TA.ANDROID||e===TA.IOS||e===TA.HARMONY_OS}function ZA(){var e=IA();return e.name!==bA.EDGE&&e.name!==bA.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function $A(){return wA()===TA.ANDROID}function ew(){var e=IA();return $A()&&(e.name===bA.CHROME||e.name===bA.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function tw(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nw(Object(n),!0).forEach((function(t){tw(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var iw=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),aw=function(e){function t(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;return tw(r(n=e.call(this,i)||this),"code",void 0),tw(r(n),"message",void 0),tw(r(n),"data",void 0),tw(r(n),"name","AgoraRTCException"),n.code=t,n.message="AgoraRTCError ".concat(n.code,": ").concat(i),n.data=a,n}i(t,e);var n=t.prototype;return n.toString=function(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message},n.print=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this},n.throw=function(e){throw this.print("error",e),this},t}(a(Error));function ow(e,t){if("boolean"!=typeof e)throw new aw(iw.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function sw(e,t,n){if(!Br(n).call(n,e))throw new aw(iw.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function cw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new aw(iw.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function uw(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new aw(iw.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&cw(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&cw(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&cw(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&cw(e.ideal,"".concat(t,".ideal"),1,1/0)}else cw(e,t,1,1/0)}function dw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new aw(iw.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!hw(e,n,r,i))throw new aw(iw.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function pw(e,t){if(!Array.isArray(e))throw new aw(iw.INVALID_PARAMS,"".concat(t," should be an array"))}function lw(e){return null==e}function hw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(var t=0;t<e.length;t+=1){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var fw=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(fw||{}),_w=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(_w||{}),vw=new(function(){return function(){var e=this;tw(this,"_clientSize",null),tw(this,"getClientWidth",(function(){return document.documentElement?document.documentElement.clientWidth:document.body.clientWidth})),tw(this,"getClientHeight",(function(){return document.documentElement?document.documentElement.clientHeight:document.body.clientHeight})),tw(this,"getStyle",(function(e){return window.getComputedStyle(e,null)})),tw(this,"checkCssVisibleProperty",(function(t){var n,r=!0,i=e.getStyle(t),a=i.display,o=i.visibility,s=i.opacity,c=i.filter;return("none"===a||Br(n=["hidden","collapse"]).call(n,o)||Number(s)<.1)&&(r=!1),!!r&&(c&&c.split(" ").filter((function(e){var t,n=e.split("(")[0];return Br(t=["brightness","blur","opacity"]).call(t,n)})).map((function(e){var t=e.split(/\(|\)/),n=t[0],r=t[1];return[n,Number(r.match(/^[0-9\.]+/))]})).forEach((function(e){var t=e[0],n=e[1];switch(t){case"brightness":(n<.1||n>3)&&(r=!1);break;case"blur":n>3&&(r=!1);break;case"opacity":n<.1&&(r=!1)}})),r)})),tw(this,"checkPropertyUpToAllParentNodes",(function(e,t){for(var n=!0,r=!0,i=function(e){return t(e)},a=e;a&&r;)i(a)||(n=!1,r=!1),(a=a.parentElement)||(r=!1);return n})),tw(this,"checkActualCssVisibleIncludeInherit",(function(t){return e.checkPropertyUpToAllParentNodes(t,e.checkCssVisibleProperty)})),tw(this,"getSizeAboutClient",(function(t){var n=t.getBoundingClientRect(),r=n.width,i=n.height,a=n.left,o=n.right,s=n.top,c=n.bottom,u=e.getClientWidth(),d=e.getClientHeight();return{width:r,height:i,left:a,right:o,top:s,bottom:c,clientWidth:u,clientHeight:d,clientMin:Math.min(u,d)}})),tw(this,"checkActualSize",(function(){var t=e._clientSize,n=t.width,r=t.height,i=t.clientMin;return e.checkSizeIsVisible(n,r,i)})),tw(this,"elementFromPoint",(function(e,t){return document.elementFromPoint?document.elementFromPoint(e,t):null})),tw(this,"checkCoverForAPoint",(function(t,n,r){var i=e.elementFromPoint(t,n);return null!==i&&i!==r})),tw(this,"getPointPositionList",(function(){for(var t=e._clientSize,n=t.width,r=t.height,i=t.left,a=t.top,o=n/6,s=r/6,c=[],u=Math.pow(10,6),d=0;d<5;d++)for(var p=0;p<5;p++){var l=(i*u+(0===d?.1:4===d?(o*d*u-1e5)/u:o*d)*u)/u,h=(a*u+(0===p?.1:4===p?(s*p*u-1e5)/u:s*p)*u)/u;c.push({x:l,y:h})}return[].concat(c)})),tw(this,"checkElementCover",(function(t){return e.getPointPositionList().map((function(n){return e.checkCoverForAPoint(n.x,n.y,t)})).filter((function(e){return!!e})).length>6})),tw(this,"checkSizeIsVisible",(function(e,t,n){return(e>50||n/e<=10)&&(t>50||n/t<=10)})),tw(this,"checkSizeOfPartInClient",(function(){var t,n,r=e._clientSize,i=r.left,a=r.right,o=r.top,s=r.bottom,c=r.clientHeight,u=r.clientWidth,d=r.clientMin;if(i<0)t=0;else{if(!(i<u))return!1;t=i}if(a<0)return!1;if(o<0)n=0;else{if(!(o<c))return!1;n=o}if(s<0)return!1;var p=(a<u?a:u)-t,l=(s<c?s:c)-n;return e.checkSizeIsVisible(p,l,d)})),tw(this,"returnHiddenResult",(function(t){return e._clientSize=null,{visible:!1,reason:t}})),tw(this,"checkOneElementVisible",(function(t){if(t instanceof HTMLElement){if(e.checkElementIsMountedOnDom(t)){if(e.checkActualCssVisibleIncludeInherit(t)){if(e._clientSize=e.getSizeAboutClient(t),e.checkElementCover(t))return e.returnHiddenResult(fw.COVERED);var n=e.checkActualSize(),r=e.checkSizeOfPartInClient();return n&&!r?e.returnHiddenResult(fw.POSITION):n?(e._clientSize=null,{visible:!0}):e.returnHiddenResult(fw.SIZE)}return e.returnHiddenResult(fw.STYLE)}return e.returnHiddenResult(_w.UNMOUNTED)}return e.returnHiddenResult(_w.INVALID_HTML_ELEMENT)})),tw(this,"checkElementIsMountedOnDom",(function(t){return e.checkPropertyUpToAllParentNodes(t,(function(e){return"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement}))}))}}());function Ew(e){return(new TextEncoder).encode(e)}var mw=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Sw=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e,t){var n="";return new Uint8Array(e).forEach((function(e){n+=e.toString(t).padStart(2,"0")})),n},e.next=3,crypto.subtle.digest("SHA-256",Ew(t));case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1,16));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gw=function(){function e(){tw(this,"_events",{}),tw(this,"addListener",this.on)}var t=e.prototype;return t.getListeners=function(e){return this._events[e]?this._events[e].map((function(e){return e.listener})):[]},t.on=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})},t.once=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})},t.off=function(e,t){if(this._events[e]){var n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}},t.removeAllListeners=function(e){e?delete this._events[e]:this._events={}},t.emit=function(e){this._events[e]||(this._events[e]=[]);for(var t=this._events[e].map((function(e){return e})),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a+=1){var o=t[a];o.once&&this.off(e,o.listener),o.listener.apply(this,r||[])}},t.safeEmit=function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[].concat(this._events[e]||[]).forEach((function(n){n.once&&t.off(e,n.listener);try{n.listener.apply(t,r)}catch(n){console.error("safeEmit event:".concat(e," error ").concat(null==n?void 0:n.toString()))}}))},t._indexOfListener=function(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1},e}(),Tw=null;function bw(){if(Tw)return Tw;if(window.electron)return Tw=window.electron;if(!window.require)return null;try{return Tw=window.require("electron")}catch(e){return null}}var Rw=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Cw=function(e){return e.TRACER="tracer",e}({});function yw(e){return cw(e.timeout,"config.timeout",0,1e5),cw(e.timeoutFactor,"config.timeoutFactor",0,100,!1),cw(e.maxRetryCount,"config.maxRetryConfig",0,1/0),cw(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var Iw=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Aw=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ww(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((function(e){if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function Ow(e){return dw(e.turnServerURL,"turnServerURL"),dw(e.username,"username"),dw(e.password,"password"),e.udpport&&cw(e.udpport,"udpport",1,99999,!0),e.forceturn&&ow(e.forceturn,"forceturn"),e.security&&ow(e.security,"security"),e.tcpport&&cw(e.tcpport,"tcpport",1,99999,!0),!0}function kw(e){return void 0!==e.level&&sw(e.level,"level",[1,2,3]),void 0!==e.delay&&cw(e.delay,"delay",0,3e3,!0),!0}var Nw=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Dw=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Pw=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Lw=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function xw(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?zl.reject(new aw(iw.UNEXPECTED_ERROR,"can not emit promise")):new zl((function(n,i){e.emit.apply(e,[t].concat(r,[n,i]))}))}function Mw(e,t){if(0===e.getListeners(t).length)return zl.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return xw.apply(void 0,[e,t].concat(r))}function Uw(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Vw.apply(void 0,[e,t].concat(r))}function Vw(e,t){for(var n=null,r=null,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];if(e.emit.apply(e,[t].concat(a,[function(e){n=e},function(e){r=e}])),null!==r)throw r;if(null===n)throw new aw(iw.UNEXPECTED_ERROR,"handler is not sync");return n}var Fw=new(function(e){function t(){var t;return tw(r(t=e.call(this)||this),"_moduleName","network-indicator"),tw(r(t),"_networkState",Pw.ONLINE),tw(r(t),"onlineWaiter",void 0),window.addEventListener("online",(function(){t.networkState=Pw.ONLINE})),window.addEventListener("offline",(function(){t.networkState=Pw.OFFLINE})),t}return i(t,e),v(t,[{key:"networkState",get:function(){return this._networkState},set:function(e){var t=this;this.emit(Lw.NETWORK_STATE_CHANGE,e,this._networkState),e===Pw.ONLINE?this.emit(Lw.ONLINE):e===Pw.OFFLINE&&(this.onlineWaiter=new zl((function(e){t.once(Lw.ONLINE,(function(){t.onlineWaiter=void 0,e(Pw.ONLINE)}))})),this.emit(Lw.OFFLINE)),this._networkState=e}},{key:"isOnline",get:function(){return this._networkState===Pw.ONLINE}}]),t}(gw));function Bw(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function jw(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),t}function Gw(e){void 0!==zl?zl.resolve().then(e):setTimeout(e,0)}function Ww(e){return JSON.parse(JSON.stringify(e))}function Hw(e){try{return Ww(e)}catch(t){return e}}var Kw={};function Yw(e,t){Kw[t]||(Kw[t]=!0,e())}function qw(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function zw(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Xw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){var r=new Uint8Array(t);r.set(n),n=r}return n}function Jw(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=ui(t).call(t,(function(e,t){return e+t.length}),0),i=new Uint8Array(new ArrayBuffer(r)),a=0;return t.forEach((function(e){i.set(e,a),a+=e.length})),i}function Qw(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Zw(e){var t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((function(e){t+="string"==typeof e?Qw(e):e.size})),t+138}function $w(e){var t=new aw(iw.TIMEOUT,"timeout");return new zl((function(n,r){window.setTimeout((function(){return r(t)}),e)}))}function eO(e){return new zl((function(t){window.setTimeout(t,e)}))}function tO(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+tO(e-n.length,"")}function nO(){return tO(32,"").toUpperCase()}var rO=function(){},iO=new(function(){function e(){tw(this,"fnMap",new Map)}return e.prototype.throttleByKey=function(e,t,n,r){for(var i=this,a=arguments.length,o=new Array(a>4?a-4:0),s=4;s<a;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){var c=this.fnMap.get(t);if(c.threshold!==n){c.fn.apply(c,c.args),clearTimeout(c.timer);var u=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,e.args),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:o,skipFn:r})}else c.skipFn&&c.skipFn.apply(c,c.args),this.fnMap.set(t,rw(rw({},c),{},{fn:e,args:o,skipFn:r}))}else{var d=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,e.args),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:o,skipFn:r})}},e}()),aO=iO.throttleByKey.bind(iO);function oO(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function sO(e,t){if(!oO(e)||!oO(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){for(var n=[].concat(e),r=0;r<t.length;r++)n[r]=sO(e[r],t[r]);return n}var i=rw({},e);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?i[a]=sO(e[a],t[a]):i[a]=t[a]);return i}function cO(e,t){var n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;for(var r=0;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function uO(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function dO(e){return ui(e).call(e,(function(e,t){return e+t}),0)}function pO(e){var t="0123456789abcdef";function n(e){var n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,o)),a),n)}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}var u,d,p,l,h,f=function(e){var t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),_=1732584193,v=-271733879,E=-1732584194,m=271733878;for(u=0;u<f.length;u+=16)d=_,p=v,l=E,h=m,_=a(_,v,E,m,f[u+0],7,-680876936),m=a(m,_,v,E,f[u+1],12,-389564586),E=a(E,m,_,v,f[u+2],17,606105819),v=a(v,E,m,_,f[u+3],22,-1044525330),_=a(_,v,E,m,f[u+4],7,-176418897),m=a(m,_,v,E,f[u+5],12,1200080426),E=a(E,m,_,v,f[u+6],17,-1473231341),v=a(v,E,m,_,f[u+7],22,-45705983),_=a(_,v,E,m,f[u+8],7,1770035416),m=a(m,_,v,E,f[u+9],12,-1958414417),E=a(E,m,_,v,f[u+10],17,-42063),v=a(v,E,m,_,f[u+11],22,-1990404162),_=a(_,v,E,m,f[u+12],7,1804603682),m=a(m,_,v,E,f[u+13],12,-40341101),E=a(E,m,_,v,f[u+14],17,-1502002290),_=o(_,v=a(v,E,m,_,f[u+15],22,1236535329),E,m,f[u+1],5,-165796510),m=o(m,_,v,E,f[u+6],9,-1069501632),E=o(E,m,_,v,f[u+11],14,643717713),v=o(v,E,m,_,f[u+0],20,-373897302),_=o(_,v,E,m,f[u+5],5,-701558691),m=o(m,_,v,E,f[u+10],9,38016083),E=o(E,m,_,v,f[u+15],14,-660478335),v=o(v,E,m,_,f[u+4],20,-405537848),_=o(_,v,E,m,f[u+9],5,568446438),m=o(m,_,v,E,f[u+14],9,-1019803690),E=o(E,m,_,v,f[u+3],14,-187363961),v=o(v,E,m,_,f[u+8],20,1163531501),_=o(_,v,E,m,f[u+13],5,-1444681467),m=o(m,_,v,E,f[u+2],9,-51403784),E=o(E,m,_,v,f[u+7],14,1735328473),_=s(_,v=o(v,E,m,_,f[u+12],20,-1926607734),E,m,f[u+5],4,-378558),m=s(m,_,v,E,f[u+8],11,-2022574463),E=s(E,m,_,v,f[u+11],16,1839030562),v=s(v,E,m,_,f[u+14],23,-35309556),_=s(_,v,E,m,f[u+1],4,-1530992060),m=s(m,_,v,E,f[u+4],11,1272893353),E=s(E,m,_,v,f[u+7],16,-155497632),v=s(v,E,m,_,f[u+10],23,-1094730640),_=s(_,v,E,m,f[u+13],4,681279174),m=s(m,_,v,E,f[u+0],11,-358537222),E=s(E,m,_,v,f[u+3],16,-722521979),v=s(v,E,m,_,f[u+6],23,76029189),_=s(_,v,E,m,f[u+9],4,-640364487),m=s(m,_,v,E,f[u+12],11,-421815835),E=s(E,m,_,v,f[u+15],16,530742520),_=c(_,v=s(v,E,m,_,f[u+2],23,-995338651),E,m,f[u+0],6,-198630844),m=c(m,_,v,E,f[u+7],10,1126891415),E=c(E,m,_,v,f[u+14],15,-1416354905),v=c(v,E,m,_,f[u+5],21,-57434055),_=c(_,v,E,m,f[u+12],6,1700485571),m=c(m,_,v,E,f[u+3],10,-1894986606),E=c(E,m,_,v,f[u+10],15,-1051523),v=c(v,E,m,_,f[u+1],21,-2054922799),_=c(_,v,E,m,f[u+8],6,1873313359),m=c(m,_,v,E,f[u+15],10,-30611744),E=c(E,m,_,v,f[u+6],15,-1560198380),v=c(v,E,m,_,f[u+13],21,1309151649),_=c(_,v,E,m,f[u+4],6,-145523070),m=c(m,_,v,E,f[u+11],10,-1120210379),E=c(E,m,_,v,f[u+2],15,718787259),v=c(v,E,m,_,f[u+9],21,-343485551),_=r(_,d),v=r(v,p),E=r(E,l),m=r(m,h);return n(_)+n(v)+n(E)+n(m)}var lO=1,hO=console,fO=function(){function e(e,t){tw(this,"id",void 0),tw(this,"lockingPromise",zl.resolve()),tw(this,"locks",0),tw(this,"name",""),tw(this,"lockId",void 0),this.lockId=lO++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}e.setLogger=function(e){hO=e};var t=e.prototype;return t.logger=function(e,t){var n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");hO.debug("".concat(n," ").concat(r))},t.setId=function(e){this.id=e},t.lock=function(e){var t,n=this;this.locks+=1,this.logger("locked",e);var r=new zl((function(r){t=function(){n.locks-=1,n.logger("unlocked",e),r()}})),i=this.lockingPromise.then((function(){return t}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),i},v(e,[{key:"isLocked",get:function(){return this.locks>0}}]),e}();function _O(e,t){return function(n,r,i){var a=i.value;if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return i.value=p(l().mark((function n(){var i,o,s,c,u,d=arguments;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this[t]){n.next=3;break}throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));case 3:return n.next=5,i.lock("From ".concat(e,".").concat(r));case 5:for(o=n.sent,n.prev=6,s=d.length,c=new Array(s),u=0;u<s;u++)c[u]=d[u];return n.next=10,a.apply(this,c);case 10:return n.abrupt("return",n.sent);case 11:return n.prev=11,o(),n.finish(11);case 14:case"end":return n.stop()}}),n,this,[[6,,11,14]])}))),i}}var vO={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function EO(e,t){var n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function mO(e,t,n,r){var i=Object.assign({},vO,r),a=i.timeout,o=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(e){return new zl((function(t){window.setTimeout(t,e)}))}(a);case 2:a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=!1,c=new zl(p(l().mark((function r(a,c){var u,d;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=t||function(){return!1},n=n||function(){return!0},u=0;case 2:if(!(u<i.maxRetryCount)){r.next=28;break}if(!s){r.next=5;break}return r.abrupt("return",c(new aw(iw.OPERATION_ABORTED)));case 5:return r.prev=5,r.next=8,e();case 8:if(d=r.sent,t(d,u)){r.next=11;break}return r.abrupt("return",a(d));case 11:if(u+1!==i.maxRetryCount){r.next=13;break}return r.abrupt("return",a(d));case 13:return r.next=15,o();case 15:r.next=25;break;case 17:if(r.prev=17,r.t0=r.catch(5),n(r.t0,u)){r.next=21;break}return r.abrupt("return",c(r.t0));case 21:if(u+1!==i.maxRetryCount){r.next=23;break}return r.abrupt("return",c(r.t0));case 23:return r.next=25,o();case 25:u+=1,r.next=2;break;case 28:case"end":return r.stop()}}),r,null,[[5,17]])}))));return c.cancel=function(){return s=!0},c}var SO,gO=function(){function e(e){tw(this,"input",[]),tw(this,"size",void 0),this.size=e}var t=e.prototype;return t.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},t.mean=function(){var e;return 0===this.input.length?0:ui(e=this.input).call(e,(function(e,t){return e+t}))/this.input.length},e}();function TO(e,t,n,r){return new zl((function(i,a){t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Qw(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?Zw(t.data):Qw(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,_A.request(t).then((function(e){"string"==typeof e.data?Qw(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:Qw(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((function(e){_A.isCancel(e)?a(new aw(iw.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new aw(iw.NETWORK_TIMEOUT,e.message)):e.response?a(new aw(iw.NETWORK_RESPONSE_ERROR,e.response.status)):a(new aw(iw.NETWORK_ERROR,e.message))}))}))}function bO(e,t){return RO.apply(this,arguments)}function RO(){return(RO=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Blob([n.data],{type:"buffer"}),e.next=3,TO(t,rw(rw({},n),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var CO=function(){return void 0!==window.isSecureContext};function yO(e){if(Array.isArray(e))return e.map((function(e){return e}));if(!IO(e))return e;var t={};for(var n in e){var r=e[n];IO(r)||Array.isArray(r)?t[n]=yO(r):t[n]=r}return t}function IO(e){return!("object"!=typeof e||Array.isArray(e)||!e)}var AO=function(){function e(e){tw(this,"input",[]),tw(this,"size",void 0),this.size=e}var t=e.prototype;return t.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},t.diffMean=function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},e}(),wO={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},OO={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:wO,remoteCandidate:wO},updateInterval:0},kO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},NO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},DO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},PO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},LO=function(){function e(e,t){var n=this;tw(this,"onFirstVideoReceived",void 0),tw(this,"onFirstVideoDecoded",void 0),tw(this,"onFirstAudioReceived",void 0),tw(this,"onFirstVideoDecodedTimeout",void 0),tw(this,"onFirstAudioDecoded",void 0),tw(this,"onSelectedLocalCandidateChanged",void 0),tw(this,"onSelectedRemoteCandidateChanged",void 0),tw(this,"videoIsReady",!1),tw(this,"videoIsReady2",{}),tw(this,"pc",void 0),tw(this,"options",void 0),tw(this,"intervalTimer",void 0),tw(this,"stats",yO(OO)),tw(this,"isFirstVideoReceived",{}),tw(this,"isFirstVideoDecoded",{}),tw(this,"isFirstAudioReceived",{}),tw(this,"isFirstAudioDecoded",{}),tw(this,"isFirstVideoDecodedTimeout",{}),tw(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.updateStats();case 1:case"end":return e.stop()}}),e)}))),this.options.updateInterval)}var t=e.prototype;return t.getStats=function(){return this.stats},t.getSelectedCandidatePair=function(){return new zl((function(e){e({local:rw({},wO),remote:rw({},wO)})}))},t.setVideoIsReady=function(e){this.videoIsReady=e},t.setVideoIsReady2=function(e,t){this.videoIsReady2[e]=t},t.getVideoIsReady=function(e){return this.videoIsReady2[e]||!1},t.setIsFirstAudioDecoded=function(e){},t.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},t.calcLossRate=function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,a=0,o=0,s=function(){var s=u[c];e[s].forEach((function(e,c){if(t.lossRateWindowStats[n-1][s][c]&&t.lossRateWindowStats[0][s][c]){var u=t.lossRateWindowStats[n-1][s][c].packets-t.lossRateWindowStats[0][s][c].packets,d=t.lossRateWindowStats[n-1][s][c].packetsLost-t.lossRateWindowStats[0][s][c].packetsLost;"videoSend"===s||"audioSend"===s?(r+=u,a+=d):(i+=u,o+=d),Number.isNaN(u)||Number.isNaN(u)?e.packetLostRate=0:e.packetLostRate=u<=0||d<=0?0:d/(u+d)}}))},c=0,u=["videoSend","audioSend","videoRecv","audioRecv"];c<u.length;c++)s();e.sendPacketLossRate=r<=0||a<=0?0:a/(r+a),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)},e}(),xO=function(e){function t(){var t;return tw(r(t=e.apply(this,arguments)||this),"_stats",OO),tw(r(t),"lastDecodeVideoReceiverStats",new Map),t}i(t,e);var n=t.prototype;return n.updateStats=function(){var e=p(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStats();case 2:t=e.sent,n=this.statsResponsesToObjects(t),this._stats=yO(OO),r=n.filter((function(e){return"ssrc"===e.type})),this.processSSRCStats(r),(i=n.find((function(e){return"VideoBwe"===e.type})))&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.processBandwidthStats=function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)},n.processSSRCStats=function(e){var t=this;e.forEach((function(e){var n,r=Br(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(r?"send":"recv")){case"video_send":var i=yO(NO);i.codec=e.googCodecName,i.adaptionChangeReason="none",e.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(e.googAvgEncodeMs),i.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.firsCount=Number(e.googFirReceived),i.nacksCount=Number(e.googNacksReceived),i.plisCount=Number(e.googPlisReceived),i.frameCount=Number(e.framesEncoded),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(i),t._stats.rtt=i.rttMs;break;case"video_recv":var a=yO(kO),o=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(a.codec=e.googCodecName,a.targetDelayMs=Number(e.googTargetDelayMs),a.renderDelayMs=Number(e.googRenderDelayMs),a.currentDelayMs=Number(e.googCurrentDelayMs),a.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),a.decodeMs=Number(e.googDecodeMs),a.maxDecodeMs=Number(e.googMaxDecodeMs),a.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},a.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},a.decodeFrameRate=Number(e.googFrameRateDecoded),a.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},a.jitterBufferMs=Number(e.googJitterBufferMs),a.firsCount=Number(e.googFirsSent),a.nacksCount=Number(e.googNacksSent),a.plisCount=Number(e.googPlisSent),a.framesDecodeCount=Number(e.framesDecoded),a.bytes=Number(e.bytesReceived),a.packets=Number(e.packetsReceived),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.packets>0&&!t.isFirstVideoReceived[a.ssrc]&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(a.ssrc),t.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!t.isFirstVideoDecoded[a.ssrc]&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),t.isFirstVideoDecoded[a.ssrc]=!0),o){var s=o.stats,c=Date.now()-o.lts;a.framesDecodeFreezeTime=s.framesDecodeFreezeTime,a.framesDecodeInterval=s.framesDecodeInterval,a.framesDecodeCount>s.framesDecodeCount&&t.isFirstVideoDecoded[a.ssrc]?(o.lts=Date.now(),a.framesDecodeInterval=c,a.framesDecodeInterval>=t.options.freezeRateLimit&&(t.getVideoIsReady(parseInt(e.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:t.setVideoIsReady2(parseInt(e.ssrc,10),!0))):a.framesDecodeCount<o.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:rw({},a),lts:Date.now()}),t._stats.videoRecv.push(a);break;case"audio_recv":var u=yO(PO);u.codec=e.googCodecName,u.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,u.decodingCNG=Number(e.googDecodingCNG),u.decodingCTN=Number(e.googDecodingCTN),u.decodingCTSG=Number(e.googDecodingCTSG),u.decodingNormal=Number(e.googDecodingNormal),u.decodingPLC=Number(e.googDecodingPLC),u.decodingPLCCNG=Number(e.googDecodingPLCCNG),u.expandRate=Number(e.googExpandRate),u.accelerateRate=Number(e.googAccelerateRate),u.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),u.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),u.speechExpandRate=Number(e.googSpeechExpandRate),u.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),u.jitterBufferMs=Number(e.googJitterBufferMs),u.jitterMs=Number(e.googJitterReceived),u.bytes=Number(e.bytesReceived),u.packets=Number(e.packetsReceived),u.packetsLost=Number(e.packetsLost),u.ssrc=Number(e.ssrc),u.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),u.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),u.receivedFrames>0&&!t.isFirstAudioReceived[u.ssrc]&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(u.ssrc),t.isFirstAudioReceived[u.ssrc]=!0),u.decodingNormal>0&&!t.isFirstAudioDecoded[u.ssrc]&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(u.ssrc),t.isFirstAudioDecoded[u.ssrc]=!0),t._stats.audioRecv.push(u);break;case"audio_send":var d=yO(DO);d.codec=e.googCodecName,d.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,d.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(e.bytesSent),d.packets=Number(e.packetsSent),d.packetsLost=Number(e.packetsLost),d.ssrc=Number(e.ssrc),d.rttMs=Number(e.googRtt||0),t._stats.rtt=d.rttMs,t._stats.audioSend.push(d)}}))},n._getStats=function(){var e=this;return new zl((function(t,n){e.pc.getStats(t,n)}))},n.statsResponsesToObjects=function(e){var t=[];return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t.push(n)})),t},t}(LO),MO=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),UO=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),VO=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),FO=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),BO=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(BO||{});function jO(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:BO.kNone;if(t){var a=Number(t[n]);if("number"==typeof a){var o=Number(t[r]);if("number"==typeof o){if(!e)return o?a/o*i:void 0;var s=Number(e[n]);if("number"==typeof s){var c=Number(e[r]);if("number"==typeof c){var u=o-c;return u?(a-s)/u*i:void 0}}}}}}var GO=function(e){function t(){var t;return tw(r(t=e.apply(this,arguments)||this),"_stats",OO),tw(r(t),"report",void 0),tw(r(t),"lastDecodeVideoReceiverStats",new Map),tw(r(t),"lastVideoFramesRecv",new Map),tw(r(t),"lastVideoFramesSent",new Map),tw(r(t),"lastVideoFramesDecode",new Map),tw(r(t),"lastVideoFramesOutput",new Map),tw(r(t),"lastVideoJBDelay",new Map),tw(r(t),"lastAudioJBDelay",new Map),tw(r(t),"mediaBytesSent",new Map),tw(r(t),"mediaBytesRetransmit",new Map),tw(r(t),"mediaBytesTargetEncode",new Map),tw(r(t),"lastDecodeAudioReceiverStats",new Map),tw(r(t),"lastAudioConcealment",new Map),tw(r(t),"lastEncoderMs",new Map),t}i(t,e);var n=t.prototype;return n.updateStats=function(){var e=p(l().mark((function e(){var t=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.getStats();case 2:this.report=e.sent,this._stats=yO(OO),this.report.forEach((function(e){switch(e.type){case FO.OUTBOUND:case FO.INBOUND:var n=e.mediaType||e.kind,r=!n&&"frameWidth"in e,i=!n&&!("frameWidth"in e);e.type===FO.OUTBOUND?"audio"===n||i?t.processAudioOutboundStats(e):("video"===n||r)&&t.processVideoOutboundStats(e):e.type===FO.INBOUND&&("audio"===n||i?t.processAudioInboundStats(e):("video"===n||r)&&t.processVideoInboundStats(e));break;case FO.TRANSPORT:var a=t.report.get(e.selectedCandidatePairId);a&&t.processCandidatePairStats(a);break;case FO.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getSelectedCandidatePair=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.getStats();case 2:return t=e.sent,n={local:rw({},wO),remote:rw({},wO)},e.abrupt("return",(t.forEach((function(e){var r;if(e.type===FO.TRANSPORT&&(r=t.get(e.selectedCandidatePairId)),e.type===FO.CANDIDATE_PAIR&&e.selected&&(r=e),r){var i=function(e,t){e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){var a=t.get(r.localCandidateId);a&&i(n.local,a)}if(r.remoteCandidateId){var o=t.get(r.remoteCandidateId);o&&i(n.remote,o)}}})),n));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.processCandidatePairStats=function(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){var t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){var n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}},n.processCandidateStats=function(e){var t;e.type===FO.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===FO.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===FO.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(rw({},t),rw({},this.stats.selectedCandidatePair.localCandidate)),e.type===FO.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(rw({},t),rw({},this.stats.selectedCandidatePair.remoteCandidate)))},n.processAudioInboundStats=function(e){var t=this._stats.audioRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=yO(PO),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;var n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=jO(n,t,"totalProcessingDelay","jitterBufferEmittedCount",BO.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,rw({},t))},n.calculateAudioFreeze=function(e,t,n){var r=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=r){var i=r.lts,a=n.timestamp,o=a-i;if(o<=0)return;var s=e.concealedSamples-t.concealedSamples-0,c=r.nonSilent+s,u=e.totalSamplesReceived-t.totalSamplesReceived;if(u<=0)return;var d=80*u/o,p=200*u/o,l=o/u,h=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(r.plc80>0?(e.freezeSamples80+=s,e.freezeMs80+=Math.round(s*l)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*l)),h=r.plc80+1);var f=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>p&&(r.plc200>0?(e.freezeSamples200+=s,e.freezeMs200+=Math.round(s*l)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*l)),f=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:s,lts:a,plc80:h,plc200:f})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})},n.processVideoInboundStats=function(e){var t=this._stats.videoRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=yO(kO),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){var o=t.decodedFrame?t.decodedFrame.width:0,s=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,s),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){var c=n.stats,u=a-n.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=jO(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=jO(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",BO.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=jO(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",BO.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=jO(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",BO.kMillisecondsFromSeconds),r&&a-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&a-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:rw({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})},n.processVideoOutboundStats=function(e){var t=this._stats.videoSend.find((function(t){return t.ssrc===e.ssrc}));t||(t=yO(NO),this._stats.videoSend.push(t));var n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{var r=new AO(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(void 0!==e.retransmittedBytesSent){var i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{var a=new AO(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){var o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{var s=new AO(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){var c=this.lastEncoderMs.get(e.ssrc);if(!c||c.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{var u=e.framesEncoded-c.lastFrameCount,d=e.totalEncodeTime-c.lastEncoderTime;t.avgEncodeMs=1e3*d/u}}if(e.framesEncoded&&e.qpSum){var p=this.lastEncoderMs.get(e.ssrc);!p||p.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-p.lastQpSum)/(e.framesEncoded-p.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var l=this.findRemoteStatsId(e.ssrc,FO.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,t)}},n.processAudioOutboundStats=function(e){var t=this._stats.audioSend.find((function(t){return t.ssrc===e.ssrc}));if(t||(t=yO(DO),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,FO.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}},n.findRemoteStatsId=function(e,t){var n,r=Array.from(nh(n=this.report).call(n)).find((function(n){return n.type===t&&n.ssrc===e}));return r?r.id:null},n.processVideoMediaSource=function(e,t){var n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})},n.processAudioMediaSource=function(e,t){var n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)},n.processVideoTrackSenderStats=function(e,t,n){var r,i,a,o,s=t?this.report.get(t):void 0,c=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"==typeof c){var u=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(a=null==s?void 0:s.frameHeight)&&void 0!==a?a:e.frameHeight,p=null!==(o=null==s?void 0:s.framesPerSecond)&&void 0!==o?o:e.framesPerSecond;if("number"==typeof u&&"number"==typeof d||(u=0,d=0),null==p){var l=Date.now(),h=this.lastVideoFramesSent.get(n.ssrc);h&&l-h.lts>=800?(p=Math.round((c-h.count)/((l-h.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:l,rate:p})):h?p=h.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:l,rate:0})}n.sentFrame={width:u,height:d,frameRate:Math.max(0,p)}}},n.processVideoTrackReceiverStats=function(e,t,n){var r,i,a,o,s,c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,d=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,p=null!==(a=null==c?void 0:c.frameHeight)&&void 0!==a?a:e.frameHeight,l=null!==(o=null==c?void 0:c.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,h=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof u){var f=this.lastVideoFramesRecv.get(n.ssrc),_=Date.now();n.framesReceivedCount=u;var v=0;f&&_-f.lts>=800?(v=Math.round((u-f.count)/((_-f.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:_,rate:v})):f?v=f.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:_,rate:0}),n.receivedFrame={width:d||0,height:p||0,frameRate:v||0},n.decodedFrame={width:d||0,height:p||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:p||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(l&&h){var E=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},m=E.jitterBufferMs,S=h-E.jitterBufferEmittedCount;S>0&&(m=1e3*(l-E.jitterBufferDelay)/S),n.jitterBufferMs=m,n.currentDelayMs=Math.round(m),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:l,jitterBufferEmittedCount:h,jitterBufferMs:n.currentDelayMs})}},n.processAudioTrackSenderStats=function(e,t,n){var r,i,a,o,s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(a=null!==(o=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==o?o:e.echoReturnLossEnhancement)&&void 0!==a?a:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u},n.processAudioTrackReceiverStats=function(e,t,n){var r,i,a,o,s,c,u,d,p,l=t?this.report.get(t):void 0,h=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,f=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,_=null!==(a=null==l?void 0:l.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,v=null!==(o=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount,E=null!==(s=null==l?void 0:l.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,m=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,S=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples,g=null!==(d=null==l?void 0:l.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,T=null!==(p=null==l?void 0:l.concealmentEvents)&&void 0!==p?p:e.concealmentEvents;if("number"==typeof f&&(n.totalSamplesReceived=f),"number"==typeof g&&(n.silentConcealedSamples=g),"number"==typeof T&&(n.concealmentEvents=T),"number"==typeof S&&(n.concealedSamples=S),h&&f&&(n.accelerateRate=h/f),_&&v){var b=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},R=b.jitterBufferMs,C=v-b.jitterBufferEmittedCount;C>0&&(R=1e3*(_-b.jitterBufferDelay)/C),n.jitterBufferMs=Math.round(R),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:v,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=E;var y=1920;m&&f&&(y=f/m/50,n.receivedFrames=Math.round(f/y)),S&&(n.droppedFrames=Math.round(S/y))},n.processRemoteInboundStats=function(e,t){var n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))},n.getCodecFromCodecStats=function(e){var t=this.report.get(e);if(!t)return"";var n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""},n.updateSendBitrate=function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach((function(t){e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((function(e){t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((function(e){n=null===n?e.diffMean():n+e.diffMean()}));var r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))},t}(LO),WO=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype.updateStats=function(){return zl.resolve()},t}(LO);function HO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,a=function(){var e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return a?a<76?new xO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new GO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;var t=e.getStats();return!!(t instanceof zl||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new GO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new WO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}var KO="websdk_ng_install_id";function YO(){try{if(rk("INSTALL_ID"))return rk("INSTALL_ID");var e=window.localStorage.getItem(KO);return e||(e=nO(),window.localStorage.setItem(KO,e)),nk("INSTALL_ID",e),e}catch(e){return}}var qO=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){var n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.23.4"),zO=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),XO=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),JO=function(){var e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");for(var r=n.join(""),i=[],a=0;a<6;a++)i.push("1");var o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=JO;var QO={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},ZO={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},$O="v4.23.4-0-g17410532-dirty(6/5/2025, 4:24:52 PM)",ek={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},tk=rw(rw(rw(rw({},ek),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:ZO,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},QO),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function nk(e,t,n){var r,i,a;Br(r=Object.keys(tk)).call(r,e)&&(!n&&Br(i=Object.keys(ak)).call(i,e)||(tk[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(tk.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(tk.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(a=!!t,tk.USE_NEW_NETWORK_CONFIG=a,a&&(tk.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],tk.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],tk.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],tk.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],tk.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",tk.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",tk.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(tk.ENABLE_INSTANT_VIDEO=!0,tk.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(tk.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(tk.NEW_TURN_MODE||(tk.NEW_TURN_MODE=4))))}function rk(e){return tk[e]}zO||(tk.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],tk.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],tk.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],tk.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],tk.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],tk.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],tk.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",tk.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",tk.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",tk.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",tk.AREAS=["NORTH_AMERICA","OVERSEA"]);var ik=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),ak={},ok=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ok||{}),sk=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});var ck=10,uk=0,dk=function(){var e={8:function(e,t,n){n.r(t),n.d(t,{Parser:function(){return y},Printer:function(){return k},parse:function(){return L},print:function(){return x}});var a,o="\n",s="".concat("\r").concat(o),c=" ";function u(e){return e>="0"&&e<="9"}function d(e){return e>="!"&&e<="~"}function p(e){return d(e)||e>=""&&e<="ÿ"}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function f(e){return e>="1"&&e<="9"}function _(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function v(e){return"d"===e||"h"===e||"m"===e||"s"===e}function E(e){return e>""&&e<"\t"||e>"\v"&&e<"\f"||e>""&&e<"ÿ"}function m(e){return _(e)||u(e)||"+"===e||"/"===e}function S(e){return u(e)||_(e)||"+"===e||"/"===e||"-"===e||"_"===e}function g(e){return _(e)||u(e)||"+"===e||"/"===e}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));var C=function(){function e(){}var t=e.prototype;return t.consumeText=function(e,t){for(var n=t;n<e.length;){var r=e[n];if("\0"===r||"\r"===r||r===o)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n},t.consumeUnicastAddress=function(e,t,n){return this.consumeTill(e,t,c)},t.consumeOneOrMore=function(e,t,n){for(var r=t;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r},t.consumeSpace=function(e,t){if(e[t]===c)return t+1;throw new Error("Invalid space at ".concat(t,"."))},t.consumeIP4Address=function(e,t){for(var n=t,r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n},t.consumeDecimalUChar=function(e,t){for(var n=t,r=0;r<3&&u(e[n]);r++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");var i=parseInt(e.slice(t,n));if(i>=0&&i<=255)return n;throw new Error("Invalid decimal uchar")},t.consumeIP6Address=function(e,t){var n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n)):n},t.consumeHexpart=function(e,t){var n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(":"===e[n=this.consumeHexseq(e,n)]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n},t.consumeHexseq=function(e,t){for(var n=t;":"===e[n=this.consumeHex4(e,n)]&&":"!==e[n+1];)n+=1;return n},t.consumeHex4=function(e,t){for(var n,r=0;r<4;r++)if(!((n=e[t+r])>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F")){if(0===r)throw new Error("Invalid hex 4");break}return t+r},t.consumeFQDN=function(e,t){for(var n=t;u(e[n])||_(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n},t.consumeExtnAddr=function(e,t){return this.consumeOneOrMore(e,t,p)},t.consumeMulticastAddress=function(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}},t.consumeIP6MulticastAddress=function(e,t){var n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n},t.consumeIP4MulticastAddress=function(e,t){var n=t+3,r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(var a=0;a<3;a++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),"/"===e[n=this.consumeTTL(e,n)]&&(n=this.consumeInteger(e,n)),n},t.consumeInteger=function(e,t){if(!f(e[t]))throw new Error("Invalid integer.");for(t+=1;u(e[t]);)t+=1;return t},t.consumeTTL=function(e,t){if("0"===e[t])return t+1;if(!f(e[t]))throw new Error("Invalid TTL.");t+=1;for(var n=0;n<2&&u(e[t]);n++)t+=1;return t},t.consumeToken=function(e,t){return this.consumeOneOrMore(e,t,l)},t.consumeTime=function(e,t){var n=t;if("0"===e[n])return n+1;for(f(e[n])&&(n+=1);u(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n},t.consumeAddress=function(e,t){return this.consumeTill(e,t,c)},t.consumeTypedTime=function(e,t){var n=t;return v(e[n=this.consumeOneOrMore(e,n,u)])?n+1:n},t.consumeRepeatInterval=function(e,t){if(!f(e[t]))throw new Error("Invalid repeat interval");for(t+=1;u(e[t]);)t+=1;return v(e[t])&&(t+=1),t},t.consumePort=function(e,t){return this.consumeOneOrMore(e,t,u)},t.consume=function(e,t,n){for(var r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length},t.consumeTill=function(e,t,n){for(var r=t;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r},e}(),y=function(e){function t(){var t;return R(r(t=e.call(this)||this),"records",[]),R(r(t),"currentLine",0),t}i(t,e);var n=t.prototype;return n.parse=function(e){var t=this.probeEOL(e);this.records=e.split(t).filter((function(e){return!!mS(e).call(e)})).map(this.parseLine),this.currentLine=0;var n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),a=this.parseInformation(),o=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),d=this.parseBandWidth(),p=this.parseTimeFields(),l=this.parseKey(),h=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:a,uri:o,emails:s,phones:c,connection:u,bandwidths:d,timeFields:p,key:l,attributes:h,mediaDescriptions:f}},n.getCurrentRecord=function(){var e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e},n.probeEOL=function(e){for(var t=0;t<e.length;t++)if(e[t]===o)return"\r"===e[t-1]?s:o;throw new Error("Invalid newline character.")},n.parseLine=function(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");var n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}},n.parseSessionAttribute=function(){for(var e=new A;this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;var n={attField:this.extractOneOrMore(t,(function(e){return l(e)&&":"!==e})),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,E)),e.parse(n),this.currentLine++}return e.digest()},n.parseMediaAttributes=function(e){for(var t=new w(e);this.currentLine<this.records.length;){var n=this.getCurrentRecord();if(n.type!==a.ATTRIBUTE)break;var r={attField:this.extractOneOrMore(n,(function(e){return l(e)&&":"!==e})),_cur:0};":"===n.value[n.cur]&&(n.cur+=1,r.attValue=this.extractOneOrMore(n,E)),t.parse(r),this.currentLine++}return t.digest()},n.parseKey=function(){var e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}},n.parseZone=function(){var e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){for(var t=[];;)try{var n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);var i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]},n.parseRepeat=function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;var n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}return e},n.parseTypedTime=function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t},n.parseTime=function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}},n.parseBandWidth=function(){for(var e=[];this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;var n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;var r=this.extractOneOrMore(t,u);e.push({bwtype:n,bandwidth:r}),this.currentLine++}return e},n.parseVersion=function(){var e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");var t=e.value.slice(0,this.consumeOneOrMore(e.value,0,u));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t},n.parseOrigin=function(){var e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");var t=this.extractOneOrMore(e,p);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);var r=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);var i=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);var o=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);var s=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:s}},n.parseSessionName=function(){var e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){var t=this.extract(e,this.consumeText);return this.currentLine++,t}},n.parseInformation=function(){var e=this.getCurrentRecord();if(e.type===a.INFORMATION){var t=this.extract(e,this.consumeText);return this.currentLine++,t}},n.parseUri=function(){var e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value},n.parseEmail=function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e},n.parsePhone=function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e},n.parseConnection=function(){var e=this.getCurrentRecord();if(e.type===a.CONNECTION){var t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);var r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}},n.parseMedia=function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);var r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");var i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}},n.parseTimeFields=function(){for(var e=[];this.getCurrentRecord().type===a.TIME;){var t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e},n.parseMediaDescription=function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){var t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:s})}return e},n.parseConnections=function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e},n.parseFmt=function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t},n.extract=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.call.apply(t,[this,e.value,e.cur].concat(r)),o=e.value.slice(e.cur,a);return e.cur=a,o},n.extractOneOrMore=function(e,t){var n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r},n.consumeSpaceForRecord=function(e){if(e.value[e.cur]!==c)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1},t}(C),I=function(e){function t(){var t;return R(r(t=e.apply(this,arguments)||this),"attributes",void 0),R(r(t),"digested",!1),t}i(t,e);var n=t.prototype;return n.extractOneOrMore=function(e,t,n){var r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),a=n||[],o=a[0],s=a[1];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i},n.consumeAttributeSpace=function(e){if(e.attValue[e._cur]!==c)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1},n.extract=function(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.call.apply(t,[this,e.attValue,e._cur].concat(r)),o=e.attValue.slice(e._cur,a);return e._cur=a,o},n.atEnd=function(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length},n.peekChar=function(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]},n.peek=function(e,t){if(!e.attValue)throw new Error;for(var n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0},n.parseIceUfrag=function(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])},n.parseIcePwd=function(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])},n.parseIceOptions=function(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");for(var t=[];!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t},n.parseFingerprint=function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})},n.parseExtmap=function(e){var t,n=this.extractOneOrMore(e,u);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeTill,c),i=b(b({entry:parseInt(n,10)},t&&{direction:t}),{},{extensionName:r});this.peekChar(e)===c&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)},n.parseSetup=function(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");var t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t},t}(C),A=function(e){function t(){var t;return R(r(t=e.apply(this,arguments)||this),"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]}),t}i(t,e);var n=t.prototype;return n.parse=function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")},n.digest=function(){return this.digested=!0,this.attributes},n.parseGroup=function(e){for(var t=this.extract(e,this.consumeToken),n=[];!this.atEnd(e)&&this.peekChar(e)===c;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})},n.parseIceLite=function(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0},n.parseTlsId=function(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,S)},n.parseIdentity=function(e){for(var t=this.extractOneOrMore(e,g),n=[];!this.atEnd(e)&&this.peekChar(e)===c;){this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");var i=this.extractOneOrMore(e,(function(e){return e!==c&&E(e)}));n.push({name:r,value:i})}this.attributes.identities.push({assertionValue:t,extensions:n})},n.parseMsidSemantic=function(e){this.peekChar(e)===c&&this.consumeAttributeSpace(e);for(var t={semantic:this.extract(e,this.consumeToken),identifierList:[]};;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}var n=this.extract(e,this.consumeTill,c);t.identifierList.push(n)}this.attributes.msidSemantic=t},t}(I),w=function(e){function t(t){var n;return R(r(n=e.call(this)||this),"attributes",void 0),-1!==t.protos.indexOf("RTP")||t.protos.indexOf("rtp"),n.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]},n}i(t,e);var n=t.prototype;return n.parse=function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")},n.parseCandidate=function(e){var t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);var n=this.extractOneOrMore(e,u,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var i=this.extractOneOrMore(e,u,[1,10]);this.consumeAttributeSpace(e);var a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var o=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);var s={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:o,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),s.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),s.relPort=this.extract(e,this.consumePort));this.peekChar(e)===c;){this.consumeAttributeSpace(e);var p=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),s.extension[p]=this.extractOneOrMore(e,d)}this.attributes.candidates.push(s)},n.parseRemoteCandidate=function(e){for(var t=[];;){var n=this.extractOneOrMore(e,u,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)},n.parseEndOfCandidates=function(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0},n.parseRtpmap=function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");var r={encodingName:n,clockRate:this.extractOneOrMore(e,u)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})},n.parsePtime=function(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)},n.parseMaxPtime=function(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)},n.parseDirection=function(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField},n.parseSSRC=function(e){var t,n=this.extractOneOrMore(e,u);this.consumeAttributeSpace(e);var r,i=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));var a=this.attributes.ssrcs.find((function(e){return e.ssrcId===parseInt(n,10)}));a?a.attributes[i]=r:this.attributes.ssrcs.push({ssrcId:parseInt(n,10),attributes:(t={},t[i]=r,t)})},n.parseFmtp=function(e){var t=this.extract(e,this.consumeTill,c);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((function(e){var t=e.split("="),n=t[0],i=t[1];n=mS(n).call(n);var a="string"==typeof i?mS(i).call(i):null;"string"==typeof n&&n.length>0&&(r[n]=a)}));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})},n.parseFmtParameters=function(e){var t={},n=this.extract(e,this.consumeTill,"=");e._cur++;var r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){var i=this.extract(e,this.consumeTill,"=");e._cur++;var a=this.extract(e,this.consumeTill,";");t[i]=a}return t},n.parseRtcpFb=function(e){var t;t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,c),this.consumeAttributeSpace(e);var n,r=this.extract(e,this.consumeTill,c);if("trr-int"===r)n={type:r,interval:this.extract(e,this.consumeTill)};else{var i={type:r};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),i.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===c&&(i.additional=this.extract(e,this.consumeTill))),n=i}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{var a=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));a?a.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}},n.parseRTCPMux=function(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0},n.parseRTCPMuxOnly=function(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0},n.parseRTCPRsize=function(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0},n.parseRTCP=function(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");var t={port:this.extract(e,this.consumePort)};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t},n.parseMsid=function(e){var t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===c&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)},n.parseImageAttr=function(e){this.attributes.imageattr.push(e.attValue)},n.parseRid=function(e){var t=this.extractOneOrMore(e,(function(e){return _(e)||u(e)||"_"===e||"-"===e}));this.consumeAttributeSpace(e);var n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===c){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");for(var r=[];;){var i=this.extract(e,this.consumeToken);r.push(i);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=r,this.peekChar(e)===c&&this.extract(e,this.consume,c)}for(;;){var a=this.extract(e,this.consumeToken);switch(a){case"depend":var o={type:a,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(o);break;default:var s={type:a};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),s.val=this.extract(e,this.consumeTill,";")),n.params.push(s)}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)},n.parseSimulcast=function(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)},n.parseSctpPort=function(e){this.attributes.sctpPort=this.extractOneOrMore(e,u,[1,5])},n.parseMaxMessageSize=function(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,u,[1,void 0])},n.digest=function(){return this.digested=!0,this.attributes},n.parseMid=function(e){this.attributes.mid=this.extract(e,this.consumeToken)},n.parseSSRCGroup=function(e){for(var t=this.extract(e,this.consumeToken),n=[];;)try{this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeInteger);n.push(parseInt(r,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})},t}(I);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(){O(this,"eol",s)}var t=e.prototype;return t.print=function(e,t){var n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions)},t.printVersion=function(e){return"v=".concat(e).concat(this.eol)},t.printOrigin=function(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)},t.printSessionName=function(e){return e?"s=".concat(e).concat(this.eol):""},t.printInformation=function(e){return e?"i=".concat(e).concat(this.eol):""},t.printUri=function(e){return e?"u=".concat(e).concat(this.eol):""},t.printEmail=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}return n},t.printPhone=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}return n},t.printConnection=function(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""},t.printBandwidth=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+="b=".concat(i.bwtype,":").concat(i.bandwidth).concat(this.eol)}return n},t.printTimeFields=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+="t=".concat(i.time.startTime," ").concat(i.time.startTime).concat(this.eol);for(var a,o=h(i.repeats);!(a=o()).done;){var s=a.value;n+="r=".concat(s.repeatInterval," ").concat(s.typedTimes.join(" ")).concat(this.eol)}i.zoneAdjustments&&(n+="z=",n+="z=".concat(i.zoneAdjustments.map((function(e){return"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)})).join(" ")).concat(this.eol),n+=this.eol)}return n},t.printKey=function(e){return e?"k=".concat(e).concat(this.eol):""},t.printAttributes=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+="a=".concat(i.attField).concat(i.attValue?":".concat(i.attValue):"").concat(this.eol)}return n},t.printMediaDescription=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+=this.printMedia(i.media),n+=this.printInformation(i.information),n+=this.printConnections(i.connections),n+=this.printBandwidth(i.bandwidths),n+=this.printKey(i.key),n+=this.printMediaAttributes(i)}return n},t.printConnections=function(e){for(var t,n="",r=h(e);!(t=r()).done;){var i=t.value;n+=this.printConnection(i)}return n},t.printMedia=function(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)},t.printSessionAttributes=function(e){return new D(this.eol).print(e)},t.printMediaAttributes=function(e){return new P(this.eol).print(e)},e}(),N=function(){function e(e){O(this,"eol",void 0),this.eol=e}var t=e.prototype;return t.printIceUfrag=function(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)},t.printIcePwd=function(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)},t.printIceOptions=function(e){return void 0===e?"":"a=ice-options:".concat(e.join(c)).concat(this.eol)},t.printFingerprints=function(e){return e.length>0?e.map((function(e){return"a=fingerprint:".concat(e.hashFunction).concat(c).concat(e.fingerprint)})).join(this.eol)+this.eol:""},t.printExtmap=function(e){var t=this;return e.map((function(e){return"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(c).concat(e.extensionName).concat(e.extensionAttributes?"".concat(c).concat(e.extensionAttributes):"").concat(t.eol)})).join("")},t.printSetup=function(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)},t.printUnrecognized=function(e){var t=this;return e.map((function(e){return"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(t.eol)})).join("")},e}(),D=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.print=function(e){var t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized)},n.printGroups=function(e){var t=this,n="";return e.length>0&&(n+=e.map((function(e){return"a=group:".concat(e.semantic).concat(e.identificationTag.map((function(e){return"".concat(c).concat(e)})).join("")).concat(t.eol)})).join("")),n},n.printIceLite=function(e){return void 0===e?"":"a=ice-lite"+this.eol},n.printTlsId=function(e){return e?"a=tls-id:".concat(e).concat(this.eol):""},n.printIdentity=function(e){return 0===e.length?"":e.map((function(e){return"a=identity:".concat(e.assertionValue).concat(e.extensions.map((function(e){return"".concat(c).concat(e.name).concat(e.value?"=".concat(e.value):"")})))})).join(this.eol)+this.eol},n.printMsidSemantic=function(e){if(!e)return"";var t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(c,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((function(e){return"".concat(c).concat(e)}))),t+this.eol},t}(N),P=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.print=function(e){var t=e.attributes,n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized)},n.printCandidates=function(e){var t=this;return e.map((function(e){return"a=candidate:".concat(e.foundation).concat(c).concat(e.componentId).concat(c).concat(e.transport).concat(c).concat(e.priority).concat(c).concat(e.connectionAddress).concat(c).concat(e.port).concat(c,"typ").concat(c).concat(e.type).concat(e.relAddr?"".concat(c,"raddr").concat(c).concat(e.relAddr):"").concat(e.relPort?"".concat(c,"rport").concat(c).concat(e.relPort):"").concat(Object.keys(e.extension).map((function(t){return"".concat(c).concat(t).concat(c).concat(e.extension[t])})).join("")).concat(t.eol)})).join("")},n.printRemoteCandidatesList=function(e){var t=this;return e.map((function(e){return"a=remote-candidates:".concat(e.join(c)).concat(t.eol)})).join("")},n.printEndOfCandidates=function(e){return void 0===e?"":"a=end-of-candidates"+this.eol},n.printRTPRelated=function(e){var t=this;if(!e.payloads)return"";var n=e.payloads,r="";r+=e.rtcpFeedbackWildcards.map((function(e){return t.printRTCPFeedback("*",e)})).join("");for(var i,a=function(){var e=i.value;r+=t.printRtpMap(e.payloadType,e.rtpMap),r+=t.printFmtp(e.payloadType,e.fmtp),r+=e.rtcpFeedbacks.map((function(n){return t.printRTCPFeedback(e.payloadType,n)})).join("")},o=h(n);!(i=o()).done;)a();return r},n.printFmtp=function(e,t){if(!t)return"";var n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(c).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(c).concat(Object.keys(t.parameters).map((function(e){return"".concat(e,"=").concat(t.parameters[e])})).join(";")).concat(this.eol)},n.printRtpMap=function(e,t){return t?"a=rtpmap:".concat(e).concat(c).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""},n.printRTCPFeedback=function(e,t){var n="a=rtcp-fb:".concat(e).concat(c),r=t;return"trr-int"===r.type?n+="ttr-int".concat(c).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(c).concat(r.parameter),r.additional&&(n+="".concat(c).concat(r.additional)))),n+this.eol},n.printPtime=function(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)},n.printMaxPtime=function(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)},n.printDirection=function(e){return void 0===e?"":"a=".concat(e).concat(this.eol)},n.printSSRC=function(e){var t=this;return e.map((function(e){return Object.keys(e.attributes).map((function(n){return"a=ssrc:".concat(e.ssrcId.toString(10)).concat(c).concat(n).concat(e.attributes[n]?":".concat(e.attributes[n]):"").concat(t.eol)})).join("")})).join("")},n.printRTCPMux=function(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)},n.printRTCPMuxOnly=function(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)},n.printRTCPRsize=function(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)},n.printRTCP=function(e){if(void 0===e)return"";var t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(c).concat(e.netType)),e.addressType&&(t+="".concat(c).concat(e.addressType)),e.address&&(t+="".concat(c).concat(e.address)),t+this.eol},n.printMSId=function(e){var t=this;return e.map((function(e){return"a=msid:".concat(e.id).concat(e.appdata?"".concat(c).concat(e.appdata):"").concat(t.eol)})).join("")},n.printImageattr=function(e){var t=this;return e.map((function(e){return"a=imageattr:".concat(e).concat(t.eol)})).join("")},n.printRid=function(e){var t=this;return e.map((function(e){var n="a=rid:".concat(e.id).concat(c).concat(e.direction);return e.payloads&&(n+="".concat(c,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(n+="".concat(c).concat(e.params.map((function(e){return"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)})).join(";"))),n+t.eol})).join("")},n.printSimulcast=function(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)},n.printSCTPPort=function(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)},n.printMaxMessageSize=function(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)},n.printMid=function(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)},n.printSSRCGroups=function(e){var t=this;return e.map((function(e){return"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((function(e){return"".concat(c).concat(e.toString(10))})).join("")).concat(t.eol)})).join("")},t}(N);function L(e){return(new y).parse(e)}function x(e,t){return(new k).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)}();function pk(e){return dk.parse(e)}function lk(e,t){return dk.print(e,t)}var hk=cr("Array","keys"),fk=Cr,_k=dt,vk=b,Ek=hk,mk=Array.prototype,Sk={DOMTokenList:!0,NodeList:!0},gk=d((function(e){var t=e.keys;return e===mk||vk(mk,e)&&t===mk.keys||_k(Sk,fk(e))?Ek:t}));function Tk(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bk(Object(n),!0).forEach((function(t){Tk(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ck=new(function(e){function t(){var t;return Tk(r(t=e.apply(this,arguments)||this),"currentUploadLogID",0),t}return i(t,e),t.prototype.reportLogUploadError=function(e){var t=e.errorRange;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))},t}(gw)),yk=function(){function e(e){Tk(this,"logger",void 0),Tk(this,"prefixLists",[]),this.logger=e}var t=e.prototype;return t.debug=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).debug.apply(e,this.prefixLists.concat(n))},t.info=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).info.apply(e,this.prefixLists.concat(n))},t.warning=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).warning.apply(e,this.prefixLists.concat(n))},t.error=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).error.apply(e,this.prefixLists.concat(n))},t.prefix=function(e){return this.prefixLists.push(e),this},t.popPrefix=function(){return this.prefixLists.pop(),this},e}();function Ik(){var e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function Ak(){var e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var wk,Ok={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},kk=Date.now(),Nk=function(e){for(var t in Ok)if(Object.prototype.hasOwnProperty.call(Ok,t)&&Ok[t]===e)return t;return"DEFAULT"},Dk=new(function(){function e(){var e=this;Tk(this,"proxyServerURL",void 0),Tk(this,"logLevel",Ok.DEBUG),Tk(this,"uploadState","collecting"),Tk(this,"uploadLogWaitingList",[]),Tk(this,"uploadLogUploadingList",[]),Tk(this,"uploadErrorCount",0),Tk(this,"currentLogID",0),Tk(this,"url",void 0),Tk(this,"extLog",(function(t,n){e.appendLogToWaitingList.apply(e,[t].concat(n))}))}var t=e.prototype;return t.debug=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Ok.DEBUG].concat(t);this.log.apply(this,r)},t.info=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Ok.INFO].concat(t);this.log.apply(this,r)},t.warning=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Ok.WARNING].concat(t);this.log.apply(this,r)},t.warn=function(){this.warning.apply(this,arguments)},t.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Ok.ERROR].concat(t);this.log.apply(this,r)},t.upload=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[Ok.DEBUG].concat(t);this.uploadLog.apply(this,r)},t.setLogLevel=function(e){e=Math.min(Math.max(0,e),4),this.logLevel=e},t.enableLogUpload=function(){nk("UPLOAD_LOG",!0)},t.disableLogUpload=function(){nk("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]},t.setProxyServer=function(e){this.proxyServerURL=e},t.prefix=function(e){return new yk(this).prefix(e)},t.log=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-kk<100)setTimeout((function(){e.log.apply(e,n)}),Date.now()-kk);else{var i=Math.max(0,Math.min(4,n[0]));if(n[0]=Ik()+" Agora-SDK [".concat(Nk(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n)),!(i<this.logLevel)){var a=Ik()+" %cAgora-SDK [".concat(Nk(i),"]:"),o=[];if(!rk("USE_NEW_LOG"))switch(i){case Ok.DEBUG:o=[a,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,o);break;case Ok.INFO:o=[a,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,o);break;case Ok.WARNING:o=[a,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,o);break;case Ok.ERROR:o=[a,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,o)}}}},t.uploadLog=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-kk<100)setTimeout((function(){e.uploadLog.apply(e,n)}),Date.now()-kk);else{var i=Math.max(0,Math.min(4,n[0]));n[0]=Ik()+" Agora-SDK [".concat(Nk(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n))}},t.appendLogToWaitingList=function(e){if(rk("UPLOAD_LOG")){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=Ak()+" Agora-SDK [".concat(Nk(e),"]:"):n[0]=Ak()+" Agora-SDK [".concat(Nk(e),"]:");var i="";n.forEach((function(e){"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}},t.startUpload=function(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()},t.uploadLogs=function(){var e=p(l().mark((function e(){var t,n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.uploadLogUploadingList,n={sdk_version:qO,process_id:rk("PROCESS_ID"),payload:JSON.stringify(t)},e.abrupt("return",mO(p(l().mark((function e(){var t,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_A.post(r.url||(r.proxyServerURL?"https://".concat(r.proxyServerURL,"/ls/?h=").concat(rk("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(rk("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});case 2:if("OK"===(t=e.sent).data){e.next=6;break}throw(i=new Error("unexpected upload log response")).response=t,i;case 6:case"end":return e.stop()}}),e)}))),(function(){return r.uploadLogUploadingList=[],!1}),(function(e){var n={status:-1,message:e.message,errorRange:t.map((function(e){return e.log_item_id}))};return e.response?(n.status=e.response.status,n.data=e.response.data,n.headers=e.response.headers):e.request&&(n.status=e.request.status),Ck.reportLogUploadError(n),!0}),{timeout:rk("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:rk("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.uploadLogInterval=function(){var e=this;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,rk("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((function(){e.uploadErrorCount=0,e.uploadLogWaitingList.length>0&&window.setTimeout((function(){return e.uploadLogInterval()}),rk("UPLOAD_LOG_INTERVAL"))})).catch((function(t){e.uploadErrorCount+=1,e.uploadErrorCount<2?window.setTimeout((function(){return e.uploadLogInterval()}),rk("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((function(){return e.uploadLogInterval()}),rk("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))},e}());function Pk(e){return dw(e.reportId,"params.reportId",0,100,!1),dw(e.category,"params.category",0,100,!1),dw(e.event,"params.event",0,100,!1),dw(e.label,"params.label",0,100,!1),cw(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(wk={}).FREE="free",wk.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var Lk={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},xk=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Mk=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});var Uk=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Vk(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){var i=r.value;if("function"==typeof i){var a=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t,r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];var c=o;if(e.argsMap)try{c=e.argsMap.apply(e,[this].concat(o))}catch(e){Dk.warning(e),c=[]}try{JSON.stringify(c)}catch(e){Dk.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}var u=(e.report||Fk).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(a,".").concat(String(n)),options:c,tag:Cw.TRACER,reportResult:e.reportResult},e.throttleTime);try{var d=i.apply(this,o);return d instanceof zl?d.then((function(t){return u.onSuccess(e.reportResult&&t),t})).catch((function(e){throw u.onError(e),e})):(u.onSuccess(e.reportResult&&d),d)}catch(e){throw u.onError(e),e}}}return r}}var Fk=new(function(){function e(){var e=this;Tk(this,"baseInfoMap",new Map),Tk(this,"proxyServer",void 0),Tk(this,"eventUploadTimer",void 0),Tk(this,"setSessionIdTimer",void 0),Tk(this,"url",void 0),Tk(this,"sids",new Set),Tk(this,"backupUrl",void 0),Tk(this,"_appId",void 0),Tk(this,"_aid",0),Tk(this,"keyEventUploadPendingItems",[]),Tk(this,"normalEventUploadPendingItems",[]),Tk(this,"apiInvokeUploadPendingItems",[]),Tk(this,"apiInvokeCount",0),Tk(this,"apiInvokeLoggedCount",0),Tk(this,"ltsList",[]),Tk(this,"lastSendNormalEventTime",Date.now()),Tk(this,"customReportCounterTimer",void 0),Tk(this,"customReportCount",0),Tk(this,"extApiInvoke",p(l().mark((function t(n){var r,i,a,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=h(n);!(i=r()).done;)a=i.value,o=Rk(Rk({},a),{},{sid:null,invokeId:++e.apiInvokeCount,tag:Cw.TRACER}),e.sendApiInvoke(o);case 1:case"end":return t.stop()}}),t)})))),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),rk("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),rk("EVENT_REPORT_SEND_INTERVAL"))}var t=e.prototype;return t.getBaseInfoBySessionId=function(e){return this.baseInfoMap.get(e)},t.setAppId=function(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(function(e){return e[0]+e[1]})),16)||0},t.reportApiInvoke=function(e,t,n){var r=this;t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;var i=Date.now();this.apiInvokeCount+=1;var a=this.apiInvokeCount,o=!!rk("SHOW_REPORT_INVOKER_LOG"),s=!!rk("SHOW_REPORT_USER_INVOKER_LOG"),c=o||s&&t.id;c&&(this.apiInvokeLoggedCount+=1);var u=this.apiInvokeLoggedCount;function d(e,n){if(c){var r="[apiInvoke-".concat(u,"]");if(t.id&&(r+="[".concat(t.id,"]")),t.name&&(r+="[".concat(t.name,"]"),t.name===Rw.JOIN))return Dk.info("".concat(r," ").concat(e));Dk.info("".concat(r," ").concat(e),"start"===e?t.options:n||"")}}var p=function(){return{tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}};d("start");var l=!1;eO(t.timeout).then((function(){l||(r.sendApiInvoke(Rk(Rk({},p()),{},{error:iw.API_INVOKE_TIMEOUT,success:!1})),d("timeout"))}));var h=new aw(iw.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:function(e){var i=function(){if(l)throw h;return l=!0,r.sendApiInvoke(Rk(Rk({},p()),{},{success:!0},t.reportResult&&{result:e})),d("onSuccess"),e};return n?aO(i,t.name+"Success",n,(function(){return l=!0})):i()},onError:function(e){var i=function(){if(l)throw e;l=!0,r.sendApiInvoke(Rk(Rk({},p()),{},{success:!1,error:e})),d("onFailure",e.toString())};return n?aO(i,t.name+"Error",n,(function(){return l=!0})):i()}}},t.sessionInit=function(e,t){if(!this.baseInfoMap.has(e)){var n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;var i,a=Object.assign({},{willUploadConsoleLog:rk("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:zO?"global":"oversea",areas:rk("AREAS")&&rk("AREAS").join(",")},t.extend),o=t.stringUid,s=t.channelProfile,c=t.channelMode,u=t.isABTestSuccess,d=t.lsid,p=t.clientRole,l=Date.now(),h=Rk(Rk({},r),{},{eventType:xk.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:$O,lts:l,elapse:l-n,extend:JSON.stringify(a),mode:t.mode,process:rk("PROCESS_ID"),appType:rk("APP_TYPE"),success:!0,version:qO,stringUid:o,channelProfile:s,channelMode:c,isABTestSuccess:u,lsid:d,clientType:Br(i=window.navigator.userAgent).call(i,"AgoraWebView")?42:20,clientRole:p,serviceId:rk("PROCESS_ID"),extensionID:rk("PLUGIN_INFO").join(",")||""});this.send({type:Mk.SESSION,data:h},!0)}},t.joinChooseServer=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{role:t.role,eventType:xk.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Mk.JOIN_CHOOSE_SERVER,data:a},!0)}},t.reqUserAccount=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{eventType:xk.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Mk.REQ_USER_ACCOUNT,data:a},!0)}},t.joinGateway=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;var i=Date.now(),a=t.firstSuccess,o=t.addr,s=t.isProxy,c=i-n.startTime,u=Rk(Rk({},r),{},{eventType:xk.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:i-t.lts,firstSuccess:a,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:YO(),isABTestSuccess:t.isABTestSuccess?1:0}),d=u.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),a)this.send({type:Mk.JOIN_GATEWAY,data:u},!0);else{var p;if(o)if(s){var l=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),h=o.match(/p=[0-9]{1,6}/g);p={isSuccess:d,gatewayIp:l&&l.length?l[0].split("=")[1].replace(/-/g,"."):"",port:h&&h.length?h[0].split("=")[1]:"",isProxy:s?1:0}}else{var f=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_=o.match(/(:|p=)[0-9]{1,6}/g);p={isSuccess:d,gatewayIp:f&&f.length?f[0].split("//")[1].replace(/-/g,"."):"",port:_&&_.length?_[0].split(/:|p=/g)[1]:"",isProxy:s?1:0}}else p={isSuccess:d,gatewayIp:"",port:"",isProxy:s?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);var v=Object.assign({},u,p,{eventType:xk.REJOIN_GATEWAY});this.send({type:Mk.RE_JOIN_GATEWAY,data:v},!0)}}},t.joinChannelTimeout=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=Date.now(),i=Rk(Rk({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Mk.JOIN_CHANNEL_TIMEOUT,data:i},!0)}},t.publish=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{eventType:xk.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Mk.PUBLISH,data:a},!0)}},t.subscribe=function(e,t,n){var r=this.baseInfoMap.get(e);if(r){var i=r.info,a=Date.now(),o=Rk(Rk({},i),{},{eventType:xk.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:Mk.SUBSCRIBE,data:o},!0)}},t.wsCompressorInit=function(e){var t,n=[].concat(gk(t=this.baseInfoMap).call(t)),r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(i){var a=i.info,o=Date.now(),s=Rk(Rk({},a),{},{eventType:xk.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:Mk.WS_COMPRESSOR_INIT,data:s},!0)}},t.firstRemoteVideoDecode=function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=Rk(Rk(Rk({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}},t.firstRemoteFrame=function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=Rk(Rk(Rk({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:s},!0)}},t.abTest=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:xk.AB_TEST,lts:i});this.send({type:Mk.AB_TEST,data:a},!0)}},t.pcStats=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:xk.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Mk.PC_STATS,data:a},!0)}},t.updateRemoteRTPCapabilities=function(e,t){if(e){var n=this.baseInfoMap.get(e);if(!n)return;var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:xk.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Mk.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}},t.onGatewayStream=function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=Rk(Rk(Rk({},a),r),{},{eventType:t,lts:o});this.send({type:n,data:s},!0)}},t.streamSwitch=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{eventType:xk.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Mk.STREAM_SWITCH,data:a},!0)}},t.requestProxyAppCenter=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{eventType:xk.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mk.REQUEST_PROXY_APPCENTER,data:a},!0)}},t.requestProxyWorkerManager=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{eventType:xk.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mk.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}},t.setProxyServer=function(e){this.proxyServer=e,e?Dk.debug("reportProxyServerurl: ".concat(e)):Dk.debug("disable reportProxyServerurl: ".concat(e))},t.peerPublishStatus=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Mk.PEER_PUBLISH_STATUS,data:a},!0)}},t.workerEvent=function(e,t){var n=this,r=this.baseInfoMap.get(e);if(r){var i=r.info,a=Date.now();(function(e,t,n,r){var i=e[t];if(!i||"string"!=typeof i)return[e];e[t]="";for(var a=Qw(JSON.stringify(e)),o=0,s=[],c=0,u=0;u<i.length;u++){var d;(c+=i.charCodeAt(u)<=127?1:3)<=1300-a||(s[s.length]=rw(rw({},e),{},((d={})[t]=i.substring(o,u),d)),o=u,c=i.charCodeAt(u)<=127?1:3)}return o!==i.length-1&&(s[s.length]=rw(rw({},e),{},((r={})[t]=i.substring(o),r))),s})(Rk(Rk(Rk({},i),t),{},{elapse:a-r.startTime,lts:a,productType:"WebRTC"}),"payload").forEach((function(e){return n.send({type:Mk.WORKER_EVENT,data:e},!0)}))}},t.apworkerEvent=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mk.AP_WORKER_EVENT,data:a},!0)}},t.joinWebProxyAP=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Mk.JOIN_WEB_PROXY_AP,data:a},!0)}},t.WebSocketQuit=function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=Rk(Rk(Rk({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mk.WEBSOCKET_QUIT,data:a},!0)}},t.sendCustomReportMessage=function(){var e=p(l().mark((function e(t,n){var r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.customReportCount+=n.length,!(this.customReportCount>rk("CUSTOM_REPORT_LIMIT"))){e.next=2;break}throw new aw(iw.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);case 2:if(this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((function(){a.customReportCount=0}),5e3)),r=Date.now(),i=n.map((function(e){return{type:Mk.USER_ANALYTICS,data:Rk(Rk({sid:t},e),{},{lts:r})}})),e.prev=4,!rk("NEW_REPORT_SERVER")){e.next=10;break}return e.next=8,this.postDataToStatsCollector2(i);case 8:e.next=12;break;case 10:return e.next=12,this.postDataToStatsCollector(i);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(4),Dk.error("send custom report message failed",e.t0.toString()),new aw(iw.CUSTOM_REPORT_SEND_FAILED,e.t0.message);case 17:case"end":return e.stop()}}),e,this,[[4,14]])})));return function(t,n){return e.apply(this,arguments)}}(),t.sendApiInvoke=function(e){var t=rk("NOT_REPORT_EVENT");if(e.tag&&Br(t)&&Br(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;var n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;var r,i=n.info,a=i.cname,o=i.uid,s=i.cid;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof aw){var c=e.error,u=c.code,d=c.message;r=u||d||e.error.toString()}else r=e.error.toString();var p={invokeId:e.invokeId,sid:e.sid,cname:a,cid:s,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?r:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Mk.API_INVOKE,data:p},!1),!0},t.addSid=function(e){this.sids.add(e)},t.removeSid=function(e){this.sids.delete(e)},t.appendSessionId=function(){var e=this,t=this.apiInvokeUploadPendingItems;if(0!==t.length){var n=Array.from(this.sids).find((function(e){return null!==e}));n&&t.forEach((function(t){t&&(t.sid=n,e.sendApiInvoke(Object.assign({},t)))})),t.length=0}},t.send=function(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>rk("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)},t.doSend=function(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)},t.sendItems=function(e,t){for(var n=this,r=[],i=[];e.length;){var a=e.shift();r.length<20?r.push(a):i.push(a)}e.push.apply(e,i);for(var o=0,s=[].concat(r);o<s.length;o++){var c,u=s[o];-1!==this.ltsList.indexOf(u.data.lts)?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),Vh(c=this.ltsList).call(c,(function(e,t){return e-t})))}return t||(this.lastSendNormalEventTime=Date.now()),rk("ENABLE_EVENT_REPORT")?(r.length&&(rk("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch(function(e){return function(r){rk("EVENT_REPORT_RETRY")&&(t?n.keyEventUploadPendingItems=n.keyEventUploadPendingItems.concat(e):(n.normalEventUploadPendingItems=n.normalEventUploadPendingItems.concat(e),n.normalEventUploadPendingItems.length>rk("NORMAL_EVENT_QUEUE_CAPACITY")&&(n.normalEventUploadPendingItems.splice(0,n.normalEventUploadPendingItems.length-rk("NORMAL_EVENT_QUEUE_CAPACITY")),Dk.warning("report: drop normal events"))))}}(r)),e):e},t.postDataToStatsCollector2=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Fw.networkState===Pw.OFFLINE,!e.t0){e.next=4;break}return e.next=4,zl.race([Fw.onlineWaiter,eO(2*vO.maxRetryTimeout)]);case 4:n=function(e){var t=new Uint8Array;return e.forEach((function(e){var n=Ew(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=function(e){var t=0;return Object.entries(Mk).forEach((function(n){var r=n[0];n[1]===e.type&&(t=Uk[r])})),t}(e),a=new DataView(r);a.setUint16(0,n.byteLength,!0),a.setUint8(2,255&i),a.setUint8(3,i>>>8&255),a.setUint8(4,i>>>16&255),t=mw(t,new Uint8Array(r)),t=mw(t,n)})),t},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rk("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(rk("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r),a=0;case 7:if(!(a<2)){e.next=23;break}return 1===a&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rk("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(rk("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r)),e.prev=9,e.next=12,TO(i,{timeout:1e4,data:n(t),headers:Rk(Rk({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0);case 12:e.next=19;break;case 14:if(e.prev=14,e.t1=e.catch(9),1!==a){e.next=18;break}throw e.t1;case 18:return e.abrupt("continue",20);case 19:return e.abrupt("return");case 20:a+=1,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,14]])})));return function(t){return e.apply(this,arguments)}}(),t.postDataToStatsCollector=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u=this,d=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]&&d[1],r=function(e){var t=e&&e.data.sid&&u.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0}(t[0]),i=r?void 0:this._aid,a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((function(e){return JSON.stringify(e)})),vid:r,aid:i},e.t0=Fw.networkState===Pw.OFFLINE,!e.t0){e.next=6;break}return e.next=6,zl.race([Fw.onlineWaiter,eO(2*vO.maxRetryTimeout)]);case 6:o=n?"/events/proto-raws":"/events/messages",s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rk("EVENT_REPORT_DOMAIN"),"&p=").concat(rk("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(rk("EVENT_REPORT_DOMAIN"),":").concat(rk("STATS_COLLECTOR_PORT")).concat(o)),c=0;case 9:if(!(c<2)){e.next=30;break}if(1===c&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(rk("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(rk("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(rk("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(rk("STATS_COLLECTOR_PORT")).concat(o))),e.prev=11,!n){e.next=17;break}return e.next=15,bO(s,{timeout:1e4,data:a});case 15:e.next=19;break;case 17:return e.next=19,TO(s,{timeout:1e4,data:a});case 19:e.next=26;break;case 21:if(e.prev=21,e.t1=e.catch(11),1!==c){e.next=25;break}throw e.t1;case 25:return e.abrupt("continue",27);case 26:return e.abrupt("return");case 27:c+=1,e.next=9;break;case 30:case"end":return e.stop()}}),e,this,[[11,21]])})));return function(t){return e.apply(this,arguments)}}(),t.createBaseInfo=function(e,t){var n=Object.assign({},Lk);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n},t.reportResourceTiming=function(e,t){var n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Cw.TRACER}).onSuccess()},e}());Ck.on("REPORT_LOG_UPLOAD",(function(e){e.networkState=Fw.networkState,Fk.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Cw.TRACER}).onSuccess("logUploadError")}));var Bk=function(e){function t(t){var n;return Tk(r(n=e.call(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0)||this),"name","AgoraRTCException"),n}i(t,e);var n=t.prototype;return n.print=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return e.prototype.print.call(this,t,Dk)},n.throw=function(){e.prototype.throw.call(this,Dk)},t}(aw),jk={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Gk(){return jk}function Wk(){return"setSinkId"in HTMLAudioElement.prototype&&(!rk("RESTRICTION_SET_PLAYBACK_DEVICE")||(NA()||PA())&&!QA())}function Hk(){return!jk.supportUnifiedPlan||rk("CHROME_FORCE_PLAN_B")&&ZA()}var Kk=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Yk(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function qk(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function zk(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function Xk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}var Jk={"90p":qk(160,90),"90p_1":qk(160,90),"120p":qk(160,120,15,30,65),"120p_1":qk(160,120,15,30,65),"120p_3":qk(120,120,15,30,50),"120p_4":qk(212,120),"180p":qk(320,180,15,30,140),"180p_1":qk(320,180,15,30,140),"180p_3":qk(180,180,15,30,100),"180p_4":qk(240,180,15,30,120),"240p":qk(320,240,15,40,200),"240p_1":qk(320,240,15,40,200),"240p_3":qk(240,240,15,40,140),"240p_4":qk(424,240,15,40,220),"360p":qk(640,360,15,80,400),"360p_1":qk(640,360,15,80,400),"360p_3":qk(360,360,15,80,260),"360p_4":qk(640,360,30,80,600),"360p_6":qk(360,360,30,80,400),"360p_7":qk(480,360,15,80,320),"360p_8":qk(480,360,30,80,490),"360p_9":qk(640,360,15,80,800),"360p_10":qk(640,360,24,80,800),"360p_11":qk(640,360,24,80,1e3),"480p":qk(640,480,15,100,500),"480p_1":qk(640,480,15,100,500),"480p_2":qk(640,480,30,100,1e3),"480p_3":qk(480,480,15,100,400),"480p_4":qk(640,480,30,100,750),"480p_6":qk(480,480,30,100,600),"480p_8":qk(848,480,15,100,610),"480p_9":qk(848,480,30,100,930),"480p_10":qk(640,480,10,100,400),"720p":qk(1280,720,15,120,1130),"720p_auto":qk(1280,720,30,900,3e3),"720p_1":qk(1280,720,15,120,1130),"720p_2":qk(1280,720,30,120,2e3),"720p_3":qk(1280,720,30,120,1710),"720p_5":qk(960,720,15,120,910),"720p_6":qk(960,720,30,120,1380),"1080p":qk(1920,1080,15,120,2080),"1080p_1":qk(1920,1080,15,120,2080),"1080p_2":qk(1920,1080,30,120,3e3),"1080p_3":qk(1920,1080,30,120,3150),"1080p_5":qk(1920,1080,60,120,4780),"1440p":qk(2560,1440,30,120,4850),"1440p_1":qk(2560,1440,30,120,4850),"1440p_2":qk(2560,1440,60,120,7350),"4k":qk(3840,2160,30,120,8910),"4k_1":qk(3840,2160,30,120,8910),"4k_3":qk(3840,2160,60,120,13500)},Qk={"480p":zk(640,480,5),"480p_1":zk(640,480,5),"480p_2":zk(640,480,30),"480p_3":zk(640,480,15),"720p":zk(1280,720,5),"720p_auto":qk(1280,720,30,900,3e3),"720p_1":zk(1280,720,5),"720p_2":zk(1280,720,30),"720p_3":zk(1280,720,15),"1080p":zk(1920,1080,5),"1080p_1":zk(1920,1080,5),"1080p_2":zk(1920,1080,30),"1080p_3":zk(1920,1080,15)},Zk={"1SL1TL":Xk(1,1),"3SL3TL":Xk(3,3),"2SL3TL":Xk(2,3)};function $k(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},Jk[e]):e}function eN(e){return"string"==typeof e?Object.assign({},Qk[e]):e}function tN(e){return"string"==typeof e?Object.assign({},Zk[e]):e}var nN={speech_low_quality:Yk(16e3,!1),speech_standard:Yk(32e3,!1,18),music_standard:Yk(48e3,!1),standard_stereo:Yk(48e3,!0,56),high_quality:Yk(48e3,!1,128),high_quality_stereo:Yk(48e3,!0,192)};function rN(e){return"string"==typeof e?Object.assign({},nN[e]):e}var iN=[];function aN(e){return sw(e,"mediaSource",["screen","window","application"]),!0}var oN=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),sN=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),cN=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),uN=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),dN=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),pN=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),lN=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),hN=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),fN=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),_N=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({}),vN={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},EN={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},mN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},SN={uplinkNetworkQuality:0,downlinkNetworkQuality:0},gN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},TN=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),bN=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),RN=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),CN=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),yN=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),IN=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),AN={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},wN=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function ON(e,t,n,r,i){var a,o,s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=ui(a=Ti(o=n.slice()).call(o)).call(a,(function(n,r){return r(e,t,n)||n}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function kN(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function DN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NN(Object(n),!0).forEach((function(t){kN(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var PN=function(e){function t(t,n){var i;return kN(r(i=e.call(this)||this),"trackMediaType",void 0),kN(r(i),"_ID",void 0),kN(r(i),"_rtpTransceiver",void 0),kN(r(i),"_lowRtpTransceiver",void 0),kN(r(i),"_hints",[]),kN(r(i),"_isClosed",!1),kN(r(i),"_originMediaStreamTrack",void 0),kN(r(i),"mediaStreamTrack",void 0),kN(r(i),"_external",{}),i._ID=n||tO(8,"track-"),i._originMediaStreamTrack=t,i.mediaStreamTrack=t,function(e){Br(iN).call(iN,e)||iN.push(e)}(r(i)),i}i(t,e);var n=t.prototype;return n.toString=function(){return this._ID},n.getTrackId=function(){return this._ID},n.getMediaStreamTrack=function(e){var t=this;return e||Yw((function(){var e;Fk.reportApiInvoke(null,{name:Rw.GET_MEDIA_STREAM_TRACK,options:[],tag:Cw.TRACER}).onSuccess((null===(e=t._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack},n.getRTCRtpTransceiver=function(e){return e===cN.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver},n.getMediaStreamTrackSettings=function(){return this.getMediaStreamTrack(!0).getSettings()},n.close=function(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){var t=iN.indexOf(e);-1!==t&&iN.splice(t,1)}(this),this.emit(lN.CLOSED),this.removeAllListeners(pN.SEI_RECEIVED)},n._updateRtpTransceiver=function(e,t){if(t===cN.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(pN.TRANSCEIVER_UPDATED,e,t)},v(t,[{key:"_mediaStreamTrack",get:function(){return this.mediaStreamTrack},set:function(e){e!==this.mediaStreamTrack&&(this.safeEmit(pN.TRACK_UPDATED,e),this.mediaStreamTrack=e)}}]),t}(gw),LN=function(e){function t(t,n){var i;return kN(r(i=e.call(this,t,n)||this),"_enabled",!0),kN(r(i),"_muted",!1),kN(r(i),"_isExternalTrack",!1),kN(r(i),"_isClosed",!1),kN(r(i),"_enabledMutex",void 0),kN(r(i),"processor",void 0),kN(r(i),"_processorContext",void 0),kN(r(i),"_handleTrackEnded",(function(){i.onTrackEnded()})),i._enabledMutex=new fO("".concat(i.getTrackId())),t.addEventListener("ended",i._handleTrackEnded),i}i(t,e);var n=t.prototype;return n.getTrackLabel=function(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""},n.close=function(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Dk.debug("[".concat(this.getTrackId(),"] close")),this.emit(oN.NEED_CLOSE),e.prototype.close.call(this))},n._updateOriginMediaStreamTrack=function(){var e=p(l().mark((function e(t,n){var r,i=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]&&i[2],this._isExternalTrack=r,e.t0=t!==this._originMediaStreamTrack,!e.t0){e.next=13;break}return this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=12,Mw(this,oN.NEED_REPLACE_TRACK,this);case 12:this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n._getDefaultPlayerConfig=function(){return{}},n.onTrackEnded=function(){Dk.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lN.TRACK_ENDED)},n.stateCheck=function(e,t){if(Dk.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),ow(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new aw(iw.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",Dk);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new aw(iw.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",Dk)},n.getProcessorStats=function(){return this._processorContext&&this._processorContext.gatherStats()||[]},n.getProcessorUsage=function(){return this._processorContext?this._processorContext.gatherUsage():zl.resolve([])},v(t,[{key:"isExternalTrack",get:function(){return this._isExternalTrack}},{key:"muted",get:function(){return this._muted}},{key:"enabled",get:function(){return this._enabled}},{key:"processorContext",get:function(){return this._processorContext}}]),t}(PN),xN=window.AudioContext||window.webkitAudioContext,MN=null,UN=new(function(e){function t(){var t;return kN(r(t=e.apply(this,arguments)||this),"prevState",void 0),kN(r(t),"curState",void 0),kN(r(t),"currentTime",void 0),kN(r(t),"currentTimeStuckAt",void 0),kN(r(t),"interruptDetectorTrack",void 0),kN(r(t),"onLocalAudioTrackMute",(function(){Dk.info("ios15-interruption-start"),t.emit(Kk.IOS_15_16_INTERRUPTION_START)})),kN(r(t),"onLocalAudioTrackUnmute",p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.info("ios15-interruption-end"),"running"===t.curState&&!t.duringInterruption){e.next=5;break}Dk.info("ios15-interruption-end-canceled"),e.next=10;break;case 5:if(e.t0=MN,!e.t0){e.next=9;break}return e.next=9,MN.suspend();case 9:t.emit(Kk.IOS_15_16_INTERRUPTION_END);case 10:case"end":return e.stop()}}),e)})))),t}i(t,e);var n=t.prototype;return n.bindInterruptDetectorTrack=function(e){Dk.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)},n.unbindInterruptDetectorTrack=function(e){Dk.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)},v(t,[{key:"duringInterruption",get:function(){return"running"===this.prevState&&"interrupted"===this.curState}}]),t}(gw));function VN(){if(!MN){if(function(){if(xN){Dk.info("create audio context");var e=DN({},rk("WEBAUDIO_INIT_OPTIONS"));Dk.debug("audio context init option:",JSON.stringify(e)),MN=new xN(e),UN.curState=MN.state,MN.onstatechange=function(){UN.prevState=UN.curState,UN.curState=MN?MN.state:void 0;var e=UN.prevState,t=UN.curState,n="running"===t,r="interrupted"===t,i="running"===e,a="suspended"===e,o="interrupted"===e,s=IA().osVersion;(xA()||zA())&&i&&r&&(Dk.info("ios".concat(s,"-interruption-start")),UN.emit(Kk.IOS_INTERRUPTION_START)),(xA()||zA())&&(a||o)&&n&&(Dk.info("ios".concat(s,"-interruption-end")),UN.emit(Kk.IOS_INTERRUPTION_END)),e!==t&&UN.emit(Kk.STATE_CHANGE,t,e)},setInterval((function(){var e,t=null===(e=MN)||void 0===e?void 0:e.currentTime;UN.currentTime!==t?(UN.currentTimeStuckAt&&(Dk.debug("AudioContext current time resume at ".concat(t)),UN.currentTimeStuckAt=void 0),UN.currentTime=t):(t!==UN.currentTimeStuckAt&&(Fk.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Cw.TRACER}).onSuccess(),Dk.warning("AudioContext current time stuck at ".concat(t))),UN.currentTimeStuckAt=t)}),5e3),p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p,h,f,_,v,E;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_=function(){p(!0)},f=function(){r.removeEventListener("playing",f),r.removeEventListener("abort",f),r.removeEventListener("error",f),o=!1,p(!1)},h=function(e){if(a!==e){a=e;for(var t=0,r=n;t<r.length;t++){var i=r[t];e?window.addEventListener(i,_,{capture:!0,passive:!0}):window.removeEventListener(i,_,{capture:!0,passive:!0})}}},p=function(e){if(!o)if(r.paused)if(e){var t;h(!1),o=!0;try{(t=r.play())?t.then(f,f):(r.addEventListener("playing",f),r.addEventListener("abort",f),r.addEventListener("error",f))}catch(e){f()}}else h(!0);else h(!1)},d=function(){s(!0)},u=function(){s(!1)},c=function(e){if(i!==e){i=e;for(var t=0,r=n;t<r.length;t+=1){var a=r[t];e?window.addEventListener(a,d,{capture:!0,passive:!0}):window.removeEventListener(a,d,{capture:!0,passive:!0})}}},s=function(e){"running"===t.state?c(!1):xA()||zA()?"suspended"===t.state&&(c(!0),e&&t.resume().then(u,u)):"closed"!==t.state&&(c(!0),e&&t.resume().then(u,u))},n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i=!1,a=!1,o=!1,xA()&&(v=t.createMediaStreamDestination(),(E=document.createElement("div")).innerHTML="<audio x-webkit-airplay='deny'></audio>",(r=E.children.item(0)).controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=v.stream,p(!0)),UN.on(Kk.STATE_CHANGE,(function(){s(!0)})),s(!1);case 12:case"end":return e.stop()}}),e)})))(MN)}else Dk.error("your browser is not support web audio")}(),!MN)throw new aw(iw.NOT_SUPPORTED,"can not create audio context");return MN}return MN}function FN(e){if(!function(){if(null!==BN)return BN;var e=VN(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);var i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),BN=i,i}()){var t=e.connect,n=e.disconnect;e.connect=function(n,r,i){var a;return e._inputNodes||(e._inputNodes=[]),Br(a=e._inputNodes).call(a,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=function(r,i,a){n.call(e),r?Bw(e._inputNodes,r):e._inputNodes=[];for(var o,s=h(e._inputNodes);!(o=s()).done;){var c=o.value;t.call(e,c)}}}}var BN=null;function jN(e,t){var n=!1,r=1/t;if(rk("DISABLE_WEBAUDIO"))var i=window.setInterval((function(){n?window.clearInterval(i):e(performance.now()/1e3)}),1e3*r);else{var a=VN(),o=a.createGain();o.gain.value=0,o.connect(a.destination),function t(){if(n)o=null;else{var i=a.createOscillator();i.onended=t,i.connect(o),i.start(0),i.stop(a.currentTime+r),e(a.currentTime)}}()}return function(){n=!0}}var GN=function(){function e(){kN(this,"context",void 0),kN(this,"analyserNode",void 0),kN(this,"sourceNode",void 0),this.context=VN(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}var t=e.prototype;return t.updateSource=function(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}},t.getVolumeLevel=function(){if(!this.sourceNode)return 0;if(!this.context||xA()||zA()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;var e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{var t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(var n=0;n<e.length;++n)e[n]=t[n]/128-1}var r=ui(e).call(e,(function(e,t){return e+t*t}),0)/e.length;return Math.max(10*Math.log10(r)+100,0)/100},t.getAnalyserNode=function(){return this.analyserNode},t.rebuildAnalyser=function(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){Dk.warning("rebuild analyser node failed.")}},t.destroy=function(){this.updateSource(void 0)},e}(),WN=function(e){function t(){var t;return kN(r(t=e.call(this)||this),"outputNode",void 0),kN(r(t),"outputTrack",void 0),kN(r(t),"isPlayed",!1),kN(r(t),"sourceNode",void 0),kN(r(t),"context",void 0),kN(r(t),"audioBufferNode",void 0),kN(r(t),"destNode",void 0),kN(r(t),"audioOutputLevel",0),kN(r(t),"volumeLevelAnalyser",void 0),kN(r(t),"_processedNode",void 0),kN(r(t),"playNode",void 0),kN(r(t),"isDestroyed",!1),kN(r(t),"onNoAudioInput",void 0),kN(r(t),"isNoAudioInput",!1),kN(r(t),"_noAudioInputCount",0),t.context=VN(),t.playNode=t.context.destination,t.outputNode=t.context.createGain(),FN(t.outputNode),t.volumeLevelAnalyser=new GN,t}i(t,e);var n=t.prototype;return n.startGetAudioBuffer=function(e){var t=this;this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=function(e){t.emit(_N.ON_AUDIO_BUFFER,function(e){for(var t=0;t<e.outputBuffer.numberOfChannels;t+=1)for(var n=e.outputBuffer.getChannelData(t),r=0;r<n.length;r+=1)n[r]=0;return e.inputBuffer}(e))})},n.stopGetAudioBuffer=function(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)},n.createOutputTrack=function(){if(!Gk().webAudioMediaStreamDest)throw new aw(iw.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack},n.play=function(e){"running"!==this.context.state&&Gw((function(){UN.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)},n.stop=function(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1},n.getAccurateVolumeLevel=function(){return this.volumeLevelAnalyser.getVolumeLevel()},n.checkHasAudioInput=function(){var e=p(l().mark((function e(){var t,n,r,i,a,o=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=o.length>0&&void 0!==o[0]?o[0]:0)>5)){e.next=3;break}return e.abrupt("return",(this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1));case 3:for(xA()||zA()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume(),(n=this.volumeLevelAnalyser.getAnalyserNode()).getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r)),i=!1,a=0;a<r.length;a++)0!==r[a]&&(i=!0);if(!i){e.next=12;break}e.t0=(this.isNoAudioInput=!1,!0),e.next=20;break;case 12:return e.next=14,eO(200);case 14:return e.next=16,this.checkHasAudioInput(t?t+1:1);case 16:if(e.t1=e.sent,!e.t1){e.next=19;break}e.t1=i;case 19:e.t0=e.t1;case 20:return e.abrupt("return",e.t0);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getAudioVolume=function(){return this.outputNode.gain.value},n.setVolume=function(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)},n.destroy=function(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0},n.disconnect=function(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()},n.connect=function(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)},v(t,[{key:"processSourceNode",get:function(){return this.sourceNode}},{key:"processedNode",get:function(){return this._processedNode},set:function(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}}]),t}(gw),HN=function(e){function t(t,n,i){var a,o;if(kN(r(a=e.call(this)||this),"sourceNode",void 0),kN(r(a),"track",void 0),kN(r(a),"clonedTrack",void 0),kN(r(a),"audioElement",void 0),kN(r(a),"isCurrentTrackCloned",!1),kN(r(a),"isRemoteTrack",!1),kN(r(a),"originVolumeLevelAnalyser",void 0),kN(r(a),"rebuildWebAudio",p(l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("ready to rebuild web audio, state:",a.context.state),e.t0=a.isNoAudioInput,!e.t0){e.next=5;break}return e.next=5,a.checkHasAudioInput();case 5:if(a.isNoAudioInput&&!a.isDestroyed){e.next=7;break}return e.abrupt("return",(document.body.removeEventListener("click",a.rebuildWebAudio,!0),void Dk.debug("rebuild web audio success, current volume status",a.getAccurateVolumeLevel())));case 7:a.context.resume().then((function(){return Dk.info("resume success")})),Dk.debug("rebuild web audio because of ios 12 bugs"),a.disconnect(),t=a.track,a.track=a.track.clone(),a.isCurrentTrackCloned?t.stop():a.isCurrentTrackCloned=!0,n=new MediaStream([a.track]),a.sourceNode=a.context.createMediaStreamSource(n),FN(a.sourceNode),a.volumeLevelAnalyser.rebuildAnalyser(),r=a.outputNode.gain.value,a.outputNode=a.context.createGain(),a.outputNode.gain.setValueAtTime(r,a.context.currentTime),FN(a.outputNode),a.emit(_N.UPDATE_SOURCE),a.connect(),a.audioElement.srcObject=n,a.isPlayed&&a.play(a.playNode),a.checkHasAudioInput();case 14:case"end":return e.stop()}}),e)})))),"audio"!==t.kind)throw new aw(iw.UNEXPECTED_ERROR);a.track=t;var s=new MediaStream([a.track]);if(a.isRemoteTrack=!!n,a.sourceNode=a.context.createMediaStreamSource(s),FN(a.sourceNode),i){var c=i.clone();c.enabled=!0,a.clonedTrack=c,Dk.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));var u=a.context.createMediaStreamSource(new MediaStream([c]));FN(u),a.originVolumeLevelAnalyser=new GN,a.originVolumeLevelAnalyser.updateSource(u)}a.connect(),a.audioElement=document.createElement("audio"),a.audioElement.srcObject=s;var d=IA();return n&&d.os===TA.IOS&&Number(null===(o=d.osVersion)||void 0===o?void 0:o.split(".")[0])<15&&(UN.on(Kk.STATE_CHANGE,(function(){"suspended"===a.context.state?document.body.addEventListener("click",a.rebuildWebAudio,!0):"running"===a.context.state&&a.rebuildWebAudio()})),a.checkHasAudioInput().then((function(e){e||document.body.addEventListener("click",a.rebuildWebAudio,!0)}))),r(a)}i(t,e);var n=t.prototype;return n.updateTrack=function(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;var t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),FN(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(_N.UPDATE_SOURCE),this.audioElement.srcObject=t},n.destroy=function(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),UN.off("state-change",this.rebuildWebAudio),null===(t=this.originVolumeLevelAnalyser)||void 0===t||t.destroy(),this.clonedTrack=void 0,e.prototype.destroy.call(this)},n.createMediaStreamSourceNode=function(e){return this.context.createMediaStreamSource(new MediaStream([e]))},n.updateOriginTrack=function(e){var t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),Dk.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));var n=this.context.createMediaStreamSource(new MediaStream([t]));FN(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)},n.getOriginVolumeLevel=function(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()},v(t,[{key:"isFreeze",get:function(){return!1}}]),t}(WN);function KN(e,t,n){return YN.apply(this,arguments)}function YN(){return(YN=p(l().mark((function e(t,n,r){var i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:(i=function(e,t){return e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t})(n.height,1080),maxWidth:i(n.width,1920)}}},n.frameRate&&"number"!=typeof n.frameRate?(a.video.mandatory.maxFrameRate=n.frameRate.max,a.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(a.video.mandatory.maxFrameRate=n.frameRate),e.next=4,navigator.mediaDevices.getUserMedia(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qN(e,t){return zN.apply(this,arguments)}function zN(){return(zN=p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XN(t.mediaSource);case 2:return r=e.sent,e.next=5,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new zl((function(n,r){var i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var a=document.createElement("div");a.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");var u=document.createElement("button");u.innerHTML="cancel",u.setAttribute("style","width: 85px;"),u.onclick=function(){document.body.removeChild(f);var e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};var d=t,p=document.createElement("div");if(t){var l=document.createElement("input");l.setAttribute("type","checkbox");var h=document.createElement("span");l.setAttribute("style","margin-right: 6px;"),h.innerText="Share audio",l.checked=d,l.onchange=function(){d=l.checked},p.appendChild(l),p.appendChild(h)}c.appendChild(p),c.appendChild(u),a.appendChild(o),a.appendChild(s),a.appendChild(c);var f=document.createElement("div");f.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),f.appendChild(i),f.appendChild(a),document.body.appendChild(f),e.map((function(e){if(e.id){var t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var r=e.thumbnail;try{r.getSize().width>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=function(){document.body.removeChild(f),n({sourceId:e.id,audio:d})},s.appendChild(t)}}))}))}(r,n);case 5:return i=e.sent,a=i.sourceId,o=i.audio,e.next=10,KN(a,t,o);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function XN(e){return JN.apply(this,arguments)}function JN(){return(JN=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=["window","screen"],"application"!==t&&"window"!==t||(n=["window"]),"screen"===t&&(n=["screen"]),r=bw()){e.next=5;break}throw console.error("failed to fetch electron, please mount it to window"),new aw(iw.ELECTRON_IS_NULL);case 5:i=null;try{i=(null===(a=r.desktopCapturer)||void 0===a?void 0:a.getSources({types:n}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch(e){i=null}return i&&i.then||(i=new zl((function(e,t){r.desktopCapturer.getSources({types:n},(function(n,r){n?t(n):e(r)}))}))),e.prev=8,e.next=11,i;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),new aw(iw.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.t0.toString());case 17:case"end":return e.stop()}}),e,null,[[8,14]])})))).apply(this,arguments)}var QN=new fO("safari"),ZN=!1,$N=!1;function eD(e,t){return tD.apply(this,arguments)}function tD(){return(tD=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,i=null;case 1:if(!(r<2)){e.next=23;break}return e.prev=2,e.next=5,nD(t,n,r>0);case 5:return i=e.sent,e.abrupt("break",23);case 9:if(e.prev=9,e.t0=e.catch(2),!(e.t0 instanceof aw)){e.next=13;break}throw Dk.error("[".concat(n,"] ").concat(e.t0.toString())),e.t0;case 13:if((a=iD(e.t0.name||e.t0.code||e.t0,e.t0.message)).code!==iw.MEDIA_OPTION_INVALID){e.next=20;break}return Dk.debug("[".concat(n,"] detect media option invalid, retry")),r+=1,e.next=19,eO(500);case 19:return e.abrupt("continue",21);case 20:throw Dk.error("[".concat(n,"] ").concat(a.toString())),a;case 21:e.next=1;break;case 23:if(i){e.next=25;break}throw new aw(iw.UNEXPECTED_ERROR,"can not find stream after getUserMedia");case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function nD(e,t,n){return rD.apply(this,arguments)}function rD(){return(rD=p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p,h,f,_,v,E,m,S,g,T,b;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=2;break}throw new aw(iw.NOT_SUPPORTED,"can not find getUserMedia");case 2:if(r&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height)),i=Gk(),a=new MediaStream,t.audioSource&&a.addTrack(t.audioSource),t.videoSource&&a.addTrack(t.videoSource),t.audio||t.video||t.screen){e.next=6;break}return e.abrupt("return",(Dk.debug("Using Video Source/ Audio Source"),a));case 6:if(!t.screen){e.next=68;break}if(!bw()){e.next=25;break}if(!t.screen.sourceId){e.next=17;break}return e.t0=aD,e.t1=a,e.next=13,KN(t.screen.sourceId,t.screen,!!t.screenAudio);case 13:e.t2=e.sent,(0,e.t0)(e.t1,e.t2),e.next=23;break;case 17:return e.t3=aD,e.t4=a,e.next=21,qN(t.screen,!!t.screenAudio);case 21:e.t5=e.sent,(0,e.t3)(e.t4,e.t5);case 23:e.next=68;break;case 25:if(!(NA()&&t.screen.extensionId&&t.screen.mandatory)){e.next=41;break}if(i.getStreamFromExtension){e.next=28;break}throw new aw(iw.NOT_SUPPORTED,"This browser does not support screen sharing");case 28:return Dk.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"')),e.next=31,E=t.screen.extensionId,m=n,new zl((function(e,t){try{chrome.runtime.sendMessage(E,{getStream:!0},(function(n){if(!n||!n.streamId)return Dk.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new aw(iw.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){Dk.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(E,")"),e.toString()),t(new aw(iw.CHROME_PLUGIN_NOT_INSTALL))}}));case 31:return o=e.sent,t.screen.mandatory.chromeMediaSourceId=o,e.t6=aD,e.t7=a,e.next=37,navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}});case 37:e.t8=e.sent,(0,e.t6)(e.t7,e.t8),e.next=68;break;case 41:if(!i.getDisplayMedia){e.next=57;break}return t.screen.mediaSource&&aN(t.screen.mediaSource),c={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:null!==(s=t.screen.displaySurface)&&void 0!==s?s:"screen"===t.screen.mediaSource?"monitor":t.screen.mediaSource},u=t.screen,d=u.selfBrowserSurface,p=u.surfaceSwitching,h=u.systemAudio,f=u.preferCurrentTab,_={selfBrowserSurface:d,surfaceSwitching:p,systemAudio:h,preferCurrentTab:f},!d&&delete _.selfBrowserSurface,!p&&delete _.surfaceSwitching,!h&&delete _.systemAudio,!f&&delete _.preferCurrentTab,Dk.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:c,audio:t.screenAudio,controls:_})),e.t9=aD,e.t10=a,e.next=53,navigator.mediaDevices.getDisplayMedia(DN({video:c,audio:t.screenAudio},_));case 53:e.t11=e.sent,(0,e.t9)(e.t10,e.t11),e.next=68;break;case 57:if(LA()){e.next=59;break}throw Dk.error("[".concat(n,"] This browser does not support screenSharing")),new aw(iw.NOT_SUPPORTED,"This browser does not support screen sharing");case 59:return t.screen.mediaSource&&aN(t.screen.mediaSource),v={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}},Dk.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(v))),e.t12=aD,e.t13=a,e.next=66,navigator.mediaDevices.getUserMedia(v);case 66:e.t14=e.sent,(0,e.t12)(e.t13,e.t14);case 68:if(t.video||t.audio){e.next=70;break}return e.abrupt("return",a);case 70:if(S={video:t.video,audio:t.audio},g=rk("MEDIA_DEVICE_CONSTRAINTS"))try{"string"==typeof g&&(g=JSON.parse(g)),S=sO(S,g)}catch(e){}if(Dk.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(S)),IA(),b=null,e.t15=DA()||xA()||kA(),!e.t15){e.next=79;break}return e.next=78,QN.lock();case 78:b=e.sent;case 79:return e.prev=79,e.next=82,navigator.mediaDevices.getUserMedia(S);case 82:T=e.sent,e.next=88;break;case 85:throw e.prev=85,e.t16=e.catch(79),b&&b(),e.t16;case 88:return e.abrupt("return",(S.audio&&(ZN=!0),S.video&&($N=!0),aD(a,T),b&&b(),a));case 89:case"end":return e.stop()}}),e,null,[[79,85]])})))).apply(this,arguments)}function iD(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new aw(iw.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new aw(iw.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new aw(iw.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new aw(iw.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new aw(iw.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new aw(iw.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return Dk.error("getUserMedia unexpected error",e),new aw(iw.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function aD(e,t){var n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}var oD=new(function(e){function t(){var t;return kN(r(t=e.call(this)||this),"_state",RN.IDLE),kN(r(t),"isAccessMicrophonePermission",!1),kN(r(t),"isAccessCameraPermission",!1),kN(r(t),"lastAccessMicrophonePermission",!1),kN(r(t),"lastAccessCameraPermission",!1),kN(r(t),"checkdeviceMatched",!1),kN(r(t),"deviceInfoMap",new Map),t.init().then((function(){navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",t.updateDevicesInfo.bind(r(t))),window.setInterval((function(){(rk("ENUMERATE_DEVICES_INTERVAL")||($A()||wA()===TA.HARMONY_OS)&&ZA())&&t.updateDevicesInfo()}),rk("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((function(e){return Dk.error(e.toString())})),t}i(t,e);var n=t.prototype;return n.enumerateDevices=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f,_,v=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>2&&void 0!==v[2]&&v[2],navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return e.abrupt("return",new aw(iw.NOT_SUPPORTED,"enumerateDevices() not supported.").throw());case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:if(i=e.sent,a=this.checkMediaDeviceInfoIsOk(i),o=!this.isAccessMicrophonePermission&&t,s=!this.isAccessCameraPermission&&n,a.audio&&(o=!1),a.video&&(s=!1),c=null,u=null,d=null,r||!o&&!s){e.next=69;break}if(e.t0=QN.isLocked,!e.t0){e.next=19;break}return Dk.debug("[device manager] wait GUM lock"),e.next=16,QN.lock();case 16:e.t1=e.sent,(0,e.t1)(),Dk.debug("[device manager] GUM unlock");case 19:if(ZN&&(o=!1,this.isAccessMicrophonePermission=!0),$N&&(s=!1,this.isAccessCameraPermission=!0),Dk.debug("[device manager] check media device permissions",t,n,o,s),!o||!s){e.next=38;break}return e.prev=23,e.next=26,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 26:d=e.sent,e.next=35;break;case 29:if(e.prev=29,e.t2=e.catch(23),(p=iD(e.t2.name||e.t2.code||e.t2,e.t2.message)).code!==iw.PERMISSION_DENIED){e.next=34;break}throw p;case 34:Dk.warning("getUserMedia failed in getDevices",p);case 35:this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0,e.next=68;break;case 38:if(!o){e.next=54;break}return e.prev=39,e.next=42,navigator.mediaDevices.getUserMedia({audio:t});case 42:c=e.sent,e.next=51;break;case 45:if(e.prev=45,e.t3=e.catch(39),(h=iD(e.t3.name||e.t3.code||e.t3,e.t3.message)).code!==iw.PERMISSION_DENIED){e.next=50;break}throw h;case 50:Dk.warning("getUserMedia failed in getDevices",h);case 51:this.isAccessMicrophonePermission=!0,e.next=68;break;case 54:if(!s){e.next=68;break}return e.prev=55,e.next=58,navigator.mediaDevices.getUserMedia({video:n});case 58:u=e.sent,e.next=67;break;case 61:if(e.prev=61,e.t4=e.catch(55),(f=iD(e.t4.name||e.t4.code||e.t4,e.t4.message)).code!==iw.PERMISSION_DENIED){e.next=66;break}throw f;case 66:Dk.warning("getUserMedia failed in getDevices",f);case 67:this.isAccessCameraPermission=!0;case 68:Dk.debug("[device manager] mic permission",t,"cam permission",n);case 69:return e.prev=69,e.next=72,navigator.mediaDevices.enumerateDevices();case 72:return _=e.sent,e.abrupt("return",(c&&c.getTracks().forEach((function(e){return e.stop()})),u&&u.getTracks().forEach((function(e){return e.stop()})),d&&d.getTracks().forEach((function(e){return e.stop()})),c=null,u=null,d=null,_));case 76:return e.prev=76,e.t5=e.catch(69),e.abrupt("return",(c&&c.getTracks().forEach((function(e){return e.stop()})),u&&u.getTracks().forEach((function(e){return e.stop()})),d&&d.getTracks().forEach((function(e){return e.stop()})),c=null,u=null,d=null,new aw(iw.ENUMERATE_DEVICES_FAILED,e.t5.toString()).throw()));case 79:case"end":return e.stop()}}),e,this,[[23,29],[39,45],[55,61],[69,76]])})));return function(t,n){return e.apply(this,arguments)}}(),n.getRecordingDevices=function(){var e=p(l().mark((function e(){var t,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audioinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getCamerasDevices=function(){var e=p(l().mark((function e(){var t,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!1,!0,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"videoinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getSpeakers=function(){var e=p(l().mark((function e(){var t,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audiooutput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.searchDeviceIdByName=function(e){var t=null;return this.deviceInfoMap.forEach((function(n){n.device.label===e&&(t=n.device.deviceId)})),t},n.getDeviceById=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(n=e.sent.find((function(e){return e.deviceId===t}))){e.next=5;break}throw new aw(iw.DEVICE_NOT_FOUND,"deviceId: ".concat(t));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.init=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state=RN.INITING,e.prev=1,e.next=4,this.updateDevicesInfo();case 4:this.state=RN.INITEND,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),Dk.warning("Device Detection functionality cannot start properly.",e.t0.toString()),this.state=RN.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new aw(iw.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}(),n.updateDevicesInfo=function(){var e=p(l().mark((function e(){var t,n,r,i,a,o,s=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(t=e.sent,n=Date.now(),r=[],t[0]&&t[0].label&&!1===this.checkdeviceMatched&&(this.checkdeviceMatched=!0,i=t.find((function(e){return"audioinput"===e.kind&&"default"===e.deviceId})),a=t.find((function(e){return"audiooutput"===e.kind&&"default"===e.deviceId})),i&&a?a.groupId===i.groupId?Dk.debug("[device-check] default input ".concat(i.label," and output ").concat(a.label," is the same group")):Dk.debug("[device-check] default input ".concat(i.label," and output ").concat(a.label," is not the same group")):Dk.debug("[device-check] default input or output not found")),o=this.checkMediaDeviceInfoIsOk(t),t.forEach((function(e){if(e.deviceId){var t=s.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(t?t.state:"INACTIVE")){var i={initAt:n,updateAt:n,device:e,state:"ACTIVE"};s.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),r.push(i)}t&&(t.updateAt=n)}})),this.deviceInfoMap.forEach((function(e,t){"ACTIVE"===e.state&&e.updateAt!==n&&(e.state="INACTIVE",r.push(e))})),this.state===RN.INITEND){e.next=9;break}return e.abrupt("return",(o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0))));case 9:r.forEach((function(e){switch(e.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(CN.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(CN.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(CN.PLAYOUT_DEVICE_CHANGED,e)}})),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.checkMediaDeviceInfoIsOk=function(e){for(var t,n=e.filter((function(e){return"audioinput"===e.kind})),r=e.filter((function(e){return"videoinput"===e.kind})),i={audio:!1,video:!1},a=h(n);!(t=a()).done;){var o=t.value;if(o.label&&o.deviceId){i.audio=!0;break}}for(var s,c=h(r);!(s=c()).done;){var u=s.value;if(u.label&&u.deviceId){i.video=!0;break}}return i},v(t,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this.emit(CN.STATE_CHANGE,e),this._state=e)}}]),t}(gw)),sD=!1,cD=new(function(e){function t(){var t;return kN(r(t=e.apply(this,arguments)||this),"onAutoplayFailed",void 0),kN(r(t),"onAudioAutoplayFailed",void 0),t}return i(t,e),t}(gw));function uD(){if(IA(),!sD){var e=function e(t){t.preventDefault(),sD=!1,ew()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};sD=!0,ew()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Dk.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),cD.onAutoplayFailed?cD.onAutoplayFailed():cD.onAudioAutoplayFailed?Dk.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):Dk.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),cD.emit("autoplay-failed")}}function dD(e,t,n,r){if(e){var i=Fk.getBaseInfoBySessionId(e);if(i){var a=i.info,o=Date.now(),s=DN(DN({},a),{},{vid:void 0===a.vid?0:Number(a.vid),lts:o,elapse:o-i.startTime,cbRegistered:cD.onAutoplayFailed||cD.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});Fk.send({type:Mk.AUTOPLAY_FAILED,data:s},!0)}}}var pD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],lD=new(function(){function e(){var e=this;kN(this,"onAutoplayFailed",void 0),kN(this,"elementMap",new Map),kN(this,"elementStateMap",new Map),kN(this,"elementsNeedToResume",[]),kN(this,"sinkIdMap",new Map),kN(this,"autoResumeAfterInterruption",(function(t){Array.from(e.elementMap.entries()).forEach((function(n){var r=n[0],i=n[1],a=e.elementStateMap.get(r),o=i.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(Dk.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(s," ").concat(t)),"live"===s){if(t)return i.pause(),void i.play();if("running"===UN.curState)return KA()?(i.pause(),void i.play()):void(a&&"paused"===a&&i.play())}}))})),kN(this,"autoResumeAfterInterruptionOnIOS15_16",(function(){Array.from(e.elementMap.entries()).forEach((function(e){e[0];var t=e[1],n=t.srcObject.getAudioTracks()[0];n&&"live"===n.readyState&&(Dk.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),t.pause(),t.play())}))})),this.autoResumeAudioElement(),UN.on(Kk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),UN.on(Kk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),UN.on(Kk.STATE_CHANGE,(function(){xA()&&"suspended"===UN.prevState&&"running"===UN.curState&&e.autoResumeAfterInterruption()}))}var t=e.prototype;return t.setSinkID=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.elementMap.get(t),this.sinkIdMap.set(t,n),!r){e.next=10;break}return e.prev=2,e.next=5,r.setSinkId(n);case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new aw(iw.PERMISSION_DENIED,"can not set sink id: "+e.t0.toString());case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,n){return e.apply(this,arguments)}}(),t.play=function(e,t,n,r){var i=this;if(!this.elementMap.has(t)){var a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,yN.INIT),this.setVolume(t,n);var o=this.sinkIdMap.get(t);if(o)try{a.setSinkId(o).catch((function(e){Dk.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){Dk.warning("[".concat(t,"] set sink id failed"),e.toString())}var s=a.play();s&&s.then&&s.catch((function(e){r&&dD(r,"audio",e.message,t),Dk.warning("audio element play warning",e.toString()),i.elementMap.has(t)&&"NotAllowedError"===e.name&&(Dk.warning("detected audio element autoplay failed"),i.elementsNeedToResume.push(a),Gw((function(){i.onAutoplayFailed&&i.onAutoplayFailed(),uD()})))}))}},t.updateTrack=function(e,t){var n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))},t.isPlaying=function(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)},t.setVolume=function(e,t){var n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)},t.stop=function(e){var t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),t){var n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}},t.bindAudioElementEvents=function(e,t){var n=this;pD.forEach((function(r){t.addEventListener(r,(function(r){var i=n.elementStateMap.get(e),a="pause"===r.type?"paused":r.type;if(Dk.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(a)),"error"===r.type){var o=null==t?void 0:t.error;o&&Dk.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}n.elementStateMap.set(e,a)}))}))},t.getPlayerState=function(e){return this.elementStateMap.get(e)||"uninit"},t.autoResumeAudioElement=function(){var e=this,t=function(){e.elementsNeedToResume.forEach((function(e){e.play().then((function(e){Dk.debug("Auto resume audio element success")})).catch((function(e){Dk.warning("Auto resume audio element failed!",e)}))})),e.elementsNeedToResume=[]};new zl((function(e){document.body?e():window.addEventListener("load",(function(){return e()}))})).then((function(){ew()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))},e}());function hD(){return function(e,t,n){var r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new aw(iw.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",Dk);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=r.apply(this,t);return i instanceof zl?new zl((function(e,t){i.then(e).catch(t)})):i}),n}}var fD=function(e){function t(t){var n;return kN(r(n=e.call(this)||this),"name","VideoProcessorDestination"),kN(r(n),"ID","0"),kN(r(n),"_source",void 0),kN(r(n),"videoContext",void 0),kN(r(n),"inputTrack",void 0),n.videoContext=t,n}i(t,e);var n=t.prototype;return n.pipe=function(){throw new aw(iw.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")},n.unpipe=function(){throw new aw(iw.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")},n.enable=function(){},n.disable=function(){},n.updateInput=function(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(TN.ON_TRACK,e.track))},n.reset=function(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(TN.ON_TRACK,void 0)},v(t,[{key:"kind",get:function(){return"video"}},{key:"enabled",get:function(){return!0}}]),t}(gw),_D=function(e){function t(t,n){var i;return kN(r(i=e.call(this)||this),"constraintsMap",new Map),kN(r(i),"statsRegistry",[]),kN(r(i),"usageRegistry",[]),kN(r(i),"trackId",void 0),kN(r(i),"direction",void 0),kN(r(i),"_chained",!1),i.trackId=t,i.direction=n,i}i(t,e);var n=t.prototype;return n.getConstraints=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xw(this,bN.REQUEST_CONSTRAINTS);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.requestApplyConstraints=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(Dk.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Mw(this,bN.REQUEST_UPDATE_CONSTRAINTS,Array.from(nh(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.requestRevertConstraints=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(Dk.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Mw(this,bN.REQUEST_UPDATE_CONSTRAINTS,Array.from(nh(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.registerStats=function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})},n.unregisterStats=function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)},n.gatherStats=function(){for(var e,t=[],n=h(this.statsRegistry);!(e=n()).done;){var r=e.value,i=r.processorID,a=r.processorName,o=r.type,s=r.cb;try{var c=s();t.push({processorID:i,processorName:a,type:o,stats:c})}catch(t){Dk.error(new aw(iw.UNEXPECTED_ERROR,t.message))}}return t},n.registerUsage=function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})},n.unregisterUsage=function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)},n.gatherUsage=function(){var e=p(l().mark((function e(){var t,n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=h(this.usageRegistry);case 4:if((r=n()).done){e.next=21;break}if(i=r.value.cb,e.prev=6,a=i(),e.t0=a instanceof zl,!e.t0){e.next=13;break}return e.next=12,a;case 12:a=e.sent;case 13:t.push(DN(DN({},a),{},{direction:this.direction})),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(6),Dk.error("gather extension usage error",e.t1);case 19:e.next=4;break;case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(){return e.apply(this,arguments)}}(),n.getDirection=function(){return this.direction},v(t,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}}]),t}(gw),vD=function(e){function t(t){var n;return kN(r(n=e.call(this)||this),"name","AudioProcessorDestination"),kN(r(n),"ID","0"),kN(r(n),"inputTrack",void 0),kN(r(n),"inputNode",void 0),kN(r(n),"audioProcessorContext",void 0),kN(r(n),"_source",void 0),n.audioProcessorContext=t,n}i(t,e);var n=t.prototype;return n.pipe=function(){throw new aw(iw.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")},n.unpipe=function(){throw new aw(iw.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")},n.enable=function(){},n.disable=function(){},n.reset=function(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(TN.ON_TRACK,void 0),this.emit(TN.ON_NODE,void 0)},n.updateInput=function(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(TN.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(TN.ON_NODE,this.inputNode))},v(t,[{key:"kind",get:function(){return"audio"}},{key:"enabled",get:function(){return!0}}]),t}(gw),ED=function(e){function t(t,n,i){var a;return kN(r(a=e.call(this)||this),"constraintsMap",new Map),kN(r(a),"statsRegistry",[]),kN(r(a),"audioContext",void 0),kN(r(a),"trackId",void 0),kN(r(a),"direction",void 0),kN(r(a),"usageRegistry",[]),kN(r(a),"_chained",!1),a.audioContext=t,a.trackId=n,a.direction=i,a}i(t,e);var n=t.prototype;return n.getConstraints=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xw(this,bN.REQUEST_CONSTRAINTS));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getAudioContext=function(){return this.audioContext},n.requestApplyConstraints=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(Dk.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Mw(this,bN.REQUEST_UPDATE_CONSTRAINTS,Array.from(nh(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.requestRevertConstraints=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(this.constraintsMap.delete(t),Mw(this,bN.REQUEST_UPDATE_CONSTRAINTS,Array.from(nh(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.registerStats=function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})},n.unregisterStats=function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)},n.gatherStats=function(){for(var e,t=[],n=h(this.statsRegistry);!(e=n()).done;){var r=e.value,i=r.processorID,a=r.processorName,o=r.type,s=r.cb;try{var c=s();t.push({processorID:i,processorName:a,type:o,stats:c})}catch(t){Dk.error(new aw(iw.UNEXPECTED_ERROR,t.message))}}return t},n.registerUsage=function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})},n.unregisterUsage=function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)},n.gatherUsage=function(){var e=p(l().mark((function e(){var t,n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=h(this.usageRegistry);case 4:if((r=n()).done){e.next=21;break}if(i=r.value.cb,e.prev=6,a=i(),e.t0=a instanceof zl,!e.t0){e.next=13;break}return e.next=12,a;case 12:a=e.sent;case 13:t.push(DN(DN({},a),{},{direction:this.direction})),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(6),Dk.error("gather extension usage error",e.t1);case 19:e.next=4;break;case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(){return e.apply(this,arguments)}}(),n.getDirection=function(){return this.direction},v(t,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}}]),t}(gw),mD=function(e){function t(){var t;return kN(r(t=e.call(this)||this),"context",void 0),kN(r(t),"processSourceNode",void 0),kN(r(t),"outputTrack",void 0),kN(r(t),"processedNode",void 0),kN(r(t),"clonedTrack",void 0),kN(r(t),"outputNode",void 0),t.outputNode=new SD,t}i(t,e);var n=t.prototype;return n.setVolume=function(){},n.createOutputTrack=function(){throw new aw(iw.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")},n.getOriginVolumeLevel=function(){return 0},n.getAccurateVolumeLevel=function(){return 0},n.stopGetAudioBuffer=function(){},n.startGetAudioBuffer=function(){},n.play=function(){},n.stop=function(){},n.destroy=function(){},n.updateTrack=function(){},n.updateOriginTrack=function(){},n.createMediaStreamSourceNode=function(){},v(t,[{key:"isPlayed",get:function(){return!0}},{key:"isFreeze",get:function(){return!1}}]),t}(gw),SD=function(){function e(){}var t=e.prototype;return t.disconnect=function(){},t.connect=function(){},e}();function gD(e){return new zl((function(t,n){var r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);var a=xA()?"canplay":"playing";i.addEventListener(a,(function(){var e=i.videoWidth,n=i.videoHeight;!e&&LA()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(rO),setTimeout((function(){r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function TD(e){var t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});var n=$k(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!JA()&&n.frameRate&&(t.frameRate=n.frameRate),PA()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),LA()&&(t.frameRate={ideal:30,max:30}),t}function bD(e){var t={};return JA()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,NA()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function RD(e){var t=bD(e);if(e.encoderConfig){var n=rN(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),$A()&&(t.sampleRate=void 0),t}var CD,yD,ID,AD,wD,OD,kD,ND,DD,PD,LD,xD,MD,UD,VD,FD,BD,jD,GD,WD,HD,KD,YD,qD,zD,XD,JD,QD,ZD,$D,eP,tP,nP,rP,iP,aP,oP,sP,cP,uP,dP=function(e){var t=e._encoderConfig;if(t){var n=e.getMediaStreamTrackSettings(),r=n.frameRate,i=n.width,a=n.height,o=t.frameRate,s=void 0===o?r:o,c=t.width,u=void 0===c?i:c,d=t.height,p=void 0===d?a:d;if(s&&u&&p){var l=function(e,t,n){var r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(u=uO(u),p=uO(p),s=uO(s)),h=l.max,f=l.min,_=t||{},v=_.bitrateMax,E=_.bitrateMin;v||Dk.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(p,", fps: ").concat(s,"] => [brMax: ").concat(v,", brMin: ").concat(E,"]"));var m=rk("ENCODER_CONFIG_LIMIT").maxFramerate;return m&&"number"==typeof m&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:v||h,bitrateMin:E||f,scaleResolutionDownBy:1,scale:0}}}},pP=function(){var e=p(l().mark((function e(t,n,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(pO(""+n+r)).slice(0,16),a=i.slice(0,12),e.next=4,window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);case 4:return o=e.sent,e.t0=Uint8Array,e.next=8,window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,t);case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})))(t.buffer,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),lP=function(e){var t=document.createElement("canvas");return t.width=2,t.height=2,new zl((function(n,r){t.toBlob(p(l().mark((function e(i){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.remove(),!i){e.next=7;break}return e.next=3,hP(i);case 3:a=e.sent,n({buffer:a,width:t.width,height:t.height}),e.next=8;break;case 7:r(new aw(iw.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return e.stop()}}),e)}))),e,1)}))},hP=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fP=(CD=Vk({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),yD=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),ID=hD(),AD=_O("LocalAudioTrack","_enabledMutex"),wD=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),OD=hD(),kD=_O("LocalAudioTrack","_enabledMutex"),ND=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),DD=hD(),PD=hD(),LD=hD(),xD=Vk({argsMap:function(e){return[e.getTrackId()]}}),MD=hD(),UD=Vk({argsMap:function(e){return[e.getTrackId()]}}),VD=hD(),FD=Vk({argsMap:function(e){return[e.getTrackId()]}}),BD=Vk({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),jD=Vk({argsMap:function(e){return[e.getTrackId()]}}),ON((GD=function(e){function t(t,n,i,a){var o;return kN(r(o=e.call(this,t,i)||this),"trackMediaType",fN.AUDIO),kN(r(o),"_encoderConfig",void 0),kN(r(o),"_trackSource",void 0),kN(r(o),"metadata",[]),kN(r(o),"_enabled",!0),kN(r(o),"_volume",100),kN(r(o),"_useAudioElement",!0),kN(r(o),"_bypassWebAudio",!1),kN(r(o),"processor",void 0),kN(r(o),"_processorContext",void 0),kN(r(o),"_processorDestination",void 0),kN(r(o),"_getOriginVolumeLevel",void 0),o._encoderConfig=n,o._getOriginVolumeLevel=!!a,o._trackSource=new mD,rk("DISABLE_WEBAUDIO")&&(o._bypassWebAudio=!0),rk("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(o._useAudioElement=!1),DA()&&!MN?setTimeout((function(){return o.initWebAudio()})):o.initWebAudio(),o}i(t,e);var n=t.prototype;return n.setVolume=function(e){var t=this;cw(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&lD.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Dk.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));var n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,Mw(this,oN.NEED_REPLACE_TRACK,this).then((function(){Dk.debug("[".concat(t.getTrackId(),"] replace web audio track success"))})).catch((function(e){Dk.warning("[".concat(t.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}},n.getVolumeLevel=function(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()},n.setPlaybackDevice=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement&&Wk()){e.next=2;break}throw new aw(iw.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,lD.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setEnabled=function(){var e=p(l().mark((function e(t,n,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._setEnabled(t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n._setEnabled=function(){var e=p(l().mark((function e(t,n,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Dk.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=18;break}return this._originMediaStreamTrack.enabled=!0,e.prev=6,r||(this._enabled=!0),e.next=10,Mw(this,oN.NEED_ENABLE_TRACK,this);case 10:Dk.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success")),e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(6),r||(this._enabled=!1),Dk.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t0.toString()),e.t0;case 16:e.next=27;break;case 18:return this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1),e.prev=19,e.next=22,Mw(this,oN.NEED_DISABLE_TRACK,this);case 22:e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(19),r||(this._enabled=!0),Dk.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 27:case"end":return e.stop()}}),e,this,[[6,13],[19,24]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.setMuted=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,Dk.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,Mw(this,oN.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,Mw(this,oN.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getStats=function(){return Yw((function(){Dk.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),Uw(this,oN.GET_STATS)||DN({},vN)},n.setAudioFrameCallback=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(_N.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(_N.ON_AUDIO_BUFFER),this._source.on(_N.ON_AUDIO_BUFFER,(function(t){return e(t)}))},n.play=function(){Dk.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Dk.debug("[".concat(this.getTrackId(),"] start audio playback in element")),lD.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()},n.stop=function(){Dk.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?lD.stop(this.getTrackId()):this._source.stop()},n.close=function(){e.prototype.close.call(this),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()},n._updatePlayerSource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Dk.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&lD.updateTrack(this.getTrackId(),this._mediaStreamTrack)},n._updateOriginMediaStreamTrack=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._originMediaStreamTrack!==t,!e.t0){e.next=16;break}if(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack===this._source.outputTrack){e.next=14;break}return this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=12,Mw(this,oN.NEED_REPLACE_TRACK,this);case 12:e.next=15;break;case 14:this._source.updateTrack(this._originMediaStreamTrack);case 15:this._getOriginVolumeLevel&&this._source.updateOriginTrack(t);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.renewMediaStreamTrack=function(e){return zl.resolve(void 0)},n.pipe=function(e){if(this._bypassWebAudio)throw new aw(iw.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new aw(iw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e},n.unpipe=function(){var e;if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}},n.bindProcessorDestinationEvents=function(e){var t=this;e.on(TN.ON_TRACK,p(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=10;break}if(e.t0=n!==t._mediaStreamTrack,!e.t0){e.next=8;break}return t._mediaStreamTrack=n,t._updatePlayerSource(!1),t._source.processedNode=t._source.createMediaStreamSourceNode(n),e.next=8,Mw(t,oN.NEED_REPLACE_TRACK,t);case 8:e.next=16;break;case 10:if(e.t1=t._mediaStreamTrack!==t._originMediaStreamTrack,!e.t1){e.next=16;break}return t._mediaStreamTrack=t._originMediaStreamTrack,t._updatePlayerSource(),e.next=16,Mw(t,oN.NEED_REPLACE_TRACK,t);case 16:case"end":return e.stop()}}),e)})))),e.on(TN.ON_NODE,(function(e){t._source.processedNode=e}))},n.unbindProcessorDestinationEvents=function(e){e.removeAllListeners(TN.ON_TRACK),e.removeAllListeners(TN.ON_NODE)},n.bindProcessorContextEvents=function(e){var t=this;e.on(bN.REQUEST_CONSTRAINTS,p(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t._originMediaStreamTrack.getSettings());case 1:case"end":return e.stop()}}),e)}))))},n.unbindProcessorContextEvents=function(e){e.removeAllListeners(bN.REQUEST_CONSTRAINTS)},n.initWebAudio=function(){return this._trackSource instanceof mD&&(this._trackSource=new HN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource},n.initProcessor=function(){var e=this,t=new ED(this._source.context,this.getTrackId(),"local"),n=new vD(t);return this._processorContext=t,this._processorDestination=n,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(n),this._source.on(_N.UPDATE_SOURCE,(function(){e.processor&&e.processor.updateInput({node:e._source.processSourceNode,context:t})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(lD.stop(this.getTrackId()),this._source.play()),Mw(this,oN.NEED_REPLACE_MIXING_TRACK,this).then((function(){Dk.debug("[".concat(e.getTrackId(),"] replace from origin track to web audio track success"))})).catch((function(t){Dk.warning("[".concat(e.getTrackId(),"] replace from origin track to web audio track failed"),t)}))),{processorContext:t,processorDestination:n}},v(t,[{key:"_source",get:function(){return this.initWebAudio()},set:function(e){this._trackSource=e}},{key:"processorContext",get:function(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}},{key:"processorDestination",get:function(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}},{key:"isPlaying",get:function(){return this._useAudioElement?lD.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"LocalAudioTrack"}}]),t}(LN)).prototype,"setVolume",[CD],Object.getOwnPropertyDescriptor(GD.prototype,"setVolume"),GD.prototype),ON(GD.prototype,"setPlaybackDevice",[yD,ID],Object.getOwnPropertyDescriptor(GD.prototype,"setPlaybackDevice"),GD.prototype),ON(GD.prototype,"setEnabled",[AD,wD,OD],Object.getOwnPropertyDescriptor(GD.prototype,"setEnabled"),GD.prototype),ON(GD.prototype,"setMuted",[kD,ND,DD],Object.getOwnPropertyDescriptor(GD.prototype,"setMuted"),GD.prototype),ON(GD.prototype,"getStats",[PD],Object.getOwnPropertyDescriptor(GD.prototype,"getStats"),GD.prototype),ON(GD.prototype,"setAudioFrameCallback",[LD],Object.getOwnPropertyDescriptor(GD.prototype,"setAudioFrameCallback"),GD.prototype),ON(GD.prototype,"play",[xD,MD],Object.getOwnPropertyDescriptor(GD.prototype,"play"),GD.prototype),ON(GD.prototype,"stop",[UD,VD],Object.getOwnPropertyDescriptor(GD.prototype,"stop"),GD.prototype),ON(GD.prototype,"close",[FD],Object.getOwnPropertyDescriptor(GD.prototype,"close"),GD.prototype),ON(GD.prototype,"pipe",[BD],Object.getOwnPropertyDescriptor(GD.prototype,"pipe"),GD.prototype),ON(GD.prototype,"unpipe",[jD],Object.getOwnPropertyDescriptor(GD.prototype,"unpipe"),GD.prototype),GD),_P=(WD=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),HD=hD(),KD=_O("MicrophoneAudioTrack","_enabledMutex"),YD=Vk({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),qD=hD(),zD=Vk({argsMap:function(e){return[e.getTrackId()]}}),ON((XD=function(e){function t(t,n,i,a){var o;return kN(r(o=e.call(this,t,n.encoderConfig?rN(n.encoderConfig):{},a,rk("GET_VOLUME_OF_MUTED_AUDIO_TRACK"))||this),"_config",void 0),kN(r(o),"_deviceName","default"),kN(r(o),"_constraints",void 0),kN(r(o),"_originalConstraints",void 0),kN(r(o),"_enabled",!0),o._config=n,o._constraints=i,o._originalConstraints=i,o._deviceName=t.label,"boolean"==typeof n.bypassWebAudio&&(o._bypassWebAudio=n.bypassWebAudio),(KA()||YA())&&UN.bindInterruptDetectorTrack(r(o)),o}i(t,e);var n=t.prototype;return n.setDevice=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),!this._enabled){e.next=35;break}return e.prev=1,e.next=4,oD.getDeviceById(t);case 4:return n=e.sent,(r={}).audio=DN({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,eD(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),Dk.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,eD({audio:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 25:this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=33;break;case 30:throw e.prev=30,e.t1=e.catch(1),Dk.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 33:e.next=45;break;case 35:return e.prev=35,e.next=38,oD.getDeviceById(t);case 38:a=e.sent,this._deviceName=a.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=45;break;case 42:throw e.prev=42,e.t2=e.catch(35),Dk.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 45:Dk.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"));case 46:case"end":return e.stop()}}),e,this,[[1,30],[8,14],[35,42]])})));return function(t){return e.apply(this,arguments)}}(),n.setEnabled=function(){var t=p(l().mark((function t(n,r,i){var a,o,s,c,u;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=5;break}return Dk.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),t.next=4,e.prototype._setEnabled.call(this,n);case 4:return t.abrupt("return",t.sent);case 5:if(i){t.next=9;break}if(n!==this._enabled){t.next=8;break}return t.abrupt("return");case 8:this.stateCheck("enabled",n);case 9:if(Dk.info("[".concat(this.getTrackId(),"] start setEnabled"),n),rk("AUTO_RESET_AUDIO_ROUTE")&&(xA()||zA())&&(a=navigator.audioSession)&&(n||(a.type="playback"),a.type="auto"),n){t.next=21;break}return this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(o=this._source.clonedTrack)||void 0===o||o.stop(),i||(this._enabled=!1),t.prev=12,t.next=15,Mw(this,oN.NEED_DISABLE_TRACK,this);case 15:t.next=20;break;case 17:throw t.prev=17,t.t0=t.catch(12),Dk.error("[".concat(this.getTrackId(),"] setEnabled false failed"),t.t0.toString()),t.t0;case 20:return t.abrupt("return");case 21:return s=DN({},this._constraints),(c=oD.searchDeviceIdByName(this._deviceName))&&!s.deviceId&&(s.deviceId=c),t.prev=23,i||(this._enabled=!0),t.next=27,eD({audio:this._constraints},this.getTrackId());case 27:return u=t.sent,t.next=30,this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1);case 30:return t.next=32,Mw(this,oN.NEED_ENABLE_TRACK,this);case 32:t.next=37;break;case 34:throw t.prev=34,t.t1=t.catch(23),i||(this._enabled=!1),Dk.error("[".concat(this.getTrackId(),"] setEnabled true failed"),t.t1.toString()),t.t1;case 37:Dk.info("[".concat(this.getTrackId(),"] setEnabled success"));case 38:case"end":return t.stop()}}),t,this,[[12,17],[23,34]])})));return function(e,n,r){return t.apply(this,arguments)}}(),n.close=function(){e.prototype.close.call(this),(KA()||YA())&&UN.unbindInterruptDetectorTrack(this)},n.onTrackEnded=function(){var e=this;if((xA()||zA())&&this._enabled&&!this._isClosed&&UN.duringInterruption){var t=function(){var n=p(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(UN.off(Kk.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return Dk.debug("[".concat(e.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();UN.on(Kk.IOS_INTERRUPTION_END,t)}else Dk.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lN.TRACK_ENDED)},n.renewMediaStreamTrack=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=oD.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId=r),this._constraints=n,!this._enabled){e.next=8;break}return this._originMediaStreamTrack.stop(),e.next=5,eD({audio:this._constraints},this.getTrackId());case 5:return i=e.sent,e.next=8,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.bindProcessorContextEvents=function(t){var n=this;e.prototype.bindProcessorContextEvents.call(this,t),t.on(bN.REQUEST_UPDATE_CONSTRAINTS,p(l().mark((function e(t,r,i){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object.assign.apply(Object,[{},n._originalConstraints].concat(t)),e.next=4,n.renewMediaStreamTrack(a);case 4:r(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),i(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))))},n.unbindProcessorContextEvents=function(t){e.prototype.unbindProcessorContextEvents.call(this,t),t.removeAllListeners(bN.REQUEST_UPDATE_CONSTRAINTS)},v(t,[{key:"__className__",get:function(){return"MicrophoneAudioTrack"}}]),t}(fP)).prototype,"setDevice",[WD,HD],Object.getOwnPropertyDescriptor(XD.prototype,"setDevice"),XD.prototype),ON(XD.prototype,"setEnabled",[KD,YD,qD],Object.getOwnPropertyDescriptor(XD.prototype,"setEnabled"),XD.prototype),ON(XD.prototype,"close",[zD],Object.getOwnPropertyDescriptor(XD.prototype,"close"),XD.prototype),XD),vP=(JD=Vk({argsMap:function(e,t){return[e.getTrackId(),t,e.duration]}}),QD=hD(),ZD=Vk({argsMap:function(e){return[e.getTrackId()]}}),$D=hD(),eP=Vk({argsMap:function(e){return[e.getTrackId()]}}),tP=hD(),nP=Vk({argsMap:function(e){return[e.getTrackId()]}}),rP=hD(),iP=Vk({argsMap:function(e){return[e.getTrackId()]}}),aP=hD(),oP=Vk({argsMap:function(e){return[e.getTrackId()]}}),sP=Vk({argsMap:function(e){return[e.getTrackId()]}}),cP=hD(),ON((uP=function(e){function t(t,n,i,a){var o;kN(r(o=e.call(this,n.createOutputTrack(),i,a)||this),"source",void 0),kN(r(o),"_bufferSource",void 0),o._useAudioElement=!1,o.source=t,o._bufferSource=n,o._bufferSource.on(_N.AUDIO_SOURCE_STATE_CHANGE,(function(e){o.safeEmit(lN.SOURCE_STATE_CHANGE,e)}));try{o._mediaStreamTrack=o._source.createOutputTrack()}catch(t){}return o}i(t,e);var n=t.prototype;return n.getCurrentTime=function(){return this._bufferSource.currentTime},n.startProcessAudioBuffer=function(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()},n.pauseProcessAudioBuffer=function(){this._bufferSource.pauseProcessAudioBuffer()},n.seekAudioBuffer=function(e){this._bufferSource.seekAudioBuffer(e)},n.resumeProcessAudioBuffer=function(){this._bufferSource.resumeProcessAudioBuffer()},n.stopProcessAudioBuffer=function(){this._bufferSource.stopProcessAudioBuffer()},n.close=function(){this.source=null,this._bufferSource.destroy(),e.prototype.close.call(this)},n.setAudioBufferPlaybackSpeed=function(e){cw(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)},v(t,[{key:"__className__",get:function(){return"BufferSourceAudioTrack"}},{key:"currentState",get:function(){return this._bufferSource.currentState}},{key:"duration",get:function(){return this._bufferSource.duration}},{key:"playbackSpeed",get:function(){return this._bufferSource.playbackSpeed}}]),t}(fP)).prototype,"startProcessAudioBuffer",[JD,QD],Object.getOwnPropertyDescriptor(uP.prototype,"startProcessAudioBuffer"),uP.prototype),ON(uP.prototype,"pauseProcessAudioBuffer",[ZD,$D],Object.getOwnPropertyDescriptor(uP.prototype,"pauseProcessAudioBuffer"),uP.prototype),ON(uP.prototype,"seekAudioBuffer",[eP,tP],Object.getOwnPropertyDescriptor(uP.prototype,"seekAudioBuffer"),uP.prototype),ON(uP.prototype,"resumeProcessAudioBuffer",[nP,rP],Object.getOwnPropertyDescriptor(uP.prototype,"resumeProcessAudioBuffer"),uP.prototype),ON(uP.prototype,"stopProcessAudioBuffer",[iP,aP],Object.getOwnPropertyDescriptor(uP.prototype,"stopProcessAudioBuffer"),uP.prototype),ON(uP.prototype,"close",[oP],Object.getOwnPropertyDescriptor(uP.prototype,"close"),uP.prototype),ON(uP.prototype,"setAudioBufferPlaybackSpeed",[sP,cP],Object.getOwnPropertyDescriptor(uP.prototype,"setAudioBufferPlaybackSpeed"),uP.prototype),uP),EP=function(e){function t(){var t,n=VN().createMediaStreamDestination();kN(r(t=e.call(this,n.stream.getAudioTracks()[0],void 0,tO(8,"track-mix-"))||this),"trackList",void 0),kN(r(t),"destNode",void 0),t._useAudioElement=!1;try{t._mediaStreamTrack=t._source.createOutputTrack()}catch(n){}return t.destNode=n,t.trackList=[],t}i(t,e);var n=t.prototype;return n.hasAudioTrack=function(e){return-1!==this.trackList.indexOf(e)},n.addAudioTrack=function(e){-1===this.trackList.indexOf(e)?(Dk.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Dk.debug("track ".concat(e.getTrackId()," is already added"))},n.removeAudioTrack=function(e){if(-1!==this.trackList.indexOf(e)){Dk.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}Bw(this.trackList,e),this.updateEncoderConfig()}},n.updateEncoderConfig=function(){var e={};this.trackList.forEach((function(t){t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e},n._updateRtpTransceiver=function(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((function(n){n instanceof t?n.emit(pN.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)})))},v(t,[{key:"__className__",get:function(){return"MixingAudioTrack"}},{key:"isActive",get:function(){for(var e,t=h(this.trackList);!(e=t()).done;){var n=e.value;if(n._enabled&&!n._isClosed&&!n.muted)return!0}return!1}}]),t}(fP),mP=function(e){function t(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return kN(r(n=e.call(this)||this),"audioBuffer",void 0),kN(r(n),"sourceNode",void 0),kN(r(n),"startPlayTime",0),kN(r(n),"startPlayOffset",0),kN(r(n),"pausePlayTime",0),kN(r(n),"options",void 0),kN(r(n),"currentLoopCount",0),kN(r(n),"currentPlaybackSpeed",100),kN(r(n),"_currentState","stopped"),n.audioBuffer=t,n.options=i,n.startPlayOffset=n.options.startPlayTime||0,n}i(t,e);var n=t.prototype;return n.createWebAudioDiagram=function(){return this.context.createGain()},n.updateOptions=function(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Dk.warning("can not set audio source options")},n.startProcessAudioBuffer=function(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"},n.pauseProcessAudioBuffer=function(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")},n.seekAudioBuffer=function(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))},n.resumeProcessAudioBuffer=function(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")},n.stopProcessAudioBuffer=function(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}},n.destroy=function(){this.audioBuffer=null,e.prototype.destroy.call(this)},n.setAudioBufferPlaybackSpeed=function(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e},n.startSourceNode=function(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))},n.createSourceNode=function(){var e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e},n.handleSourceNodeEnded=function(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()},n.reset=function(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0},v(t,[{key:"currentState",get:function(){return this._currentState},set:function(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(_N.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}},{key:"playbackSpeed",get:function(){return this.currentPlaybackSpeed}},{key:"currentTime",get:function(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}}]),t}(WN),SP=new Map;function gP(e,t){if(0===e.length||0===t.length)return 1/0;var n=dO(e),r=dO(t);return Math.floor(r/n)}var TP,bP,RP,CP,yP,IP,AP,wP,OP,kP,NP,DP,PP,LP,xP,MP,UP,VP,FP,BP,jP,GP,WP,HP,KP,YP,qP,zP,XP,JP,QP,ZP,$P,eL,tL,nL,rL,iL,aL,oL,sL,cL,uL,dL,pL,lL,hL,fL,_L=function(){function e(e){var t=this;kN(this,"trackId",void 0),kN(this,"config",void 0),kN(this,"onFirstVideoFrameDecoded",void 0),kN(this,"onVideoStateChanged",void 0),kN(this,"freezeTimeCounterList",[]),kN(this,"renderFreezeAccTime",0),kN(this,"renderFreezeAccTime2",0),kN(this,"isKeepLastFrame",!1),kN(this,"timeUpdatedCount",0),kN(this,"freezeTime",0),kN(this,"playbackTime",0),kN(this,"lastTimeUpdatedTime",0),kN(this,"autoplayFailed",!1),kN(this,"videoTrack",void 0),kN(this,"videoElement",void 0),kN(this,"cacheVideoElement",void 0),kN(this,"_render_interframe_delays",[]),kN(this,"_render_interframe_delays_sizes",[]),kN(this,"_videoState",IN.VideoStateStopped),kN(this,"videoElementCheckInterval",void 0),kN(this,"videoElementFreezeTimeout",void 0),kN(this,"_videoElementStatus",yN.NONE),kN(this,"isGettingVideoDimensions",!1),kN(this,"startGetVideoDimensions",(function(){!t.isGettingVideoDimensions&&function e(){if(t.isGettingVideoDimensions=!0,t.videoElement.videoWidth*t.videoElement.videoHeight>4)return Dk.debug("[".concat(t.trackId,"] current video dimensions:"),t.videoElement.videoWidth,t.videoElement.videoHeight),void(t.isGettingVideoDimensions=!1);setTimeout(e,500)}()})),kN(this,"autoResumeAfterInterruption",(function(){t.videoTrack&&"live"===t.videoTrack.readyState&&"running"===UN.curState&&(Dk.debug("[track-".concat(t.trackId,"] video element paused, auto resume for ").concat(OA())),qA()?(t.videoElement.srcObject=null,t.videoElement.srcObject=new MediaStream([t.videoTrack]),t.videoElement.play()):(t.videoElement.pause(),t.videoElement.play()))})),kN(this,"handleVideoEvents",(function(e){switch(e.type){case"play":case"playing":t.startGetVideoDimensions(),t.videoElementStatus=yN.PLAYING;break;case"loadeddata":if(t.videoState=IN.VideoStateStarting,t.onFirstVideoFrameDecoded&&t.onFirstVideoFrameDecoded(),t.cacheVideoElement){try{t.cacheVideoElement.srcObject=null,t.cacheVideoElement.remove()}catch(e){}t.cacheVideoElement=void 0}break;case"canplay":t.videoElementStatus=yN.CANPLAY;break;case"stalled":t.videoElementStatus=yN.STALLED;break;case"suspend":t.videoElementStatus=yN.SUSPEND;break;case"pause":t.videoElementStatus=yN.PAUSED,xA()||zA()||DA()&&t.autoplayFailed||!t.videoTrack||"live"!==t.videoTrack.readyState||(Dk.debug("[track-".concat(t.trackId,"] video element paused, auto resume")),t.videoElement.play());break;case"waiting":t.videoElementStatus=yN.WAITING;break;case"abort":t.videoElementStatus=yN.ABORT;break;case"ended":t.videoElementStatus=yN.ENDED;break;case"emptied":t.videoElementStatus=yN.EMPTIED;break;case"error":var n=t.videoElement.error;n&&(t.videoElementStatus=yN.ERROR,Dk.error("[".concat(t.trackId,"] media error: ").concat(n.message," (").concat(n.code,")")));break;case"timeupdate":var r=performance.now();if(t.timeUpdatedCount+=1,t.timeUpdatedCount<10)return void(t.lastTimeUpdatedTime=r);var i=r-t.lastTimeUpdatedTime,a=t.lastTimeUpdatedTime;if(t.lastTimeUpdatedTime=r,CL.lastVisibleTime<CL.lastHiddenTime||a<CL.lastHiddenTime||a<CL.lastVisibleTime)return;for(i>rk("VIDEO_FREEZE_DURATION")&&(t.freezeTime+=i),t.playbackTime+=i;t.playbackTime>=6e3;){t.playbackTime-=6e3;var o=Math.min(6e3,t.freezeTime);t.freezeTimeCounterList.push(o),t.freezeTime=Math.max(0,t.freezeTime-6e3)}}})),kN(this,"autoResumeAfterInterruptionOnIOS15_16",(function(){t.videoTrack&&"live"===t.videoTrack.readyState&&(Dk.debug("[track-".concat(t.trackId,"] video element paused, auto resume for ").concat(OA())),qA()?(t.videoElement.srcObject=null,t.videoElement.srcObject=new MediaStream([t.videoTrack]),t.videoElement.play()):(t.videoElement.pause(),t.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),UN.on(Kk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),UN.on(Kk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}var t=e.prototype;return t.getVideoElement=function(){return this.videoElement},t.getContainerElement=function(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0},t.updateConfig=function(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()},t.updateVideoTrack=function(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())},t.play=function(e){var t=this,n=this.videoElement.play();n&&n.catch&&n.catch((function(n){e&&dD(e,"video",n.message,t.trackId),"NotAllowedError"===n.name?(Dk.warning("detected video element autoplay failed",n),t.autoplayFailed=!0,t.handleAutoPlayFailed()):Dk.warning("[".concat(t.trackId,"] play warning: "),n)}));var r=IA();if(("Safari"===r.name&&15===Number(r.version)||KA())&&n&&n.then){var i=function(){t.config.mirror&&(t.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}},t.getCurrentFrame=function(){var e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");if(!t)return Dk.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);var n=t.getImageData(0,0,e.width,e.height);return e.remove(),n},t.getCurrentFrameToUint8Array=function(){var e=p(l().mark((function e(t){var n,r,i,a=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:1,(r=document.createElement("canvas")).width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight,!(i=r.getContext("2d"))){e.next=8;break}e.t0=(i.drawImage(this.videoElement,0,0,r.width,r.height),new zl((function(e,i){r.toBlob(p(l().mark((function t(n){var a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.remove(),!n){t.next=7;break}return t.next=3,hP(n);case 3:a=t.sent,e({buffer:a,width:r.width,height:r.height}),t.next=8;break;case 7:i(new aw(iw.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return t.stop()}}),t)}))),t,n<0?.1:n>1?1:n)}))),e.next=11;break;case 8:return e.next=10,lP(t);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.destroy=function(){UN.off(Kk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),UN.off(Kk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=IN.VideoStateStopped},t.initVideoElement=function(){var e=this;if(this.videoElementStatus=yN.INIT,!this.videoElementCheckInterval&&(vL.forEach((function(t){e.videoElement.addEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((function(){(function(e){return e!==document.body&&document.body.contains(e)})(e.videoElement)||(e.videoElementStatus=yN.DESTROYED)}),1e3),rk("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n,r,i=function t(){"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",t),e.videoElementFreezeTimeout=window.setTimeout(a,rk("VIDEO_FREEZE_DURATION")))},a=function(){e.videoElementFreezeTimeout=void 0,e.videoState===IN.VideoStateDecoding&&("visible"===document.visibilityState?e.videoState=IN.VideoStateFrozen:document.addEventListener("visibilitychange",i))};null===(t=(n=this.videoElement).requestVideoFrameCallback)||void 0===t||t.call(n,(function t(n,i){if(e.videoElementStatus===yN.PLAYING){if(r){var o=i.presentationTime-r.presentationTime,s=i.presentedFrames-r.presentedFrames;e._render_interframe_delays_sizes.push(s),e._render_interframe_delays.push(o);var c=dO(e._render_interframe_delays_sizes),u=c-e._render_interframe_delays_sizes[0];if(c>30&&u>5&&(e._render_interframe_delays_sizes.shift(),e._render_interframe_delays.shift()),e.videoState===IN.VideoStateStarting&&(e.videoState=IN.VideoStateDecoding),e.videoState===IN.VideoStateDecoding&&e.onVideoStateChanged&&(e.videoElementFreezeTimeout&&window.clearTimeout(e.videoElementFreezeTimeout),e.videoElementFreezeTimeout=window.setTimeout(a,rk("VIDEO_FREEZE_DURATION"))),o<rk("VIDEO_FREEZE_DURATION")&&e.videoState===IN.VideoStateFrozen&&(e.videoState=IN.VideoStateDecoding),o>rk("VIDEO_FREEZE_DURATION")&&CL.lastVisibleTime>=CL.lastHiddenTime&&r.timestamp>CL.lastVisibleTime&&r.timestamp>CL.lastHiddenTime){var d=Math.min(66,gP(e._render_interframe_delays_sizes,e._render_interframe_delays)),p=Math.max(0,o-(s-1)*d);e.renderFreezeAccTime2+=p>d?p:0,e.renderFreezeAccTime+=o}}r=DN(DN({},i),{},{timestamp:n})}var l,h;rk("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(l=(h=e.videoElement).requestVideoFrameCallback)||void 0===l||l.call(h,t))}))}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),$A()&&!rk("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");var o=IA();"Safari"===o.name&&15===Number(o.version)||KA()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,LA()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,LA()&&this.videoElement.load());var s=this.videoElement.play();void 0!==s&&s.catch((function(t){Dk.debug("[".concat(e.trackId,"] playback interrupted"),t.toString())}))},t.resetVideoElement=function(){var e=this;vL.forEach((function(t){e.videoElement&&e.videoElement.removeEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=yN.NONE},t.handleAutoPlayFailed=function(){var e=this,t=function t(n){n.preventDefault(),e.videoElement.play().then((function(){Dk.debug("[".concat(e.trackId,"] Video element for trackId:").concat(e.trackId," autoplay resumed."))})).catch((function(e){Dk.error(e)})),e.autoplayFailed=!1,ew()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};ew()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),uD()},v(e,[{key:"rendFrameRate",get:function(){var e=Math.max(1,gP(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}},{key:"videoElementStatus",get:function(){return this._videoElementStatus},set:function(e){e!==this._videoElementStatus&&(Dk.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}},{key:"videoState",get:function(){return this._videoState},set:function(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}}]),e}(),vL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],EL=function(e){function t(t){var n;return kN(r(n=e.call(this,t)||this),"container",void 0),kN(r(n),"slot",void 0),n.slot=t.element,n.updateConfig(t),n}i(t,e);var n=t.prototype;return n.updateConfig=function(e){this.config=e,this.trackId=e.trackId;var t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()},n.updateVideoTrack=function(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())},n.play=function(t){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&e.prototype.play.call(this,t)},n.getCurrentFrame=function(){var t;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?e.prototype.getCurrentFrame.call(this):new ImageData(2,2)},n.getCurrentFrameToUint8Array=function(){var t=p(l().mark((function t(n){var r,i,a=arguments;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=a.length>1&&void 0!==a[1]?a[1]:1,null===(r=this.container)||void 0===r||!r.contains(this.videoElement)){t.next=7;break}return t.next=4,e.prototype.getCurrentFrameToUint8Array.call(this,n,i);case 4:t.t0=t.sent,t.next=10;break;case 7:return t.next=9,lP(n);case 9:t.t0=t.sent;case 10:return t.abrupt("return",t.t0);case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n.destroy=function(){if(e.prototype.destroy.call(this),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}},n.createElements=function(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",rk("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)},n.mountedVideoElement=function(){var t;!this.container||null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),e.prototype.initVideoElement.call(this),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"},n.unmountedVideoElement=function(){var t;if(null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)){e.prototype.resetVideoElement.call(this);try{this.container&&this.container.removeChild(this.videoElement)}catch(t){}this.videoElement=document.createElement("video")}},n.resetVideoElement=function(){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&(e.prototype.resetVideoElement.call(this),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))},n.getContainerElement=function(){return this.container},t}(_L),mL=(TP=Vk({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),bP=hD(),RP=Vk({argsMap:function(e){return[e.getTrackId()]}}),CP=_O("LocalVideoTrack","_enabledMutex"),yP=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),IP=hD(),AP=_O("LocalVideoTrack","_enabledMutex"),wP=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),OP=hD(),kP=Vk({argsMap:function(e,t){return[e.getTrackId(),t,e._saveEncodeBitrateRatio]}}),NP=hD(),DP=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),PP=hD(),LP=hD(),xP=Vk({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),MP=hD(),UP=hD(),VP=hD(),FP=hD(),BP=hD(),jP=hD(),GP=hD(),WP=Vk({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),HP=Vk({argsMap:function(e){return[e.getTrackId()]}}),KP=Vk({argsMap:function(e){return[e.getTrackId()]}}),YP=Vk({argsMap:function(e,t,n){return[e.getTrackId(),t.label,n]}}),ON((qP=function(e){function t(t,n,i,a,o,s){var c;if(kN(r(c=e.call(this,t,o)||this),"trackMediaType",fN.VIDEO),kN(r(c),"_player",void 0),kN(r(c),"isUseScaleResolutionDownBy",!1),kN(r(c),"_videoVisibleTimer",null),kN(r(c),"_previousVideoVisibleStatus",void 0),kN(r(c),"_clearPreviousVideoVisibleStatus",(function(){return c._previousVideoVisibleStatus=void 0})),kN(r(c),"_encoderConfig",void 0),kN(r(c),"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),kN(r(c),"_optimizationMode",void 0),kN(r(c),"_saveEncodeBitrateRatio",1),kN(r(c),"_videoHeight",void 0),kN(r(c),"_videoWidth",void 0),kN(r(c),"_forceBitrateLimit",void 0),kN(r(c),"_enabled",!0),kN(r(c),"_processorDestination",void 0),kN(r(c),"_processorContext",void 0),DA()){var u=t.getSettings(),d=u.width,p=u.height;c._videoWidth=d,c._videoHeight=p}else c.updateMediaStreamTrackResolution();if(c._scalabilityMode=i,c._optimizationMode=a,c._hints=s||[],n&&-1!==c._hints.indexOf(sN.CUSTOM_TRACK)?c._encoderConfig=Ww(n):c._encoderConfig=n,-1===c._hints.indexOf(sN.SCREEN_TRACK))c.updateBitrateFromProfile();else if(VA(bA.CHROME,115)&&-1!==wA().indexOf("Windows")){var l=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&Gk().supportWebRTCInsertableStream){var n,r,i=new MediaStreamTrackProcessor(e),a=new MediaStreamTrackGenerator({kind:"video"}),o=Date.now(),s=function t(){c&&(clearInterval(c),c=void 0),n&&(n.close(),n=void 0),e.stop(),r=void 0,a.removeEventListener("ended",t)},c=window.setInterval((function(){if(r&&n&&Date.now()-o>1e3)try{"live"===a.readyState?r.enqueue(n.clone()):s()}catch(e){s()}}),1e3),u=new TransformStream({transform:function(e,t){"live"===a.readyState?(r=t,o=Date.now(),void 0===n?(n=e,t.enqueue(e.clone())):(t.enqueue(n),n=e)):e.close()}});return a.addEventListener("ended",s),i.readable.pipeThrough(u).pipeTo(a.writable),a}}(t);l&&(Dk.info("local screen video track begin to inject frame"),c._mediaStreamTrack=l)}return n&&-1!==c._hints.indexOf(sN.CUSTOM_TRACK)&&c.setEncoderConfiguration(n),c._processorContext=new _D(c.getTrackId(),"local"),c._processorDestination=new fD(c.processorContext),c.bindProcessorDestinationEvents(),r(c)}i(t,e);var n=t.prototype;return n.play=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(Dk.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Dk.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=DN(DN(DN({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new _L(i):this._player=new EL(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var e=t.getVideoElementVisibleStatus();t.safeEmit(lN.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),rk("CHECK_VIDEO_VISIBLE_INTERVAL"))},n.stop=function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Dk.debug("[".concat(this.getTrackId(),"] stop video playback")))},n.setEnabled=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Dk.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){e.next=15;break}return this._originMediaStreamTrack.enabled=!1,e.prev=6,e.next=9,Mw(this,oN.NEED_DISABLE_TRACK,this);case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),Dk.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t0.toString()),e.t0;case 14:return e.abrupt("return",(n||(this._enabled=!1),void Dk.info("[".concat(this.getTrackId(),"] setEnabled to false success"))));case 15:return this._originMediaStreamTrack.enabled=!0,e.prev=16,e.next=19,Mw(this,oN.NEED_ENABLE_TRACK,this);case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(16),Dk.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t1.toString()),e.t1;case 24:Dk.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0);case 25:case"end":return e.stop()}}),e,this,[[6,11],[16,21]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setMuted=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,Dk.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,Mw(this,oN.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,Mw(this,oN.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setSaveEncodeBitrateRatio=function(){var e=p(l().mark((function e(){var t,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:this._saveEncodeBitrateRatio,!(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin)){e.next=11;break}return this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),Dk.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1,e.prev=3,e.next=6,Mw(this,oN.NEED_UPDATE_VIDEO_ENCODER,this);case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(3),e.abrupt("return",e.t0.throw(Dk));case 11:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}(),n.setEncoderConfiguration=function(){var e=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new aw(iw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:if(t=$k(t),rk("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),!(t.width||t.height||t.frameRate)){e.next=15;break}return r=TD({encoderConfig:t}),(DA()||xA()||zA())&&(r.deviceId=void 0),Dk.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r)),e.prev=5,e.next=8,this._originMediaStreamTrack.applyConstraints(r);case 8:this.updateMediaStreamTrackResolution(),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),i=new aw(iw.UNEXPECTED_ERROR,e.t0.toString()),Dk.error("[".concat(this.getTrackId(),"] applyConstraints error"),i.toString()),i;case 15:return this._encoderConfig=t,-1===this._hints.indexOf(sN.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=16,e.next=19,Mw(this,oN.NEED_UPDATE_VIDEO_ENCODER,this);case 19:e.next=24;break;case 21:return e.prev=21,e.t1=e.catch(16),e.abrupt("return",e.t1.throw(Dk));case 24:case"end":return e.stop()}}),e,this,[[5,11],[16,21]])})));return function(t,n){return e.apply(this,arguments)}}(),n.getStats=function(){return Yw((function(){Dk.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),Uw(this,oN.GET_STATS)||DN({},EN)},n.setBeautyEffect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Dk.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.getCurrentFrameData=function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)},n.getCurrentFrameImage=function(){var e=p(l().mark((function e(t){var n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:1,!this._player){e.next=5;break}e.t0=this._player.getCurrentFrameToUint8Array(t,n),e.next=8;break;case 5:return e.next=7,lP(t);case 7:e.t0=e.sent;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setBitrateLimit=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Dk.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setOptimizationMode=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("motion"===t||"detail"===t||"balanced"===t){e.next=2;break}return e.abrupt("return",void Dk.error(iw.INVALID_PARAMS,"optimization mode must be motion, detail or balanced"));case 2:return n=this._optimizationMode,e.prev=3,this._optimizationMode=t,e.next=7,Mw(this,oN.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._optimizationMode=n,Dk.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.t0.toString()),e.t0;case 12:Dk.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"));case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),n.setScalabiltyMode=function(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Dk.error(iw.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,Dk.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))},n.updateMediaStreamTrackResolution=function(){var e=this;gD(this._originMediaStreamTrack).then((function(t){var n=t[0],r=t[1];e._videoHeight=r,e._videoWidth=n})).catch(rO)},n._updatePlayerSource=function(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)},n._getDefaultPlayerConfig=function(){return{fit:"contain"}},n.setSenderConfiguration=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new aw(iw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:return Dk.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=$k(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,-1===this._hints.indexOf(sN.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=3,e.next=6,Mw(this,oN.NEED_UPDATE_VIDEO_ENCODER,this);case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(3),e.abrupt("return",e.t0.throw(Dk));case 11:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),n.updateBitrateFromProfile=function(){if(this._encoderConfig){var e=this.getMediaStreamTrackSettings(),t=e.width,n=e.height,r=e.frameRate;if(t&&n&&r){var i=this._encoderConfig,a=i.bitrateMax,o=i.bitrateMin;if(null==o||null==a){var s=function(e,t,n,r,i){var a=rk("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===a)return{min:r,max:i};if(void 0===i){var o=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===a?4*o:2*o,r=null!=r?r:o}else r=null!=r?r:Math.floor(i/10);return{min:r,max:i}}(t,n,r,o,a),c=s.max,u=s.min;if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=c,rk("VIDEO_STANDARD_BITRATE_VERSION")&&null==o&&null==a){var d=function(e,t,n){var r=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),i=e*t,a=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),o=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),s=nh(a).call(a).next().value,c=1;if(a.has(i))s=a.get(i);else{var u,d=Vh(u=Array.from(a.entries())).call(u,(function(e,t){return e[0]-t[0]})),p=d.find((function(e){return e[0]>i}));if(p){var l=d.indexOf(p);if(l>0){var h=d[l-1],f=(i-h[0])/(p[0]-h[0]);s=h[1]+f*(p[1]-h[1])}else s=p[1]}else s=d[d.length-1][1]}if(o.has(i))c=o.get(i);else{var _,v=Vh(_=Array.from(o.entries())).call(_,(function(e,t){return e[0]-t[0]})),E=v.find((function(e){return e[0]>i}));if(E){var m=v.indexOf(E);if(m>0){var S=v[m-1],g=(i-S[0])/(E[0]-S[0]);c=S[1]+g*(E[1]-S[1])}else c=E[1]}else c=v[v.length-1][1]}var T=rk("VIDEO_NEW_BITRATE_RATIO");T&&T>0&&(s=T/100);var b=Math.floor(r*s),R=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69)),C=b,y=rk("VIDEO_STANDARD_BITRATE_VERSION");return y&&y>0&&(1===y?C=r:2===y?C=b:3===y&&(C=R)),[Math.floor(C/1e3),c]}(t,n,r),p=d[0],l=d[1];this._encoderConfig.bitrateMax=p,this._encoderConfig.bitrateMin=u?Math.min(u,p):p,this._saveEncodeBitrateRatio=l,Dk.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else Dk.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(c,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}}},n.getVideoElementVisibleStatus=function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,a=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){var o=vw.checkOneElementVisible(i),s=Object.assign({},o);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=Fk.reportApiInvoke(null,{tag:Cw.TRACER,name:Rw.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(e){throw new aw(iw.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}},n.renewMediaStreamTrack=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.pipe=function(e){if(this.processor===e)return e;if(e._source)throw new aw(iw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e},n.unpipe=function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}},n.close=function(){e.prototype.close.call(this),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()},n.clone=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;e&&(r=DN(DN({},r),$k(e))),r=Hw(r);var i=tO(8,"track-video-cloned-"),a=new t(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Hw(this._scalabilityMode),this._optimizationMode,i,Hw(this._hints));return e&&r&&a.setEncoderConfiguration(r),Dk.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a},n.replaceTrack=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof MediaStreamTrack){e.next=2;break}throw new aw(iw.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");case 2:if("video"===t.kind){e.next=4;break}throw new aw(iw.INVALID_PARAMS,"track should be a video MediaStreamTrack");case 4:return e.next=6,this._updateOriginMediaStreamTrack(t,n,!0);case 6:this.updateMediaStreamTrackResolution();case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.sendSeiData=function(e){if(Yw((function(){Fk.reportApiInvoke(null,{name:Rw.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Cw.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),rk("ENABLE_VIDEO_SEI")&&rk("ENABLE_ENCODED_TRANSFORM")){if(e instanceof Uint8Array==0)return new aw(iw.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();var t=this.getRTCRtpTransceiver();if(t){var n=t.sender.getParameters();if(0!==n.codecs.length){var r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):Dk.warning("SEI is not supported by ".concat(r))}}else Dk.warning("Video track is not published, SEI can not be send")}else Dk.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient')},n.bindProcessorDestinationEvents=function(){var e=this;this.processorDestination.on(TN.ON_TRACK,p(l().mark((function t(n){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}if(t.t0=n!==e._mediaStreamTrack,!t.t0){t.next=7;break}return e._mediaStreamTrack=n,e._updatePlayerSource(),t.next=7,Mw(e,oN.NEED_REPLACE_TRACK,e);case 7:t.next=15;break;case 9:if(t.t1=e._mediaStreamTrack!==e._originMediaStreamTrack,!t.t1){t.next=15;break}return e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource(),t.next=15,Mw(e,oN.NEED_REPLACE_TRACK,e);case 15:case"end":return t.stop()}}),t)}))))},n.unbindProcessorDestinationEvents=function(){this.processorDestination.removeAllListeners(TN.ON_TRACK)},n.unbindProcessorContextEvents=function(){this.processorContext.removeAllListeners(bN.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(bN.REQUEST_CONSTRAINTS)},v(t,[{key:"videoHeight",get:function(){if(DA()){var e=this._mediaStreamTrack.getSettings().height;return this._videoHeight=e,this._videoHeight}return this._videoHeight}},{key:"videoWidth",get:function(){if(DA()){var e=this._mediaStreamTrack.getSettings().width;return this._videoWidth=e,this._videoWidth}return this._videoWidth}},{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==yN.PLAYING)}},{key:"processorDestination",get:function(){return this._processorDestination}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"__className__",get:function(){return"LocalVideoTrack"}}]),t}(LN)).prototype,"play",[TP,bP],Object.getOwnPropertyDescriptor(qP.prototype,"play"),qP.prototype),ON(qP.prototype,"stop",[RP],Object.getOwnPropertyDescriptor(qP.prototype,"stop"),qP.prototype),ON(qP.prototype,"setEnabled",[CP,yP,IP],Object.getOwnPropertyDescriptor(qP.prototype,"setEnabled"),qP.prototype),ON(qP.prototype,"setMuted",[AP,wP,OP],Object.getOwnPropertyDescriptor(qP.prototype,"setMuted"),qP.prototype),ON(qP.prototype,"setSaveEncodeBitrateRatio",[kP,NP],Object.getOwnPropertyDescriptor(qP.prototype,"setSaveEncodeBitrateRatio"),qP.prototype),ON(qP.prototype,"setEncoderConfiguration",[DP,PP],Object.getOwnPropertyDescriptor(qP.prototype,"setEncoderConfiguration"),qP.prototype),ON(qP.prototype,"getStats",[LP],Object.getOwnPropertyDescriptor(qP.prototype,"getStats"),qP.prototype),ON(qP.prototype,"setBeautyEffect",[xP,MP],Object.getOwnPropertyDescriptor(qP.prototype,"setBeautyEffect"),qP.prototype),ON(qP.prototype,"getCurrentFrameData",[UP],Object.getOwnPropertyDescriptor(qP.prototype,"getCurrentFrameData"),qP.prototype),ON(qP.prototype,"getCurrentFrameImage",[VP],Object.getOwnPropertyDescriptor(qP.prototype,"getCurrentFrameImage"),qP.prototype),ON(qP.prototype,"setBitrateLimit",[FP],Object.getOwnPropertyDescriptor(qP.prototype,"setBitrateLimit"),qP.prototype),ON(qP.prototype,"setOptimizationMode",[BP],Object.getOwnPropertyDescriptor(qP.prototype,"setOptimizationMode"),qP.prototype),ON(qP.prototype,"setScalabiltyMode",[jP],Object.getOwnPropertyDescriptor(qP.prototype,"setScalabiltyMode"),qP.prototype),ON(qP.prototype,"updateMediaStreamTrackResolution",[GP],Object.getOwnPropertyDescriptor(qP.prototype,"updateMediaStreamTrackResolution"),qP.prototype),ON(qP.prototype,"pipe",[WP],Object.getOwnPropertyDescriptor(qP.prototype,"pipe"),qP.prototype),ON(qP.prototype,"unpipe",[HP],Object.getOwnPropertyDescriptor(qP.prototype,"unpipe"),qP.prototype),ON(qP.prototype,"close",[KP],Object.getOwnPropertyDescriptor(qP.prototype,"close"),qP.prototype),ON(qP.prototype,"replaceTrack",[YP],Object.getOwnPropertyDescriptor(qP.prototype,"replaceTrack"),qP.prototype),qP),SL=(zP=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),XP=hD(),JP=_O("CameraVideoTrack","_enabledMutex"),QP=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),ZP=hD(),$P=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),eL=hD(),tL=Vk({argsMap:function(e){return[e.getTrackId()]}}),ON((nL=function(e){function t(t,n,i,a,o,s){var c;return kN(r(c=e.call(this,t,$k(n.encoderConfig),a,o,s)||this),"_config",void 0),kN(r(c),"_originalConstraints",void 0),kN(r(c),"_constraints",void 0),kN(r(c),"_enabled",!0),kN(r(c),"_deviceName","default"),kN(r(c),"tryResumeVideoForIOS15_16WeChat",p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(KA()||YA())&&!function(){var e=IA();if(e.os!==TA.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&XA()&&c._enabled&&!c._isClosed,!e.t0){e.next=5;break}return Dk.debug("[".concat(c.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),e.next=5,c.renewMediaStreamTrack();case 5:case"end":return e.stop()}}),e)})))),c._config=n,c._originalConstraints=i,c._constraints=i,c._deviceName=t.label,c._encoderConfig=$k(c._config.encoderConfig),UN.on(Kk.IOS_15_16_INTERRUPTION_END,c.tryResumeVideoForIOS15_16WeChat),UN.on(Kk.IOS_INTERRUPTION_END,c.tryResumeVideoForIOS15_16WeChat),c.bindProcessorContextEvents(),c}i(t,e);var n=t.prototype;return n.setDevice=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","string"==typeof t?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n._setDeviceById=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),!this._enabled){e.next=36;break}return e.prev=1,e.next=4,oD.getDeviceById(t);case 4:return n=e.sent,(r={}).video=DN({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,eD(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),Dk.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,eD({video:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 25:this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(1),Dk.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 34:e.next=46;break;case 36:return e.prev=36,e.next=39,oD.getDeviceById(t);case 39:a=e.sent,this._deviceName=a.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=46;break;case 43:throw e.prev=43,e.t2=e.catch(36),Dk.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 46:Dk.info("[".concat(this.getTrackId(),"] setDevice success"));case 47:case"end":return e.stop()}}),e,this,[[1,31],[8,14],[36,43]])})));return function(t){return e.apply(this,arguments)}}(),n._setDeviceByFacingModel=function(){var e=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t)),n={video:DN(DN({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})},!this._enabled){e.next=23;break}return this._originMediaStreamTrack.stop(),r=null,e.prev=5,e.next=8,eD(n,this.getTrackId());case 8:r=e.sent,e.next=20;break;case 11:return e.prev=11,e.t0=e.catch(5),Dk.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),e.t0.toString()),e.next=16,eD({video:this._constraints},this.getTrackId());case 16:return r=e.sent,e.next=19,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 19:throw e.t0;case 20:return e.next=22,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 22:this.updateMediaStreamTrackResolution();case 23:this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=DN({},n.video),Dk.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"));case 24:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),n.setEnabled=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(Dk.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=25;break}if(e.prev=5,!this.isExternalTrack){e.next=10;break}this._originMediaStreamTrack.enabled=!0,e.next=15;break;case 10:return e.next=12,eD({video:this._constraints},this.getTrackId());case 12:return r=e.sent,e.next=15,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 15:return e.next=17,Mw(this,oN.NEED_ENABLE_TRACK,this);case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(5),Dk.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.t0.toString()),e.t0;case 22:this.updateMediaStreamTrackResolution(),Dk.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0),e.next=35;break;case 25:return this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1),e.prev=26,e.next=29,Mw(this,oN.NEED_DISABLE_TRACK,this);case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),Dk.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 34:Dk.info("[".concat(this.getTrackId(),"] setEnabled to false success"));case 35:case"end":return e.stop()}}),e,this,[[5,19],[26,31]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setEncoderConfiguration=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new aw(iw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:return t=$k(t),rk("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin),(r=Ww(this._config)).encoderConfig=t,i=TD(r),(DA()||xA()||zA())&&(i.deviceId=void 0),Dk.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i)),e.prev=7,e.next=10,this._originMediaStreamTrack.applyConstraints(i);case 10:this.updateMediaStreamTrackResolution(),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),a=new aw(iw.UNEXPECTED_ERROR,e.t0.toString()),Dk.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a;case 17:return this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,-1===this._hints.indexOf(sN.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=18,e.next=21,Mw(this,oN.NEED_UPDATE_VIDEO_ENCODER,this);case 21:e.next=26;break;case 23:return e.prev=23,e.t1=e.catch(18),e.abrupt("return",e.t1.throw(Dk));case 26:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])})));return function(t,n){return e.apply(this,arguments)}}(),n._getDefaultPlayerConfig=function(){return{mirror:!0,fit:"cover"}},n.onTrackEnded=function(){var e=this;if((xA()||zA())&&this._enabled&&!this._isClosed&&UN.duringInterruption){var t=function(){var n=p(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(UN.off(Kk.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return Dk.debug("[".concat(e.getTrackId(),"] try capture camera media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();UN.on(Kk.IOS_INTERRUPTION_END,t)}else Dk.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lN.TRACK_ENDED)},n.renewMediaStreamTrack=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=oD.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId={exact:r}),!this._enabled){e.next=9;break}return e.next=4,eD({video:n},this.getTrackId());case 4:return i=e.sent,this._constraints=n,e.next=8,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0);case 8:this.updateMediaStreamTrackResolution();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.close=function(){e.prototype.close.call(this),UN.off(Kk.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),UN.off(Kk.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)},n.clone=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;e&&(r=DN(DN({},r),$k(e))),r=Hw(r);var i=tO(8,"track-cam-cloned-"),a=new t(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Hw(DN(DN({},this._config),{},{encoderConfig:r})),Hw(this._constraints),Hw(this._scalabilityMode),this._optimizationMode,i);return e&&r&&a.setEncoderConfiguration(r),Dk.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a},n.bindProcessorContextEvents=function(){var e=this;this.processorContext.on(bN.REQUEST_UPDATE_CONSTRAINTS,p(l().mark((function t(n,r,i){var a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=Object.assign.apply(Object,[{},e._originalConstraints].concat(n)),t.next=4,e.renewMediaStreamTrack(a);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),this.processorContext.on(bN.REQUEST_CONSTRAINTS,p(l().mark((function t(n){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e._originMediaStreamTrack.getSettings());case 1:case"end":return t.stop()}}),t)}))))},v(t,[{key:"__className__",get:function(){return"CameraVideoTrack"}}]),t}(mL)).prototype,"setDevice",[zP,XP],Object.getOwnPropertyDescriptor(nL.prototype,"setDevice"),nL.prototype),ON(nL.prototype,"setEnabled",[JP,QP,ZP],Object.getOwnPropertyDescriptor(nL.prototype,"setEnabled"),nL.prototype),ON(nL.prototype,"setEncoderConfiguration",[$P,eL],Object.getOwnPropertyDescriptor(nL.prototype,"setEncoderConfiguration"),nL.prototype),ON(nL.prototype,"close",[tL],Object.getOwnPropertyDescriptor(nL.prototype,"close"),nL.prototype),nL);function gL(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=DN(DN({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Dk.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Dk.debug("[".concat(e,"] set content hint failed")))):Dk.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var TL=function(e){i(n,e);var t=n.prototype;function n(t,n,i,a){var o;return kN(r(o=e.call(this,t,"track-".concat(t.kind,"-").concat(n,"-").concat(a.clientId,"_").concat(tO(5,"")))||this),"_userId",void 0),kN(r(o),"_uintId",void 0),kN(r(o),"_isDestroyed",!1),kN(r(o),"store",void 0),kN(r(o),"processor",void 0),kN(r(o),"processorContext",void 0),o._userId=n,o._uintId=i,o.store=a,o}return t.getUserId=function(){return this._userId},t._updateOriginMediaStreamTrack=function(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})},t._destroy=function(){this._isDestroyed=!0,Dk.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),e.prototype.close.call(this)},t.getProcessorStats=function(){return this.processorContext.gatherStats()},t.getProcessorUsage=function(){return this.processorContext.gatherUsage()},n}(PN),bL=(rL=Vk({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),iL=Vk({argsMap:function(e){return[e.getTrackId()]}}),aL=Vk({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),oL=Vk({argsMap:function(e){return[e.getTrackId()]}}),ON((sL=function(e){function t(t,n,i,a){var o;return kN(r(o=e.call(this,t,n,i,a)||this),"_videoVisibleTimer",null),kN(r(o),"_previousVideoVisibleStatus",void 0),kN(r(o),"_clearPreviousVideoVisibleStatus",(function(){return o._previousVideoVisibleStatus=void 0})),kN(r(o),"trackMediaType",fN.VIDEO),kN(r(o),"_videoWidth",void 0),kN(r(o),"_videoHeight",void 0),kN(r(o),"_player",void 0),kN(r(o),"processorDestination",void 0),kN(r(o),"processorContext",void 0),o.updateMediaStreamTrackResolution(),o.processorContext=new _D(o.getTrackId(),"remote"),o.processorDestination=new fD(o.processorContext),o.bindProcessorDestinationEvents(),o}i(t,e);var n=t.prototype;return n.getStats=function(){return Yw((function(){Dk.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),Uw(this,oN.GET_STATS)||DN({},gN)},n.play=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(Dk.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Dk.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=DN(DN({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new _L(i):this._player=new EL(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=function(){t.store.subscribe(t.getUserId(),"video",void 0,void 0,Date.now()),t.safeEmit(hN.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=function(e){t.safeEmit(hN.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var e=t.getVideoElementVisibleStatus();t.safeEmit(hN.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),rk("CHECK_VIDEO_VISIBLE_INTERVAL"))},n.stop=function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Dk.debug("[".concat(this.getTrackId(),"] stop video playback")))},n.getCurrentFrameData=function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)},n.updateMediaStreamTrackResolution=function(){var e=this;gD(this._originMediaStreamTrack).then((function(t){var n=t[0],r=t[1];e._videoHeight=r,e._videoWidth=n})).catch(rO)},n._updatePlayerSource=function(){Dk.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)},n.getVideoElementVisibleStatus=function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,a=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){var o=vw.checkOneElementVisible(i),s=Object.assign({},o);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=Fk.reportApiInvoke(null,{tag:Cw.TRACER,name:Rw.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(e){throw new aw(iw.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}},n.pipe=function(e){if(this.processor===e)return e;if(e._source)throw new aw(iw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e},n.unpipe=function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}},n.bindProcessorDestinationEvents=function(){var e=this;this.processorDestination.on(TN.ON_TRACK,p(l().mark((function t(n){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource()):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)}))))},n.unbindProcessorDestinationEvents=function(){this.processorDestination.removeAllListeners(TN.ON_TRACK)},n._destroy=function(){e.prototype._destroy.call(this),this.unbindProcessorDestinationEvents()},n._onSei=function(e){this.emit(pN.SEI_RECEIVED,e)},v(t,[{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==yN.PLAYING)}},{key:"__className__",get:function(){return"RemoteVideoTrack"}}]),t}(TL)).prototype,"play",[rL],Object.getOwnPropertyDescriptor(sL.prototype,"play"),sL.prototype),ON(sL.prototype,"stop",[iL],Object.getOwnPropertyDescriptor(sL.prototype,"stop"),sL.prototype),ON(sL.prototype,"pipe",[aL],Object.getOwnPropertyDescriptor(sL.prototype,"pipe"),sL.prototype),ON(sL.prototype,"unpipe",[oL],Object.getOwnPropertyDescriptor(sL.prototype,"unpipe"),sL.prototype),sL),RL=(cL=Vk({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),uL=Vk({argsMap:function(e,t){return[e.getTrackId(),t]}}),dL=Vk({argsMap:function(e){return[e.getTrackId()]}}),pL=Vk({argsMap:function(e){return[e.getTrackId()]}}),lL=Vk({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),hL=Vk({argsMap:function(e){return[e.getTrackId()]}}),ON((fL=function(e){function t(t,n,i,a){var o;return kN(r(o=e.call(this,t,n,i,a)||this),"trackMediaType",fN.AUDIO),kN(r(o),"_source",void 0),kN(r(o),"_useAudioElement",!0),kN(r(o),"_volume",100),kN(r(o),"processorContext",void 0),kN(r(o),"processorDestination",void 0),kN(r(o),"_played",!1),kN(r(o),"_bypassWebAudio",!1),rk("DISABLE_WEBAUDIO")?(o._source=new mD,o._bypassWebAudio=!0,o._useAudioElement=!0):(o._source=new HN(t,!0),rk("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(o._useAudioElement=!1)),o._source.once(_N.RECEIVE_TRACK_BUFFER,(function(){o.safeEmit(hN.FIRST_FRAME_DECODED)})),o.processorContext=new ED(o._source.context,o.getTrackId(),"remote"),o.processorDestination=new vD(o.processorContext),o.bindProcessorDestinationEvents(),o._source.on(_N.UPDATE_SOURCE,(function(){o.processor&&o.processor.updateInput({node:o._source.processSourceNode,context:o.processorContext})})),o}i(t,e);var n=t.prototype;return n.setAudioFrameCallback=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(_N.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(_N.ON_AUDIO_BUFFER),this._source.on(_N.ON_AUDIO_BUFFER,(function(t){return e(t)}))},n.setVolume=function(e){this._volume=e,this._useAudioElement?lD.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)},n.setPlaybackDevice=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement&&Wk()){e.next=2;break}throw new aw(iw.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,lD.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getVolumeLevel=function(){return this._source.getAccurateVolumeLevel()},n.getStats=function(){return Yw((function(){Dk.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),Uw(this,oN.GET_STATS)||DN({},mN)},n.play=function(){Dk.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Dk.debug("[".concat(this.getTrackId(),"] use audio element to play")),lD.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()},n.stop=function(){Dk.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?lD.stop(this.getTrackId()):this._source.stop()},n._destroy=function(){e.prototype._destroy.call(this),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()},n._isFreeze=function(){return this._source.isFreeze},n._updatePlayerSource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Dk.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&lD.updateTrack(this.getTrackId(),this._mediaStreamTrack)},n.pipe=function(e){if(this._bypassWebAudio)throw new aw(iw.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new aw(iw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e},n.unpipe=function(){var e;if(this._bypassWebAudio)throw new aw(iw.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}},n.bindProcessorDestinationEvents=function(){var e=this;this.processorDestination.on(TN.ON_TRACK,p(l().mark((function t(n){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n)):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)})))),this.processorDestination.on(TN.ON_NODE,(function(t){e._source.processedNode=t;var n=!t;e._useAudioElement!==n&&(e._played?(e.stop(),e._useAudioElement=n,e.play()):e._useAudioElement=n)}))},n.unbindProcessorDestinationEvents=function(){this.processorDestination.removeAllListeners(TN.ON_TRACK),this.processorDestination.removeAllListeners(TN.ON_NODE)},v(t,[{key:"isPlaying",get:function(){return this._useAudioElement?lD.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"RemoteAudioTrack"}}]),t}(TL)).prototype,"setVolume",[cL],Object.getOwnPropertyDescriptor(fL.prototype,"setVolume"),fL.prototype),ON(fL.prototype,"setPlaybackDevice",[uL],Object.getOwnPropertyDescriptor(fL.prototype,"setPlaybackDevice"),fL.prototype),ON(fL.prototype,"play",[dL],Object.getOwnPropertyDescriptor(fL.prototype,"play"),fL.prototype),ON(fL.prototype,"stop",[pL],Object.getOwnPropertyDescriptor(fL.prototype,"stop"),fL.prototype),ON(fL.prototype,"pipe",[lL],Object.getOwnPropertyDescriptor(fL.prototype,"pipe"),fL.prototype),ON(fL.prototype,"unpipe",[hL],Object.getOwnPropertyDescriptor(fL.prototype,"unpipe"),fL.prototype),fL),CL=new(function(e){function t(){var t;return kN(r(t=e.call(this)||this),"_lastHiddenTime",0),kN(r(t),"_lastVisibleTime",0),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?t._lastHiddenTime=performance.now():t._lastVisibleTime=performance.now(),Dk.debug("current web page is ".concat(document.visibilityState)),t.emit("VISIBILITY_CHANGE",document.visibilityState)})),t}return i(t,e),v(t,[{key:"visibility",get:function(){return document.visibilityState}},{key:"lastHiddenTime",get:function(){return this._lastHiddenTime}},{key:"lastVisibleTime",get:function(){return this._lastVisibleTime}}]),t}(gw)),yL=function(e){function t(t,n){var i;return kN(r(i=e.call(this)||this),"trackMediaType",fN.DATA),kN(r(i),"_version",1),kN(r(i),"_type",3),kN(r(i),"_config",void 0),kN(r(i),"_originDataChannel",void 0),kN(r(i),"_dataStreamPacketHeader",new ArrayBuffer(4)),kN(r(i),"_dataStreamPacketHandler",{serialize:function(e){return e},deserialize:function(e){return e}}),kN(r(i),"_datachannelEventMap",new Map),i._config=t,n&&(i._originDataChannel=n,i._bandDataChannelEvents(n)),i._initPacketHeader(),i}i(t,e);var n=t.prototype;return n.useDataStream=function(e){this._dataStreamPacketHandler=e},n.getChannelId=function(){return this.id},n.getConfig=function(){return this._config},n._close=function(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)},n._waitTillOpen=function(){var e=p(l().mark((function e(){var t=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new zl((function(e,n){if(t._originDataChannel){"open"===t._originDataChannel.readyState&&e();var r=setTimeout((function(){var e;n(new aw(iw.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=t._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);t._originDataChannel.onopen=function(){clearTimeout(r),t._originDataChannel&&t._bandDataChannelEvents(t._originDataChannel),e()},t._originDataChannel.onerror=function(){throw clearTimeout(r),new aw(iw.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new aw(iw.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n._updateOriginDataChannel=function(e){this._originDataChannel=e,this._bandDataChannelEvents(e)},n._initPacketHeader=function(){var e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)},n._bandDataChannelEvents=function(e){var t=this;this._unbindDataChannelEvents(e),[wN.OPEN,wN.CLOSE,wN.ERROR].forEach((function(n){var r=function(){t.emit(n)};t._datachannelEventMap.set(n,r),e.addEventListener(n,r)}))},n._unbindDataChannelEvents=function(e){Array.from(this._datachannelEventMap.entries()).forEach((function(t){var n=t[0],r=t[1];e.removeEventListener(n,r)})),this._datachannelEventMap.clear()},v(t,[{key:"id",get:function(){return this._config.id}},{key:"ordered",get:function(){return this._config.ordered}},{key:"maxRetransmits",get:function(){return rk("DATASTREAM_MAX_RETRANSMITS")}},{key:"metadata",get:function(){return this._config.metadata}},{key:"readyState",get:function(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}},{key:"_originDataChannelId",get:function(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}}]),t}(gw),IL=function(e){function t(t){var n;return kN(r(n=e.call(this,t)||this),"_messageListener",void 0),n._messageListener=function(e){if(e.data.byteLength<n._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+n._dataStreamPacketHeader.byteLength);var t=e.data.slice(0,n._dataStreamPacketHeader.byteLength),r=new DataView(t).getUint8(3);if(r===n.id){var i=e.data.slice(n._dataStreamPacketHeader.byteLength);i=n._dataStreamPacketHandler.deserialize(i),n.emit(wN.MESSAGE,i)}else rk("SHOW_DATASTREAM2_LOG")&&Dk.debug("invalid datachannel id: ".concat(r," !== ").concat(n.id))},n}i(t,e);var n=t.prototype;return n._updateOriginDataChannel=function(t){e.prototype._updateOriginDataChannel.call(this,t),this._bandRemoteDataChannelEvents()},n._close=function(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),e.prototype._close.call(this))},n._bandRemoteDataChannelEvents=function(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)},t}(yL),AL=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype.send=function(e){if(this._originDataChannel){var t;t=this._dataStreamPacketHandler.serialize(e);var n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}},t}(yL);function wL(){var e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout((function(){return cm.revokeObjectURL(e)}),0),new Worker(cm.createObjectURL(e))}var OL=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(OL||{});function kL(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getUint8(0);if(71===n){var r=e.getUint16(1),i=3+r,a=new Uint8Array(e.byteLength-i);a.set(new Uint8Array(e.buffer,i,e.byteLength-i));for(var o={m:n,tlvLen:r,tlv:[],frame:a},s=3;s<i;){var c=e.getUint8(s),u=e.getUint16(s+1),d=3;if(c===OL.AUDIO_LEVEL){for(var p=e.getUint8(s+d),l=1;l<u;l++)p=p<<8|e.getUint8(s+d+l);o.tlv.push({tag:c,length:u,value:t?127^p>>1:127&p})}else if(c===OL.METADATA||c===OL.AUDIO_64_BIT_PTS){for(var h=new Uint8Array(u),f=0;f<u;f++)h[f]=e.getUint8(s+d+f);o.tlv.push({tag:c,length:u,value:h})}s+=d+u}return o}}var NL=new Map,DL=127,PL=1e-10,LL=139/13,xL=new Map;function ML(e,t,n){var r="".concat(e,"-").concat(t,"-").concat(n),i=0;return xL.has(r)?i=xL.get(r):(i=Math.log(function(e,t){var n=e-t;t<n&&(t=n);for(var r=1,i=e,a=1;i>t;i--,a++)r=r*i/a;return r}(t,e))+e*Math.log(.5)+(t-e)*Math.log(.5)-Math.log(n)+n*e,xL.set(r,i)),i<PL&&(i=PL),i}function UL(e,t,n){for(var r=t.length,i=e.length/r,a=!1,o=0,s=0;o<r;o++){for(var c=0,u=s+i;s<u;s++)e[s]>n&&c++;t[o]!==c&&(t[o]=c,a=!0)}return a}window.cache=xL;var VL,FL=0,BL=function(){function e(e){kN(this,"id",void 0),kN(this,"immediates",[]),kN(this,"lastNonSilence",-1),kN(this,"immediateSpeechActivityScore",PL),kN(this,"lastLevelChangedTime",Date.now()),kN(this,"levels",[]),kN(this,"longs",[]),kN(this,"longSpeechActivityScore",PL),kN(this,"mediums",[]),kN(this,"mediumSpeechActivityScore",PL),kN(this,"minLevel",0),kN(this,"nextMinLevel",0),kN(this,"nextMinLevelWindowLength",0),kN(this,"energyScore",0),this.id=e||"".concat(FL++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}var t=e.prototype;return t.computeImmediates=function(){for(var e=this.immediates,t=this.levels,n=this.minLevel+LL,r=!1,i=0;i<e.length;++i){var a=t[i];a<n&&(a=0);var o=Math.floor(a/LL);e[i]!==o&&(e[i]=o,r=!0)}return r},t.computeLongs=function(){return UL(this.mediums,this.longs,4)},t.computeMediums=function(){return UL(this.immediates,this.mediums,7)},t.evaluateImmediateSpeechActivityScore=function(){this.immediateSpeechActivityScore=ML(this.immediates[0],13,.78)},t.evaluateLongSpeechActivityScore=function(e){this.longSpeechActivityScore=ML(this.longs[0],10,47),this.longSpeechActivityScore>PL&&(this.lastNonSilence=e)},t.evaluateMediumSpeechActivityScore=function(){this.mediumSpeechActivityScore=ML(this.mediums[0],5,24)},t.evaluateSpeechActivityScores=function(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))},t.getLastLevelChangedTime=function(){return this.lastLevelChangedTime},t.getLevels=function(){var e;return"[".concat(Ti(e=[].concat(this.levels)).call(e).join(),"]")},t.getSpeechActivityScore=function(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}},t.levelChanged=function(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;var n=e;return e<0&&(n=0),e>DL&&(n=DL),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+LL?n:n/2}return-1},t.levelTimedOut=function(){this.levelChanged(0,this.lastLevelChangedTime)},t.updateMinLevel=function(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){var t=Math.sqrt(this.minLevel*this.nextMinLevel);t<0?t=0:t>DL&&(t=DL),this.minLevel=t,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}},e}(),jL=function(){function e(e){kN(this,"algorithm",void 0),this.algorithm=e}return e.prototype.execute=function(){var e=!this.algorithm;if(!e)try{var t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)},e}(),GL=function(e,t,n){kN(this,"isDominant",void 0),kN(this,"energyRanking",void 0),kN(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n},WL=function(e){function t(t){var n;return kN(r(n=e.call(this)||this),"dominantId",null),kN(r(n),"lastDecisionTime",0),kN(r(n),"lastLevelChangedTime",0),kN(r(n),"lastLevelIdleTime",0),kN(r(n),"relativeSpeechActivities",[]),kN(r(n),"speakers",new Map),kN(r(n),"enableSilence",!1),kN(r(n),"timeoutToSilenceInterval",0),kN(r(n),"decisionMaker",null),kN(r(n),"loudest",[]),kN(r(n),"numLoudestToTrack",3),kN(r(n),"energyExpireTimeMs",250),kN(r(n),"energyAlphaPct",50),n.timeoutToSilenceInterval=t,n.enableSilence=t>0,n.relativeSpeechActivities.length=3,n}i(t,e);var n=t.prototype;return n.setLoudestConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)},n.getDominantSpeaker=function(){return this.dominantId},n.isAmongLoudest=function(e){return this.loudest.some((function(t){return t.id===e}))},n.levelChanged=function(e,t){var n=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());var i=r.levelChanged(t,n);return this.updateLoudestList(r,i,n)},n.runInDecisionMaker=function(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()},n.decisionMakerExited=function(e){this.decisionMaker===e&&(this.decisionMaker=null)},n.destroy=function(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()},n.addSpeakers=function(e){var t=this;e.forEach((function(e){t.speakers.has(e.id)||t.speakers.set(e.id,e)}))},n.removeSpeakers=function(e){var t=this;e.forEach((function(e){t.speakers.delete(e.id)}))},n.getOrCreateSpeaker=function(e){var t=this.speakers.get(e);return t||(t=new BL(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t},n.updateLoudestList=function(e,t,n){var r=e.id===this.dominantId;if(t<0){for(var i=0;i<this.loudest.length&&this.loudest[i]!==e;)++i;return new GL(r,i,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new GL(r,0,e.energyScore);for(var a=n-this.energyExpireTimeMs,o=0;o<this.loudest.length;){var s=this.loudest[o];if(s.getLastLevelChangedTime()<a&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(s.id!==e.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}for(var c=0;c<this.loudest.length&&!(this.loudest[c].energyScore<e.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new GL(r,c,e.energyScore)},n.maybeStartDecisionMaker=function(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new jL(this),this.decisionMaker.execute())},n.makeDecision=function(e){var t=null,n=null,r=this.speakers.size,i=null;if(0===r)i=null;else if(1===r){var a,o=nh(a=this.speakers).call(a).next().value;this.enableSilence&&o&&(i=o.id,o.evaluateSpeechActivityScores(e),e-o.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{var s=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==s){var c=this.speakers.entries().next();c.value&&(i=c.value[0],s=c.value[1])}else i=s.id;null!=s&&s.evaluateSpeechActivityScores(e);for(var u,d=this.relativeSpeechActivities,p=2,l=h(this.speakers.entries());!(u=l()).done;){var f=u.value,_=f[0],v=f[1];if(v!==s){v.evaluateSpeechActivityScores(e);for(var E=0;E<d.length;++E){var m=null==s?PL:s.getSpeechActivityScore(E);d[E]=Math.log(v.getSpeechActivityScore(E)/m)}var S=d[0],g=d[1],T=d[2];S>3&&g>2&&T>0&&g>p&&(p=g,i=_)}}this.enableSilence&&null!=s&&i===s.id&&e-s.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)},n._runInDecisionMaker=function(){var e=Date.now(),t=300-(e-this.lastLevelIdleTime),n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;var r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&n>r&&(n=r),n},n.timeoutIdleLevels=function(e){for(var t,n=this,r=[],i=h(nh(a=this.speakers).call(a));!(t=i()).done;){var a,o=t.value,s=e-o.getLastLevelChangedTime();36e5<s&&(null==this.dominantId||o.id!==this.dominantId)?r.push(o.id):300<s&&o.levelTimedOut()}r.forEach((function(e){return n.speakers.delete(e)}))},t}(gw),HL=new Map,KL=null,YL=null,qL=[],zL=new Map,XL=new Map,JL=function(){function e(e,t){kN(this,"id",void 0),kN(this,"track",void 0),kN(this,"score",0),kN(this,"active",!0),kN(this,"muted",!1),kN(this,"timer",0),kN(this,"actives",0),kN(this,"inactives",0),this.id=e,this.track=t,this.setActive(zL.size<3)}var t=e.prototype;return t.autoCheckActive=function(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0},t.autoSetActive=function(){var e=this,t=this.active;this.active=this.activeRate>=.8;var n,r,i=function(){var e=[],t=[];return Array.from(nh(zL).call(zL)).forEach((function(n){n.active?e.push(n):t.push(n)})),{actives:e,inactives:t}}(),a=i.actives,o=i.inactives;a.length>3&&(a.forEach((function(e){(!n||n.score>e.score)&&(n=e)})),n&&n.setActive(!1)),a.length<3&&o.length>0&&(o.forEach((function(t){(!r||r.score<t.score)&&t.id!==e.id&&(r=t)})),r&&t&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)),this.setMuted(!this.active)},t.setActive=function(e){this.active=e,this.resetTimer(),this.setMuted(!e)},t.autoAdjustActive=function(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()},t.autoSwitchToActive=function(){var e=function(e){var t;return Array.from(nh(zL).call(zL)).forEach((function(n){!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)})),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))},t.autoSwitchToInactive=function(){var e=function(e){var t;return Array.from(nh(zL).call(zL)).forEach((function(n){n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)})),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))},t.addSample=function(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()},t.setMuted=function(e){this.track&&(this.track.enabled=!e,this.muted=e)},t.resetTimer=function(){var e=this;this.clearTimer(),this.timer=window.setTimeout((function(){if(0!==e.samples)return e.samples<50?e.resetTimer():void e.autoCheckActive()}),1e3)},t.clearTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},v(e,[{key:"samples",get:function(){return this.actives+this.inactives}},{key:"activeRate",get:function(){return this.actives/this.samples}}]),e}();function QL(e){var t=zL.get(e);t&&(zL.delete(e),t.clearTimer())}var ZL=new Map,$L=new Map;function ex(e,t,n){for(var r=new Uint8Array(e,t,n),i=[],a=0;i.length<n;)a+3<n&&0===r[a]&&0===r[a+1]&&3===r[a+2]&&(0===r[a+3]||1===r[a+3]||2===r[a+3]||3===r[a+3])?(i.push(r[a],r[a+1],r[a+3]),a+=4):(i.push(r[a]),a++);return new Uint8Array(i)}var tx=new Map,nx=new Map;!function(){var e=IA();jk.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),jk.getStreamFromExtension=e.name===bA.CHROME&&Number(e.version)>34,jk.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),jk.supportMinBitrate=e.name===bA.CHROME||e.name===bA.EDGE,jk.supportSetRtpSenderParameters=function(){var e=IA();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ZA()||!(!DA()&&!kA())||e.name===bA.FIREFOX&&Number(e.version)>=64)}(),e.name===bA.SAFARI&&(Number(e.version)>=14?jk.supportDualStream=!0:jk.supportDualStream=!1),jk.webAudioMediaStreamDest=function(){var e=IA();return!(e.name===bA.SAFARI&&Number(e.version)<12)}(),jk.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,jk.supportWebGL="undefined"!=typeof WebGLRenderingContext,jk.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ZA()||(jk.webAudioWithAEC=!0),jk.supportShareAudio=function(){var e=IA();return(e.os===TA.WIN_10||e.os===TA.WIN_81||e.os===TA.WIN_7||e.os===TA.LINUX||e.os===TA.MAC_OS||e.os===TA.CHROMIUM_OS)&&e.name===bA.CHROME&&Number(e.version)>=74}(),jk.supportDataChannel=!!(MA(76)||function(e){var t=IA();return!(t.name!==bA.FIREFOX||!t.osVersion)&&Number(t.version)>=68}()||BA(14)),jk.supportPCSetConfiguration=function(){var e=window.RTCPeerConnection;return!LA()&&!!e&&e.prototype.setConfiguration instanceof Function}(),jk.supportWebRTCEncodedTransform=function(){var e=IA();return"Chrome"===e.name&&Number(e.version)>=87||"Safari"===e.name&&Number(e.version)>=15}(),jk.supportWebRTCInsertableStream=function(){var e=IA();return(e.name===bA.CHROME||e.name===bA.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),jk.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,jk.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,Gw((function(){jk.supportDualStreamEncoding=function(){var e=IA();return!!rk("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&rk("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Dk.debug("browser ua: ",navigator.userAgent),Dk.info("browser info: ",e),Dk.info("browser compatibility: ",jk)}))}();var rx=["CHINA","GLOBAL"],ix=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ax=[],ox=[];function sx(e,t){return!!t&&ax.some((function(n){return n.uid===e&&n.channelName===t}))}function cx(){return ox.length>0}var ux=lb.forEach,dx=Jr("forEach")?[].forEach:function(e){return ux(this,e,arguments.length>1?arguments[1]:void 0)};Bn({target:"Array",proto:!0,forced:[].forEach!==dx},{forEach:dx});var px=cr("Array","forEach"),lx=Cr,hx=dt,fx=b,_x=px,vx=Array.prototype,Ex={DOMTokenList:!0,NodeList:!0},mx=d((function(e){var t=e.forEach;return e===vx||fx(vx,e)&&t===vx.forEach||hx(Ex,lx(e))?_x:t})),Sx=st,gx=fa;Bn({target:"Object",stat:!0,forced:f((function(){gx(1)}))},{keys:function(e){return gx(Sx(e))}});var Tx=d(pe.Object.keys),bx=d(ci),Rx=d(gi),Cx=Bn,yx=pi,Ix=Jc,Ax=de,wx=zn,Ox=$n,kx=ce,Nx=x_,Dx=Ct,Px=iu,Lx=IT("slice"),xx=Dx("species"),Mx=Array,Ux=Math.max;Cx({target:"Array",proto:!0,forced:!Lx},{slice:function(e,t){var n,r,i,a=kx(this),o=Ox(a),s=wx(e,o),c=wx(void 0===t?o:t,o);if(yx(a)&&(n=a.constructor,(Ix(n)&&(n===Mx||yx(n.prototype))||Ax(n)&&null===(n=n[xx]))&&(n=void 0),n===Mx||void 0===n))return Px(a,s,c);for(r=new(void 0===n?Mx:n)(Ux(c-s,0)),i=0;s<c;s++,i++)s in a&&Nx(r,i,a[s]);return r.length=i,r}});var Vx=cr("Array","slice"),Fx=b,Bx=Vx,jx=Array.prototype,Gx=d((function(e){var t=e.slice;return e===jx||Fx(jx,e)&&t===jx.slice?Bx:t}));function Wx(e,t,n,r,i){var a,o,s,c={};return mx(a=Tx(r)).call(a,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=bx(o=Rx(s=Gx(n).call(n)).call(s)).call(o,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer?(_T(e,t,c),null):c}var Hx=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Kx=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Yx=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),qx=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),zx=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Xx=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Jx=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Qx=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Zx=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),$x=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),eM=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),tM=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function nM(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Dk.error("Invalid Channel Name ".concat(e)),new Bk(iw.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function rM(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||hw(e,1,255)))throw new Bk(iw.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&Dk.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var iM=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),aM={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},oM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function sM(e,t){dw(e.url,"".concat(t,".url"),1,1e3,!1),lw(e.x)||cw(e.x,"".concat(t,".x"),0,1e4),lw(e.y)||cw(e.y,"".concat(t,".y"),0,1e4),lw(e.width)||cw(e.width,"".concat(t,".width"),0,1e4),lw(e.height)||cw(e.height,"".concat(t,".height"),0,1e4),lw(e.zOrder)||cw(e.zOrder,"".concat(t,".zOrder"),0,255),lw(e.alpha)||cw(e.alpha,"".concat(t,".alpha"),0,1,!1)}var cM={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},uM=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),dM=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),pM=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function lM(e){if(!e.channelName)throw new Bk(iw.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new Bk(iw.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&dw(e.token,"info.token",1,2047),rM(e.uid),nM(e.channelName),!0}var hM=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),fM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),_M=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),vM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),EM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),mM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),SM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),gM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),TM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),bM=[TM.AFRICA,TM.ASIA,TM.CHINA,TM.EUROPE,TM.GLOBAL,TM.INDIA,TM.JAPAN,TM.NORTH_AMERICA,TM.OCEANIA,TM.OVERSEA,TM.SOUTH_AMERICA],RM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),CM={CHINA:{},ASIA:{CODE:RM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:RM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:RM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:RM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:RM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:RM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:RM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:RM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:RM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:RM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:RM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:RM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:RM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};zO&&(CM.CHINA={CODE:RM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var yM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function IM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}var AM=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"onICEConnectionStateChange",void 0),XC(r(i),"onConnectionStateChange",void 0),XC(r(i),"onDTLSTransportStateChange",void 0),XC(r(i),"onDTLSTransportError",void 0),XC(r(i),"onICETransportStateChange",void 0),XC(r(i),"onFirstAudioReceived",void 0),XC(r(i),"onFirstVideoReceived",void 0),XC(r(i),"onFirstAudioDecoded",void 0),XC(r(i),"onFirstVideoDecoded",void 0),XC(r(i),"onFirstVideoDecodedTimeout",void 0),XC(r(i),"onSelectedLocalCandidateChanged",void 0),XC(r(i),"onSelectedRemoteCandidateChanged",void 0),XC(r(i),"onICECandidateError",void 0),XC(r(i),"getLocalVideoStats",void 0),i}return i(t,e),t}(gw),wM=function(e){function t(t,n){var i;return XC(r(i=e.call(this,t,n)||this),"establishPromise",void 0),i}return i(t,e),t}(AM),OM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),kM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),NM=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),DM=["disconnected","failed"],PM=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),LM=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),xM=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),MM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),UM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),VM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),FM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),BM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),jM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),GM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),WM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),HM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),KM=function(e){return e.ABORT="abort",e}({}),YM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),qM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),zM=((o={})[Hx.ACCESS_POINT]=((e={})[qx.NO_FLAG_SET]={desc:"flag is zero",retry:!1},e[qx.FLAG_SET_BUT_EMPTY]={desc:"flag is empty",retry:!1},e[qx.INVALID_FALG_SET]={desc:"invalid flag",retry:!1},e[qx.FLAG_SET_BUT_NO_RE]={desc:"flag set unilbs but no request",retry:!1},e[qx.INVALID_SERVICE_ID]={desc:"invalid service id",retry:!1},e[qx.NO_SERVICE_AVAILABLE]={desc:"no service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_P2P]={desc:"no unilbs p2p service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_VOICE]={desc:"no unilbs voice service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_WEBRTC]={desc:"no unilbs webrtc service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_CDS]={desc:"no cds service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_CDN]={desc:"no cdn dispatcher service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_TDS]={desc:"no tds service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_REPORT]={desc:"no unilbs report service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_APP_CENTER]={desc:"no app center service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_ENV0]={desc:"no unilbs sig env0 service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_VOET]={desc:"no unilbs voet service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_STRING_UID]={desc:"no string uid service available",retry:!0},e[qx.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]={desc:"no webrtc unilbs service available",retry:!0},e),o[Hx.UNILBS]=((t={})[Yx.INVALID_VENDOR_KEY]={desc:"invalid vendor key, can not find appid",retry:!1},t[Yx.INVALID_CHANNEL_NAME]={desc:"invalid channel name",retry:!1},t[Yx.INTERNAL_ERROR]={desc:"unilbs internal error",retry:!1},t[Yx.NO_AUTHORIZED]={desc:"invalid token, authorized failed",retry:!1},t[Yx.DYNAMIC_KEY_TIMEOUT]={desc:"dynamic key or token timeout",retry:!1},t[Yx.NO_ACTIVE_STATUS]={desc:"no active status",retry:!1},t[Yx.DYNAMIC_KEY_EXPIRED]={desc:"dynamic key expired",retry:!1},t[Yx.STATIC_USE_DYNAMIC_KEY]={desc:"static use dynamic key",retry:!1},t[Yx.DYNAMIC_USE_STATIC_KEY]={desc:"dynamic use static key",retry:!1},t[Yx.USER_OVERLOAD]={desc:"amount of users over load",retry:!1},t[Yx.FORBIDDEN_REGION]={desc:"the request is forbidden in this area",retry:!1},t[Yx.CANNOT_MEET_AREA_DEMAND]={desc:"unable to allocate services in this area",retry:!1},t),o[Hx.STRING_UID_ALLOCATOR]=((n={})[Kx.IIIEGAL_APPID]={desc:"invalid appid",retry:!1},n[Kx.IIIEGAL_UID]={desc:"invalid string uid",retry:!1},n[Kx.INTERNAL_ERROR]={desc:"string uid allocator internal error",retry:!0},n),o);function XM(e){var t=zM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};var n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Hx.ACCESS_POINT){var r=e%1e4;if("1"===r.toString()[0])return{desc:e.toString(),retry:!1};if("2"===r.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}var JM=((s={})[zx.K_TIMESTAMP_EXPIRED]={desc:"K_TIMESTAMP_EXPIRED",action:"failed"},s[zx.K_CHANNEL_PERMISSION_INVALID]={desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},s[zx.K_CERTIFICATE_INVALID]={desc:"K_CERTIFICATE_INVALID",action:"failed"},s[zx.K_CHANNEL_NAME_EMPTY]={desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},s[zx.K_CHANNEL_NOT_FOUND]={desc:"K_CHANNEL_NOT_FOUND",action:"failed"},s[zx.K_TICKET_INVALID]={desc:"K_TICKET_INVALID",action:"failed"},s[zx.K_CHANNEL_CONFLICTED]={desc:"K_CHANNEL_CONFLICTED",action:"failed"},s[zx.K_SERVICE_NOT_READY]={desc:"K_SERVICE_NOT_READY",action:"tryNext"},s[zx.K_SERVICE_TOO_HEAVY]={desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},s[zx.K_UID_BANNED]={desc:"K_UID_BANNED",action:"failed"},s[zx.K_IP_BANNED]={desc:"K_IP_BANNED",action:"failed"},s[zx.DATASTREAM2_NOT_AVAILABLE]={desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},s[zx.K_AUTO_REBALANCE]={desc:"k_AUTO_REBALANCE",action:"recover"},s[zx.ERR_INVALID_VENDOR_KEY]={desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},s[zx.ERR_INVALID_CHANNEL_NAME]={desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},s[zx.WARN_NO_AVAILABLE_CHANNEL]={desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},s[zx.WARN_LOOKUP_CHANNEL_TIMEOUT]={desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},s[zx.WARN_LOOKUP_CHANNEL_REJECTED]={desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},s[zx.WARN_OPEN_CHANNEL_TIMEOUT]={desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},s[zx.WARN_OPEN_CHANNEL_REJECTED]={desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},s[zx.WARN_REQUEST_DEFERRED]={desc:"WARN_REQUEST_DEFERRED",action:"failed"},s[zx.ERR_DYNAMIC_KEY_TIMEOUT]={desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},s[zx.ERR_NO_AUTHORIZED]={desc:"ERR_NO_AUTHORIZED",action:"failed"},s[zx.ERR_VOM_SERVICE_UNAVAILABLE]={desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},s[zx.ERR_NO_CHANNEL_AVAILABLE_CODE]={desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},s[zx.ERR_MASTER_VOCS_UNAVAILABLE]={desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},s[zx.ERR_INTERNAL_ERROR]={desc:"ERR_INTERNAL_ERROR",action:"tryNext"},s[zx.ERR_NO_ACTIVE_STATUS]={desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},s[zx.ERR_INVALID_UID]={desc:"ERR_INVALID_UID",action:"failed"},s[zx.ERR_DYNAMIC_KEY_EXPIRED]={desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},s[zx.ERR_STATIC_USE_DYANMIC_KE]={desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},s[zx.ERR_DYNAMIC_USE_STATIC_KE]={desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},s[zx.ERR_NO_VOCS_AVAILABLE]={desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},s[zx.ERR_NO_VOS_AVAILABLE]={desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},s[zx.ERR_JOIN_CHANNEL_TIMEOUT]={desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},s[zx.ERR_JOIN_BY_MULTI_IP]={desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},s[zx.ERR_NOT_JOINED]={desc:"ERR_NOT_JOINED",action:"failed"},s[zx.ERR_REPEAT_JOIN_REQUEST]={desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},s[zx.ERR_REPEAT_JOIN_CHANNEL]={desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},s[zx.ERR_INVALID_STRINGUID]={desc:"ERR_INVALID_STRINGUID",action:"failed"},s[zx.ERR_TOO_MANY_USERS]={desc:"ERR_TOO_MANY_USERS",action:"tryNext"},s[zx.ERR_SET_CLIENT_ROLE_TIMEOUT]={desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},s[zx.ERR_SET_CLIENT_ROLE_NO_PERMISSION]={desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},s[zx.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]={desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},s[zx.ERR_PUBLISH_REQUEST_INVALID]={desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},s[zx.ERR_SUBSCRIBE_REQUEST_INVALID]={desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},s[zx.ERR_NOT_SUPPORTED_MESSAGE]={desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},s[zx.ERR_ILLEAGAL_PLUGIN]={desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},s[zx.ILLEGAL_CLIENT_ROLE_LEVEL]={desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},s[zx.ERR_REJOIN_TOKEN_INVALID]={desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},s[zx.ERR_REJOIN_USER_NOT_JOINED]={desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},s[zx.ERR_INVALID_OPTIONAL_INFO]={desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},s[zx.ERR_TEST_RECOVER]={desc:"ERR_TEST_RECOVER",action:"recover"},s[zx.ERR_TEST_TRYNEXT]={desc:"ERR_TEST_TRYNEXT",action:"recover"},s[zx.ERR_TEST_RETRY]={desc:"ERR_TEST_RETRY",action:"recover"},s[zx.ILLEGAL_AES_PASSWORD]={desc:"ERR_TEST_RETRY",action:"failed"},s[zx.ERR_TOO_MANY_BROADCASTERS]={desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},s[zx.ERR_TOO_MANY_SUBSCRIBERS]={desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},s[zx.ERR_LICENSE_ILLEGAL]={desc:"ERR_LICENSE_ILLEGAL",action:"quit"},s[zx.ERR_LICENSE_MISSING]={desc:"ERR_LICENSE_MISSING",action:"quit"},s[zx.ERR_LICENSE_EXPIRED]={desc:"ERR_LICENSE_EXPIRED",action:"quit"},s[zx.ERR_LICENSE_MINUTES_EXCEEDED]={desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},s[zx.ERR_LICENSE_PERIOD_INVALID]={desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},s[zx.ERR_LICENSE_MULTIPLE_SDK_SERVICE]={desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"},s);function QM(e){return JM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function ZM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZM(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function eU(e,t){if("string"==typeof e)return e;var n=e.proxy,r=e.host,i=e.port;if(t){var a=rk("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===a?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(a,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}var tU=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,nU=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,rU=/wss:\/\/(.+):([0-9]+)\/?/,iU=/wss:\/\/(.[^\/]+)\/?/,aU=0,oU=function(){function e(e,t){XC(this,"id",0),XC(this,"store",void 0),XC(this,"recordIndex",void 0),XC(this,"websockets",[]),XC(this,"try443PortDuration",2e3),XC(this,"forceCloseWSDuration",5e3),XC(this,"try443PortTimeout",null),XC(this,"forceCloseTimeout",null),XC(this,"isTry443PortFailed",!1),XC(this,"isNormalPortFailed",!1),XC(this,"useDoubleDomain",!1),XC(this,"useProxy",!1),XC(this,"startTime",Date.now()),this.id=++aU,this.try443PortDuration=rk("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}var t=e.prototype;return t.closeAllWebsockets=function(){this.websockets.forEach((function(e){e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0},t.clearTimeout=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null})),t.logger=function(){for(var e,t=Date.now()-this.startTime,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];Dk.debug.apply(Dk,["[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:")].concat(r))},t.createWebSocket=function(e,t,n){var r,i=this;this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});var a=rk("GATEWAY_DOMAINS"),o=Date.now(),s=[],c=a.find((function(t){var n;return Br(n=e.host).call(n,t)}));c||(this.useDoubleDomain=!1);var u=[];if(this.useDoubleDomain)a.forEach((function(n){u.push(eU($M($M({},e),{},{host:e.host.replace(c,n)}),t))}));else{var d=$M({},e);if(t&&c){var p=a.find((function(e){return e!==c}));p&&(d.host=d.host.replace(c,p))}u.push(eU(d,t))}try{u.forEach((function(e){var t=new WebSocket(e);t.binaryType="arraybuffer",s.push(t),i.logger("ws is connecting:",t.url)}))}catch(a){if(this.logger("ws create failed"),s.forEach((function(e){return e.close()})),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new Bk(iw.WS_ERR,"init websocket failed! Error: ".concat(a.toString()))}var l=EA();this.store&&this.store.recordJoinChannelService({urls:s.map((function(e){return e.url})),service:"gateway"},this.recordIndex),s.forEach((function(e){e.onopen=function(){i.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-o,"ms")),i.websockets.forEach((function(t){t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),i.logger("close backup websocket: ".concat(t.url)))})),i.websockets.length=0,l.resolve(e)},e.onclose=function(n){i.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(e.readyState));var r=s.every((function(e){return e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING}));i.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(r)),r&&(t||i.isTry443PortFailed||i.useProxy)?(i.logger("onclose: all websocket is closed, ".concat(n.reason)),l.reject({code:n.code,reason:SM.A_ROUND_WS_FAILED})):!t&&r&&!i.isNormalPortFailed&&i.try443PortTimeout&&(i.logger("all 47xx websocket is closed, try 443 port"),i.clearTimeout(),f()),t?i.isTry443PortFailed=r:i.isNormalPortFailed=r},e.onmessage=function(t){return i.logger("".concat(e.url," onmessage: ").concat(t.data))}})),(r=this.websockets).push.apply(r,s);var h=function(){i.websockets.forEach((function(e){return e.readyState!==WebSocket.OPEN&&e.close()}))},f=function(){if(l.isResolved)return h();IA().os===TA.MAC_OS&&LA()&&h(),i.createWebSocket(e,!0,!0).then((function(e){l.resolve(e)})).catch((function(e){i.isNormalPortFailed&&l.reject(e),i.logger("try 443 port to create ws failed")})),i.forceCloseTimeout=window.setTimeout((function(){i.logger("5s timeout close un-opens, isWebsocket created: ",l.isResolved),i.forceCloseTimeout=null,h()}),i.forceCloseWSDuration)};return n||function(){if(t||i.useProxy)return i.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),i.forceCloseTimeout=window.setTimeout((function(){i.forceCloseTimeout=null,h()}),i.forceCloseWSDuration);i.try443PortTimeout=window.setTimeout((function(){i.logger("2s timeout, isWebsocket created: ",l.isResolved),i.try443PortTimeout=null,f()}),i.try443PortDuration)}(),l.promise},t.chooseBestWebsocket=function(e,t,n,r){var i=this;return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e,t,n,r,i){var a,o,s;return a=(t=e.match(tU)||[])[1],o=t[2],s=t[3],a||(o=(n=e.match(nU)||[])[1],s=n[2]),o&&s||(o=(r=e.match(rU)||[])[1],s=r[2]),o&&s||(o=(e.match(iU)||[])[1]),o||Dk.warning("un-destructible url: ",e),{proxy:a,host:o,port:s||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(Dk.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((function(){return i.clearTimeout()}))},e}();function sU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var cU=function(e){i(n,e);var t=n.prototype;function n(t,n){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5?arguments[5]:void 0;XC(r(i=e.call(this)||this),"_websocketUrl",null),XC(r(i),"connectionID",0),XC(r(i),"currentURLIndex",0),XC(r(i),"urls",[]),XC(r(i),"_reconnectMode","tryNext"),XC(r(i),"reconnectReason",void 0),XC(r(i),"_initMutex",void 0),XC(r(i),"name",void 0),XC(r(i),"_state","closed"),XC(r(i),"reconnectInterrupter",void 0),XC(r(i),"websocket",void 0),XC(r(i),"retryConfig",void 0),XC(r(i),"reconnectCount",0),XC(r(i),"forceCloseTimeout",5e3),XC(r(i),"onlineReconnectListener",void 0),XC(r(i),"useCompress",void 0),XC(r(i),"tryDoubleDomain",!1),XC(r(i),"use443PortOnly",!1),XC(r(i),"wsInflateLength",0),XC(r(i),"wsDeflateLength",0),XC(r(i),"closeEstablishingWs",(function(){})),XC(r(i),"store",void 0),XC(r(i),"joinGatewayRecordIndex",void 0),i.store=c,i.name=t,i.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sU(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n),i.useCompress=a,i.tryDoubleDomain=o,i.use443PortOnly=s,i._initMutex=new fO("websocket",c?c.clientId:void 0);var u=n.timeout,d=n.timeoutFactor,p=Math.max(300,Math.floor(3*u/5)),l=Math.max(1.2,Math.floor(8*d)/10);return Pw.ONLINE&&(i.retryConfig.timeout=p,i.retryConfig.timeoutFactor=l),Fw.on(Lw.NETWORK_STATE_CHANGE,(function(e,t){e!==t&&(i.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===Pw.ONLINE?(i.retryConfig.timeout=p,i.retryConfig.timeoutFactor=l):(i.retryConfig.timeout=u,i.retryConfig.timeoutFactor=d))})),i}return t.resetReconnectCount=function(e){Dk.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0},t.getConnection=function(){return this.websocket||void 0},t.init=function(){var e=p(l().mark((function e(t){var n,r,i,a,o=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:5e3,e.next=3,this._initMutex.lock();case 3:return r=e.sent,this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting",e.prev=5,i=EA(),a=this.urls[this.currentURLIndex],rk("ENABLE_PREALLOC_PC")&&this.emit(FM.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(i.resolve).catch(i.reject),this.once(tM.CLOSED,(function(){i.reject(new aw(iw.WS_DISCONNECT))})),this.once(tM.CONNECTED,i.resolve),e.next=13,i.promise;case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(5);case 17:return e.prev=17,r(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[5,15,17,20]])})));return function(t){return e.apply(this,arguments)}}(),t.close=function(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var n=this.websocket;t?setTimeout((function(){return n.close()}),500):n.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()},t.reconnect=function(e,t){if(this.websocket){void 0!==e&&(this.reconnectMode=e),Dk.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);var n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}else Dk.warning("[".concat(this.name,"] can not reconnect, no websocket"))},t.sendMessage=function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new aw(iw.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new aw(iw.WS_ERR,"send websocket message error"+e.toString())}},t.setWsInflateData=function(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength},t.getWsInflateData=function(){var e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}},t.clearWsInflateData=function(){this.wsInflateLength=0,this.wsDeflateLength=0},t.createWebSocketConnection=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,h,f,_,v,E=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=EA(),this.connectionID+=1,this.joinGatewayRecordIndex=void 0,i=function(e){var t;null===(t=E.store)||void 0===t||t.signalChannelOpen(),Dk.debug("[".concat(E.name,"] websocket opened:"),e),E.reconnectMode="retry",E.state="connected",E.resetReconnectCount("opened"),r.resolve()},a=function(){var e=p(l().mark((function e(t){var n,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("[".concat(E.name,"] websocket close ").concat(null===(n=E.websocket)||void 0===n?void 0:n.url,", code: ").concat(t.code,", reason: ").concat(t.reason,", current mode: ").concat(E.reconnectMode)),!(E.reconnectCount>=E.retryConfig.maxRetryCount)){e.next=4;break}r.reject(new aw(iw.WS_DISCONNECT,"websocket close: ".concat(t.code))),E.close(),e.next=14;break;case 4:return"connected"===E.state&&(E.reconnectReason=t.reason,E.state="reconnecting"),i=Uw(E,tM.WILL_RECONNECT,E.reconnectMode,t.reason)||E.reconnectMode,e.next=8,E.reconnectWithAction(i);case 8:if(a=e.sent,"closed"!==E.state){e.next=11;break}return e.abrupt("return",void Dk.debug("[".concat(E.connectionID,"] ws is closed, no need to reconnect")));case 11:if(a){e.next=13;break}return e.abrupt("return",(r.reject(new aw(iw.WS_DISCONNECT,"websocket reconnect failed: ".concat(t.code))),E.close(!0)));case 13:r.resolve();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(e){E.emit(tM.ON_MESSAGE,e)},s=function(e){Dk.warn("[".concat(E.connectionID,"] ws open error ").concat(e))},this.websocket&&(this.websocket.onclose=null,this.websocket.close()),rk("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=rk("GATEWAY_WSS_ADDRESS")),Dk.debug("[".concat(this.name,"] start connect, url:"),t),c=null===(n=this.store)||void 0===n?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),e.prev=5,this._websocketUrl=eU(t),e.next=9,this.chooseBestWebsocketConnection(t);case 9:n=e.sent,this.websocket=n,i&&i(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=o,this.websocket.onerror=s,null===(u=this.store)||void 0===u||u.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinGatewayRecordIndex=c,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),d="closed"===this.state,h=e.t0 instanceof aw,f=h&&e.t0.code===iw.WS_ABORT,_=h&&e.t0.code===iw.WS_ERR,v=h?e.t0.message:e.t0&&(e.t0.reason||e.t0.toString()),Dk.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(v)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:f?"aborted":"error",errors:[e.t0]},c),d||_?(r.reject(d?new aw(iw.WS_DISCONNECT,"websocket is closed: ".concat(v)):new aw(iw.WS_ERR,"init websocket failed: ".concat(v))),_&&Dk.error("[".concat(this.name,"] init websocket failed: ").concat(v))):a&&a(e.t0);case 17:return e.abrupt("return",r.promise);case 18:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),t.reconnectWithAction=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c=this,u=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(u.length>1&&void 0!==u[1])||u[1],!(this.reconnectCount>=this.retryConfig.maxRetryCount)){e.next=3;break}return e.abrupt("return",!1);case 3:if(0!==this.urls.length){e.next=5;break}return e.abrupt("return",!1);case 5:if("closed"!==this.state){e.next=7;break}return e.abrupt("return",!1);case 7:if(Dk.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Fw.isOnline||!Fw.onlineWaiter||(this.onlineReconnectListener=Fw.onlineWaiter.then((function(){c.onlineReconnectListener=void 0}))),r=!0,this.reconnectInterrupter=function(){return r=!1},!n){e.next=14;break}return i=EO(this.reconnectCount,this.retryConfig),Dk.debug("[".concat(this.name,"] wait ").concat(i,"ms to reconnect websocket, mode: ").concat(t)),e.next=14,zl.race([eO(i),this.onlineReconnectListener||new zl((function(){}))]);case 14:if("closed"!==this._state&&r){e.next=16;break}return e.abrupt("return",!1);case 16:if(this.reconnectCount+=1,a=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.emit(tM.RECONNECT_CREATE_CONNECTION,n),e.next=3,c.createWebSocketConnection(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=18,"retry"!==t){e.next=24;break}return e.next=22,a(this.urls[this.currentURLIndex],t);case 22:e.next=42;break;case 24:if("tryNext"!==t){e.next=32;break}if(this.currentURLIndex+=1,!(this.currentURLIndex>=this.urls.length)){e.next=27;break}return e.abrupt("return",this.reconnectWithAction("recover",!1));case 27:return Dk.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),e.next=30,a(this.urls[this.currentURLIndex],t);case 30:e.next=42;break;case 32:if(e.t0="recover"===t,!e.t0){e.next=42;break}return Dk.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),e.next=38,xw(this,tM.REQUEST_NEW_URLS);case 38:return this.urls=e.sent,this.currentURLIndex=0,e.next=42,a(this.urls[this.currentURLIndex],t);case 42:e.next=49;break;case 44:return e.prev=44,e.t1=e.catch(18),Dk.error("[".concat(this.name,"] reconnect failed ").concat(e.t1&&e.t1.toString())),s=null==e.t1||null===(o=e.t1.data)||void 0===o?void 0:o.desc,e.abrupt("return",Array.isArray(s)&&Br(s).call(s,"dynamic key expired")?(this.emit(tM.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n));case 49:return e.abrupt("return",!0);case 50:case"end":return e.stop()}}),e,this,[[18,44]])})));return function(t){return e.apply(this,arguments)}}(),v(n,[{key:"url",get:function(){return this.websocket&&this.websocket.url||this._websocketUrl}},{key:"reconnectMode",get:function(){return this._reconnectMode},set:function(e){var t;Br(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(tM.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(tM.CONNECTED):"closed"===this._state?this.emit(tM.CLOSED):"failed"===this._state&&this.emit(tM.FAILED))}}]),n}(gw),uU=function(e){function t(t,n){return e.call(this,t,n,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)||this}return i(t,e),t.prototype.chooseBestWebsocketConnection=function(){var e=p(l().mark((function e(t,n){var r,i,a,o=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=EA(),i=function(e,t){return new oU(e,t)}(this.forceCloseTimeout,this.store),this.closeEstablishingWs=function(){Dk.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new aw(iw.WS_ABORT,"choose best websocket aborted"))},a=rk("GATEWAY_DOMAINS"),e.abrupt("return",(Dk.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally((function(){o.closeEstablishingWs=void 0}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t}(cU),dU=function(e){function t(t,n){return e.call(this,t,n,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)||this}return i(t,e),t.prototype.chooseBestWebsocketConnection=function(){var e=p(l().mark((function e(t,n){var r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new zl((function(e,i){var a=!1,o=[];r.closeEstablishingWs=function(){Dk.debug("[choose-best-ws] close establishing websockets"),o.forEach((function(e){e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),i(new aw(iw.WS_ABORT,"choose best websocket aborted"))};var s,c=rk("GATEWAY_DOMAINS"),u=t.indexOf("?h="),d=c.find((function(e){return-1!==u?Br(t).call(t,e,u):Br(t).call(t,e)}));Dk.debug("[choose-best-ws] currentDomain: ",d,", domains: ",c);var p=!r.tryDoubleDomain||!d;if(!p&&d){var l,h=Date.now();try{c.forEach((function(e){var n=-1===u?t.replace(d,e):t.substr(0,u)+t.substr(u).replace(d,e),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),Dk.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(Dk.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((function(e){return e.close()}));o.length;)o.pop();p=!0}null===(l=r.store)||void 0===l||l.recordJoinChannelService({urls:o.map((function(e){return e.url})),service:"gateway"},n),o.forEach((function(t){t.onopen=function(){if(!a){var n=Date.now()-h;Dk.debug("[choose-best-ws] ws open cost ".concat(n,"ms")),o.filter((function(e){return e!==t})).forEach((function(e){Dk.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),a=!0,e(t)}},t.onclose=function(e){s=e,a||o.find((function(e){return!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}))||(Dk.debug("[choose-best-ws] all websocket is closed"),a=!0,i(s))},t.onmessage=function(e){Dk.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))}})),eO(r.forceCloseTimeout).then((function(){o.forEach((function(e){e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(p){var f,_;Dk.debug("[choose-best-ws] use single url: ",t),null===(f=r.store)||void 0===f||f.recordJoinChannelService({urls:[t],service:"gateway"},n);try{_=new WebSocket(t),o.push(_),_.binaryType="arraybuffer"}catch(e){var v=new aw(iw.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Dk.error("[".concat(r.name,"]").concat(v)),void i(v)}_.onopen=function(){e(_)},_.onclose=function(e){i(e)},_.onmessage=function(e){Dk.debug("[choose-best-ws]".concat(_.url," onmessage: ").concat(e.data))},eO(r.forceCloseTimeout).then((function(){_&&_.readyState!==WebSocket.OPEN&&_.close()}))}})).then((function(e){return r.closeEstablishingWs=void 0,e})).catch((function(e){throw r.closeEstablishingWs=void 0,e})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t}(cU),pU=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"_disconnectedReason",void 0),XC(r(i),"_websocketReconnectReason",void 0),XC(r(i),"_connectionState",Xx.CLOSED),XC(r(i),"reconnectToken",void 0),XC(r(i),"websocket",void 0),XC(r(i),"openConnectionTime",void 0),XC(r(i),"clientId",void 0),XC(r(i),"lastMsgTime",Date.now()),XC(r(i),"uploadCache",[]),XC(r(i),"uploadCacheInterval",void 0),XC(r(i),"rttRolling",new gO(5)),XC(r(i),"pingpongTimer",void 0),XC(r(i),"wsInflateDataTimer",void 0),XC(r(i),"pingpongTimeoutCount",0),XC(r(i),"joinResponse",void 0),XC(r(i),"multiIpOption",void 0),XC(r(i),"initError",void 0),XC(r(i),"spec",void 0),XC(r(i),"store",void 0),XC(r(i),"onWebsocketMessage",(function(e){if(e.data instanceof ArrayBuffer)i.emit(Jx.ON_BINARY_DATA,e.data);else{var t=JSON.parse(e.data);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(i.emit(t._type,t._message),t._type===$x.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===$x.ON_USER_BANNED)switch(t._message.error_code){case 14:i.close(Aw.UID_BANNED);break;case 15:i.close(Aw.IP_BANNED);break;case 16:i.close(Aw.CHANNEL_BANNED)}if(t._type===$x.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case zx.ERR_LICENSE_MISSING:i.close(Aw.LICENSE_MISSING);break;case zx.ERR_LICENSE_EXPIRED:i.close(Aw.LICENSE_EXPIRED);break;case zx.ERR_LICENSE_MINUTES_EXCEEDED:i.close(Aw.LICENSE_MINUTES_EXCEEDED);break;case zx.ERR_LICENSE_PERIOD_INVALID:i.close(Aw.LICENSE_PERIOD_INVALID);break;case zx.ERR_LICENSE_MULTIPLE_SDK_SERVICE:i.close(Aw.LICENSE_MULTIPLE_SDK_SERVICE);break;case zx.ERR_LICENSE_ILLEGAL:i.close(Aw.LICENSE_ILLEGAL);break;default:i.close()}}}})),i.clientId=t.clientId,i.spec=t,i.store=n,i.websocket=new uU("gateway-".concat(i.clientId),i.spec.retryConfig,!0,rk("JOIN_GATEWAY_USE_DUAL_DOMAIN"),rk("JOIN_GATEWAY_USE_443PORT_ONLY"),n),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===Xx.CONNECTED&&i.reconnect("retry",Dw.OFFLINE)})),i}i(t,e);var n=t.prototype;return n.request=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p,h,f,_=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=tO(6,""),o={_id:a,_type:t,_message:n},s=this.websocket.connectionID,c=function(){return new zl((function(e,n){if(_.connectionState===Xx.CONNECTED)return e();var r=function(){_.off(Jx.WS_CLOSED,i),e()},i=function(){_.off(Jx.WS_CONNECTED,r),n(new Bk(iw.WS_ABORT))};_.once(Jx.WS_CONNECTED,r),_.once(Jx.WS_CLOSED,i),t!==Qx.PUBLISH&&t!==Qx.PUBLISH_DATASTREAM&&t!==Qx.SUBSCRIBE&&t!==Qx.SUBSCRIBE_DATASTREAM&&t!==Qx.UNSUBSCRIBE&&t!==Qx.UNSUBSCRIBE_DATASTREAM&&t!==Qx.UNPUBLISH&&t!==Qx.UNPUBLISH_DATASTREAM&&t!==Qx.CONTROL&&t!==Qx.RESTART_ICE||_.once(Jx.DISCONNECT_P2P,(function(){n(new Bk(iw.DISCONNECT_P2P))})),t!==Qx.PUBLISH&&t!==Qx.RESTART_ICE||_.once(Jx.ABORT_P2P_EXECUTION,(function(){n(new Bk(iw.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==Xx.CONNECTING&&this.connectionState!==Xx.RECONNECTING||t===Qx.JOIN||t===Qx.REJOIN,e.t0){e.next=5;break}return e.next=5,c();case 5:if(this.websocket.sendMessage(o,!0),!i){e.next=8;break}return e.abrupt("return");case 8:return u=new zl((function(e,r){var i=!1,o=function(r,a){i=!0,e({isSuccess:"success"===r,message:a||{}}),_.off(Jx.WS_CLOSED,c),_.off(Jx.WS_RECONNECTING,c),_.emit(Jx.REQUEST_SUCCESS,t,n)};_.once("res-@".concat(a),o);var c=function e(){r(new Bk(iw.WS_ABORT,"type: ".concat(t))),_.off(Jx.WS_CLOSED,e),_.off(Jx.WS_RECONNECTING,e),_.off("res-@".concat(a),o)};_.once(Jx.WS_CLOSED,c),_.once(Jx.WS_RECONNECTING,c),eO(rk("SIGNAL_REQUEST_TIMEOUT")).then((function(){_.websocket.connectionID!==s||i||(Dk.warning("[".concat(_.clientId,"] ws request timeout, type: ").concat(t)),_.emit(Jx.REQUEST_TIMEOUT,t,n))}))})),d=null,e.prev=10,e.next=13,u;case 13:d=e.sent,e.next=35;break;case 16:if(e.prev=16,e.t1=e.catch(10),this.connectionState!==Xx.CLOSED&&t!==Qx.LEAVE){e.next=20;break}throw new Bk(iw.WS_ABORT);case 20:if(this.spec.forceWaitGatewayResponse&&!r){e.next=24;break}e.t2=e.t1.throw(),e.next=34;break;case 24:if(t!==Qx.JOIN&&t!==Qx.REJOIN){e.next=28;break}e.t3=null,e.next=33;break;case 28:return e.next=30,c();case 30:return e.next=32,this.request(t,n);case 32:e.t3=e.sent;case 33:e.t2=e.t3;case 34:return e.abrupt("return",e.t2);case 35:if(!d.isSuccess){e.next=37;break}return e.abrupt("return",d.message);case 37:if(p=Number(d.message.error_code||d.message.code),h=QM(p),f=new Bk(iw.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(d.message.error_str),{code:p,data:d.message,desc:h.desc}),"success"!==h.action){e.next=42;break}e.t4=d.message,e.next=67;break;case 42:if(Dk.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(p,", message: ").concat(h.desc,", action: ").concat(h.action)),p!==zx.ERR_TOO_MANY_BROADCASTERS){e.next=47;break}e.t5=t===Qx.JOIN||t===Qx.REJOIN?(this.initError=f,this.close(),f.throw()):f.throw(),e.next=66;break;case 47:if("failed"!==h.action){e.next=51;break}e.t6=f.throw(),e.next=65;break;case 51:if("quit"!==h.action){e.next=55;break}e.t7=(this.initError=f,this.close(),f.throw()),e.next=64;break;case 55:if(p===zx.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,Dk.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Dw.MULTI_IP)):this.reconnect(h.action,Dw.SERVER_ERROR),t!==Qx.JOIN&&t!==Qx.REJOIN){e.next=60;break}e.t8=null,e.next=63;break;case 60:return e.next=62,this.request(t,n);case 62:e.t8=e.sent;case 63:e.t7=e.t8;case 64:e.t6=e.t7;case 65:e.t5=e.t6;case 66:e.t4=e.t5;case 67:return e.abrupt("return",e.t4);case 68:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.waitMessage=function(e,t){var n=this;return new zl((function(r){n.on(e,(function i(a){(!t||t(a))&&(n.off(e,i),r(a))}))}))},n.uploadWRTCStats=function(e){if(this.store.sessionId){var t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Zx.WRTC_STATS,t)}else Dk.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"))},n.upload=function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=rk("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===Xx.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),rk("UPLOAD_CACHE_INTERVAL")||2e3))}},n.send=function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)},n.init=function(e){var t=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new zl((function(n,r){t.once(Jx.WS_CONNECTED,(function(){return n(t.joinResponse)})),t.once(Jx.WS_CLOSED,(function(e){return r(t.initError||new Bk(iw.WS_ABORT,e))})),t.connectionState=Xx.CONNECTING,t.websocket.init(e).catch(r),t.wsInflateDataTimer&&window.clearInterval(t.wsInflateDataTimer),t.wsInflateDataTimer=window.setInterval((function(){t.handleWsInflateData()}),2e4)}))},n.close=function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Aw.LEAVE,this.connectionState=Xx.CLOSED,Dk.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()},n.join=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(Jx.ABORT_P2P_EXECUTION),e.next=4,xw(this,Jx.REQUEST_JOIN_INFO);case 4:return t=e.sent,e.next=7,this.request(Qx.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(Jx.REPORT_JOIN_GATEWAY,SM.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(Jx.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=Xx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.rejoin=function(){var e=p(l().mark((function e(){var t,n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new Bk(iw.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=Vw(this,Jx.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(Qx.REJOIN,t);case 6:return n=e.sent,e.abrupt("return",!!n&&(this.connectionState=Xx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((function(e){r.emit($x.ON_USER_ONLINE,{uid:e.uid}),e.audio&&r.emit($x.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&r.emit($x.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?r.emit($x.MUTE_AUDIO,{uid:e.uid}):r.emit($x.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?r.emit($x.MUTE_VIDEO,{uid:e.uid}):r.emit($x.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?r.emit($x.ENABLE_LOCAL_AUDIO,{uid:e.uid}):r.emit($x.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?r.emit($x.ENABLE_LOCAL_VIDEO,{uid:e.uid}):r.emit($x.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||r.emit($x.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reconnect=function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)},n.handleNotification=function(e){Dk.debug("[".concat(this.clientId,"] receive notification: "),e);var t=QM(e.code);if(28===e.code&&"detail"in e&&(Dk.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Jx.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Aw.UID_BANNED),void this.close()):void this.reconnect(t.action,Dw.SERVER_ERROR);Dk.error("[".concat(this.clientId,"] ignore error: "),t.desc)}},n.handlePingPong=function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=rk("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(Dk.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>rk("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Dw.TIMEOUT):this.request(Qx.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),rk("REPORT_STATS")&&e.send(Qx.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}},n.handleWsInflateData=function(){var e=this.websocket.getWsInflateData(),t=e.wsInflateLength,n=e.wsDeflateLength;0!==t&&0!==n&&this.upload(Zx.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})},n.handleWebsocketEvents=function(){var e=this;this.websocket.on(tM.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(Jx.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(tM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tM.CLOSED,(function(){e.connectionState=Xx.CLOSED})),this.websocket.on(tM.FAILED,(function(){e._disconnectedReason=Aw.NETWORK_ERROR,e.connectionState=Xx.CLOSED})),this.websocket.on(tM.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===Xx.CONNECTED?e.connectionState=Xx.RECONNECTING:e.connectionState=Xx.CONNECTING})),this.websocket.on(tM.WILL_RECONNECT,(function(t,n,r){var i=Vw(e,Jx.IS_P2P_DISCONNECTED),a=i||"retry"!==t;i&&"retry"===t&&(Dk.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=SM.P2P_DISCONNECTED),a&&(Dk.debug("".concat(e.clientId," will renewSession, reconnect mode: ").concat(t)),e.emit(Jx.REPORT_JOIN_GATEWAY,n||SM.UNKNOWN_REASON,e.url||""),e.reconnectToken=void 0,e.emit(Jx.DISCONNECT_P2P)),r(t)})),this.websocket.on(tM.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){Dk.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",Dw.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(Jx.REPORT_JOIN_GATEWAY,t,e.url||""),t instanceof Bk){if(t.code===iw.UNEXPECTED_RESPONSE&&t.data.code===zx.ERR_NO_AUTHORIZED)return e.initError=new Bk(iw.TOKEN_EXPIRE,"dynamic key expired"),void e.close(Aw.TOKEN_EXPIRE);Dk.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",Dw.SERVER_ERROR):(e.initError=t,e.close())}}))})),this.websocket.on(tM.REQUEST_NEW_URLS,(function(t,n){xw(e,Jx.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(tM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit($x.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(FM.PRE_CONNECT_PC,(function(){e.emit(Jx.PRE_CONNECT_PC)}))},v(t,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===Xx.CONNECTED?this.emit(Jx.WS_CONNECTED):e===Xx.RECONNECTING?this.emit(Jx.WS_RECONNECTING,this._websocketReconnectReason):e===Xx.CLOSED&&this.emit(Jx.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket&&this.websocket.url||null}},{key:"rtt",get:function(){return this.rttRolling.mean()}}]),t}(gw),lU=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),hU=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function fU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fU(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vU(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(rk("TURN_DOMAIN")):(Dk.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function EU(e,t){e.addresses||(e.addresses=[]);var n=function(e,t){if(rk("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((function(e){var t=e.ip,n=e.port;return{address:"".concat(t,":").concat(n)}}));var n=rk("GATEWAY_DOMAINS"),r=n[1]&&Br(t).call(t,n[1])?1:0;return e.map((function(e){var t=e.domain_prefix,i=e.port,a=e.ip;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};var o=/^[\.\:\d]+$/.test(a),s=o?"".concat(a.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(a,":").concat(i);return o||Dk.debug("Cannot recognized as ip address: ".concat(a,", use as host")),{ip:a,port:i,address:s}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r)for(var i=r.split(";"),a=0;a<i.length;a++){var o,s=mS(o=i[a]).call(o);n[a]&&s&&(n[a].ip6=s)}var c,u=e.detail&&e.detail.candidate;if(u){var d=u.split(":"),p=d[0],l=d[1];p&&l&&(c={port:Number(l),ip:p,address:"".concat(p,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function mU(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function SU(e){var t=e._encoderConfig;if(!t)return{};var n={resolution:t.width&&t.height?"".concat(mU(t.width),"x").concat(mU(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function gU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function TU(e,t){var n,r,i;switch(t){case hU.CHOOSE_SERVER:r=4096,i="choose server";break;case hU.CLOUD_PROXY:r=1048576,i="proxy";break;case hU.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case hU.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new Bk(iw.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((function(t){t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((function(e){return _U(_U({},e),{},{ticket:t.buffer.cert})})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:_U(_U({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new Bk(iw.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}function bU(e,t){return RU.apply(this,arguments)}function RU(){return(RU=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zl.all(t.addresses.map(p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=rk("USE_TURN_IP")?t.ip:vU(t.ip),e.t1=t.port,e.t2=t.port,e.t3=n&&rk("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():JO.username,!(n&&rk("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext)){e.next=10;break}return e.next=7,Sw(n.toString());case 7:e.t4=e.sent,e.next=11;break;case 10:e.t4=JO.password;case 11:return e.t5=e.t4,e.abrupt("return",{address:e.t0,tcpport:e.t1,udpport:e.t2,username:e.t3,password:e.t5});case 13:case"end":return e.stop()}}),e)})))));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CU(e,t){var n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(mU(e.height),mU(e.width)),1):(Dk.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function yU(e){var t=e.candidateType,n=e.relayProtocol,r=e.type,i=e.address,a=e.port,o={candidateType:t,relayProtocol:n,protocol:e.protocol};if("local-candidate"!==r){var s=i.split(".");s.length>=4&&(s[1]="*",s[2]="*"),o.address=s.join("."),o.port=a}return o}function IU(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rk("SVC_MODE");if(rk("ENABLE_SVC"))return function(e){return e in UO}(e)?e:UO.L1T3}var AU=((c={})[OM.VIDEO]=[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],c[OM.AUDIO]=[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}],c);function wU(e,t,n){t.forEach((function(t){var r,i=AU[e].find((function(e){var n,r=e.key;return Br(n=t.extensionName).call(n,r)}));if(i){var a=n.find((function(e){var t=e.extensionName;return Br(t).call(t,i.key)}));a&&Br(r=a.extensionName).call(r,"gdpr_forbidden")&&(t.extensionName=a.extensionName)}}))}function OU(e,t){t.forEach((function(t){var n,r=AU[e].find((function(e){var n,r=e.key;return Br(n=t.extensionName).call(n,r)}));Br(n=t.extensionName).call(n,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)}))}function kU(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Br(e).call(e,"abs-send-time")}function NU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Br(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function PU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DU(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function LU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=t.filterRTX,a=t.filterVideoFec,o=t.filterAudioFec,s=t.filterAudioCodec,c=t.filterVideoCodec,u=n.useXR,d=[],p=[],l=[],h=[],f=!1,_=!1;if(pk(e).mediaDescriptions.forEach((function(e){r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(p=e.attributes.payloads,h=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||_||(d=e.attributes.payloads,l=e.attributes.extmaps,_=!0))})),!h||0===p.length)throw new Error("Cannot get video capabilities from SDP.");if(!l||0===d.length)throw new Error("Cannot get audio capabilities from SDP.");if(p.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),d.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(d=d.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),p=p.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),a&&(p=p.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),o&&(d=d.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null==s?void 0:s.length)>0&&(d=d.filter((function(e){var t;return Br(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0){var v=p.filter((function(e){var t;return Br(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));p=v.concat(i?[]:$U(v,p))}var E=rk("UNSUPPORTED_VIDEO_CODEC");return E&&E.length>0&&(p=p.filter((function(e){return!(e.rtpMap&&Br(E).call(E,e.rtpMap.encodingName.toLowerCase()))}))),{audioCodecs:d,videoCodecs:p,audioExtensions:l,videoExtensions:h}}function xU(e){for(var t,n,r,i=pk(e),a=h(i.mediaDescriptions);!(r=a()).done;){var o=r.value;if(!t){var s=o.attributes.iceUfrag,c=o.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:s,icePwd:c}}if(!n){var u=o.attributes.fingerprints;u.length>0&&(n={fingerprints:u})}}if(!n&&i.attributes.fingerprints.length>0&&(n={fingerprints:i.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function MU(e,t){var n=[],r=e.attributes.ssrcGroups.filter((function(e){return"FID"===e.semantic})),i=e.attributes.ssrcGroups.find((function(e){return"SIM"===e.semantic})),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((function(e){var i,a=null===(i=r.find((function(t){return t.ssrcIds[0]===e})))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?a:void 0})}));else if(r.length>0){var o=r[0].ssrcIds[0],s=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?s:void 0})}else{if(0===a.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function UU(e,t,n){var r=e.cname,i=[];t&&(i=VU(t)),0===i.length&&(i=e.iceParameters.candidates.map((function(e){return{foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}})),Dk.debug("Using candidates from gateway."));var a,o={fingerprints:e.dtlsParameters.fingerprints.map((function(e){return{hashFunction:e.algorithm,fingerprint:e.fingerprint}}))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}var c=JU(e.rtpCapabilities),u=[];return Array.isArray(n)&&n.length>0&&n.forEach((function(e){u.push({kind:OM.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:OM.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})})),{dtlsParameters:o,iceParameters:s,candidates:i,rtpCapabilities:c,setup:a,cname:r,preSSRCs:u}}function VU(e){var t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],Dk.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),Dk.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function FU(e,t,n){var r=[],i=[];return e.forEach((function(e){var a=e.ssrcId,o=e.rtx,s=tO(8,"track-"),c={ssrcId:a,attributes:PU({label:s,mslabel:n=n||tO(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==o){var u={ssrcId:o,attributes:PU({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(u),i.push({semantic:"FID",ssrcIds:[a,o]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((function(e){return e.ssrcId}))}),{ssrcs:r,ssrcGroups:i}}function BU(e,t){t instanceof fP&&e.attributes.payloads.forEach((function(e){var n,r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(r&&-1!==["opus","pcmu","pcma","g722"].indexOf(r)){e.fmtp||(e.fmtp={parameters:{}}),"opus"===r&&"number"==typeof rk("OPUS_PTIME")?e.fmtp.parameters.ptime=rk("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";var i=t._encoderConfig;i&&("pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!LA()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof _P&&"opus"===r&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))}}))}function jU(e){var t=e.attributes.unrecognized.findIndex((function(e){return"x-google-flag"===e.attField&&"conference"===e.attValue}));-1!==t&&e.attributes.unrecognized.splice(t,1)}function GU(e,t){var n;if(t instanceof mL&&t._encoderConfig&&-1===t._hints.indexOf(sN.SCREEN_TRACK)){var r=t._encoderConfig;Gk().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((function(e){var t,n;Br(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),Gk().supportMinBitrate&&!Br(n=t._hints).call(n,sN.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((function(e){var t,n;Br(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(rk("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}}function WU(e){if("video"===e.media.mediaType){var t=IA();if(t.name===bA.SAFARI||t.os===TA.IOS){var n=e.attributes.extmaps.findIndex((function(e){return/video-orientation/g.test(e.extensionName)}));-1!==n&&e.attributes.extmaps.splice(n,1)}}}function HU(e,t,n){if(t){var r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){var a=r.find((function(e){return NU(e.extensionName)}));if(a){var o=a.extensionName;e.attributes.extmaps.find((function(e){return NU(e.extensionName)}))||e.attributes.extmaps.push({entry:a.entry,extensionName:o}),function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))}))}))}(i,e.attributes.payloads).forEach((function(e){e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){var s=e.attributes.extmaps.findIndex((function(e){return NU(e.extensionName)}));-1!==s&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){var c=r.find((function(e){return kU(e.extensionName)}));if(c){var u=c.extensionName;e.attributes.extmaps.find((function(e){return e.extensionName===u}))||e.attributes.extmaps.push({entry:c.entry,extensionName:u}),function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))}))}))}(i,e.attributes.payloads).forEach((function(e){e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){var d=e.attributes.extmaps.findIndex((function(e){return kU(e.extensionName)}));-1!==d&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"goog-remb"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}}function KU(e,t,n){if(!LA()&&"video"===e.media.mediaType&&t instanceof mL&&("vp9"===n||"vp8"===n)&&("vp8"!==n||rk("SIMULCAST"))&&!("vp9"===n&&rk("ENABLE_SVC")||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)){for(var r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find((function(e){return"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId})),o={semantic:"SIM",ssrcIds:[i.ssrcId]},s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:Ww(i.attributes)}),o.ssrcIds.push(i.ssrcId+s),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+s,attributes:Ww(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,a.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(o)}}function YU(){return qU.apply(this,arguments)}function qU(){return(qU=p(l().mark((function e(){var t,n,r,i,a,o,s,c,u=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=u.length>1&&void 0!==u[1]?u[1]:{},(r=new RTCPeerConnection).addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),e.next=5,r.createOffer();case 5:i=e.sent.sdp,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=LU(n,e,t,"sendonly"),i=LU(n,e,t,"recvonly"),a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(XU(r,i,"videoExtensions",a,o,s),XU(r,i,"videoCodecs",a,o,s),XU(r,i,"audioExtensions",a,o,s),XU(r,i,"audioCodecs",a,o,s),rk("RAISE_H264_BASELINE_PRIORITY")){var c=[],u=[];s.videoCodecs.forEach((function(e,t){var n;if("h264"===(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){var r,i,a=s.videoCodecs[t+1],o=a&&aV(e,a),d=null===(r=e.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"],p=null===(i=e.fmtp)||void 0===i?void 0:i.parameters["packetization-mode"];!d||d!==rk("FIRST_H264_PROFILE_LEVEL_ID")||rk("FIRST_PACKETIZATION_MODE")&&p!==rk("FIRST_PACKETIZATION_MODE")?o?u.push([e,a]):u.push([e]):o?c.push([e,a]):c.push([e])}})),c.length>0&&u.length>0&&(Dk.debug("raising H264 baseline profile priority"),s.videoCodecs.forEach((function(e,t){var n;if("h264"===(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){var r,i,a=aV(e,s.videoCodecs[t+1]),o=c.shift()||u.shift()||[];o.length>0&&(a?(r=s.videoCodecs).splice.apply(r,[t,2].concat(o)):(i=s.videoCodecs).splice.apply(i,[t,1].concat(o)))}})),o.videoCodecs=o.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==rk("FIRST_H264_PROFILE_LEVEL_ID"))})),rk("FILTER_SEND_H264_BASELINE")&&(a.videoCodecs=a.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==rk("FIRST_H264_PROFILE_LEVEL_ID"))}))))}return{send:a,recv:o,sendrecv:s}}(t,n,i),o=a.send,s=a.recv,c=a.sendrecv;try{r.close()}catch(e){}return e.abrupt("return",{send:o,recv:s,sendrecv:c});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zU(){var e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=LU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(XU(e,t,"videoExtensions",n,r,i),XU(e,t,"videoCodecs",n,r,i),XU(e,t,"audioExtensions",n,r,i),XU(e,t,"audioCodecs",n,r,i),rk("RAISE_H264_BASELINE_PRIORITY")){var a=i.videoCodecs.findIndex((function(e){return e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]}));if(-1!==a){var o=i.videoCodecs.findIndex((function(e){return e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()}));if(o<a){Dk.debug("raising H264 baseline profile priority");var s=i.videoCodecs[a];i.videoCodecs.splice(a,1),i.videoCodecs.splice(o,0,s)}-1!==o&&(r.videoCodecs=r.videoCodecs.filter((function(e){return!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])})))}}return{send:n,recv:r,sendrecv:i}}function XU(e,t,n,r,i,a){if("videoExtensions"===n||"audioExtensions"===n){var o=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.entry===t.entry&&e.extensionName===t.extensionName)return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===o.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){var s=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===s.indexOf(t)&&i[n].push(e)}))}}function JU(e){var t,n,r=e.send,i=e.recv,a=e.sendrecv;if(!a){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}return r?((t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(r.audioCodecs,a.audioCodecs),t.videoCodecs=[].concat(r.videoCodecs,a.videoCodecs),t.audioExtensions=[].concat(r.audioExtensions,a.audioExtensions),t.videoExtensions=[].concat(r.videoExtensions,a.videoExtensions)):t=a,i?((n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(i.audioCodecs,a.audioCodecs),n.videoCodecs=[].concat(i.videoCodecs,a.videoCodecs),n.audioExtensions=[].concat(i.audioExtensions,a.audioExtensions),n.videoExtensions=[].concat(i.videoExtensions,a.videoExtensions)):n=a,{send:t,recv:n}}function QU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((function(e){var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((function(e){e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function ZU(e,t,n,r){var i=[];if(e===OM.VIDEO){if(rk("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((function(e){var t;return Br(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===rk("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){var a=[],o=[],s=[],c=[];if(n.videoCodecs.forEach((function(e){var t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"";Br(t).call(t,r)?a.push(e):Br(t).call(t,"vp9")?o.push(e):Br(t).call(t,"vp8")?s.push(e):Br(t).call(t,"h264")&&c.push(e)})),0===a.length){var u="";0!==o.length?(a=o,u="vp9"):0!==s.length?(a=s,u="vp8"):0!==c.length&&(a=c,u="h264"),Dk.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}0!==a.length&&(i=t.videoCodecs.filter((function(e){return a.some((function(t){return t.payloadType===e.payloadType}))})))}if(0===i.length&&(Dk.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),rk("USE_PUB_RTX")||rk("USE_SUB_RTX")){var d=$U(i,t.videoCodecs);i=[].concat(i,d)}}else{i=t.audioCodecs.filter((function(e){var t;return Br(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)}));var p=t.audioCodecs.filter((function(e){var t;return Br(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")}));0===i.length&&(Dk.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((function(e){var t;return Br(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")}))),rk("ENABLE_AUDIO_RED")&&0!==p.length&&(i=[].concat(p,i))}return i}function $U(e,t){var n=e.map((function(e){return e.payloadType.toString()}));return t.filter((function(e){return e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Br(n).call(n,e.fmtp&&e.fmtp.parameters.apt)}))}function eV(e,t,n){return tV.apply(this,arguments)}function tV(){return(tV=p(l().mark((function e(t,n,r){var i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.toString(),a=rV(i,"offer","remote","exchangeSDP"),e.next=3,t.setRemoteDescription({type:"offer",sdp:i});case 3:return e.next=5,t.createAnswer();case 5:if((o=e.sent).sdp){e.next=8;break}throw new Error("cannot get answer sdp");case 8:return s=nV(s=o.sdp,r||{}),null==a||a(s||""),e.next=13,t.setLocalDescription({type:"answer",sdp:s});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nV(e,t,n){var r=pk(e),i=t.useXR;return r.mediaDescriptions.forEach((function(e){var t;e.attributes.mid&&(Array.isArray(n)&&!Br(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&QU(e),i&&Br(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach((function(e){-1===e.rtcpFeedbacks.findIndex((function(e){return"rrtr"===e.type}))&&e.rtcpFeedbacks.push({type:"rrtr"})}))))})),lk(r)}function rV(e,t,n,r){if(rk("SDP_LOGGING"))return Dk.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){rV(e,"answer","local"===n?"remote":"local",r)}:void 0}function iV(e){var t=rk("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((function(t){return Br(e).call(e,t)}))}function aV(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function oV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sV(e,t){return typeof rk(e)===t?rk(e):void 0}var cV={};function uV(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&Dk.debug("install service ".concat(e.name)),cV[e.name]=e}function dV(e){var t=cV[e];if(!t)throw new aw(iw.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function pV(e,t){return dV("DataStream").create(e,t)}function lV(){return dV("InterceptFrame").create()}function hV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hV(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _V=new Map,vV=function(e){function t(t,n){var i,a,o,s;return XC(r(i=e.call(this)||this),"store",void 0),XC(r(i),"joinInfo",void 0),XC(r(i),"key",void 0),XC(r(i),"ntpOffset",0),XC(r(i),"signal",void 0),XC(r(i),"role",void 0),XC(r(i),"inChannelInfo",{joinAt:null,duration:0}),XC(r(i),"spec",void 0),XC(r(i),"_state","DISCONNECTED"),XC(r(i),"_statsCollector",void 0),XC(r(i),"_disconnectedReason",void 0),XC(r(i),"isSignalRecover",!1),XC(r(i),"hasChangeBGPAddress",!1),XC(r(i),"trafficStatsInterval",void 0),XC(r(i),"networkQualityInterval",void 0),XC(r(i),"_joinGatewayStartTime",0),XC(r(i),"_signalTimeout",!1),XC(r(i),"_clientRoleOptions",void 0),XC(r(i),"_isProactiveJoin",!1),i.store=t,i.spec=n,i.signal=i.store.useP2P?(a={spec:fV(fV({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},null===(o=(s=dV("P2PChannel")).createSubmodule)||void 0===o?void 0:o.call(s,a)):new pU(fV(fV({},n),{},{retryConfig:n.websocketRetryConfig}),t),i._statsCollector=n.statsCollector,i.role=n.role||"audience",i._clientRoleOptions=n.clientRoleOptions,i.handleSignalEvents(),i}i(t,e);var n=t.prototype;return n.join=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.joinGatewayStart(),"disabled"!==t.cloudProxyServer&&(this.hasChangeBGPAddress=!0),i=Date.now(),(a=_V.get(t.cname))||(a=new Map,_V.set(t.cname,a)),this._isProactiveJoin=!0,!a.has(t.uid)){e.next=6;break}throw o=new Bk(iw.UID_CONFLICT),Fk.joinGateway(t.sid,{lts:i,succ:!1,ec:o.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),o;case 6:return a.set(t.uid,!0),this.joinInfo=t,this.key=n,s=0,this.joinGatewayStartTime=i,c=t.proxyServer,e.prev=10,Dk.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s)),u=t.gatewayAddrs.map((function(e){var n=e.address.split(":"),r={host:n[0],port:n[1]};return t.proxyServer&&(r.proxy=t.proxyServer),r})),e.next=15,this.signal.init(u);case 15:s=e.sent.uid,Dk.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime)),e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),Dk.error("[".concat(this.store.clientId,"] User join failed"),e.t0.toString()),Fk.joinGateway(t.sid,{lts:i,succ:!1,ec:(null===(d=e.t0.data)||void 0===d?void 0:d.desc)||e.t0.code,errorMsg:e.t0.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),a.delete(t.uid),this.signal.close(),e.t0;case 22:return e.abrupt("return",(this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Dk.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((function(){p.updateTrafficStats().catch((function(e){Dk.warning("[".concat(p.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((function(){navigator&&void 0!==navigator.onLine&&!navigator.onLine?p.emit(mM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):p._signalTimeout?p.emit(mM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===p.state&&p._statsCollector.trafficStats?p.emit(mM.NETWORK_QUALITY,{uplinkNetworkQuality:gU(p._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:gU(p._statsCollector.trafficStats.B_dnq)}):p.emit(mM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),s));case 23:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.leave=function(){var e=p(l().mark((function e(){var t,n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],n=r.length>1?r[1]:void 0,"DISCONNECTED"===this.state){e.next=14;break}if(n!==Aw.FALLBACK&&(this.state="DISCONNECTING"),e.prev=3,e.t0=t||this.signal.connectionState!==Xx.CONNECTED,e.t0){e.next=8;break}return e.next=8,function(e,t){return zl.race([e,$w(3e3)])}(this.signal.request(Qx.LEAVE,void 0,!0));case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(3),Dk.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e.t1);case 13:this.signal.close(n),n!==Aw.FALLBACK&&(this.state="DISCONNECTED"),this.reset();case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),n.publish=function(){var e=p(l().mark((function e(t,n,r){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 2:return i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:rk("PUB_EXTEND"),twcc:!!rk("PUBLISH_TWCC"),rtx:!!rk("USE_PUB_RTX")},e.prev=3,e.next=6,this.signal.request(Qx.PUBLISH,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==zx.ERR_PUBLISH_REQUEST_INVALID){e.next=16;break}return Dk.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),e.t0.toString()),e.next=15,this.tryUnpubBeforeRepub(t,n);case 15:return e.abrupt("return",this.publish(t,n,!1));case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.publishDataChannel=function(){var e=p(l().mark((function e(t,n,r){var i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 2:return a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:null!==(i=n.maxRetransmits)&&void 0!==i?i:10,channel_id:n.channelId,metadata:n.metadata},e.prev=3,e.next=6,this.signal.request(Qx.PUBLISH_DATASTREAM,a,!0);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==zx.ERR_PUBLISH_REQUEST_INVALID){e.next=15;break}return Dk.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),e.t0.toString()),e.next=14,this.tryUnpubDataChannelBeforeRepub(t,n);case 14:return e.abrupt("return",this.publishDataChannel(t,n,!1));case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.unpublish=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new Bk(iw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,this.signal.request(Qx.UNPUBLISH,{stream_id:n,ortc:t},!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Dk.warning("[".concat(this.store.clientId,"] unpublish warning: "),e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),n.unpublishDataChannel=function(){var e=p(l().mark((function e(t){var n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new Bk(iw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,zl.all(t.map((function(e){return n.signal.request(Qx.UNPUBLISH_DATASTREAM,{channel_id:e},!0)})));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Dk.warning("unpublish datachannels warning: ",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),n.presubscribe=function(){var e=p(l().mark((function e(t,n,r){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));case 2:return i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!rk("SUBSCRIBE_TWCC"),rtx:!!rk("USE_SUB_RTX")||void 0,extend:rk("SUB_EXTEND"),svc:Array.isArray(rk("SVC"))&&0!==rk("SVC").length?rk("SVC"):void 0},e.prev=3,e.next=6,this.signal.request(Qx.PRE_SUBSCRIBE,i,!0);case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==zx.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=13;break}return e.abrupt("return",(Dk.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),e.t0.toString()),this.presubscribe(t,n,!1)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.subscribe=function(){var e=p(l().mark((function e(t,n,r){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));case 2:return i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!rk("SUBSCRIBE_TWCC"),rtx:!!rk("USE_SUB_RTX"),extend:rk("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(rk("SVC"))&&0!==rk("SVC").length?rk("SVC"):void 0},e.prev=3,e.next=6,this.signal.request(Qx.SUBSCRIBE,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==zx.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return Dk.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),e.t0.toString()),e.next=15,this.tryUnsubBeforeResub(t,n);case 15:return e.next=17,this.subscribe(t,n,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.subscribeDataChannel=function(){var e=p(l().mark((function e(t,n,r){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));case 2:return i={uid:t,stream_id:n.id,channel_id:n.datachannelId},e.prev=3,e.next=6,this.signal.request(Qx.SUBSCRIBE_DATASTREAM,i,!0);case 6:return e.abrupt("return",void e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==zx.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return Dk.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),e.t0.toString()),e.next=15,this.tryUnsubDataChannelBeforeResub(t,n);case 15:return e.next=17,this.subscribeDataChannel(t,n,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.subscribeAll=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));case 2:return r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!rk("USE_SUB_RTX"),twcc:!!rk("SUBSCRIBE_TWCC"),svc:Array.isArray(rk("SVC"))&&0!==rk("SVC").length?rk("SVC"):void 0},e.prev=3,e.next=6,this.signal.request(Qx.SUBSCRIBE_STREAMS,r,!0);case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!n||!e.t0.data||e.t0.data.code!==zx.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return Dk.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),e.t0.toString()),e.next=15,this.tryMassUnsubBeforeResub(t);case 15:return e.next=17,this.subscribeAll(t,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setVideoProfile=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=function(e){if(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width){var t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&((t=t.exact||t.ideal||t.max||t.min||0)||(i=!1)),"number"!=typeof n&&((n=n.exact||n.ideal||n.max||n.min||0)||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}}(t))){e.next=3;break}return e.abrupt("return",this.signal.request(Qx.SET_VIDEO_PROFILE,n));case 3:Dk.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Dk.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),n.unsubscribeDataChannel=function(){var e=p(l().mark((function e(t,n){var r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new Bk(iw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,zl.all(t.map((function(e){return r.signal.request(Qx.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:n},!0)})));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Dk.warning("unsubscribeDataChannel warning: ",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),n.massUnsubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNSUBSCRIBE_STREAMS,t,!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Dk.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),n.reconnectPC=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iceParameters,r=t.dtlsParameters,i=t.rtpCapabilities,e.next=3,this.signal.request(Qx.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0);case 3:return e.t0=e.sent,e.t1=this.getCurrentGatewayAddress(),e.abrupt("return",{gatewayEstablishParams:e.t0,gatewayAddress:e.t1});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getGatewayInfo=function(){return this.signal.request(Qx.GATEWAY_INFO)},n.renewToken=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.RENEW_TOKEN,t);case 2:this.key=t.token;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.updateClientRole=function(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),rk("CLIENT_ROLE_OPTIONS")&&(Dk.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(rk("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},rk("CLIENT_ROLE_OPTIONS"))),this.role=e},n.setClientRole=function(){var e=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&(this._clientRoleOptions=Object.assign({},n)),rk("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},rk("CLIENT_ROLE_OPTIONS")),Dk.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(rk("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"===this.state){e.next=2;break}return e.abrupt("return",void(this.role=t));case 2:return i=0,"audience"===t?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,e.next=6,this.signal.request(Qx.SET_CLIENT_ROLE,{role:t,level:i,delay:r,client_ts:Date.now()});case 6:this.role=t;case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setRemoteVideoStreamType=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setDefaultRemoteVideoStreamType=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.DEFAULT_VIDEO_STREAM,{stream_type:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setStreamFallbackOption=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.pickSVCLayer=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setRTM2Flag=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.SET_RTM2_FLAG,{rtm2_flag:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.sendExtensionMessage=function(){var e=p(l().mark((function e(t,n,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.store.useP2P){e.next=2;break}return e.abrupt("return",this.signal.sendExtensionMessage(t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.getInChannelInfo=function(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),fV({},this.inChannelInfo)},n.getGatewayVersion=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.GATEWAY_INFO);case 2:return e.abrupt("return",e.sent.version);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reset=function(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){var e=_V.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)},n.updateTurnConfigFromSignal=function(){if(this.joinInfo){var e=function(e){var t;return(t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/))?{username:JO.username,password:JO.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(fV(fV({},JO),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}},n.updateTrafficStats=function(){var e=p(l().mark((function e(){var t,n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.signal.request(Qx.TRAFFIC_STATS,void 0,!0);case 4:(t=e.sent).timestamp=Date.now(),null!=t.ntp_offset&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((function(e){var t=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find((function(t){return t.peer_uid===e.peer_uid}));t&&t.B_st!==e.B_st&&Gw((function(){n.emit(mM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getJoinMessage=function(e){var t;if(!this.joinInfo||!this.key)throw new Bk(iw.UNEXPECTED_ERROR,"can not generate join message, no join info");var n,r=Object.assign({},this.joinInfo.apResponse),i=rk("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(mM.UPDATE_GATEWAY_CONFIG),n=this.store.clientId,Br(ox).call(ox,n)||ox.push(n);var a=!(LA()||UA(87)||Hk())&&"boolean"==typeof rk("ENABLE_PRE_SUB")&&rk("ENABLE_PRE_SUB"),o=!Hk()&&sV("ENABLE_PREALLOC_PC","boolean"),s=function(){try{var e=rk("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oV(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}catch(e){return Dk.debug("handle gateway attributes failed: ",e),{}}}(),c=MA(87)||function(){var e=IA();if(e.name!==bA.SAFARI||!e.browserVersion)return!1;var t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}(),u=fV({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:qO,browser:navigator.userAgent,process_id:rk("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:rk("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:fV(fV({enableEncodedTransform:!!rk("ENABLE_AUDIO_METADATA")&&c||!!rk("ENABLE_AUDIO_TOPN")&&VA(bA.CHROME,87,116)||void 0,enableAudioMetadata:!!rk("ENABLE_AUDIO_METADATA")&&c,enableAudioPts:!!rk("ENABLE_AUDIO_PTS_METADATA")&&c,topnSmoothLevel:rk("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:rk("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:rk("TOPN_SWITCH_HOLD_MS"),topnAudioGain:rk("TOPN_AUDIO_GAIN"),enablePublishedUserList:rk("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:rk("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:sV("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:sV("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:sV("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===rk("USE_PUB_RTX")||!0===rk("USE_SUB_RTX")||void 0,disableFEC:rk("DISABLE_FEC"),enableNTPReport:!!rk("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!rk("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!rk("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:sV("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!rk("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!rk("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:sV("USE_XR","boolean"),enableLossbasedBwe:sV("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!rk("ENABLE_AUT_CC")||void 0,enableCCFallback:sV("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:a?sV("PRE_SUB_NUM","number"):void 0,enablePubTWCC:sV("PUBLISH_TWCC","boolean"),enableSubTWCC:sV("SUBSCRIBE_TWCC","boolean"),enablePubRTX:sV("USE_PUB_RTX","boolean"),enableSubRTX:sV("USE_SUB_RTX","boolean"),enableSubSVC:rk("ENABLE_SVC")?rk("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(rk("SVC"))&&0!==rk("SVC").length?rk("SVC"):void 0,enableSvcExtended:rk("ENABLE_SVC")&&Array.isArray(rk("SVC_EXTENDED"))&&0!==rk("SVC_EXTENDED").length?rk("SVC_EXTENDED"):void 0},s),{},{audioDuplicate:sV("ENABLE_AUDIO_RED","boolean")?null!==(t=sV("AUDIO_DUPLICATE_NUM","number"))&&void 0!==t?t:2:void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(u.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(u.aes_mode=this.joinInfo.aesmode,rk("ENCRYPT_AES")?(u.aes_secret=this.joinInfo.aespassword,u.aes_encrypt=!0):u.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(u.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(u.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(u.default_video_stream=this.joinInfo.defaultVideoStream),u},n.getRejoinMessage=function(){if(!this.joinInfo)throw new Bk(iw.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}},n.handleSignalEvents=function(){var e=this;this.signal.on(Jx.WS_RECONNECT_CREATE_CONNECTION,(function(t){e.joinGatewayStartTime=Date.now()})),this.signal.on(Jx.WS_RECONNECTING,(function(t){e.joinInfo&&Fk.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:t||Dw.NETWORK_ERROR}),e.joinInfo&&(e.state="RECONNECTING",Fk.sessionInit(e.joinInfo.sid,{lts:(new Date).getTime(),extend:e.isSignalRecover?{recover:!0}:{rejoin:!0},cname:e.joinInfo.cname,appid:e.joinInfo.appId,mode:e.spec.mode,stringUid:e.joinInfo.stringUid,channelProfile:"live"===e.spec.mode?1:0,channelMode:0,lsid:e.joinInfo.sid,clientRole:"audience"===e.role?2:1,buildFormat:1}),e.isSignalRecover=!1,e.joinGatewayStartTime=Date.now())})),this.signal.on(Jx.WS_CLOSED,(function(t){var n;switch(t){case Aw.LEAVE:n=Dw.LEAVE;break;case Aw.UID_BANNED:case Aw.IP_BANNED:case Aw.CHANNEL_BANNED:case Aw.SERVER_ERROR:n=Dw.SERVER_ERROR;break;case Aw.FALLBACK:n=Dw.FALLBACK;break;case Aw.LICENSE_MISSING:case Aw.LICENSE_EXPIRED:case Aw.LICENSE_MINUTES_EXCEEDED:case Aw.LICENSE_PERIOD_INVALID:case Aw.LICENSE_MULTIPLE_SDK_SERVICE:case Aw.LICENSE_ILLEGAL:case Aw.TOKEN_EXPIRE:n=t;break;default:n=Dw.NETWORK_ERROR}Dk.debug("[".concat(e.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Dw.NETWORK_ERROR)),e.joinInfo&&Fk.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:t===Aw.LEAVE?1:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:n}),e._disconnectedReason=t,t!==Aw.FALLBACK&&(e.state="DISCONNECTED"),e.reset()})),this.signal.on(Jx.WS_CONNECTED,(function(){if(e.updateTurnConfigFromSignal(),e.state="CONNECTED",e.joinInfo){if("audience"===e.role){var t=rk("CLIENT_ROLE_OPTIONS")||e._clientRoleOptions;t&&(t.level||t.delay)&&(Dk.debug("[".concat(e.store.clientId,"] patch to send set client role, role: ").concat(e.role,", mode: ").concat(e.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),e.setClientRole(e.role,t))}if(Fk.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!0,ec:null,vid:e.joinInfo.vid,addr:e.signal.url,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,isProxy:!!e.joinInfo.proxyServer,signalChannel:"0",preload:e.joinInfo.preload,isABTestSuccess:e.store.isABTestSuccess}),e._isProactiveJoin=!1,e.joinInfo.useLocalAccessPoint&&1===e.joinInfo.setLocalAPVersion){var n=e.signal.url&&e.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void Dk.error("[".concat(e.store.clientId,"] set local access point after joined failed: ").concat(n));nk("EVENT_REPORT_DOMAIN",n[1]),nk("EVENT_REPORT_BACKUP_DOMAIN",n[1]),nk("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}})),this.signal.on($x.ON_UPLINK_STATS,(function(t){e._statsCollector.updateUplinkStats(t)})),this.signal.on(Jx.REQUEST_RECOVER,(function(t,n,r){if(!e.joinInfo)return r(new Bk(iw.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(e.joinInfo.multiIP=t,e.hasChangeBGPAddress=!0),e.isSignalRecover=!0,xw(e,mM.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)})),this.signal.on(Jx.REQUEST_JOIN_INFO,p(l().mark((function t(n,r,i){var a,o,s,c,u,d,p,h,f;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.updateTurnConfigFromSignal(),!e.store.useP2P){t.next=2;break}return t.abrupt("return",void n(e.getJoinMessage({ortc:{}})));case 2:return o=Ww(null===(a=e.joinInfo)||void 0===a?void 0:a.turnServer),rk("NEW_TURN_MODE")&&o&&(s=o.servers,c=o.serversFromGateway,u=e.signal.currentURLIndex,s.length>0&&(s=[s[u%s.length]],o.servers=s),Array.isArray(c)&&c.length>0&&(c=[c[0]],o.serversFromGateway=c),Dk.debug("[".concat(e.store.clientId,"] use single turn, use turn server index: ").concat(u))),t.next=6,xw(e,mM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:o});case 6:d=t.sent,p=d.iceParameters,h=d.dtlsParameters,f=d.rtpCapabilities;try{n(e.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:h,rtpCapabilities:f,version:"2"}}))}catch(e){r(e)}case 11:case"end":return t.stop()}}),t)})))),this.signal.on(Jx.REQUEST_REJOIN_INFO,(function(t){t(e.getRejoinMessage())})),this.signal.on(Jx.REPORT_JOIN_GATEWAY,(function(t,n){if(e.joinInfo){var r,i,a="";t instanceof Bk?(r=(null===(i=t.data)||void 0===i?void 0:i.desc)||t.code,a=t.message):r=t,Fk.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!1,ec:r,errorMsg:a,addr:n,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,isProxy:!!e.joinInfo.proxyServer,signalChannel:"0",preload:e.joinInfo.preload})}})),this.signal.on(Jx.IS_P2P_DISCONNECTED,(function(t){t(Vw(e,mM.IS_P2P_DISCONNECTED))})),this.signal.on(Jx.DISCONNECT_P2P,(function(){e.emit(mM.DISCONNECT_P2P)})),this.signal.on(Jx.REQUEST_SUCCESS,(function(){e._signalTimeout=!1})),this.signal.on(Jx.REQUEST_TIMEOUT,(function(){e._signalTimeout=!0})),this.signal.on(Jx.JOIN_RESPONSE,(function(t){var n=e.getCurrentGatewayAddress();e.emit(mM.JOIN_RESPONSE,t,n)})),this.signal.on(Jx.PRE_CONNECT_PC,p(l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.joinInfo&&(e.updateTurnConfigFromSignal(),n=e.getCurrentGatewayAddress(),r=rk("FINGERPRINT")||e.joinInfo.apResponse.addresses[e.signal.currentURLIndex].fingerprint,n&&r&&(i=VU(n),e.emit(mM.PRE_CONNECT_PC,{candidates:i,fingerprint:r})));case 1:case"end":return t.stop()}}),t)})))),this.signal.on(Jx.RECOVER_NOTIFICATION,(function(t){e.joinInfo&&"string"==typeof rk("AP_REQUEST_DETAIL")&&(e.joinInfo.apRequestDetail="".concat(rk("AP_REQUEST_DETAIL"),";").concat(t))}))},n.tryUnsubBeforeResub=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Dk.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),n.tryUnsubDataChannelBeforeResub=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNSUBSCRIBE,{stream_id:n.id},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Dk.warning("unsubscribe datachannel warning",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),n.tryUnpubBeforeRepub=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNPUBLISH,{stream_id:t,ortc:n},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Dk.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),n.tryUnpubDataChannelBeforeRepub=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(Qx.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),Dk.warning("unpublish datastream warning: ",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),n.tryMassUnsubBeforeResub=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={users:t.map((function(e){return{stream_id:e.stream_id,stream_type:e.stream_type}}))},e.prev=1,e.next=4,this.signal.request(Qx.UNSUBSCRIBE_STREAMS,n,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),n.muteLocal=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===EM.Audio}))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(Qx.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteLocal=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===EM.Audio}))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(Qx.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.muteRemote=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t===OM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n},e.prev=1,e.next=4,this.signal.request(Qx.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteRemote=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t===OM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n},e.prev=1,e.next=4,this.signal.request(Qx.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.uploadWRTCStats=function(e){this.signal.uploadWRTCStats(e)},n.upload=function(e,t){this.signal.upload(e,t)},n.getSignalRTT=function(){return this.signal.rtt},n.restartICE=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t},e.prev=1,e.next=4,this.signal.request(Qx.RESTART_ICE,n,!0);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),Dk.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),n.reconnect=function(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||Dw.P2P_FAILED)},n.getCurrentGatewayAddress=function(){var e,t;if(!rk("GATEWAY_WSS_ADDRESS"))return rk("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(Dk.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0},n.setPublishAudioFilterEnabled=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(Qx.SET_PARAMETER,{enablePublishAudioFilter:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),v(t,[{key:"state",get:function(){return this._state},set:function(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(mM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(mM.CONNECTION_STATE_CHANGE,e,t)}}},{key:"joinGatewayStartTime",get:function(){return this._joinGatewayStartTime},set:function(e){Dk.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}}]),t}(gw);function EV(e,t,n,r){return new zl((function(i,a){t.timeout=t.timeout||rk("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Qw(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?Zw(t.data):Qw(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,_A.request(t).then((function(e){"string"==typeof e.data?Qw(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:Qw(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((function(e){_A.isCancel(e)?a(new Bk(iw.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new Bk(iw.NETWORK_TIMEOUT,e.message)):e.response?a(new Bk(iw.NETWORK_RESPONSE_ERROR,e.response.status)):a(new Bk(iw.NETWORK_ERROR,e.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof u&&u];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in n))break e;n=n[o]}(t=t(a=n[e=e[e.length-1]]))!=a&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<n.length;a++){var s=i[n[a]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;e:{var d={};try{d.__proto__={a:!0},c=d.a;break e}catch(e){}c=!1}n=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var p=n;function l(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function _(e){this.g=new l,this.G=e}function v(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var a=i.value}catch(t){return e.g.j=null,e.g.s(t),E(e)}return e.g.j=null,r.call(e.g,a),E(e)}function E(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function m(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?v(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),E(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function S(e,t){return t=new m(new _(t)),p&&e.prototype&&p(t,e.prototype),t}if(l.prototype.o=function(e){this.v=e},l.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},l.prototype.return=function(e){this.l={return:e},this.h=this.u},_.prototype.o=function(e){return h(this.g),this.g.j?v(this,this.g.j.next,e,this.g.o):(this.g.o(e),E(this))},_.prototype.s=function(e){return h(this.g),this.g.j?v(this,this.g.j.throw,e,this.g.o):(this.g.s(e),E(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var g=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},T=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},R=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},C="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,y=C.FormData,I=C.XMLHttpRequest&&C.XMLHttpRequest.prototype.send,A=C.Request&&C.fetch,w=C.navigator&&C.navigator.sendBeacon,O=C.Element&&C.Element.prototype,k=C.Symbol&&Symbol.toStringTag;k&&(Blob.prototype[k]||(Blob.prototype[k]="Blob"),"File"in C&&!File.prototype[k]&&(File.prototype[k]="File"));try{new File([],"")}catch(e){C.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),k&&Object.defineProperty(e,k,{value:"File"}),e}}var N=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D=function(e){this.i=[];var t=this;e&&g(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];g(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?g(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?T(e.value):e.value,t.append(e.name,n))}))};if((e=D.prototype).append=function(e,t,n){R(arguments,2),this.i.push(b(e,t,n))},e.delete=function(e){R(arguments,1);var t=[];e=String(e),g(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return S(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){R(arguments,1);for(var n=s(this),r=n.next();!r.done;r=n.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){R(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){R(arguments,1);var t=[];return e=String(e),g(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){R(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return S(e,(function(e){if(1==e.h&&(t=s(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,f(e,s(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){R(arguments,2),e=String(e);var r=[],i=b(e,t,n),a=!0;g(this.i,(function(t){t[0]===e?a&&(a=!r.push(i)):r.push(t)})),a&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,a=this;return S(e,(function(e){if(1==e.h&&(t=s(a),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=s(r)).next(),f(e,i.next().value));n=t.next(),e.h=2}))},D.prototype._asNative=function(){for(var e=new y,t=s(this),n=t.next();!n.done;n=t.next()){var r=s(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},D.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+N(T(r))+'"\r\n\r\n'+T(e)+"\r\n"):t.push(n+N(T(r))+'"; filename="'+N(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},D.prototype[Symbol.iterator]=function(){return this.entries()},D.prototype.toString=function(){return"[object FormData]"},O&&!O.matches&&(O.matches=O.matchesSelector||O.mozMatchesSelector||O.msMatchesSelector||O.oMatchesSelector||O.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),k&&(D.prototype[k]="FormData"),I){var P=C.XMLHttpRequest.prototype.setRequestHeader;C.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},C.XMLHttpRequest.prototype.send=function(e){e instanceof D?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),I.call(this,e)):I.call(this,e)}}A&&(C.fetch=function(e,t){return t&&t.body&&t.body instanceof D&&(t.body=t.body._blob()),A.call(this,e,t)}),w&&(C.navigator.sendBeacon=function(e,t){return t instanceof D&&(t=t._asNative()),w.call(this,e,t)}),C.FormData=D}}();var mV=function(){var e=rk("AREAS");return 0===e.length&&e.push(TM.GLOBAL),ui(e).call(e,(function(e,t,n){var r=SV(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},SV=function(e){return e===TM.OVERSEA?"".concat(RM.ASIA,",").concat(RM.EUROPE,",").concat(RM.AFRICA,",").concat(RM.NORTH_AMERICA,",").concat(RM.SOUTH_AMERICA,",").concat(RM.OCEANIA):RM[e]},gV=function(e){var t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((function(e){var n=CM[e],r=Object.keys(n);r&&r.map((function(e){"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},TV={GLOBAL:{ASIA:[TM.CHINA,TM.JAPAN,TM.INDIA,TM.KOREA,TM.HKMC],EUROPE:[],NORTH_AMERICA:[TM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},bV=Object.keys(TV[TM.GLOBAL]),RV=[TM.CHINA,TM.NORTH_AMERICA,TM.EUROPE,TM.ASIA,TM.JAPAN,TM.INDIA,TM.OCEANIA,TM.SOUTH_AMERICA,TM.AFRICA,TM.KOREA,TM.HKMC,TM.US],CV=function(e,t){var n,r,i=[];if(Br(e).call(e,TM.GLOBAL)){var a=[TM.GLOBAL,TM.OVERSEA],o=Object.keys(CM);if(t===TM.GLOBAL)throw new Bk(iw.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===TM.CHINA)i=[TM.OVERSEA];else if(r=t,Br(bV).call(bV,r)){var s=(n=t,TV[TM.GLOBAL][n]||[]),c=[].concat(a,[t],s);i=o.filter((function(e){return!Br(c).call(c,e)}))}else if(function(e){var t=!1;return bV.forEach((function(n){var r;Br(r=TV[TM.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){var u=function(e){var t;return bV.forEach((function(n){var r;Br(r=TV[TM.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),d=[].concat(a,[u,t]);i=o.filter((function(e){return!Br(d).call(d,e)}))}else i=e;i=function(e){var t=[];return RV.forEach((function(n){Br(e).call(e,n)&&t.push(n)})),t.concat(e.filter((function(e){return!Br(RV).call(RV,e)})))}(i)}else i=e;return i};function yV(e){var t,n;if(!e&&Br(t=rk("AREAS")).call(t,TM.EXTENSIONS))return Dk.debug("update area from ap : reset"),void IV(rx,!0);if(Br(n=rk("AREAS")).call(n,TM.GLOBAL)&&e){var r=CM.EXTENSIONS;r&&(r={CODE:SV(TM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Dk.debug("update area from ap success: ".concat(e,",config is "),r),nk("AREAS",[TM.EXTENSIONS],!0),Object.keys(r).map((function(e){nk(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}}function IV(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Fk.reportApiInvoke(null,{name:Rw.SET_AREA,options:e,tag:Cw.TRACER});try{var r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((function(e){if(!Br(bM).call(bM,e))throw new Bk(iw.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){var i=e.areaCode,a=e.excludedArea;if(!i)throw new Bk(iw.INVALID_PARAMS,"area code is needed");var o=i;"string"==typeof i&&(o=[i]),r=a?CV(o,a):o}if(!t){if(ak.AREAS){var s=new Bk(iw.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void Dk.warning("setArea is prohibited because of config-distribute")}if(Br(r).call(r,TM.GLOBAL)&&rk("AREAS")===TM.EXTENSIONS){var c=new Bk(iw.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void Dk.warning("setArea is prohibited because of ap extensions")}}nk("AREAS",r,t);var u=gV(r);Object.keys(u).map((function(e){nk(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?u[e][0]:u[e])})),Dk.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function AV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AV(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var OV=1;function kV(e,t,n,r,i){OV+=1;var a,o,s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:OV,requestId:OV,version:qO,cname:n.cname},c={service_name:t,json_body:JSON.stringify(s)},u=e[0];return mO(p(l().mark((function e(){var n,i,s,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),e.next=3,EV(u,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});case 3:if(n=e.sent,o=Date.now()-a,0===n.code){e.next=7;break}throw i=new Bk(iw.UNEXPECTED_RESPONSE,"live streaming ap error, code"+n.code,{retry:!0,responseTime:o}),Dk.error(i.toString()),i;case 7:if(200===(s=JSON.parse(n.json_body)).code){e.next=11;break}throw d=new Bk(iw.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(s.code,", reason: ").concat(s.reason),{code:s.code,responseTime:o}),Dk.error(d.toString()),d;case 11:if(s.servers&&0!==s.servers.length){e.next=14;break}throw p=new Bk(iw.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:s.code,responseTime:o}),Dk.error(p.toString()),p;case 14:return h=function(e,t){return{addressList:e.servers.map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat(rk("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))})),workerToken:e.workerToken,vid:e.vid}}(s,t),e.abrupt("return",(rk("LIVE_STREAMING_ADDRESS")&&(h.addressList=rk("LIVE_STREAMING_ADDRESS")instanceof Array?rk("LIVE_STREAMING_ADDRESS"):[rk("LIVE_STREAMING_ADDRESS")]),wV(wV({},h),{},{responseTime:o})));case 16:case"end":return e.stop()}}),e)}))),(function(r,i){return Fk.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:o,serverIp:e[i%e.length]}),!1}),(function(r,i){return Fk.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:o,serverIp:e[i%e.length]}),!!(r.code!==iw.OPERATION_ABORTED&&r.code!==iw.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(u=e[(i+1)%e.length],!0)}),i)}var NV=1;function DV(e,t,n,r){var i,a=e.url,o=e.areaCode,s=t.clientId,c=t.sid,u=Date.now(),d=t.role,h=UV(t,o,[hU.CHOOSE_SERVER]),f=h[0],_=h[1],v=Fw.networkState;return mO(p(l().mark((function e(){var o,s,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=v&&Fw.networkState===Pw.OFFLINE&&Fw.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,zl.race([Fw.onlineWaiter,eO(r&&r.maxRetryTimeout||vO.maxRetryTimeout)]);case 4:return v=Fw.networkState,e.next=7,EV(a,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return o=e.sent,s=o.data,d=o.headers,i="1"===d.http3?1:-1,Fk.reportResourceTiming(a,c),LV(s,a,t,u,[hU.CHOOSE_SERVER],i),p=TU(s,hU.CHOOSE_SERVER),e.abrupt("return",(xV(p),EU(p,a)));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e&&Fk.joinChooseServer(c,{role:d,lts:u,succ:!0,csAddr:a,opid:_,serverList:e.gatewayAddrs.map((function(e){return e.address})),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[hU.CHOOSE_SERVER].toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1}),(function(e){return e.code!==iw.OPERATION_ABORTED&&(e.code===iw.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Fk.joinChooseServer(c,{role:d,lts:u,succ:!1,csAddr:a,serverList:null,opid:_,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[hU.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:i,corssRegionTagReq:t.apRequestDetail}),Dk.warning("[".concat(s||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),e),!0))}),r)}function PV(e,t,n,r){var i,a,o=e.url,s=e.areaCode,c=e.serviceIds,u=Date.now(),d=t.role,h=UV(t,s,c),f=h[0],_=h[1];return mO(p(l().mark((function e(){var s,d,p,h,_;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a&&Fw.networkState===Pw.OFFLINE&&Fw.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,zl.race([Fw.onlineWaiter,eO(r&&r.maxRetryTimeout||vO.maxRetryTimeout)]);case 4:return a=Fw.networkState,e.next=7,EV(o,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return s=e.sent,d=s.data,p=s.headers,i="1"===p.http3?1:-1,Fk.reportResourceTiming(o,t.sid),LV(d,o,t,u,c,i),h=TU(d,hU.CHOOSE_SERVER),_=TU(d,"proxy5"===t.cloudProxyServer?hU.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?hU.CLOUD_PROXY:hU.CLOUD_PROXY_FALLBACK),e.abrupt("return",(xV(h),{gatewayInfo:EU(h,o),proxyInfo:_,url:o}));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e.gatewayInfo&&Fk.joinChooseServer(t.sid,{role:d,lts:u,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((function(e){return e.address})),ec:null,opid:_,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&Fk.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((function(e){return e.ip})).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1}),(function(e){return e.code!==iw.OPERATION_ABORTED&&(e.code===iw.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Fk.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:a})}),Dk.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))}),r)}var LV=function(e,t,n,r,i,a){var o=n.sid,s=n.clientId,c=n.cloudProxyServer,u=[],d=function(s){4096===s.flag?Fk.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a,corssRegionTagReq:n.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||Fk.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((function(t){var n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)Dk.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{var r={error:new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};u.push(r),d(r)}if(0!==n){var i=XM(n),a={error:new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?Dk.warning(a.error.toString()):u.push(a),d(a)}})),u.length)throw Dk.warning("[".concat(s||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)})).join(" | "))),new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,u.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message)})).join(" | "),{retry:!!u.find((function(e){return e.error.data.retry})),csIp:e.detail[502],desc:[].concat(new Set(u.map((function(e){var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((function(e){return!!e}))))})},xV=function(e){var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(rk("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?yV(e.detail[23].toLowerCase()):yV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19]))for(var a=e.detail[19],o=null==a?void 0:a.split(";"),s=0;s<o.length;s++){var c,u=mS(c=o[s]).call(c);e.addresses[s]&&o&&(e.addresses[s].fingerprint=u)}if(rk("GATEWAY_ADDRESS")&&rk("GATEWAY_ADDRESS").length>0){Dk.debug("assign gateway address to",rk("GATEWAY_ADDRESS"));var d=rk("GATEWAY_ADDRESS").map((function(t){var n,r,i=null!==(n=null===(r=e.addresses.find((function(e){return e.ip===t.ip&&e.port===t.port})))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=d}},MV=function(e,t){if(e.response_body&&e.response_body.length){var n=e.response_body[0];if(0!==n.buffer.code){var r=XM(n.buffer.code);throw new Bk(iw.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw Dk.debug("update ticket request received ap response without response body:",t),new Bk(iw.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},UV=function(e,t,n){var r=Math.floor(Math.random()*Math.pow(10,12)),i="host"===e.role?"1":"audience"===e.role?"2":void 0,a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:wV(wV(wV({6:e.stringUid,11:t,12:rk("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};a.request_bodies.forEach((function(t){e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));var o=new FormData;return o.append("request",JSON.stringify(a)),[o,r]},VV=function(e,t){var n=Math.floor(Math.random()*Math.pow(10,12)),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((function(e){return{ip:e.ip,port:e.port}}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]},FV=0;function BV(e){return zl.all(e.map((function(e){return e.then((function(e){throw e}),(function(e){return e}))}))).then((function(e){throw e}),(function(e){return e}))}var jV=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fragementLength,r=t.referenceList,i=t.asyncMapHandler,a=t.allFailedhandler,o=t.promisesCollector,s=0,c=n,d=0,h=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e=s*c,t=e+c;return r.slice(e,t).map(i)}(),o&&o.push.apply(o,t),e.prev=2,e.next=5,BV(t);case 5:u=e.sent,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(2),s++,(d+=c)>=r.length){e.next=14;break}return e.next=13,h();case 13:return e.abrupt("return",void e.sent);case 14:a(e.t0);case 15:t.forEach((function(e){return e.cancel()}));case 16:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),e.next=6,h();case 6:return e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),GV=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.referenceList,r=t.asyncMapHandler,i=t.closeFn,a=n.length,o=0,s=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r(n.shift()),e.prev=1,e.next=4,t;case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!(++o>=a||null!=i&&i(e.t0))){e.next=11;break}throw e.t0;case 11:return e.abrupt("return",s());case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",s());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function WV(e,t,n,r){return HV.apply(this,arguments)}function HV(){return(HV=p(l().mark((function e(t,n,r,i){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p(l().mark((function e(t,n,r,i){var a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,o=[],s=function(){var e=p(l().mark((function e(){var a,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=rk("WEBCS_DOMAIN").slice(0,rk("AJAX_REQUEST_CONCURRENT")).map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:mV()}})),s=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=4,jV({fragementLength:rk("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return Dk.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),DV(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});case 4:return c=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=p(l().mark((function e(){var s,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eO(1e3);case 2:if(null===a){e.next=4;break}return e.abrupt("return",a);case 4:return s=rk("WEBCS_DOMAIN_BACKUP_LIST").map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:mV()}})),c=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((function(e){return e.url}))}),e.next=8,jV({fragementLength:rk("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:function(e){return Dk.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),DV(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});case 8:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,BV([s(),c()]);case 5:return a=e.sent,o.length&&o.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",a);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))(t,n,r,i),e.next=3,a;case 3:return e.t0=e.sent,e.abrupt("return",{gatewayInfo:e.t0});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function KV(e,t,n,r,i){return YV.apply(this,arguments)}function YV(){return(YV=p(l().mark((function e(t,n,r,i,a){var o,s,c,u,d,p,h,f,_,v,E,m,S,g,T,b,R,C,y,I;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("disabled"!==(o=t.cloudProxyServer)){e.next=29;break}if(i){e.next=4;break}return e.abrupt("return");case 4:if(!t.useLocalAccessPoint){e.next=8;break}return e.next=7,WV(t,n,r,a);case 7:return e.abrupt("return",e.sent);case 8:if(!rk("JOIN_WITH_FALLBACK_MEDIA_PROXY")){e.next=26;break}return e.next=11,tF(t,n,r,a);case 11:if(s=e.sent,c=s.gatewayInfo,u=s.proxyInfo,!t.turnServer||"auto"===t.turnServer.mode){e.next=16;break}return e.abrupt("return",{gatewayInfo:c});case 16:if(d=u.map((function(e){return{turnServerURL:e.address,tcpport:e.tcpport||JO.tcpport,udpport:e.udpport||JO.udpport,username:e.username||JO.username,password:e.password||JO.password,forceturn:!1,security:!0}})),!a.useP2P){e.next=25;break}return h=null!==(p=t.uid)&&void 0!==p?p:c.uid,f="glb:".concat(h.toString()),e.next=22,Sw(f);case 22:_=e.sent,v=u.map((function(e){return{turnServerURL:e.address,tcpport:e.tcpport||JO.tcpport,udpport:e.udpport||JO.udpport,username:f,password:_,forceturn:!1,security:!0}})),d.push.apply(d,v);case 25:return e.abrupt("return",(t.turnServer={mode:"manual",servers:d},{gatewayInfo:c}));case 26:return e.next=28,WV(t,n,r,a);case 28:return e.abrupt("return",e.sent);case 29:return e.next=31,tF(t,n,r,a);case 31:if(E=e.sent,m=E.proxyInfo,S=E.gatewayInfo,g={gatewayInfo:S},T=m.map((function(e){return{turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:JO.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:JO.udpport,username:e.username||JO.username,password:e.password||JO.password,forceturn:"proxy4"!==o,security:"proxy5"===o}})),!a.useP2P){e.next=44;break}return R=null!==(b=t.uid)&&void 0!==b?b:S.uid,C="glb:".concat(R.toString()),e.next=41,Sw(C);case 41:y=e.sent,I=m.map((function(e){return{turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||JO.tcpport,udpport:"proxy4"===o?void 0:e.udpport||JO.udpport,username:C,password:y,forceturn:"proxy4"!==o,security:"proxy5"===o}})),T.push.apply(T,I);case 44:return e.abrupt("return",(t.turnServer={mode:"manual",servers:T},Dk.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),g));case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qV(e,t,n,r,i){return zV.apply(this,arguments)}function zV(){return(zV=p(l().mark((function e(t,n,r,i,a){var o,s,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=rk("ACCOUNT_REGISTER").slice(0,rk("AJAX_REQUEST_CONCURRENT")),s=n.proxyServer?o.map((function(e){return"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1")})):o.map((function(e){return"https://".concat(e,"/api/v1")})),c=null==a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s}),e.prev=4,e.next=7,p(l().mark((function e(t,n,r,i,a){var o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Date.now(),s={sid:r.sid,opid:10,appid:r.appId,string_uid:n},c=t[0],e.next=4,mO((function(){return EV(c+"".concat(-1===c.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})}),(function(e,r){if(0===e.code){if(e.uid<=0||e.uid>=Math.pow(2,32))throw Dk.error("Invalid Uint Uid ".concat(n," => ").concat(e.uid),e),Fk.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:c,stringUid:s.string_uid,uid:e.uid,errorCode:iw.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new Bk(iw.INVALID_UINT_UID_FROM_STRING_UID);return Fk.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:c,stringUid:s.string_uid,uid:e.uid,errorCode:null,extend:s}),!1}var i=XM(e.code);return i.retry&&(c=t[(r+1)%t.length]),Fk.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:c,stringUid:s.string_uid,uid:e.uid,errorCode:i.desc,extend:s}),i.retry}),(function(e,n){return e.code!==iw.OPERATION_ABORTED&&(Fk.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:c,stringUid:s.string_uid,uid:null,errorCode:e.code,extend:s}),c=t[(n+1)%t.length],!0)}),a);case 4:if(0===(u=e.sent).code){e.next=8;break}throw d=XM(u.code),new Bk(iw.UNEXPECTED_RESPONSE,d.desc);case 8:return e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})))(s,t,n,r,i);case 7:return u=e.sent,e.abrupt("return",(null==a||a.recordJoinChannelService({status:"success",endTs:Date.now()},c),u.uid));case 11:throw e.prev=11,e.t0=e.catch(4),null==a||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e.t0]},c),e.t0;case 14:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function XV(e,t,n){return JV.apply(this,arguments)}function JV(){return(JV=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=rk("ACCOUNT_REGISTER"),a=n.proxyServer?i.map((function(e){return"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1")})):i.map((function(e){return"https://".concat(e,"/api/v1")})),e.prev=3,e.next=6,GV({referenceList:a,asyncMapHandler:function(e){return p(l().mark((function e(t,n,r,i){var a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),o={sid:r.sid,opid:10,appid:r.appId,string_uid:n},e.prev=1,e.next=4,EV(t+"".concat(-1===t.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});case 4:if(0===(s=e.sent).code){e.next=8;break}throw c=XM(s.code),new Bk(iw.UNEXPECTED_RESPONSE,"preload sua error:".concat(c.desc),c);case 8:if(!(s.uid<=0||s.uid>=Math.pow(2,32))){e.next=10;break}throw new Bk(iw.INVALID_UINT_UID_FROM_STRING_UID);case 10:return e.abrupt("return",{requestTime:a,url:t,req:o,uid:s.uid,elapse:Date.now()-a});case 13:throw e.prev=13,e.t0=e.catch(1),e.t0;case 16:case"end":return e.stop()}}),e,null,[[1,13]])})))(e,t,n,r)},closeFn:function(e){return e.code===iw.OPERATION_ABORTED||e.code===iw.UNEXPECTED_RESPONSE&&!e.data.retry}});case 6:return o=e.sent,e.abrupt("return",o);case 10:throw e.prev=10,e.t0=e.catch(3),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function QV(e,t,n){return ZV.apply(this,arguments)}function ZV(){return(ZV=p(l().mark((function e(t,n,r){var i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=rk("CDS_AP").slice(0,rk("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1?action=config")})),a=i.map((function(e){return function(e,t,n,r){var i=IA(),a={flag:64,cipher_method:0,features:wV(wV(wV(wV(wV({install_id:YO(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:qO,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:lU.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return mO((function(){return EV(e,{data:a,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})}),void 0,(function(e){return e.code!==iw.OPERATION_ABORTED}),r)}(e,t,n,r)})),o=null,s=null,c={},e.prev=2,e.next=5,BV(a);case 5:o=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),e.t0.code!==iw.OPERATION_ABORTED){e.next=12;break}throw e.t0;case 12:s=e.t0;case 13:if(a.forEach((function(e){return e.cancel()})),Fk.reportApiInvoke(t.sid,{name:Rw.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{c=function(e){if(!e.test_tags)return{};var t=e.test_tags,n=Object.keys(t),r={};return n.forEach((function(e){var n,i=mS(n=e.slice(4)).call(n),a=JSON.parse(t[e]),o=a[1];r[i]={tag:a[0]||"",value:o}})),r}(o)}catch(e){}return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function $V(e,t){return eF.apply(this,arguments)}function eF(){return(eF=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=rk("WEBCS_DOMAIN").concat(rk("WEBCS_DOMAIN_BACKUP_LIST")).map((function(e){return{url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:mV(),serviceIds:[hU.CHOOSE_SERVER,hU.CLOUD_PROXY_FALLBACK]}})),e.prev=1,e.next=4,GV({referenceList:r,asyncMapHandler:function(e){return p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p,h,f,_,v,E,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.url,o=t.areaCode,s=t.serviceIds,c=Date.now(),u=UV(n,o,s),d=u[0],p=u[1],h=Fw.networkState,e.prev=3,e.t0=h&&Fw.networkState===Pw.OFFLINE&&Fw.onlineWaiter,!e.t0){e.next=8;break}return e.next=8,zl.race([Fw.onlineWaiter,eO(vO.maxRetryTimeout)]);case 8:return h=Fw.networkState,e.next=11,EV(a,{data:d,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 11:return f=e.sent,_=f.data,v=f.headers,i="1"===v.http3?1:-1,function(e){var t=[];if(e.response_body.forEach((function(n){var r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{var i={error:new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(i)}if(0!==r){var a=XM(r),o={error:new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,a.desc,{desc:a.desc,retry:a.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?Dk.warning(o.error.toString()):t.push(o)}})),t.length)throw new Bk(iw.CAN_NOT_GET_GATEWAY_SERVER,t.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message)})).join(" | "),{retry:!!t.find((function(e){return e.error.data.retry})),csIp:e.detail[502],desc:[].concat(new Set(t.map((function(e){var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((function(e){return!!e}))))})}(_),E=TU(_,hU.CHOOSE_SERVER),m=TU(_,hU.CLOUD_PROXY_FALLBACK),e.abrupt("return",(xV(E),{gatewayInfo:EU(E,a),proxyInfo:m,opid:p,requestTime:c,url:a,isHttp3:i,elapse:Date.now()-c}));case 21:throw e.prev=21,e.t1=e.catch(3),e.t1;case 24:case"end":return e.stop()}}),e,null,[[3,21]])})))(e,t,n)},closeFn:function(e){return e.code===iw.OPERATION_ABORTED||e.code===iw.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry}});case 4:return i=e.sent,e.abrupt("return",i);case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function tF(e,t,n,r){return nF.apply(this,arguments)}function nF(){return(nF=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,h,f,_,v,E;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=rk("PROXY_SERVER_TYPE3"),o=function(e,t,n){var r=n||a;return Array.isArray(r)&&(r=t%2==0?a[1]:a[0]),"https://".concat(r,"/ap/?url=").concat(e)},s=null,c=[],u=function(){var e=p(l().mark((function e(){var a,s,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=rk("WEBCS_DOMAIN").slice(0,rk("AJAX_REQUEST_CONCURRENT")).map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:mV(),serviceIds:[hU.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?hU.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?hU.CLOUD_PROXY:hU.CLOUD_PROXY_FALLBACK]}})),s=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=4,jV({fragementLength:rk("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return Dk.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),PV(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:c});case 4:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=p(l().mark((function e(){var a,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eO(1e3);case 2:if(null===s){e.next=4;break}return e.abrupt("return",s);case 4:return a=rk("WEBCS_DOMAIN_BACKUP_LIST").map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:mV(),serviceIds:[hU.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?hU.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?hU.CLOUD_PROXY:hU.CLOUD_PROXY_FALLBACK]}})),u=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=8,jV({fragementLength:rk("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return Dk.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),PV(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},u),e[0]},promisesCollector:c});case 8:return d=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},u),d));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,BV([u(),d()]);case 6:v=e.sent,h=v.gatewayInfo,f=v.proxyInfo,_=v.url,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0[0];case 15:if(c.length&&c.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),h&&f){e.next=17;break}throw new Bk(iw.UNEXPECTED_ERROR,"missing gateway or proxy response").print();case 17:return t.apUrl=_,"disabled"!==t.cloudProxyServer&&Array.isArray(a)&&_&&(E=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1],Br(a).call(a,E)&&(t.proxyServer=E,Dk.setProxyServer(E),Fk.setProxyServer(E))),e.t1=h,e.next=21,bU(f,h.uid);case 21:return e.t2=e.sent,s={gatewayInfo:e.t1,proxyInfo:e.t2},e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,null,[[3,12]])})))).apply(this,arguments)}function rF(e,t,n){return iF.apply(this,arguments)}function iF(){return(iF=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=rk("UAP_AP").slice(0,rk("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})),a=i.map((function(e){return function(e,t,n,r){var i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:qO,cname:t.cname,uid:t.uid.toString(),requestId:NV,seq:NV};NV+=1;var a={service_name:"tele_channel",json_body:JSON.stringify(i)};return mO(p(l().mark((function t(){var r,i,o,s,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,EV(e,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});case 2:if(0===(r=t.sent).code){t.next=6;break}throw i=new Bk(iw.UNEXPECTED_RESPONSE,"cross channel ap error, code"+r.code,{retry:!0}),Dk.error(i.toString()),i;case 6:if(200===(o=JSON.parse(r.json_body)).code){t.next=10;break}throw s=new Bk(iw.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(o.code,", reason: ").concat(o.reason)),Dk.error(s.toString()),s;case 10:if(o.servers&&0!==o.servers.length){t.next=13;break}throw c=new Bk(iw.UNEXPECTED_RESPONSE,"cross channel app center empty server"),Dk.error(c.toString()),c;case 13:return t.abrupt("return",{vid:o.vid,workerToken:o.workerToken,addressList:(rk("CHANNEL_MEDIA_RELAY_SERVERS")||o.servers).map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat(rk("WORKER_DOMAIN"),":").concat(e.wss)}))});case 14:case"end":return t.stop()}}),t)}))),void 0,(function(e){return!!(e.code!==iw.OPERATION_ABORTED&&e.code!==iw.UNEXPECTED_RESPONSE||e.data&&e.data.retry)}),r)}(e,t,n,r)})),e.prev=1,e.next=4,BV(a);case 4:return o=e.sent,e.abrupt("return",(a.forEach((function(e){return e.cancel()})),o));case 8:throw e.prev=8,e.t0=e.catch(1),e.t0[0];case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function aF(e,t,n){return oF.apply(this,arguments)}function oF(){return(oF=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,a=[],o=function(){var e=p(l().mark((function e(o){var s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=rk(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2")})),e.t0=o,!e.t0){e.next=6;break}return e.next=5,eO(1e3);case 5:e.t0=null!==i;case 6:if(!e.t0){e.next=10;break}e.t1=i,e.next=13;break;case 10:return e.next=12,jV({fragementLength:rk("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:function(e){return Dk.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),e),function(e,t,n,r){var i=VV(t,[hU.CHOOSE_SERVER])[0],a=Fw.networkState;return mO(p(l().mark((function t(){var o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=a&&Fw.networkState===Pw.OFFLINE&&Fw.onlineWaiter,!t.t0){t.next=4;break}return t.next=4,zl.race([Fw.onlineWaiter,eO(r&&r.maxRetryTimeout||vO.maxRetryTimeout)]);case 4:return a=Fw.networkState,t.next=7,EV(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);case 7:return o=t.sent,t.abrupt("return",MV(o,e));case 9:case"end":return t.stop()}}),t)}))),(function(){return!1}),(function(e){return e.code!==iw.OPERATION_ABORTED&&(e.code===iw.UPDATE_TICKET_FAILED?e.data.retry:(Dk.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))}),r)}(e,t,n,r)},allFailedhandler:function(e){throw e[0]},promisesCollector:a});case 12:e.t1=e.sent;case 13:return e.abrupt("return",e.t1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,BV([o(!1),o(!0)]);case 5:return i=e.sent,a.length&&a.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",i);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function sF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var uF=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"configs",void 0),XC(r(i),"store",void 0),XC(r(i),"joinInfo",void 0),XC(r(i),"cancelToken",void 0),XC(r(i),"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),XC(r(i),"interval",void 0),XC(r(i),"mutex",void 0),XC(r(i),"mutableParamsRead",!1),XC(r(i),"configCache",{}),XC(r(i),"limit_bitrate",void 0),i.mutex=new fO("config-distribute",t),i.store=n,i}i(t,e);var n=t.prototype;return n.startGetConfigDistribute=function(e,t){var n=this;this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),rk("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((function(){n.updateConfigDistribute()}),rk("CONFIG_DISTRIBUTE_INTERVAL")))},n.stopGetConfigDistribute=function(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0},n.awaitConfigDistributeComplete=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutex.isLocked){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.mutex.lock();case 4:e.t0=e.sent,(0,e.t0)();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.updateConfigDistribute=function(){var e=p(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutableParamsRead||(this.mutableParamsRead=!0,Fk.reportApiInvoke(null,{options:void 0,name:Rw.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Cw.TRACER}).onSuccess(JSON.stringify(ak))),this.joinInfo&&this.cancelToken&&this.retryConfig){e.next=3;break}return e.abrupt("return",void Dk.debug("[config-distribute] get config distribute interrupted have no joininfo"));case 3:return e.next=5,this.mutex.lock();case 5:return n=e.sent,e.prev=6,e.next=9,QV(this.joinInfo,this.cancelToken,this.retryConfig);case 9:t=e.sent,Dk.debug("[config-distribute] get config distribute",JSON.stringify(t)),r=function(e){for(var t,n=Vh(t=Object.keys(e).filter((function(e){return/^webrtc_ng_global_parameter/.test(e)}))).call(t),r=0;r<n.length;r++)for(var i=n.length-1;i>r;i--){var a=n[i],o=e[a].value;if("number"==typeof o.__priority){var s=o.__priority,c=n[i-1],u=e[c].value;if("number"==typeof u.__priority){if(!(s>u.__priority))continue;var d=a;n[i]=n[i-1],n[i-1]=d}else{var p=a;n[i]=n[i-1],n[i-1]=p}}}var l=Date.now(),h={};return n.forEach((function(t){var n=e[t].value.__expires;n&&n<=l||(h[t]=e[t])})),h}(t),this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),i=new Bk(iw.NETWORK_RESPONSE_ERROR,e.t0),Dk.warning("[config-distribute] ".concat(i.toString()));case 19:return e.prev=19,n(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),n.getBitrateLimit=function(){return this.limit_bitrate||void 0},n.handleBitrateLimit=function(e){IM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(yM.UPDATE_BITRATE_LIMIT,e):this.emit(yM.UPDATE_BITRATE_LIMIT,e))},n.getLowStreamConfigDistribute=function(){return this.limit_bitrate&&cF({},this.limit_bitrate.low_stream_uplink)},n.handleABTestConfigDistribute=function(e){var t=this;try{var n={},r=Object.keys(e),i=[];r.forEach((function(r){var a=e[r].value;n[r]=a;var o=a.__id;if(!o||!t.configCache[r]||t.configCache[r].__id!==o){var s=a.__type,c=e[r].value,u=e[r].tag,d=0;s?s===ik.REALTIME&&(d=1):Object.keys(c).some((function(e){return Object.prototype.hasOwnProperty.call(ek,e)||!cx()&&Object.prototype.hasOwnProperty.call(QO,e)?(d=1,!0):void 0})),i.push({tag:u,isApplied:d,feature:r,params:JSON.stringify(a)})}})),i.forEach((function(e){var n=e.tag,r=e.feature,i=e.params,a=e.isApplied;t.store.sessionId&&Fk.abTest(t.store.sessionId,{intSucc:1,isApplied:a,tag:n,feature:r,params:i,cid:t.store.cid,uid:t.store.intUid})})),this.configCache=n}catch(e){Dk.debug("handleABTestConfigDistribute error",e)}},n.cacheGlobalParameterConfig=function(e){var t=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n].value,i=r.__expires,a=r.__type;Object.keys(r).forEach((function(e){"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=cF(cF({value:r[e]},i&&{expires:i}),a&&{type:a}))}))})),t}(e);try{var n,r=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,r&&IM(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{var t=Date.now();Object.keys(e).forEach((function(n){var r=e[n],i=r.value,a=r.type,o=r.expires;o&&o<=t||((a===ik.REALTIME||Object.prototype.hasOwnProperty.call(ek,n))&&(ak[n]=i,tk[n]=i,Dk.debug("Update realtime parameters from config distribute",n,i)),a||cx()||!Object.prototype.hasOwnProperty.call(QO,n)||(ak[n]=i,tk[n]=i,Dk.debug("Update gateway parameters from config distribute",n,i)))}))}catch(t){Dk.error("Error update config immediately: ".concat(e),t.message)}}(t);var i=JSON.stringify(t),a=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",a),Dk.debug("Caching global parameters ".concat(i))}catch(e){Dk.error("Error caching global parameters:",e.message)}},n.handleGlobalParameterConfig=function(e){var t=this;try{var n=Date.now();Object.keys(e).forEach((function(r){if("CLIENT_ROLE_OPTIONS"===r&&Object.prototype.hasOwnProperty.call(tk,r)){var i=e[r],a=i.value,o=i.expires;if(o&&o<=n)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(tk[r],a)||(ak[r]=a,tk[r]=a,t.emit(yM.UPDATE_CLIENT_ROLE_OPTIONS,a),Dk.debug("Updating client role options: ".concat(JSON.stringify(a))))}}))}catch(e){Dk.error("Error handling global parameter config:",e.message)}},v(t,[{key:"isSuccess",get:function(){return!!this.configs}}]),t}(gw),dF=function(e){function t(){var t;return XC(r(t=e.apply(this,arguments)||this),"resultStorage",new Map),t}i(t,e);var n=t.prototype;return n.setLocalAudioStats=function(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))},n.setLocalVideoStats=function(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))},n.setRemoteAudioStats=function(e,t){var n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))},n.setRemoteVideoStats=function(e,t){var n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))},n.record=function(e,t,n){if(!(rk("STATS_UPDATE_INTERVAL")>500)){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});var r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i,a=Br(i=r.result).call(i,!0);r.isPrevNormal&&!a&&this.emit("exception",pF[e],e,t),!r.isPrevNormal&&a&&this.emit("exception",pF[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=a,r.result=[]}}},n.checkAudioOutputLevel=function(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)},n.checkAudioInputLevel=function(e,t){return t instanceof EP&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel},n.checkFramerateInput=function(e,t){var n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=mU(t._encoderConfig.frameRate));var r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)},n.checkFramerateSent=function(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)},n.checkSendVideoBitrate=function(e,t){return!!t.muted||0!==e.sendBitrate},n.checkSendAudioBitrate=function(e,t){return t instanceof EP&&!t.isActive||!!t.muted||0!==e.sendBitrate},n.checkVideoDecode=function(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate},t}(gw),pF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},lF=new(function(){function e(){}var t=e.prototype;return t.markSubscribeStart=function(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))},t.markPublishStart=function(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))},t.measureFromSubscribeStart=function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0},t.measureFromPublishStart=function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0},e}());function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _F=function(){function e(e){var t=this;XC(this,"store",void 0),XC(this,"onStatsException",void 0),XC(this,"onUploadPublishDuration",void 0),XC(this,"onStatsChanged",void 0),XC(this,"onVideoCodecChanged",void 0),XC(this,"localStats",new Map),XC(this,"remoteStats",new Map),XC(this,"updateStatsInterval",void 0),XC(this,"trafficStats",void 0),XC(this,"trafficStatsPeerList",[]),XC(this,"uplinkStats",void 0),XC(this,"exceptionMonitor",void 0),XC(this,"p2pChannel",void 0),XC(this,"scalabilityMode",UO.L1T1),XC(this,"updateStats",(function(){t.p2pChannel&&(t.updateRemoteStats(t.p2pChannel),t.updateLocalStats(t.p2pChannel))})),this.store=e,this.exceptionMonitor=new dF,this.exceptionMonitor.on("exception",(function(e,n,r){t.onStatsException&&t.onStatsException(e,n,r)}))}var t=e.prototype;return t.startUpdateStats=function(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))},t.stopUpdateStats=function(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)},t.reset=function(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0},t.getLocalAudioTrackStats=function(){return this.localStats.get(PM.LocalAudioTrack)||fF({},vN)},t.getLocalVideoTrackStats=function(){return this.localStats.get(PM.LocalVideoTrack)||fF({},EN)},t.getRemoteAudioTrackStats=function(e){var t=this,n=function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppad+(Date.now()-t.trafficStats.timestamp)),n},r={};if(e){var i,a=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;a&&(r[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=e[0],i=e[1].audioStats;i&&(r[t]=n(t,i))}));return r},t.getRemoteNetworkQualityStats=function(e){var t={};if(e){var n,r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((function(e){var n=e[0],r=e[1].networkStats;r&&(t[n]=r)}));return t},t.getRemoteVideoTrackStats=function(e){var t=this,n=function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppvd+(Date.now()-t.trafficStats.timestamp)),n},r={};if(e){var i,a=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;a&&(r[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=e[0],i=e[1].videoStats;i&&(r[t]=n(t,i))}));return r},t.getRTCStats=function(){var e=0,t=0,n=0,r=0,i=this.localStats.get(PM.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);var a=this.localStats.get(PM.LocalVideoTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);var o=this.localStats.get(PM.LocalVideoLowTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate),this.remoteStats.forEach((function(e){var t=e.audioStats,i=e.videoStats;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));var s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}},t.addLocalStats=function(e){this.localStats.set(e,void 0)},t.removeLocalStats=function(e){e?this.localStats.delete(e):this.localStats.clear()},t.addRemoteStats=function(e){this.remoteStats.set(e,{})},t.removeRemoteStats=function(e){e?this.remoteStats.delete(e):this.remoteStats.clear()},t.addP2PChannel=function(e){this.p2pChannel=e},t.updateTrafficStats=function(e){var t=this;e.peer_delay=e.peer_delay.filter((function(e){return void 0!==e.B_ppad||void 0!==e.B_ppvd})),e.peer_delay.filter((function(e){return-1===t.trafficStatsPeerList.indexOf(e.peer_uid)})).forEach((function(e){var n,r=null===(n=t.p2pChannel)||void 0===n?void 0:n.getRemoteMedia(e.peer_uid),i=null!=r&&r.videoSSRC?lF.measureFromSubscribeStart(t.store.clientId,r.videoSSRC):0,a=null!=r&&r.audioSSRC?lF.measureFromSubscribeStart(t.store.clientId,r.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(t.onUploadPublishDuration&&t.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>a?i:a),t.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e},t.updateUplinkStats=function(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Dk.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e},e.isRemoteVideoFreeze=function(e,t,n){if(!e)return!1;var r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i},e.isRemoteAudioFreeze=function(e){return!!e&&e._isFreeze()},t.isLocalVideoFreeze=function(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3},t.updateLocalStats=function(e){var t=this;Array.from(this.localStats.entries()).forEach((function(n){var r=n[0],i=n[1];switch(r){case PM.LocalVideoTrack:case PM.LocalVideoLowTrack:var a,o=i,s=fF({},EN),c=e.getStats(),u=e.getLocalMedia(r);if(c){var d=c.videoSend.find((function(e){return e.ssrc===(null==u?void 0:u.ssrcs[0].ssrcId)}));if(d){var p,l=e.getLocalVideoSize(),h=e.getEncoderConfig(PM.LocalVideoTrack);"H264"!==d.codec&&"H265"!==d.codec&&"VP8"!==d.codec&&"VP9"!==d.codec&&"AV1X"!==d.codec&&"AV1"!==d.codec||(s.codecType=d.codec,(null==o?void 0:o.codecType)!==d.codec&&(null===(p=t.onVideoCodecChanged)||void 0===p||p.call(t,d.codec.toLocaleLowerCase()))),s.sendBytes=d.bytes,s.sendBitrate=o?8*Math.max(0,s.sendBytes-o.sendBytes):0,d.inputFrame?(s.captureFrameRate=d.inputFrame.frameRate,s.captureResolutionHeight=d.inputFrame.height,s.captureResolutionWidth=d.inputFrame.width):l&&(s.captureResolutionWidth=l.width,s.captureResolutionHeight=l.height),d.sentFrame?(s.sendFrameRate=d.sentFrame.frameRate,s.sendResolutionHeight=d.sentFrame.height,s.sendResolutionWidth=d.sentFrame.width):l&&(s.sendResolutionWidth=l.width,s.sendResolutionHeight=l.height),d.avgEncodeMs&&(s.encodeDelay=d.avgEncodeMs),h&&h.bitrateMax?s.targetSendBitrate=1e3*h.bitrateMax:d.targetBitrate&&(s.targetSendBitrate=d.targetBitrate),s.sendPackets=d.packets,s.sendPacketsLost=d.packetsLost,s.sendJitterMs=d.jitterMs,s.sendRttMs=d.rttMs,s.totalDuration=o?o.totalDuration+1:1,s.totalFreezeTime=o?o.totalFreezeTime:0,t.isLocalVideoFreeze(d)&&(s.totalFreezeTime+=1),d.scalabilityMode&&t.scalabilityMode!==d.scalabilityMode&&(Dk.debug("[".concat(t.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(d.scalabilityMode)),t.scalabilityMode=d.scalabilityMode)}t.trafficStats&&(s.currentPacketLossRate=(t.trafficStats.B_pvlr4||0)/100)}t.localStats.set(r,s),((null==o?void 0:o.sendResolutionWidth)!==s.sendResolutionWidth||(null==o?void 0:o.sendResolutionHeight)!==s.sendResolutionHeight)&&(null===(a=t.onStatsChanged)||void 0===a||a.call(t,"resolution",{width:s.sendResolutionWidth,height:s.sendResolutionHeight})),s&&u&&t.exceptionMonitor.setLocalVideoStats(t.store.uid,u.track,s);break;case PM.LocalAudioTrack:var f=i,_=fF({},vN),v=e.getStats(),E=e.getLocalMedia(r);if(v){var m=v.audioSend.find((function(e){return e.ssrc===(null==E?void 0:E.ssrcs[0].ssrcId)}));if(m){if("opus"!==m.codec&&"aac"!==m.codec&&"PCMU"!==m.codec&&"PCMA"!==m.codec&&"G722"!==m.codec||(_.codecType=m.codec),m.inputLevel)_.sendVolumeLevel=Math.round(32767*m.inputLevel);else{var S=e.getLocalAudioVolume();S&&(_.sendVolumeLevel=Math.round(32767*S))}_.sendBytes=m.bytes,_.sendPackets=m.packets,_.sendPacketsLost=m.packetsLost,_.sendJitterMs=m.jitterMs,_.sendRttMs=m.rttMs,_.sendBitrate=f?8*Math.max(0,_.sendBytes-f.sendBytes):0}}t.trafficStats&&(_.currentPacketLossRate=(t.trafficStats.B_palr4||0)/100),t.localStats.set(PM.LocalAudioTrack,_),_&&E&&t.exceptionMonitor.setLocalAudioStats(t.store.uid,E.track,_)}}))},t.updateRemoteStats=function(t){var n=this;Array.from(this.remoteStats.entries()).forEach((function(r){var i,a,o,s=r[0],c=r[1],u=c.videoStats,d=c.audioStats,p=u,l=c.videoPcStats,h=fF({},mN),f=fF({},gN),_=fF({},SN),v=t.getRemoteMedia(s),E=v.audioTrack,m=v.videoTrack,S=v.audioSSRC,g=v.videoSSRC,T=null===(i=o=n.store.useP2P?t.getStats(!0):t.getStats())||void 0===i?void 0:i.audioRecv.find((function(e){return e.ssrc===S})),b=null===(a=o)||void 0===a?void 0:a.videoRecv.find((function(e){return e.ssrc===g})),R=n.trafficStats&&n.trafficStats.peer_delay.find((function(e){return e.peer_uid===s}));if(T&&("opus"!==T.codec&&"aac"!==T.codec&&"PCMU"!==T.codec&&"PCMA"!==T.codec&&"G722"!==T.codec||(h.codecType=T.codec),T.outputLevel?h.receiveLevel=Math.round(32767*T.outputLevel):E&&(h.receiveLevel=Math.round(32767*E.getVolumeLevel())),h.receiveBytes=T.bytes,h.receivePackets=T.packets,h.receivePacketsLost=T.packetsLost,h.receivePacketsDiscarded=T.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=d?8*Math.max(0,h.receiveBytes-d.receiveBytes):0,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=T.jitterBufferMs,h.totalDuration>10&&e.isRemoteAudioFreeze(E)&&(h.totalFreezeTime+=1)),b){var C;"H264"!==b.codec&&"H265"!==b.codec&&"VP8"!==b.codec&&"VP9"!==b.codec&&"AV1X"!==b.codec&&"AV1"!==b.codec||(f.codecType=b.codec),f.receiveBytes=b.bytes,f.receiveBitrate=p?8*Math.max(0,f.receiveBytes-p.receiveBytes):0,f.decodeFrameRate=b.decodeFrameRate<0?0:b.decodeFrameRate,f.renderFrameRate=b.decodeFrameRate<0?0:b.decodeFrameRate,b.outputFrame&&(f.renderFrameRate=b.outputFrame.frameRate),b.receivedFrame?(f.receiveFrameRate=b.receivedFrame.frameRate,f.receiveResolutionHeight=b.receivedFrame.height,f.receiveResolutionWidth=b.receivedFrame.width):m&&(f.receiveResolutionHeight=m._videoHeight||0,f.receiveResolutionWidth=m._videoWidth||0),void 0!==b.framesRateFirefox&&(f.receiveFrameRate=Math.round(b.framesRateFirefox)),f.receivePackets=b.packets,f.receivePacketsLost=b.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost);var y=p?p.totalFreezeTime:0,I=p?p.totalDuration:0;f.totalDuration=p?p.totalDuration+1:1,f.totalFreezeTime=null!==(C=b.totalFreezesDuration)&&void 0!==C?C:y||0,f.receiveDelay=b.jitterBufferMs||0;var A=!!g&&t.getRemoteVideoIsReady(g);void 0===b.totalFreezesDuration&&m&&A&&e.isRemoteVideoFreeze(m,b,l)&&(f.totalFreezeTime+=1),f.freezeRate=Math.max(0,Math.min((f.totalFreezeTime-y)/(f.totalDuration-I),1))}R&&(h.end2EndDelay=R.B_ad,f.end2EndDelay=R.B_vd,h.transportDelay=R.B_ed,f.transportDelay=R.B_ed,h.currentPacketLossRate=R.B_ealr4/100,f.currentPacketLossRate=R.B_evlr4/100,_.uplinkNetworkQuality=R.B_punq?R.B_punq:0,_.downlinkNetworkQuality=R.B_pdnq?R.B_pdnq:0),n.remoteStats.set(s,{audioStats:h,videoStats:f,videoPcStats:b,networkStats:_}),E&&n.exceptionMonitor.setRemoteAudioStats(E,h),m&&n.exceptionMonitor.setRemoteVideoStats(m,f)}))},e}(),vF=function(){function e(){XC(this,"destChannelMediaInfos",new Map),XC(this,"srcChannelMediaInfo",void 0)}var t=e.prototype;return t.setSrcChannelInfo=function(e){lM(e),this.srcChannelMediaInfo=e},t.addDestChannelInfo=function(e){lM(e),this.destChannelMediaInfos.set(e.channelName,e)},t.removeDestChannelInfo=function(e){nM(e),this.destChannelMediaInfos.delete(e)},t.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},t.getDestChannelMediaInfo=function(){return this.destChannelMediaInfos},e}();function EF(e){if(!(e instanceof vF))return new Bk(iw.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();var t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new Bk(iw.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new Bk(iw.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}var mF=function(){function e(e,t){XC(this,"uid",void 0),XC(this,"_uintid",void 0),XC(this,"_trust_in_room_",!0),XC(this,"_trust_audio_enabled_state_",!0),XC(this,"_trust_video_enabled_state_",!0),XC(this,"_trust_audio_mute_state_",!0),XC(this,"_trust_video_mute_state_",!0),XC(this,"_audio_muted_",!1),XC(this,"_video_muted_",!1),XC(this,"_audio_enabled_",!0),XC(this,"_video_enabled_",!0),XC(this,"_audio_added_",!1),XC(this,"_video_added_",!1),XC(this,"_is_pre_created",!1),XC(this,"_video_pre_subscribed",!1),XC(this,"_audio_pre_subscribed",!1),XC(this,"_trust_video_stream_added_state_",!0),XC(this,"_trust_audio_stream_added_state_",!0),XC(this,"_audioTrack",void 0),XC(this,"_videoTrack",void 0),XC(this,"_dataChannels",[]),XC(this,"_audioSSRC",void 0),XC(this,"_videoSSRC",void 0),XC(this,"_audioOrtc",void 0),XC(this,"_videoOrtc",void 0),XC(this,"_cname",void 0),XC(this,"_rtxSsrcId",void 0),XC(this,"_videoMid",void 0),XC(this,"_audioMid",void 0),this.uid=e,this._uintid=t}return v(e,[{key:"hasVideo",get:function(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}},{key:"hasAudio",get:function(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}},{key:"audioTrack",get:function(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}},{key:"videoTrack",get:function(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}},{key:"dataChannels",get:function(){return this._dataChannels}}]),e}();function SF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var TF="9";function bF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var CF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(CF||{}),yF=new Map;function IF(e,t,n,r){var i=e.scale;if(0===i&&r===CF.UP||i>=t.length-1&&r===CF.DOWN)return e;var a=RF(RF({},e),{},{scale:r===CF.DOWN?++i:--i});switch(n){case"maintain-framerate":a=RF(RF({},a),t[i].motion);break;case"maintain-resolution":a=RF(RF({},a),t[i].detail);break;case"balanced":a=RF(RF({},a),t[i].balanced)}return a}function AF(e,t){if(t){var n={overUse:0,underUse:0,adaptationList:wF(t)};yF.set(e,n)}else yF.delete(e)}function wF(e){for(var t=RF({},e),n=t.bitrateMax,r=t.frameRate,i=t.scaleResolutionDownBy,a=t.bitrateMin,o=ZO.MIN_FRAME_RATE,s=ZO.MAX_THRESHOLD_FRAMERATE,c=ZO.MAX_SCALE,u=ZO.BITRATE_MIN_THRESHOLD,d=ZO.BITRATE_MAX_THRESHOLD,p=ZO.BWE_SCALE_UP_THRESHOLD,l=ZO.BWE_SCALE_DOWN_THRESHOLD,h=ZO.PERF_SCALE_DOWN_THRESHOLD,f=ZO.PERF_SCALE_UP_THRESHOLD,_=ZO.BALANCE_BITRATE_FACTOR,v=ZO.BALANCE_FRAMERATE_FACTOR,E=ZO.BALANCE_RESOLUTION_FACTOR,m=ZO.MOTION_RESOLUTION_FACTOR,S=ZO.MOTION_BITRATE_FACTOR,g=ZO.DETAIL_FRAMERATE_FACTOR,T=ZO.DETAIL_BITRATE_FACTOR,b=Math.min(t.frameRate,s),R=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(l,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(h,1)*b),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a}}],C=1;C<=c;C++){var y={bwe_up:Math.round(Math.pow(p,C)*n),bwe_down:Math.round(Math.pow(l,C+1)*n),fps_up:Math.round(Math.pow(f,C)*b),fps_down:Math.round(Math.pow(h,C+1)*b)},I={scaleResolutionDownBy:i/Math.pow(E,C),frameRate:Math.max(Math.round(Math.pow(v,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(_,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(_,C)*a),u)},A={scaleResolutionDownBy:i/Math.pow(m,C),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(S,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(S,C)*a),u)},w={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(g,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(T,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(T,C)*a),u)};R.push({scale:C,threshold:y,balanced:I,motion:A,detail:w})}return R}function OF(e,t,n,r,i,a){var o=yF.get(e)||{overUse:0,underUse:0,adaptationList:wF(i)},s=o.adaptationList;yF.set(e,o);var c,u,d=ZO.OVERUSE_TIMES_THRESHOLD,p=ZO.UNDERUSE_TIMES_THRESHOLD,l=r.scale;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;var i=n[t].threshold.fps_down;return rk("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,l,s,a)&&(o.overUse++,u=MO.CPU,o.overUse>d)||"number"==typeof n&&n>0&&function(e,t,n){return!(t>=n.length)&&e<n[t].threshold.bwe_down}(n,l,s)&&(o.overUse++,u=MO.BANDWIDTH,o.overUse>d)?(o.overUse=0,o.underUse=0,[c=IF(r,s,a,CF.DOWN),u]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0!==t){var i=n[t].threshold.fps_up;return rk("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}}(t,l,s,a)&&function(e,t,n){if(0!==t)return e>n[t].threshold.bwe_up}(n,l,s)&&(o.underUse++,o.underUse>p&&(o.overUse=0,o.underUse=0,0===(c=IF(r,s,a,CF.UP)).scale&&(u=MO.NONE))),[c,u])}function kF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function NF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function DF(e){var t;return!(!rk("ENABLE_AG_ADAPTATION")||!(e instanceof SL||Br(t=e._hints).call(t,sN.CUSTOM_TRACK))||!rk("FORCE_SUPPORT_AG_ADAPTATION")&&!(function(e){var t=IA();if(t.os!==TA.IOS||!t.osVersion)return!1;var n=t.osVersion.split(".");return Number(n[0])>=14}()&&jA(17,4,!0)||BA(14)&&GA(17,4,!0)))}var PF=new Map;function LF(e,t){var n=PF.get(e);if(n){var r=n.timer;window.clearTimeout(r),PF.delete(e)}t.qualityLimitationReason=MO.NONE,AF(e)}function xF(e,t){var n,r;switch(t){case PM.LocalAudioTrack:r=EM.Audio;break;case PM.LocalVideoTrack:r=Br(n=e._hints).call(n,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:r=EM.Low}return r}function MF(e){var t=Gk();if(e.some((function(e){return e._bypassWebAudio})))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function UF(e,t){MF(e);var n=t||new EP;return e.forEach((function(e){return n.addAudioTrack(e)})),n}var VF,FF=!Gk().supportUnifiedPlan||rk("CHROME_FORCE_PLAN_B")&&ZA();function BF(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return FF?(t={spec:n,store:e},dV("PlanBConnection").create(t)):new KF(n,e)}function jF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function GF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ww(e.turnServer.servers))return!1;if(rk("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((function(e){return e.forceturn})))return!0}return!1}catch(e){return!1}}function WF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WF(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var KF=(Wx((VF=function(e){function t(n,i){var a;return XC(r(a=e.call(this,n,i)||this),"id",tO(5,"connection-")),XC(r(a),"store",void 0),XC(r(a),"peerConnection",void 0),XC(r(a),"forceTurn",!1),XC(r(a),"remoteSDP",void 0),XC(r(a),"initialOffer",void 0),XC(r(a),"transportEventReceiver",void 0),XC(r(a),"statsFilter",void 0),XC(r(a),"extension",{useXR:rk("USE_XR")}),XC(r(a),"localCapabilities",void 0),XC(r(a),"remoteCodecs",void 0),XC(r(a),"localCandidateCount",0),XC(r(a),"allCandidatesReceived",!1),XC(r(a),"isPreallocation",!1),XC(r(a),"preSSRCMap",new Map),XC(r(a),"dataStreamChannelMap",new Map),XC(r(a),"establishPromise",void 0),XC(r(a),"recoveredDataChannelIds",[]),XC(r(a),"currentDataChannelId",1),XC(r(a),"supportAV1RtpSpec",!1),XC(r(a),"mutex",void 0),XC(r(a),"qualityLimitationReason",MO.NONE),XC(r(a),"isFirstConnected",!1),a.store=i,a.forceTurn=GF(n),a.mutex=new fO("P2PConnection-mutex",i.clientId),a.peerConnection=new RTCPeerConnection(t.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),a.isFirstConnected=!1,a.statsFilter=HO(a.peerConnection,rk("STATS_UPDATE_INTERVAL"),void 0,LA()?1200:void 0),a.bindPCEvents(),a.bindStatsEvents(),a.store.p2pId=a.store.p2pId+1,a.establishPromise=a.establish(),a}i(t,e);var n=t.prototype;return n.getPreMedia=function(e){var t=this.preSSRCMap.get(e);if(void 0!==t){var n=this.peerConnection.getTransceivers().find((function(e){return e.mid===t}));if(n)return{transceiver:n,track:n.receiver.track,id:t}}},n.updateRemoteRTPCapabilities=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteCodecs=n,this.remoteSDP){e.next=2;break}return e.abrupt("return",void Dk.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n)));case 2:if(!this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){e.next=15;break}return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=9,this.peerConnection.setLocalDescription(r);case 9:return a=this.remoteSDP.toString(),null==i||i(a),e.next=13,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 13:e.next=16;break;case 15:Dk.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.establish=function(){var e=p(l().mark((function e(){var t,n,r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.next=4,this.peerConnection.createOffer();case 4:if((t=e.sent).sdp){e.next=7;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 7:return n=xU(t.sdp),e.next=10,YU({filterRTX:!rk("USE_PUB_RTX")&&!rk("USE_SUB_RTX"),filterVideoFec:rk("FILTER_VIDEO_FEC"),filterAudioFec:rk("FILTER_AUDIO_FEC"),filterVideoCodec:rk("FILTER_VIDEO_CODEC")},this.extension);case 10:if(r=e.sent,this.localCapabilities=JU(r),this.initialOffer=t,!rk("ENABLE_SVC")||"av1"!=this.store.codec){e.next=16;break}return e.next=14,p(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(t=new RTCPeerConnection).addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:UO.L1T3}]}),e.next=5,t.createOffer();case 5:if((n=e.sent).sdp){e.next=8;break}return e.abrupt("return",void t.close());case 8:if(r=pk(n.sdp).mediaDescriptions[0]){e.next=11;break}return e.abrupt("return");case 11:return i=r.attributes.extmaps.find((function(e){return"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName})),e.abrupt("return",(t.close(),i));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return");case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))();case 14:(i=e.sent)&&(this.supportAV1RtpSpec=!0,null===(a=r.send)||void 0===a||a.videoExtensions.push(i));case 16:return e.abrupt("return",(t.sdp&&iV(t.sdp)&&(o=Ww(r),(s=o).send&&(OU(OM.VIDEO,s.send.videoExtensions),OU(OM.AUDIO,s.send.audioExtensions)),s.recv&&(OU(OM.VIDEO,s.recv.videoExtensions),OU(OM.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(OU(OM.VIDEO,s.sendrecv.videoExtensions),OU(OM.AUDIO,s.sendrecv.audioExtensions))),HF(HF({},n),{},{rtpCapabilities:o||r,offerSDP:t.sdp})));case 19:throw e.prev=19,e.t0=e.catch(0),new aw(iw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 22:case"end":return e.stop()}}),e,this,[[0,19]])})));return function(){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.initialOffer.sdp&&iV(this.initialOffer.sdp)&&(u=t.rtpCapabilities,d=this.localCapabilities,u.send&&(wU(OM.VIDEO,u.send.videoExtensions,d.send.videoExtensions),wU(OM.AUDIO,u.send.audioExtensions,d.send.audioExtensions)),u.recv&&(wU(OM.VIDEO,u.recv.videoExtensions,d.recv.videoExtensions),wU(OM.AUDIO,u.recv.audioExtensions,d.recv.audioExtensions))),this.remoteSDP=new(function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];XC(this,"sessionDesc",void 0),XC(this,"_localCapabilities",void 0),XC(this,"_rtpCapabilities",void 0),XC(this,"_candidates",void 0),XC(this,"_originCandidates",void 0),XC(this,"_iceParameters",void 0),XC(this,"_isUseExtmapAllowMixed",void 0),XC(this,"_dtlsParameters",void 0),XC(this,"setup",void 0),XC(this,"currentMidIndex",void 0),XC(this,"cname",void 0),XC(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t;var n=e=Ww(e),r=n.iceParameters,i=n.dtlsParameters,a=n.candidates,o=n.rtpCapabilities,s=n.setup,c=n.localCapabilities,u=n.cname;this._rtpCapabilities=o,this._candidates=a,this._originCandidates=Ww(a),this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=c,this.setup=s,this.cname=u,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}var t=e.prototype;return t.preloadRemoteMedia=function(e){for(var t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,a=this.sessionDesc.mediaDescriptions.length-1,o=1;o<e;o++){var s=2*o+4e4,c=FU([{ssrcId:2*o+2e4}],this.cname),u=c.ssrcs,d=c.ssrcGroups,p=FU([{ssrcId:s,rtx:rk("USE_SUB_RTX")?s+1:void 0}],this.cname),l=p.ssrcs,h=p.ssrcGroups;this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:TF,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:h,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++a)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:TF,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++a)}}),this.currentMidIndex+=2}this.updateBundleMids()},t.toString=function(){return lk(this.sessionDesc)},t.send=function(e,t,n,r){var i=FU(t,this.cname,rk("SYNC_GROUP")?n:void 0),a=i.ssrcs,o=i.ssrcGroups,s=this.findPreloadMediaDesc(a);if(s){if(LA()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){var c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}var u,d=this.findAvailableMediaIndex(e,a);return-1===d||1===d&&(DA()||function(){var e=IA();return!(e.name!==bA.CHROME||!e.osVersion)&&Number(e.version)<=90}()||rk("ENABLE_ENCODED_TRANSFORM")&&NA())||0===d&&rk("USE_SUB_RTX")||HA()?(u=this.createOrRecycleSendMedia(e,a,o,"sendonly",r),this.updateBundleMids()):((u=Ww(this.sessionDesc.mediaDescriptions[d])).attributes.direction="sendonly",u.attributes.ssrcs=a,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(u,r)),LA()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}},t.sendDataChannel=function(){var e=this.createOrRecycleDataChannel(),t=e.mediaDesc,n=e.needExchangeSDP;return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:n}},t.batchSend=function(e){var t=this,n=e.map((function(e){var n=e.kind,r=e.ssrcMsg,i=e.mslabel;return t.send(n,r,i)})),r=[],i=!1;return n.forEach((function(e){var t=e.mid;e.needExchangeSDP&&(i=!0),r.push(t)})),{mids:r,needExchangeSDP:i}},t.stopSending=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){"0"===e.attributes.mid||LA()||HA()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()},t.mute=function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"},t.unmute=function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"},t.muteRemote=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return Br(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))},t.unmuteRemote=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return Br(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))},t.receive=function(e,t,n,r){var i=this;e.forEach((function(e,a){i.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[a])})),this.updateBundleMids()},t.stopReceiving=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()},t.updateRemoteRTPCapabilities=function(e){var t,n=this.sessionDesc||pk((t=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(t?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));this._rtpCapabilities=e;for(var r,i=this.rtpCapabilities.send,a=this.localCapabilities.send,o=h(n.mediaDescriptions);!(r=o()).done;){var s=r.value;if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,"application"===s.media.mediaType&&(s.attributes.sctpPort="5000"),"video"===s.media.mediaType)if(0===i.videoCodecs.length){var c=a.videoCodecs.filter((function(e){var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Br(n=t.encodingName.toLowerCase()).call(n,"vp8")}))||[a.videoCodecs[0]];s.media.fmts=c.map((function(e){return e.payloadType.toString(10)})),s.attributes.payloads=c,s.attributes.extmaps=[]}else if(s.media.fmts=i.videoCodecs.map((function(e){return e.payloadType.toString(10)})),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,rk("PRELOAD_MEDIA_COUNT")>0){var u=FU([{ssrcId:4e4,rtx:rk("USE_SUB_RTX")?40001:void 0}],this.cname),d=u.ssrcs,p=u.ssrcGroups;s.attributes.ssrcs=d,s.attributes.ssrcGroups=p}if("audio"===s.media.mediaType)if(0===i.audioCodecs.length){var l=a.audioCodecs.filter((function(e){var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Br(n=t.encodingName.toLowerCase()).call(n,"opus")}))||[a.audioCodecs[0]];s.media.fmts=l.map((function(e){return e.payloadType.toString(10)})),s.attributes.payloads=l,s.attributes.extmaps=[]}else if(s.media.fmts=i.audioCodecs.map((function(e){return e.payloadType.toString(10)})),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,QU(s),rk("PRELOAD_MEDIA_COUNT")>0){var f=FU([{ssrcId:2e4}],this.cname),_=f.ssrcs,v=f.ssrcGroups;s.attributes.ssrcs=_,s.attributes.ssrcGroups=v}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc},t.updateCandidates=function(e){var t=this._originCandidates.filter((function(e){return"udp"===e.transport})),n=[];if(t.forEach((function(e){n.push(gF(gF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case kM.TCP_RELAY:this._candidates=n;break;case kM.UDP_TCP_RELAY:case kM.RELAY:this._candidates=[].concat(t,n);break;default:this._candidates=t}for(var r,i=h(this.sessionDesc.mediaDescriptions);!(r=i()).done;)r.value.attributes.candidates=this.candidates}},t.restartICE=function(e){e=Ww(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))},t.predictReceivingMids=function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t},t.findAvailableMediaIndex=function(e,t){var n=this;return this.sessionDesc.mediaDescriptions.findIndex((function(r){var i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(LA()){if(i){var a=n.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!a||a!==r.attributes.mid)}return!1}return i}))},t.createOrRecycleDataChannel=function(){for(var e,t=h(this.sessionDesc.mediaDescriptions);!(e=t()).done;){var n=e.value;if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1}}this.currentMidIndex+=1;var r="".concat(this.currentMidIndex),i={media:{mediaType:"application",port:TF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(r),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(i),{mediaDesc:i,needExchangeSDP:!0}},t.createOrRecycleRecvMedia=function(e,t,n,r,i,a){var o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=ZU(o,s,this.localCapabilities.send,o===OM.VIDEO?r:i),u=o===OM.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;var d="".concat(this.currentMidIndex),p={media:{mediaType:o,port:TF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};p=this.mungRecvMediaDsec(p,e,a);var l=this.findFirstClosedMedia(o);if(l){var h=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[h]=p}else this.sessionDesc.mediaDescriptions.push(p);return p},t.updateRemoteCodec=function(e,t,n){var r=[].concat(new Set(this._rtpCapabilities.recv.videoCodecs.map((function(e){return e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""})).filter((function(e){var t;return Br(t=Object.keys(sk)).call(t,e)})))),i=new Set(t);if(r.every((function(e){return i.has(e)})))return Dk.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;var a=this._rtpCapabilities.recv.videoCodecs.filter((function(e){return t.some((function(t){var n;return Br(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))}));if(0===a.length)return Dk.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;var o,s=[].concat(new Set(a.map((function(e){return e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""}))));if(Dk.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter((function(e){return"video"===e.media.mediaType&&"recvonly"===e.attributes.direction}));else if((o=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&"video"===t.media.mediaType&&Br(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction}))).length!==e.length)return Dk.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(rk("USE_PUB_RTX")||rk("USE_SUB_RTX")){var c=$U(a,this.rtpCapabilities.recv.videoCodecs);a.push.apply(a,c)}this._rtpCapabilities.recv.videoCodecs=a;var u=this.localCapabilities.send,d=this.rtpCapabilities.recv,p=ZU(OM.VIDEO,d,u,n);return o.forEach((function(e){var t=p.map((function(e){return e.payloadType.toString(10)}));Dk.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",p),e.attributes.payloads=p,e.media.fmts=t})),!0},t.createOrRecycleSendMedia=function(e,t,n,r,i){var a=this.rtpCapabilities.send,o=e===OM.VIDEO?a.videoCodecs:a.audioCodecs,s=e===OM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;var c="".concat(this.currentMidIndex),u={media:{mediaType:e,port:TF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);var d=this.findFirstClosedMedia(e);if(d){var p=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[p]=u}else this.sessionDesc.mediaDescriptions.push(u);return u},t.updateBundleMids=function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))},t.mungRecvMediaDsec=function(e,t,n){var r=Ww(e);return jU(r),BU(r,t),GU(r,t),WU(r),HU(r,n,this.localCapabilities.send),r},t.mungSendMediaDesc=function(e,t){var n=Ww(e);return HU(n,t,this.localCapabilities.recv),QU(n),n},t.updateRecvMedia=function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}},t.bumpMid=function(e){this.currentMidIndex+=e},t.findFirstClosedMedia=function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return LA()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))},t.findPreloadMediaDesc=function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))},t.getSSRC=function(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===t?void 0:t.attributes.ssrcs},v(e,[{key:"localCapabilities",get:function(){return Ww(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return Ww(this._rtpCapabilities)}},{key:"candidates",get:function(){return Ww(this._candidates)}},{key:"iceParameters",get:function(){return Ww(this._iceParameters)}},{key:"dtlsParameters",get:function(){return Ww(this._dtlsParameters)}}]),e}())(HF(HF({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec),n=this.remoteSDP.toString(),r=nV(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect"),this.store.descriptionStart(),e.next=8,this.peerConnection.setLocalDescription({type:"offer",sdp:r});case 8:return null==i||i(n),e.next=11,this.peerConnection.setRemoteDescription({type:"answer",sdp:n});case 11:if(null!=(a=this.peerConnection.getTransceivers()[0])&&a.receiver&&this.tryBindTransportEvents(a.receiver),!(rk("PRELOAD_MEDIA_COUNT")>0)){e.next=22;break}return this.remoteSDP.preloadRemoteMedia(rk("PRELOAD_MEDIA_COUNT")),o=this.remoteSDP.toString(),e.next=17,this.peerConnection.setRemoteDescription({type:"offer",sdp:o});case 17:return e.next=19,this.peerConnection.createAnswer();case 19:return s=e.sent,e.next=22,this.peerConnection.setLocalDescription(s);case 22:if(c=t.preSSRCs,!(Array.isArray(c)&&c.length>0)){e.next=29;break}return this.remoteSDP.batchSend(c.map((function(e){return{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}}))).mids.forEach((function(e,t){p.preSSRCMap.set(c[t].ssrcId,e)})),e.next=28,eV(this.peerConnection,this.remoteSDP,this.extension);case 28:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."));case 29:e.next=34;break;case 31:throw e.prev=31,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 34:case"end":return e.stop()}}),e,this,[[0,31]])})));return function(t){return e.apply(this,arguments)}}(),n.updateRemoteConnect=function(){var e=p(l().mark((function e(t){var n,r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");case 3:return n=t.rtpCapabilities,this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec),r=t.preSSRCs,Array.isArray(r)&&r.length>0&&this.remoteSDP.batchSend(r.map((function(e){return Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})}))).mids.forEach((function(e,t){i.preSSRCMap.set(r[t].ssrcId,e)})),e.next=9,eV(this.peerConnection,this.remoteSDP,this.extension);case 9:Dk.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP."),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.t0.toString()));case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),n.send=function(e,t,n){var r=this;return OI(l().mark((function i(){var a,o,s,c,u,d,p,h,f,_,v,E;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,NI(r.mutex.lock("From P2PConnection.send"));case 2:if(a=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:if(o=[],s=IU(),e.forEach((function(e){var t=r.peerConnection.addTransceiver(e._mediaStreamTrack,HF({direction:"sendonly"},"video"===e.trackMediaType&&r.supportAV1RtpSpec&&s?{sendEncodings:[{scalabilityMode:s}]}:{}));o.push(t),e._updateRtpTransceiver(t)})),i.t0=LA()&&!0===rk("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,NI(r.applySimulcastForFirefox(o,e));case 12:return i.next=14,NI(r.peerConnection.createOffer());case 14:return c=i.sent,u=r.remoteSDP.predictReceivingMids(e.length),d=r.mungSendOfferSDP(c.sdp,e,u),p=pk(d),h=u.map((function(e){var t=p.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return MU(t,rk("USE_PUB_RTX"))})),i.prev=19,i.next=22,h;case 22:f=i.sent,i.next=36;break;case 25:return i.prev=25,i.t1=i.catch(19),f=[],r.remoteSDP.receive(e,t,n,f),_=r.remoteSDP.toString(),i.next=31,NI(r.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 31:return i.next=33,NI(r.peerConnection.setRemoteDescription({type:"answer",sdp:_}));case 33:return i.next=35,NI(r.stopSending(u,!0));case 35:throw i.t1;case 36:return r.remoteSDP.receive(e,t,n,f),v=r.remoteSDP.toString(),E=r.logSDPExchange(d,"offer","local","send"),i.next=40,NI(r.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 40:return i.next=42,NI(r.applySimulcastEncodings(o,e));case 42:return i.next=44,NI(r.applySendEncodings(o,e));case 44:return null==E||E(v),i.next=47,NI(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}));case 47:return i.abrupt("return",o.map((function(e,t){var n=u[t];return{localSSRC:h[t],id:n,transceiver:e}})));case 50:throw i.prev=50,i.t2=i.catch(3),i.t2 instanceof aw?i.t2:new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(i.t2.toString()));case 53:return i.prev=53,a(),i.finish(53);case 56:case"end":return i.stop()}}),i,null,[[3,50,53,56],[19,25]])})))()},n.createDataChannels=function(){var e=p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");case 3:if(!(r=this.dataStreamChannelMap.get(t))||"open"!==r.readyState){e.next=8;break}Dk.debug("[P2PConnection] Channels are already available and can be reused directly."),e.next=12;break;case 8:if("number"==typeof(i=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift())){e.next=11;break}throw new Error("create DataChannel error, because cannot get dc id");case 11:(r=this.peerConnection.createDataChannel("datastream-channel",{id:i,negotiated:!0,ordered:!1,maxRetransmits:rk("DATASTREAM_MAX_RETRANSMITS")})).binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r);case 12:if(n.forEach((function(e){e._updateOriginDataChannel(r)})),!this.remoteSDP.sendDataChannel().needExchangeSDP){e.next=26;break}return a=this.remoteSDP.toString(),e.next=18,this.peerConnection.setRemoteDescription({type:"offer",sdp:a});case 18:return e.next=20,this.peerConnection.createAnswer();case 20:return o=e.sent,e.next=23,this.peerConnection.setLocalDescription(o);case 23:Dk.debug("[P2PConnection] createDataChannels by exchanging SDP."),e.next=27;break;case 26:Dk.debug("[P2PConnection] createDataChannels no need to exchange SDP.");case 27:return e.abrupt("return");case 30:throw e.prev=30,e.t0=e.catch(0),e.t0 instanceof aw?e.t0:new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.t0.toString()));case 33:case"end":return e.stop()}}),e,this,[[0,30]])})));return function(t,n){return e.apply(this,arguments)}}(),n.stopDataChannels=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.dataStreamChannelMap.get(t),e.abrupt("return",(n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)));case 5:throw e.prev=5,e.t0=e.catch(0),e.t0 instanceof aw?e.t0:new aw(iw.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.t0.toString()));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),n.stopSending=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From P2PConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 11:if((i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)}))).length===t.length){e.next=14;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 14:return i.map((function(e){var t;LF(c.id+e.mid,c),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return a=e.sent,o=this.logSDPExchange(a.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(a);case 21:return this.remoteSDP.stopReceiving(t),s=this.remoteSDP.toString(),null==o||o(s),e.next=26,this.peerConnection.setRemoteDescription({type:"answer",sdp:s});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));return function(t,n){return e.apply(this,arguments)}}(),n.receive=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:if(a=this.remoteSDP.send(t,n,r,i),o=a.mid,s=a.needExchangeSDP,e.t0=s,!e.t0){e.next=9;break}return e.next=8,eV(this.peerConnection,this.remoteSDP,this.extension);case 8:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."));case 9:if(c=this.peerConnection.getTransceivers().find((function(e){return e.mid===o}))){e.next=12;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 12:return e.abrupt("return",{track:c.receiver.track,id:o,transceiver:c});case 15:throw e.prev=15,e.t1=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t1.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.batchReceive=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:if(n=this.remoteSDP.batchSend(t),r=n.mids,i=n.needExchangeSDP,e.t0=i,!e.t0){e.next=9;break}return e.next=8,eV(this.peerConnection,this.remoteSDP,this.extension);case 8:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."));case 9:return e.abrupt("return",r.map((function(e){var t=a.peerConnection.getTransceivers().find((function(t){return t.mid===e}));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})));case 12:throw e.prev=12,e.t1=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t1.toString()));case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),n.stopReceiving=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return t.forEach((function(e){Array.from(a.preSSRCMap.entries()).some((function(t){var n=t[0];if(t[1]===e)return a.preSSRCMap.delete(n),!0}))})),this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),n.muteRemote=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.mute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),n.unmuteRemote=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.unmute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),n.muteLocal=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),n.unmuteLocal=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})))),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec),a=this.remoteSDP.toString(),null==i||i(a),e.next=19,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 19:e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t){return e.apply(this,arguments)}}(),n.restartICE=function(e){var t=this;return OI(l().mark((function n(){var r,i,a,o,s,c,u,d,p,h,f;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,NI(t.mutex.lock("From P2PConnection.restartICE"));case 2:if(r=n.sent,n.prev=3,t.remoteSDP){n.next=6;break}throw new Error("Cannot restartICE before remoteSDP created.");case 6:if(i=Gk().supportPCSetConfiguration,a=rk("FORCE_TURN_TCP")||t.forceTurn,e!==kM.RELAY||i){n.next=9;break}return n.abrupt("return");case 9:return i&&!a&&(o=e===kM.RELAY?"relay":"all",(s=t.peerConnection.getConfiguration()).iceTransportPolicy!==o&&(Dk.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(s.iceTransportPolicy,"] to [").concat(o,"]")),s.iceTransportPolicy=o,t.peerConnection.setConfiguration(s))),t.remoteSDP.updateCandidates(e),n.next=13,NI(t.peerConnection.createOffer({iceRestart:!0}));case 13:if((c=n.sent).sdp){n.next=16;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 16:return u=xU(c.sdp),n.next=19,u.iceParameters;case 19:return d=n.sent,p=d.remoteIceParameters,t.remoteSDP.restartICE(p),h=t.remoteSDP.toString(),f=t.logSDPExchange(c.sdp||"","offer","local","restartICE"),t.store.descriptionStart(),n.next=26,NI(t.peerConnection.setLocalDescription(c));case 26:return null==f||f(h),n.next=29,NI(t.peerConnection.setRemoteDescription({type:"answer",sdp:h}));case 29:n.next=34;break;case 31:n.prev=31,n.t0=n.catch(3),Dk.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),n.t0);case 34:return n.prev=34,r(),n.finish(34);case 37:case"end":return n.stop()}}),n,null,[[3,31,34,37]])})))()},n.extendCandidate=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP&&!this.isFirstConnected){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.mutex.lock("From P2PConnection.extendCandidate");case 4:return t=e.sent,e.prev=5,this.remoteSDP.updateCandidates(kM.TCP_RELAY),e.next=9,eV(this.peerConnection,this.remoteSDP,this.extension);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),Dk.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e.t0);case 14:return e.prev=14,t(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[5,11,14,17]])})));return function(){return e.apply(this,arguments)}}(),n.close=function(){var e,t=this;this.peerConnection.getTransceivers().forEach((function(e){LF(t.id+e.mid,t)})),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1},n.getStats=function(){return HF(HF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})},n.getRemoteVideoIsReady=function(e){return this.statsFilter.getVideoIsReady(e)},n.updateEncoderConfig=function(){var e=p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),a=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==o||o(a),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),n.updateSendParameters=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=LA(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setStatsRemoteVideoIsReady=function(e,t){this.statsFilter.setVideoIsReady2(e,t)},n.replaceTrack=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.getSelectedCandidatePair=function(){var e=p(l().mark((function e(){var t,n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.peerConnection.getReceivers()).length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair())){e.next=4;break}return n=t[0].transport.iceTransport,r=n.getSelectedCandidatePair(),i=r.local,a=r.remote,e.abrupt("return",{local:HF(HF({},wO),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:HF(HF({},wO),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})});case 4:return e.abrupt("return",this.statsFilter.getSelectedCandidatePair());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.bindPCEvents=function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;"connected"===e.peerConnection.connectionState&&(e.isFirstConnected=!0),null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=function(t){if(t&&(t.errorCode||t.errorText)){var n,r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"";Dk.debug("[".concat(e.store.clientId,"] [p2pId: ").concat(e.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(t.url||"",", host_candidate:").concat(i)),null===(n=e.onICECandidateError)||void 0===n||n.call(e,r)}},this.peerConnection.onicegatheringstatechange=function(t){t&&t.target&&"iceGatheringState"in t.target&&Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),rk("CANDIDATE_TIMEOUT"))},n.unbindPCEvents=function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null},t.resolvePCConfiguration=function(e){var n,r,i,a,o={iceServers:[]};return e.iceServers?o.iceServers=e.iceServers:e.turnServer&&(ww(e.turnServer.servers)?o.iceServers=e.turnServer.servers:rk("NEW_TURN_MODE")&&o.iceServers?(rk("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&(n=o.iceServers).push.apply(n,t.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):(r=o.iceServers).push.apply(r,t.newTurnServerConfigToIceServers(e.turnServer.servers)),rk("NEW_FORCE_TURN")&&(o.iceTransportPolicy="relay")):"off"!==e.turnServer.mode&&(o.iceServers&&(i=o.iceServers).push.apply(i,t.turnServerConfigToIceServers(e.turnServer.servers)),rk("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&e.turnServer.serversFromGateway&&(a=o.iceServers).push.apply(a,t.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),rk("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(o.iceTransportPolicy="relay")})))),rk("ENABLE_ENCODED_TRANSFORM")&&Gk().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o},t.turnServerConfigToIceServers=function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(vU(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!rk("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t},t.newTurnServerConfigToIceServers=function(e){var t=[];return e.forEach((function(e){var n=rk("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(vU(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(vU(e.turnServerURL),":443?transport=tcp")}))})),t},n.tryBindTransportEvents=function(e){var t=this,n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=function(){var e;null!=n&&n.state&&(null===(e=t.onDTLSTransportStateChange)||void 0===e||e.call(t,n.state))},n.onerror=function(e){var n;null===(n=t.onDTLSTransportError)||void 0===n||n.call(t,"error"in e?e.error:e)};var r=n.iceTransport;r&&(r.onstatechange=function(){var e,r=null==n?void 0:n.iceTransport.state;r&&(null===(e=t.onICETransportStateChange)||void 0===e||e.call(t,r))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=function(){if(r.getSelectedCandidatePair()){var e=r.getSelectedCandidatePair(),n=e.local,i=e.remote;Dk.info("[".concat(t.store.clientId,"] [pc-").concat(t.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}},n.tryUnbindTransportEvents=function(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))},n.updateRtpSenderEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,h,f,_,v,E,m,S,g,T,b,R,C,y=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(a=this.peerConnection.getSenders(),n=a.find((function(e){return e.track===t._mediaStreamTrack}))),n){e.next=3;break}return e.abrupt("return",Dk.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(!this.isVP8Simulcast(t)){e.next=5;break}return e.abrupt("return",Dk.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings"));case 5:if(Gk().supportSetRtpSenderParameters){e.next=7;break}return e.abrupt("return",Dk.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters"));case 7:o={},s={},e.t0=t._optimizationMode,e.next="motion"===e.t0?11:"detail"===e.t0?13:"balanced"===e.t0?15:16;break;case 11:return o.degradationPreference="maintain-framerate",e.abrupt("break",16);case 13:return o.degradationPreference="maintain-resolution",e.abrupt("break",16);case 15:o.degradationPreference="balanced";case 16:return c=function(e,t){return e.getTransceivers().find((function(e){return e.sender.track===t||e.receiver.track===t}))}(this.peerConnection,t._mediaStreamTrack),u=dP(t),DF(t)&&c&&n&&u&&this.getLocalVideoStats&&Br(r=["vp8","vp9"]).call(r,this.store.codec)&&(h=o.degradationPreference||(Br(d=t._hints).call(d,sN.CUSTOM_TRACK)?rk("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate"),function(e,t,n,r,i,a){if(LF(e,n),i(t),"balanced"===r||"maintain-framerate"===r||"maintain-resolution"===r){var o=-1;AF(e,t);var s=window.setInterval((function(){var s=PF.get(e);if(!rk("ENABLE_AG_ADAPTATION")||!s)return LF(e,n),void i(t);var c=a();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===o)return void(o=Date.now());if(Date.now()-o<1e3)return;var u=c.sendFrameRate,d=c.OutgoingAvailableBandwidth,p=OF(e,u,d,s.adaptationConfig,t,r),l=p[0],h=p[1];h&&(n.qualityLimitationReason=h),l&&s.adaptationConfig.scale!==l.scale&&(Dk.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(u,", bwe ").concat(d,", switch from ").concat(s.adaptationConfig.scale," to ").concat(l.scale," ")),s.adaptationConfig=NF(NF({},s.adaptationConfig),l),i(l))}}),rk("CHECK_LOCAL_STATS_INTERVAL")),c=NF({},t);PF.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:i}),Dk.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}}(this.id+c.mid,u,this,h,(function(e){n&&y.updateAdaptation(n,e)}),this.getLocalVideoStats.bind(this))),t._encoderConfig&&(_=t._encoderConfig,v=_.bitrateMax,E=_.frameRate,m=_.scaleResolutionDownBy,v&&(s.maxBitrate=1e3*v),(Br(f=t._hints).call(f,sN.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(E&&(s.maxFramerate=mU(E)),m&&m>=1&&(s.scaleResolutionDownBy=m))),S=rk("ENCODER_CONFIG_LIMIT"),(g=S.maxFramerate)&&"number"==typeof g&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,g):g),rk("DSCP_TYPE")&&ZA()&&(b=rk("DSCP_TYPE"),Br(T=["very-low","low","medium","high"]).call(T,b)&&(s.networkPriority=b)),R=n.getParameters(),C=null===(i=R.encodings)||void 0===i?void 0:i[0],LA()&&!C&&(o.encodings=[s]),C&&Object.assign(C,s),Object.assign(R,o),Dk.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),e.next=28,n.setParameters(R);case 28:return e.next=30,p(l().mark((function e(t,n,r){var i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Gk().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(function(e){return"vp9"===e||"av1"===e}(t)&&rk("ENABLE_SVC")){e.next=5;break}return e.abrupt("return");case 5:return a={},o={},s=n.getParameters(),c=null===(i=s.encodings)||void 0===i?void 0:i[0],o.scalabilityMode=IU(r),c&&Object.assign(c,o),Object.assign(s,a),e.next=11,n.setParameters(s);case 11:Dk.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(s.encodings))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),Dk.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))(this.store.codec,n,rk("SVC_MODE"));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.updateAdaptation=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Dk.debug("[updateAdaptation] no rtpSender found"));case 2:if(Gk().supportSetRtpSenderParameters){e.next=4;break}return e.abrupt("return",Dk.debug("[updateAdaptation] Browser not support set rtp-sender parameters"));case 4:return a={},o=n.bitrateMax,s=n.frameRate,c=n.scaleResolutionDownBy,o&&(a.maxBitrate=1e3*o),s&&(a.maxFramerate=mU(s)),c&&c>=1&&Br(r=["vp8","vp9"]).call(r,this.store.codec)&&(a.scaleResolutionDownBy=c),u=t.getParameters(),(d=null===(i=u.encodings)||void 0===i?void 0:i[0])&&Object.assign(d,a),Object.assign(u,{}),e.prev=8,e.next=11,t.setParameters(u);case 11:Dk.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),!("transport"in t)||t.transport&&"connected"===t.transport.state?"connected"!==this.peerConnectionState?Dk.debug("[updateAdaptation] peerConnection not connected}"):Dk.debug("[updateAdaptation] updateRtpSenderEncodings failed",e.t0):Dk.debug("[updateAdaptation] rtpSender transport not connected}");case 17:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t,n){return e.apply(this,arguments)}}(),n.applySendEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Gk().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=a instanceof mL&&!this.isVP8Simulcast(a),!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i.sender);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),Dk.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t,n){return e.apply(this,arguments)}}(),n.mungSendOfferSDP=function(e,t,n){var r=this,i=pk(e);return t.forEach((function(e,t){var a=n[t],o=i.mediaDescriptions.find((function(e){return e.attributes.mid===a}));o&&(BU(o,e),KU(o,e,r.store.codec))})),lk(i)},n.bindStatsEvents=function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}},n.unbindStatsEvents=function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0},n.applySimulcastForFirefox=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(u=t[r],!((d=n[r])instanceof mL&&!Br(i=d._hints).call(i,sN.LOW_STREAM)&&null!==(a=d._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(o=d._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(s=d._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(c=d._scalabilityMode)||void 0===c?void 0:c.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return p={},h={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4},p.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}],f=u.sender.getParameters(),e.next=10,u.sender.setParameters(Object.assign(f,p));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.applySimulcastEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(LA()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof mL&&this.isVP8Simulcast(i))){e.next=10;break}return a=t[r],o={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}],c=a.sender.getParameters(),e.next=10,a.sender.setParameters(Object.assign(c,o));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.isVP8Simulcast=function(e){var t,n,r,i,a;return!!(e instanceof mL&&rk("SIMULCAST")&&"vp8"===this.store.codec&&!Br(t=e._hints).call(t,sN.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)},n.logSDPExchange=function(e,t,n,r){var i=this;if(rk("SDP_LOGGING"))return Dk.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0},n.getRemoteSSRC=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",n&&0!==n.length?n[0].ssrcId:void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setConfiguration=function(e){if(Gk().supportPCSetConfiguration){var n=t.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}},v(t,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"dtlsTransportState",get:function(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}},{key:"localCodecs",get:function(){return[].concat(new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((function(e){return e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""})).filter((function(e){var t;return Br(t=Object.keys(sk)).call(t,e)}))))}}]),t}(wM)).prototype,"updateRemoteRTPCapabilities",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"updateRemoteRTPCapabilities"),VF.prototype),Wx(VF.prototype,"connect",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"connect"),VF.prototype),Wx(VF.prototype,"updateRemoteConnect",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"updateRemoteConnect"),VF.prototype),Wx(VF.prototype,"createDataChannels",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"createDataChannels"),VF.prototype),Wx(VF.prototype,"receive",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"receive"),VF.prototype),Wx(VF.prototype,"batchReceive",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"batchReceive"),VF.prototype),Wx(VF.prototype,"stopReceiving",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"stopReceiving"),VF.prototype),Wx(VF.prototype,"muteRemote",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"muteRemote"),VF.prototype),Wx(VF.prototype,"unmuteRemote",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"unmuteRemote"),VF.prototype),Wx(VF.prototype,"muteLocal",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"muteLocal"),VF.prototype),Wx(VF.prototype,"unmuteLocal",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"unmuteLocal"),VF.prototype),Wx(VF.prototype,"close",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"close"),VF.prototype),Wx(VF.prototype,"updateEncoderConfig",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"updateEncoderConfig"),VF.prototype),Wx(VF.prototype,"updateSendParameters",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"updateSendParameters"),VF.prototype),Wx(VF.prototype,"replaceTrack",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"replaceTrack"),VF.prototype),Wx(VF.prototype,"updateAdaptation",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"updateAdaptation"),VF.prototype),Wx(VF.prototype,"getRemoteSSRC",[YF],Object.getOwnPropertyDescriptor(VF.prototype,"getRemoteSSRC"),VF.prototype),VF);function YF(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=p(l().mark((function e(){var n,i,a,o,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=c.length,o=new Array(a),s=0;s<a;s++)o[s]=c[s];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function qF(e,t){var n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=mU(t.width),r.height=mU(t.height);var i=mU(t.framerate||15);document.body.append(n),document.body.append(r);var a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();var o=r.getContext("2d");if(!o)throw new Bk(iw.UNEXPECTED_ERROR,"can not get canvas context");var s=Gk(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=function(){if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){var t=n.videoWidth,i=n.videoHeight/t,s=r.width*i;Math.abs(s-r.height)>=2&&(Dk.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(s)),r.height=s)}o.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=jN((function(){return r.startCapture&&r.startCapture()}),i);var u=c.stop;return c.stop=function(){u.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),Dk.debug("clean low stream renderer")},c}var zF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(zF||{}),XF=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(XF||{}),JF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(JF||{}),QF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(QF||{}),ZF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(ZF||{}),$F=1e3,eB=Math.max(6,3);function tB(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function nB(e){var t,n=((t={})[QF.CONN_TYPE]=0,t[QF.RTT]=e.rtt,t[QF.STATS_UPDATE_INTERVAL]=e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0,t);switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":var r=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(n[QF.CONN_TYPE]=1),"tcp"===r&&(n[QF.CONN_TYPE]=3),"tls"===r&&(n[QF.CONN_TYPE]=4);break;case"srflx":n[QF.CONN_TYPE]=2;break;case"unknown":n[QF.CONN_TYPE]=5;break;default:n[QF.CONN_TYPE]=0}return n}function rB(e){var t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}var iB,aB=function(e){function t(t){var n;return XC(r(n=e.call(this)||this),"store",void 0),XC(r(n),"uploadWRTCStatsTimer",void 0),XC(r(n),"uploadOutboundDenoiserStatsTimer",void 0),XC(r(n),"uploadExtStatsTimer",void 0),XC(r(n),"uploadExtUsageStatsTimer",void 0),XC(r(n),"uploadInboundExtStatsTimer",void 0),XC(r(n),"requestStats",void 0),XC(r(n),"requestTransportStats",void 0),XC(r(n),"requestLocalMedia",void 0),XC(r(n),"requestRemoteMedia",void 0),XC(r(n),"requestAllTracks",void 0),XC(r(n),"requestVideoIsReady",void 0),XC(r(n),"requestUploadStats",void 0),XC(r(n),"requestUpload",void 0),XC(r(n),"uploadOutboundStarted",!1),XC(r(n),"uploadInboundStarted",!1),XC(r(n),"uploadTransportStarted",!1),XC(r(n),"uploadBaseStatsStarted",!1),XC(r(n),"uploadExtensionUsageStarted",!1),XC(r(n),"lastRecvStats",void 0),XC(r(n),"lastSendStats",void 0),XC(r(n),"lastRefRecvStats",void 0),XC(r(n),"lastRefSendStats",void 0),XC(r(n),"lastNormalRecvStats",void 0),XC(r(n),"lastNormalSendStats",void 0),XC(r(n),"needUploadRenderFreezeTime",!0),XC(r(n),"lastUploadCompensateTime",-1),XC(r(n),"uploadCompensateDeltaTime",0),n.store=t,n}i(t,e);var n=t.prototype;return n.uploadWRTCStats=function(e){if(this.requestStats&&this.requestUploadStats){var t,n,r=e%3==0,i=e%6==0;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),t||n){var a,o,s={};if(this.uploadTransportStarted&&t){var c=this.getTransportStats(t,n,r);c&&(s.misc=[c])}if(this.uploadOutboundStarted&&t){var u=this.getOutboundStats(t,i?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats);u&&(s.outbound=[u])}if(this.uploadInboundStarted&&n){this.uploadCompensateStats(e);var d=this.getInboundStats(n,i?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);d&&(s.inbound=d)}var p=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;p&&(Array.isArray(s.misc)?s.misc[0]&&s.misc[0].addition&&(s.misc[0].addition[ZF.RTC_PEER_CONNECTION_STATE]=VO[p]):s.misc=[{addition:(a={},a[ZF.RTC_PEER_CONNECTION_STATE]=VO[p],a)}]),this.requestUploadStats(s)}this.lastRecvStats=n,this.lastSendStats=t,i&&(this.lastNormalRecvStats=n,this.lastNormalSendStats=t),r&&(this.lastRefRecvStats=n,this.lastRefSendStats=t)}},n.startUploadWRTCStats=function(){var e=this;if(!this.uploadWRTCStatsTimer){this.uploadBaseStatsStarted=!0;var t=1;this.uploadWRTCStatsTimer=window.setInterval((function(){if(!e.uploadTransportStarted&&!e.uploadInboundStarted&&!e.uploadOutboundStarted){if(e.uploadBaseStatsStarted){var n,r,i,a=null===(r=e.requestTransportStats)||void 0===r?void 0:r.call(e);return void(a&&(null===(i=e.requestUploadStats)||void 0===i||i.call(e,{misc:[{addition:(n={},n[ZF.RTC_PEER_CONNECTION_STATE]=VO[a.connectState],n)}]})))}return e.stopUploadWRTCStats()}e.uploadWRTCStats(t),++t===eB+1&&(t=1)}),$F)}},n.uploadCompensateStats=function(e){var t=this;if(this.requestStats&&this.requestUploadStats&&this.requestRemoteMedia){var n=e%3==0&&this.needUploadRenderFreezeTime;if(this.uploadInboundStarted&&n)if(-1!==this.lastUploadCompensateTime){var r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),!(this.uploadCompensateDeltaTime<6e3)){var i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;var a=this.requestStats(!0);new Array(i).fill(0).forEach((function(){if(t.requestStats&&t.requestUploadStats&&t.requestRemoteMedia){var e={};if(t.uploadInboundStarted&&a){var n=t.requestRemoteMedia()||[],r=[];n.forEach((function(e){var n=e[0],i=e[1],o={peer:n.uid};if(n._videoSSRC&&t.requestVideoIsReady&&t.requestVideoIsReady(n._videoSSRC)&&i.has(OM.VIDEO)&&n.videoTrack){var s=function(e,t,n){if(t.videoRecv.find((function(t){return t.ssrc===e}))){var r={};if(n&&n._player){var i=n._player,a=i.renderFreezeAccTime2,o=i.videoElementStatus;if("visible"===CL.visibility&&o===yN.PLAYING&&Gk().supportRequestVideoFrameCallback){var s=Math.min(6e3,a);i.renderFreezeAccTime2=Math.max(0,a-s),tB(r,zF.Video_Render_Freeze_Time_Render2,s),rk("USE_NEW_RENDER_FREEZE_TIME")&&tB(r,zF.Video_Render_Freeze_Time_Render,s)}}return r}}(n._videoSSRC,a,n.videoTrack);s&&(o.video=s)}o.video&&r.push(o)})),r.length>0&&(e.inbound=r,t.requestUploadStats(e))}}}))}}else this.lastUploadCompensateTime=Date.now()}},n.stopUploadWRTCStats=function(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0},n.getTransportStats=function(e,t,n){var r;if(this.requestStats){if(!n)return null==e.rtt?void 0:{addition:(r={},r[QF.RTT]=e.rtt,r[QF.CONN_TYPE]=void 0,r[QF.STATS_UPDATE_INTERVAL]=e.updateInterval||void 0,r)};var i=nB(e);if(this.store.useP2P){if(t){var a=nB(t);i[QF.CONN_TYPE]+=a[QF.CONN_TYPE]<<3}i[QF.CONN_TYPE]+=110}else i[QF.CONN_TYPE]+=100;return{addition:i}}},n.getOutboundStats=function(e,t,n,r){if(this.requestUploadStats&&this.requestLocalMedia){var i,a,o,s=this.requestLocalMedia();if(s&&0!==s.length)return s.forEach((function(r){var s=r[0],c=r[1],u=c.track,d=c.ssrcs;switch(s){case PM.LocalVideoLowTrack:case PM.LocalVideoTrack:if(s===PM.LocalVideoTrack){var p=function(e,t,n,r,i,a){var o=t.videoSend.find((function(t){return t.ssrc===e}));if(o){var s={},c=o.sentFrame,u=o.inputFrame;if(r&&(tB(s,zF.Video_Send_Qp_Sum,o.qpSumPerFrame),u&&c)){var d,p=u.frameRate,l=c.frameRate;s[zF.Video_Send_Freeze]=function(e,t){return!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5)}(p,l)?1:0,s[zF.Video_Send_Type]="CameraVideoTrack"===n.__className__?0:Br(d=n._hints).call(d,sN.SCREEN_TRACK)?1:2}if(i){switch(c&&(tB(s,XF.Video_Send_Height,c.height),tB(s,XF.Video_Send_Width,c.width),tB(s,XF.Video_Send_Frame_Rate,c.frameRate)),s[XF.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,o.adaptionChangeReason){case"none":s[XF.Video_Send_Adaptation]=0;break;case"cpu":s[XF.Video_Send_Adaptation]=1;break;case"bandwidth":s[XF.Video_Send_Adaptation]=2;break;case"other":s[XF.Video_Send_Adaptation]=3}var h=0;o.adaptionChangeReason&&(h+=rB(o.adaptionChangeReason)),t.qualityLimitationReason&&(h+=rB(t.qualityLimitationReason)<<3),s[XF.Video_Send_Adaptation]=h,s[XF.Video_Send_Player_Status]=AN[n._player?n._player.videoElementStatus:"uninit"],tB(s,XF.Video_Send_Nacks,o.nacksCount),tB(s,XF.Video_Send_Plis,o.plisCount),tB(s,XF.Video_Send_Firs,o.firsCount),tB(s,XF.Video_Send_Avg_Encode,o.avgEncodeMs),tB(s,XF.Video_Send_Huge_Frame_Sent,o.hugeFramesSent),tB(s,XF.Video_Send_Bytes_Retransmit,o.retransmittedBytesSent),tB(s,XF.Video_Send_Packages_Retransmit,o.retransmittedPacketsSent),tB(s,XF.Video_Send_Key_Frames_Encoded,o.keyFramesEncoded);var f=i.videoSend.find((function(t){return t.ssrc===e}));if(f){var _=3e3;f.timestamp&&o.timestamp&&(_=o.timestamp-f.timestamp),null!=f.packets&&null!=o.packets&&tB(s,XF.Video_Send_Package_Rate,1e3*(o.packets-f.packets)/_),null!=o.packetsLost&&null!=f.packetsLost&&tB(s,XF.Video_Send_Package_Lost,o.packetsLost-f.packetsLost),null!=f.bytes&&null!=o.bytes&&tB(s,XF.Video_Send_Bitrate,8*(o.bytes-f.bytes)/_)}}return s}}(d[0].ssrcId,e,u,t,n),l=u&&function(e,t,n,r){var i=t.videoSend.find((function(t){return t.ssrc===e}));if(!i)return null;var a={};if(r){var o=i.inputFrame,s=o&&o.height||n.videoHeight||0,c=o&&o.width||n.videoWidth||0,u=o&&o.frameRate||0;tB(a,XF.Video_Capture_Height,s),tB(a,XF.Video_Capture_Width,c),tB(a,XF.Video_Capture_Frame_Rate,u)}return a}(d[0].ssrcId,e,u,!!n),h=function(e,t){var n={};return t&&(tB(n,XF.Video_Send_Retransmit,e.bitrate.retransmit),tB(n,XF.Video_Send_Target_Encoded,e.bitrate.targetEncoded),tB(n,XF.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),tB(n,XF.Video_Send_Transmit,e.bitrate.transmit),tB(n,XF.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);a=Object.assign({},p,l,h)}else o=function(e,t,n,r,i){var a=t.videoSend.find((function(t){return t.ssrc===e}));if(a){var o={};if(r){var s=a.sentFrame;s&&(tB(o,XF.Video_Send_Low_Height,s.height),tB(o,XF.Video_Send_Low_Width,s.width),tB(o,XF.Video_Send_Low_Frame_Rate,s.frameRate));var c=r.videoSend.find((function(t){return t.ssrc===e}));if(c){var u=6e3;c.timestamp&&a.timestamp&&(u=a.timestamp-c.timestamp),null!=c.packets&&null!=a.packets&&tB(o,XF.Video_Send_Low_Package_Rate,1e3*(a.packets-c.packets)/u),null!=a.packetsLost&&null!=c.packetsLost&&tB(o,XF.Video_Send_Low_Package_Lost,a.packetsLost-c.packetsLost),null!=c.bytes&&null!=a.bytes&&tB(o,XF.Video_Send_Low_Bitrate,8*(a.bytes-c.bytes)/u)}}return o}}(d[0].ssrcId,e,0,n);break;case PM.LocalAudioTrack:i=u&&function(e,t,n,r,i,a){var o=t.audioSend.find((function(t){return t.ssrc===e}));if(o){var s={};if(i){s[XF.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;var c=100*n._source.getAccurateVolumeLevel(),u=o.inputLevel;if(null!=u){var d=Math.ceil(50*Math.log10(100*u+1));tB(s,XF.Audio_Send_Level,d)}tB(s,XF.Audio_Capture_PCM_Level,c),tB(s,XF.Audio_Send_AEC_Return_Loss,o.aecReturnLoss),tB(s,XF.Audio_Send_AEC_Return_Loss_Enhancement,o.aecReturnLossEnhancement),tB(s,XF.Audio_Send_Bytes_Retransmit,o.retransmittedBytesSent),tB(s,XF.Audio_Send_Packages_Retransmit,o.retransmittedPacketsSent),s[XF.Audio_Send_Freeze]=0;var p=i.audioSend.find((function(t){return t.ssrc===e}));if(p){var l=6e3;p.timestamp&&o.timestamp&&(l=o.timestamp-p.timestamp),null!=p.bytes&&null!=o.bytes&&tB(s,XF.Audio_Send_Bitrate,8*(o.bytes-p.bytes)/l),null!=p.packets&&null!=o.packets&&tB(s,XF.Audio_Send_Package_Rate,1e3*(o.packets-p.packets)/l)}}return s}}(d[0].ssrcId,e,u,0,n)}})),{high:a,low:o,audio:i}}},n.getInboundStats=function(e,t,n,r){var i=this;if(this.requestRemoteMedia){var a=this.requestRemoteMedia()||[],o=[];return a.forEach((function(a){var s=a[0],c=a[1],u={peer:s.uid};if(c.has(OM.VIDEO)&&s.videoTrack){var d=s._videoSSRC&&i.requestVideoIsReady&&i.requestVideoIsReady(s._videoSSRC)||!1,p=s.videoTrack?function(e,t,n,r,i,a,o,s){var c=t.videoRecv.find((function(t){return t.ssrc===e}));if(c){var u={},d=c.receivedFrame,p=c.outputFrame,l=c.decodeFrameRate;tB(u,JF.Video_Render_Frame_Rate_Decode,l),c.framesRateFirefox&&tB(u,JF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&tB(u,JF.Video_Recv_Frame_Rate,d.frameRate),tB(u,JF.Video_Recv_Frame_Dropped,c.framesDroppedCount),tB(u,JF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),tB(u,JF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),tB(u,JF.Video_Recv_Packages_Discarded,c.packetsDiscarded),tB(u,JF.Video_Recv_Avg_Decode,c.avgDecodeMs),tB(u,JF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),tB(u,JF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),tB(u,JF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),tB(u,JF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);var h=s&&s.videoRecv.find((function(t){return t.ssrc===e}));if(h){var f=t.timestamp-s.timestamp||$F;null!=c.packetsLost&&null!=h.packetsLost&&tB(u,JF.Video_Recv_Package_Lost,c.packetsLost-h.packetsLost),null!=h.bytes&&null!=c.bytes&&tB(u,JF.Video_Recv_Bitrate,8*(c.bytes-h.bytes)/f),null!=h.packets&&null!=c.packets&&tB(u,JF.Video_Recv_Package_Rate,1e3*(c.packets-h.packets)/f)}var _=a&&a.videoRecv.find((function(t){return t.ssrc===e}));if(_&&(tB(u,zF.Video_Recv_Qp_Sum,c.qpSumPerFrame),u[zF.Video_Recv_Freeze]=r&&_F.isRemoteVideoFreeze(n,c,_)?1:0),o){var v,E=o.videoRecv.find((function(t){return t.ssrc===e}));d?(tB(u,XF.Video_Recv_Height,d.height),tB(u,XF.Video_Recv_Width,d.width)):n&&(tB(u,XF.Video_Recv_Height,n._videoHeight||0),tB(u,XF.Video_Recv_Width,n._videoWidth||0)),p&&tB(u,XF.Video_Recv_Frame_Rate_Output,p.frameRate);var m=null===(v=n._player)||void 0===v?void 0:v.rendFrameRate.toFixed(0);if(m&&tB(u,XF.Video_Render_Frame_Rate_Render,+m),tB(u,XF.Video_Recv_Jitter_Buffer,c.jitterBufferMs),tB(u,XF.Video_Recv_Current_Delay,c.currentDelayMs),tB(u,XF.Video_Recv_Firs,c.firsCount),tB(u,XF.Video_Recv_Nacks,c.nacksCount),tB(u,XF.Video_Recv_Plis,c.plisCount),n){u[XF.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;var S=n._player;if(S){var g=S.freezeTimeCounterList,T=S.renderFreezeAccTime,b=S.renderFreezeAccTime2,R=S.videoElementStatus;if(g&&g.length>0&&tB(u,zF.Video_Render_Freeze_Time,g.splice(0,1)[0]),i&&"visible"===CL.visibility&&R===yN.PLAYING&&Gk().supportRequestVideoFrameCallback){var C=Math.min(6e3,b);S.renderFreezeAccTime2=Math.max(0,b-C),tB(u,zF.Video_Render_Freeze_Time_Render2,C);var y=Math.min(6e3,T);S.renderFreezeAccTime=Math.max(0,T-y),tB(u,zF.Video_Render_Freeze_Time_Render,rk("USE_NEW_RENDER_FREEZE_TIME")?C:y)}if("number"==typeof c.totalFreezesDuration){var I=E&&E.totalFreezesDuration?c.totalFreezesDuration-E.totalFreezesDuration:c.totalFreezesDuration;tB(u,XF.Video_Render_Freeze_Duration,1e3*I)}}}if(u[XF.Video_Recv_Player_Status]=AN[n._player?n._player.videoElementStatus:"uninit"],E&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==E.totalInterFrameDelay&&void 0!==E.totalSquaredInterFrameDelay){var A=c.totalInterFrameDelay-E.totalInterFrameDelay,w=c.totalSquaredInterFrameDelay-E.totalSquaredInterFrameDelay,O=c.framesDecodeCount-E.framesDecodeCount,k=A/O*1e3,N=Math.round(1e3*Math.sqrt((w-Math.pow(A,2)/O)/O));!isNaN(N)&&k+N>Math.max(3*k,k+150)&&(u[XF.Video_Recv_I_Frame_Delay]=N)}}return u}}(s._videoSSRC,e,s.videoTrack,!0===d,i.needUploadRenderFreezeTime,t,n,r):void 0;p&&(u.video=p)}if(c.has(OM.AUDIO)&&s.audioTrack){var l=s.audioTrack?function(e,t,n,r,i,a){var o=t.audioRecv.find((function(t){return t.ssrc===e}));if(o){var s={};tB(s,JF.Audio_Recv_Jitter,o.jitterMs),tB(s,JF.Audio_Recv_Bytes_Retransmit,o.retransmittedBytesReceived),tB(s,JF.Audio_Recv_Packages_Retransmit,o.retransmittedPacketsReceived),tB(s,JF.Audio_Recv_Packages_Discarded,o.packetsDiscarded),tB(s,JF.Audio_Recv_Avg_Processing_Delay,o.avgProcessingDelayMs);var c,u=a&&a.audioRecv.find((function(t){return t.ssrc===e}));if(u&&(null!=o.packets&&null!=u.packets&&tB(s,JF.Audio_Recv_Package_Rate,1e3*(o.packets-u.packets)/1e3),null!=o.packetsLost&&null!=u.packetsLost&&tB(s,JF.Audio_Recv_Package_Lost,o.packetsLost-u.packetsLost)),r){var d=o.receivedFrames,p=o.droppedFrames;null!=d&&null!=p&&(s[zF.Audio_Recv_Freeze]=0===(c=d)||100*p/c>20?1:0)}if(i){var l=100*n._source.getAccurateVolumeLevel(),h=o.outputLevel;if(null!=h){var f=Math.ceil(50*Math.log10(100*h+1));tB(s,XF.Audio_Render_Level,f)}tB(s,XF.Audio_Recv_PCM_Level,l),n&&(s[XF.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),tB(s,XF.Audio_Recv_Jitter_Buffer,o.jitterBufferMs),tB(s,XF.Audio_Recv_Current_Delay,o.jitterBufferMs),s[XF.Audio_Recv_Player_Status]=AN[lD.getPlayerState(n.getTrackId())];var _=i.audioRecv.find((function(t){return t.ssrc===e}));if(_){null!=_.bytes&&null!=o.bytes&&tB(s,XF.Audio_Recv_Bitrate,8*(o.bytes-_.bytes)/3e3);var v=o.concealedSamples-_.concealedSamples;v>0&&tB(s,XF.Audio_Recv_Concealed_Samples,v);var E=o.totalSamplesReceived-_.totalSamplesReceived;E>0&&tB(s,XF.Audio_Recv_Total_Samples_Received,E);var m=o.freezeSamples80-_.freezeSamples80;m>0&&tB(s,XF.Audio_Render_Freeze_Samples_80ms,m);var S=o.freezeSamples200-_.freezeSamples200;S>0&&tB(s,XF.Audio_Render_Freeze_Samples_200ms,S);var g=o.freezeMs80-_.freezeMs80;tB(s,XF.Audio_Render_Freeze_Time_80ms,g<0?0:g);var T=o.freezeMs200-_.freezeMs200;tB(s,XF.Audio_Render_Freeze_Time_200ms,T<0?0:T)}}return s}}(s._audioSSRC,e,s.audioTrack,t,n,r):void 0;l&&(u.audio=l)}(u.video||u.audio)&&o.push(u)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}},n.startUploadTransportStats=function(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()},n.stopUploadTransportStats=function(){this.uploadTransportStarted=!1},n.startUploadOutboundStats=function(){var e=this;this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((function(){if(e.requestAllTracks&&e.requestUpload){var t=(e.requestAllTracks()||[]).find((function(e){return e instanceof _P}));if(t&&t._external.getDenoiserStats){var n=t._external.getDenoiserStats();n&&e.requestUpload(Zx.DENOISER_STATS,n)}}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((function(){e.requestAllTracks&&e.requestUpload&&e.requestAllTracks().forEach((function(t){t.getProcessorStats().forEach((function(t){e.requestUpload&&e.requestUpload(t.type,t.stats)}))}))}),2e3))},n.stopUploadOutboundStats=function(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)},n.startUploadInboundStats=function(){var e=this;this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((function(){e.requestUpload&&e.requestRemoteMedia&&(e.requestRemoteMedia()||[]).forEach((function(t){var n=t[0],r=t[1];r.has(OM.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach((function(t){e.requestUpload&&e.requestUpload(t.type,t.stats)})),r.has(OM.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach((function(t){e.requestUpload&&e.requestUpload(t.type,t.stats)}))}))}),2e3))},n.stopUploadInboundStats=function(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)},n.startUploadExtensionUsageStats=function(){var e=this;if(!this.uploadExtensionUsageStarted){this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);var t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(p(l().mark((function n(){var r,i,a,o,s,c,u,d,p,f,_,v,E,m,S;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=Date.now(),i={connectionInterval:rk("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},a=[],o=e.requestAllTracks&&e.requestAllTracks()||[],s=h(o);case 4:if((c=s()).done){n.next=15;break}if(u=c.value,n.t0=!u.muted&&u.enabled,!n.t0){n.next=13;break}return n.t1=a,n.next=11,u.getProcessorUsage();case 11:n.t2=n.sent,a=n.t1.concat.call(n.t1,n.t2);case 13:n.next=4;break;case 15:d=e.requestRemoteMedia&&e.requestRemoteMedia()||[],p=h(d);case 17:if((f=p()).done){n.next=35;break}if(_=f.value,v=_[0],E=_[1],n.t3=E.has(OM.VIDEO)&&v.videoTrack,!n.t3){n.next=26;break}return n.t4=a,n.next=24,v.videoTrack.getProcessorUsage();case 24:n.t5=n.sent,a=n.t4.concat.call(n.t4,n.t5);case 26:if(n.t6=E.has(OM.AUDIO)&&v.audioTrack,!n.t6){n.next=33;break}return n.t7=a,n.next=31,v.audioTrack.getProcessorUsage();case 31:n.t8=n.sent,a=n.t7.concat.call(n.t7,n.t8);case 33:n.next=17;break;case 35:if(0!==a.length){n.next=37;break}return n.abrupt("return");case 37:i.details=function(e,t){for(var n,r={},i=h(e);!(n=i()).done;){var a,o,s,c=n.value,u=c.id,d=c.value,p=c.level,l=c.direction,f=null!==(a=t.get(u))&&void 0!==a?a:0,_=2===d?f+rk("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:f;t.set(u,_),r[u]?(2===d&&(r[u].value=d),p>r[u].level&&(r[u].level=p),"remote"===l&&(r[u].remoteUidCount+=1),r[u].totalTs=null!==(o=t.get(u))&&void 0!==o?o:0):r[u]={value:d,level:p,remoteUidCount:"local"===l?0:1,totalTs:null!==(s=t.get(u))&&void 0!==s?s:0}}return Object.keys(r).map((function(e){var t=r[e];return{id:e,level:t.level,value:t.value,totalTs:t.totalTs}}))}(a,t),m=Date.now(),S=m>r?m:r+1,e.requestUpload&&e.requestUpload(Zx.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:S});case 40:case"end":return n.stop()}}),n)}))),rk("EXTENSION_USAGE_UPLOAD_INTERVAL"))}},n.stopUploadExtensionUsageStats=function(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)},n.stopUploadBaseStats=function(){this.uploadBaseStatsStarted=!1},t}(gw),oB=rk("ICE_RESTART_INTERVAL"),sB=new Map,cB=new Map,uB=[kM.UDP_TCP_RELAY,kM.TCP_RELAY,kM.RELAY],dB=rk("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Gk().supportPCSetConfiguration;function pB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=sB.get(e.id);n&&(window.clearTimeout(n),sB.delete(e.id));var r=cB.get(e.id);t&&r&&r.index===uB.length-1&&(Dk.debug("[".concat(e.id,"] reset ICE restart policy")),cB.delete(e.id))}function lB(e,t,n){if(0===sB.size&&0===cB.size&&(Array.isArray(rk("RESTART_SEQUENCE"))&&rk("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(var n,r=function(){var n=e[i];if(e.filter((function(e){return e===n})).length!==t.filter((function(e){return e===n})).length)return{v:!1}},i=0;i<e.length;i+=1)if(n=r())return n.v;return!0}(uB,rk("RESTART_SEQUENCE"))&&(uB=rk("RESTART_SEQUENCE").filter((function(e){var t;if(Br(t=Object.values(kM)).call(t,e))return!0})),Dk.debug("use reconnection policy from config distribution, queues: ".concat(uB.join(" => ")))),dB=rk("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Gk().supportPCSetConfiguration),0!==uB.length){var r,i=cB.get(e.id)||{},a=i.index,o=void 0===a?0:a,s=i.type;if(dB&&s===kM.RELAY)n();else{var c=s&&o>=uB.length-1;if(dB)s=kM.RELAY;else{if(c)return void n();s?(o++,s=uB[o]):(s=uB[0],o=0)}Dk.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(o)),t(s),cB.set(e.id,{index:o,type:s}),r=window.setTimeout((function(){return lB(e,t,n)}),oB),sB.set(e.id,r)}}else n()}function hB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hB(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _B(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=PI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new vB(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function vB(e){function t(e){if(Object(e)!==e)return zl.reject(new TypeError(e+" is not an object."));var t=e.done;return zl.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(vB=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?zl.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?zl.reject(e):t(n.apply(this.s,arguments))}},new vB(e)}var EB=(Wx((iB=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"isPlanB",void 0),XC(r(i),"store",void 0),XC(r(i),"statsUploader",void 0),XC(r(i),"connection",void 0),XC(r(i),"localTrackMap",new Map),XC(r(i),"remoteUserMap",new Map),XC(r(i),"localDataChannels",[]),XC(r(i),"remoteDataChannelMap",new Map),XC(r(i),"pendingLocalTracks",[]),XC(r(i),"pendingRemoteTracks",[]),XC(r(i),"pendingLocalDataChannels",[]),XC(r(i),"pendingRemoteDataChannels",[]),XC(r(i),"statsCollector",void 0),XC(r(i),"shouldForwardP2PCreation",void 0),XC(r(i),"iceFailedCount",0),XC(r(i),"dtlsFailedCount",0),XC(r(i),"mutex",void 0),XC(r(i),"_state",LM.Disconnected),XC(r(i),"_pcStatsUploadType",rk("NEW_ICE_RESTART")?NM.FIRST_CONNECTION:NM.OLD_FIRST_CONNECTION),XC(r(i),"_isStartRestartIce",!1),XC(r(i),"_restartTimer",void 0),XC(r(i),"_isTryConnecting",!1),XC(r(i),"_iceError",null),XC(r(i),"_forceTurn",!1),XC(r(i),"_isWaitPcToRePub",!1),XC(r(i),"handleMuteLocalTrack",p(l().mark((function e(t,n,a){var o,s,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.connection&&i.state===LM.Connected){e.next=6;break}return e.abrupt("return",void a(new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established.")));case 6:if(0!==(s=i.filterTobeMutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return(c=s.find((function(e){return"videoLowTrack"===e[0]})))&&c[1].track._originMediaStreamTrack.stop(),e.next=13,i.connection.muteLocal(s.map((function(e){return e[1].id})));case 13:return u=i.createMuteMessage(s),e.next=16,Mw(r(i),xM.RequestMuteLocal,u);case 16:n(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),a(e.t0);case 22:return e.prev=22,o(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,19,22,25]])})))),XC(r(i),"handleUnmuteLocalTrack",p(l().mark((function e(t,n,a){var o,s,c,u,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.connection&&i.state===LM.Connected){e.next=6;break}return e.abrupt("return",void a(new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established.")));case 6:if(0!==(s=i.filterTobeUnmutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:if(!(c=s.find((function(e){return"videoLowTrack"===e[0]})))){e.next=15;break}return(u=c[1]).track._originMediaStreamTrack.stop(),!rk("DISABLE_DUAL_STREAM_USE_ENCODING")&&Gk().supportDualStreamEncoding?(d=t._mediaStreamTrack.clone(),u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d):(p=qF(t,Vw(r(i),xM.RequestLowStreamParameter)),u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p),e.next=15,new zl((function(e,t){i.handleReplaceTrack(u.track,e,t,!0)}));case 15:return e.next=17,i.connection.unmuteLocal(s.map((function(e){return e[1].id})));case 17:return h=i.createUnmuteMessage(s),e.next=20,Mw(r(i),xM.RequestUnmuteLocal,h);case 20:n(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a(e.t0);case 26:return e.prev=26,o(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[3,23,26,29]])})))),XC(r(i),"handleUpdateVideoEncoder",p(l().mark((function e(t,n,r,a){var o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a,e.t0){e.next=5;break}return e.next=4,i.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder");case 4:o=e.sent;case 5:if(e.prev=5,s=i.localTrackMap.get(PM.LocalVideoTrack),i.connection&&s&&s.track===t&&i.state===LM.Connected){e.next=9;break}return e.abrupt("return",void n());case 9:return c=s.id,u=s.track,e.next=12,i.connection.updateSendParameters(c,u);case 12:return e.next=14,i.connection.updateEncoderConfig(c,u);case 14:i.emit(xM.UpdateVideoEncoder,u),n(),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(5),r(e.t1);case 21:return e.prev=21,null===(d=o)||void 0===d||d(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[5,18,21,24]])})))),XC(r(i),"handleUpdateVideoSendParameters",p(l().mark((function e(t,n,r){var a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(PM.LocalVideoTrack),i.connection&&o&&o.track===t&&i.state===LM.Connected){e.next=7;break}return e.abrupt("return",void n());case 7:return s=o.id,c=o.track,e.next=10,i.connection.updateSendParameters(s,c);case 10:n(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r(e.t0);case 16:return e.prev=16,a(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})))),XC(r(i),"handleReplaceMixingTrack",p(l().mark((function e(t,n,r,a){var o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.connection&&i.state===LM.Connected){e.next=2;break}return e.abrupt("return",void n());case 2:if(o=UF([t]),Dk.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),e.t0="boolean"==typeof a&&a,e.t0){e.next=9;break}return e.next=8,i.mutex.lock("From P2PChannel.handleReplaceMixingTrack");case 8:s=e.sent;case 9:return e.prev=9,e.next=12,i.replaceTrack(t,o);case 12:n(),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(9),r(e.t1);case 18:return e.prev=18,null===(c=s)||void 0===c||c(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[9,15,18,21]])})))),XC(r(i),"handleReplaceTrack",p(l().mark((function e(t,n,r,a){var o,s,c,u,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("[".concat(i.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),e.t0="boolean"==typeof a&&a,e.t0){e.next=6;break}return e.next=5,i.mutex.lock("From P2PChannel.handleReplaceTrack");case 5:o=e.sent;case 6:if(e.prev=6,c=Array.from(i.localTrackMap.entries()).find((function(e){var n=e[1].track;return t===n})),i.connection&&c&&i.state===LM.Connected){e.next=10;break}return e.abrupt("return",void n());case 10:return e.next=12,null===(s=i.connection)||void 0===s?void 0:s.replaceTrack(t,c[1].id);case 12:if(!i.isPlanB){e.next=15;break}(u=c[1]).id=t._mediaStreamTrack.id,i.localTrackMap.set(c[0],u);case 15:if(c[0]!==PM.LocalVideoTrack||rk("DISABLE_DUAL_STREAM_USE_ENCODING")||!Gk().supportDualStreamEncoding){e.next=24;break}if(!(d=i.localTrackMap.get(PM.LocalVideoLowTrack))){e.next=24;break}return p=t._mediaStreamTrack.clone(),d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=p,d.track._originMediaStreamTrack=p,e.next=24,new zl((function(e,t){i.handleReplaceTrack(d.track,e,t,!0)}));case 24:n(),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(6),r(e.t1);case 30:return e.prev=30,null===(h=o)||void 0===h||h(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[6,27,30,33]])})))),XC(r(i),"handleGetRTCStats",(function(e){e(i.statsCollector.getRTCStats())})),XC(r(i),"handleGetLocalVideoStats",(function(e){e(i.statsCollector.getLocalVideoTrackStats())})),XC(r(i),"handleGetLocalAudioStats",(function(e){e(i.statsCollector.getLocalAudioTrackStats())})),XC(r(i),"handleGetRemoteVideoStats",(function(e){return i.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]})),XC(r(i),"handleGetRemoteAudioStats",(function(e){return i.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]})),i.store=t,i.statsCollector=n,i.statsCollector.addP2PChannel(r(i)),i.statsUploader=new aB(i.store),i.bindStatsUploaderEvents(),i.mutex=new fO("P2PChannel-mutex",i.store.clientId),i.isPlanB=!Gk().supportUnifiedPlan||rk("CHROME_FORCE_PLAN_B")&&ZA(),i.shouldForwardP2PCreation=rk("FORWARD_P2P_CREATION")&&Gk().supportPCSetConfiguration&&QA(),i.shouldForwardP2PCreation&&(i.connection=BF(i.store),i.emit(xM.PeerConnectionStateChange,i.connection.peerConnectionState),i.bindConnectionEvents(i.connection)),i}i(t,e);var n=t.prototype;return n.startP2PConnection=function(){var e=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=LM.New,this._forceTurn=GF(t),Dk.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn)),r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState),this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(Dk.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=BF(this.store,t),this.emit(xM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.connection){e.next=4;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");case 4:return e.abrupt("return",(this._pcStatsUploadType=rk("NEW_ICE_RESTART")?NM.FIRST_CONNECTION:NM.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");case 2:if(!rk("ENABLE_PREALLOC_PC")||this.state!==LM.Connected){e.next=7;break}return e.next=5,this.connection.updateRemoteConnect(t);case 5:e.next=13;break;case 7:return this.store.peerConnectionStart(),e.next=10,this.connection.connect(t);case 10:this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=LM.Connected;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.updateRemoteRTPCapabilities=function(e){var t=Array.from(this.localTrackMap.entries()).filter((function(e){var t,n=e[0];return Br(t=[PM.LocalVideoLowTrack,PM.LocalVideoTrack]).call(t,n)})),n=t.map((function(e){return e[1].id})),r=t.map((function(e){return e[0]}));if(this.connection instanceof KF){if(Fk.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Br(e).call(e,this.store.codec)){var i=["vp9","vp8","h264"].find((function(t){return Br(e).call(e,t)}));i&&(this.store.codec=i,Dk.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}},n.getEstablishParams=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.connection instanceof KF&&"closed"!==this.connection.peerConnectionState&&Br(t=[LM.New,LM.Connected]).call(t,this.state))){e.next=2;break}return e.abrupt("return",this.connection.establishPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.publishDataChannel=function(){var e=p(l().mark((function e(t){var n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=4;break}if(this.state!==LM.Disconnected){e.next=3;break}throw new aw(iw.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 3:return e.abrupt("return",(t.forEach((function(e){var t;Br(t=r.pendingLocalDataChannels).call(t,e)||r.pendingLocalDataChannels.push(e)})),[]));case 4:if(0!==(n=this.filterTobePublishedDataChannels(t)).length){e.next=9;break}e.t0=[],e.next=14;break;case 9:return n.forEach((function(e){var t=Date.now();r.store.publish(e.id.toString(),"datachannel",t)})),e.next=12,this.connection.createDataChannels(this.store.uid,n);case 12:n.forEach((function(e){r.localDataChannels.push(e);var t=Date.now();r.store.publish(e.id+"","datachannel",void 0,t)})),e.t0=t.map((function(e){return{streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId}}));case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.publish=function(e,t,n){var r=this;return OI(l().mark((function i(){var a,o,s,c,u;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,NI(r.mutex.lock("From P2PChannel.publish"));case 2:if(a=i.sent,i.prev=3,s=r.connection&&Br(o=["disconnected","failed"]).call(o,r.connection.peerConnectionState),r.connection&&r.state===LM.Connected&&!s){i.next=11;break}if(r.state!==LM.Disconnected){i.next=8;break}throw new aw(iw.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 8:return r.throwIfTrackTypeNotMatch(e),c=e.filter((function(e){return-1===r.pendingLocalTracks.indexOf(e)})),i.abrupt("return",(r.pendingLocalTracks=r.pendingLocalTracks.concat(c),void(s&&(r._isWaitPcToRePub=!0))));case 11:if(r.store.pubId=r.store.pubId+1,lF.markPublishStart(r.store.clientId,r.store.pubId),0!==(u=r.filterTobePublishedTracks(e,t,n)).length){i.next=17;break}return i.next=16,NI(r.tryToUnmuteAudio(e));case 16:return i.abrupt("return",void i.sent);case 17:return i.delegateYield(DI(_B(r.doPublish(r.connection,u))),"t0",18);case 18:return i.prev=18,a(),i.finish(18);case 21:case"end":return i.stop()}}),i,null,[[3,,18,21]])})))()},n.doPublish=function(e,t){var n=this;return OI(l().mark((function r(){var i,a,o,s,c,u,d,h,f;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===PM.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t),i=t.map((function(e){return e.track})),r.next=4,NI(e.send(i,n.store.codec,n.store.audioCodec));case 4:return a=r.sent,r.next=7,NI(a.next());case 7:return o=r.sent.value,s=n.createGatewayPublishMessage(t,o),r.prev=9,r.next=12,s;case 12:c=r.sent,r.next=18;break;case 15:throw r.prev=15,r.t0=r.catch(9),a.throw(r.t0),(null==r.t0?void 0:r.t0.code)===iw.WS_ABORT&&t.forEach((function(e){var t=e.track;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),r.t0;case 18:return u=n.mapPubResToRemoteConfig(s,c,i),r.next=21,NI(a.next(u));case 21:if(d=r.sent.value,n.state!==LM.Disconnected){r.next=24;break}throw new aw(iw.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 24:rk("ENABLE_VIDEO_SEI"),h=rk("ENABLE_ENCODED_TRANSFORM"),f=rk("ENABLE_AUDIO_METADATA"),i.forEach(p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.getRTCRtpTransceiver())&&h){e.next=3;break}return e.abrupt("return");case 3:if(r=lV(),i=r.interceptLocalVideoFrame,a=r.interceptLocalAudioFrame,t.trackMediaType!==OM.VIDEO){e.next=9;break}return e.next=7,i(n.sender,t);case 7:e.next=13;break;case 9:if(e.t0=t.trackMediaType===OM.AUDIO,!e.t0){e.next=13;break}return e.next=13,a(n.sender,{metadata:f?function(){var e=t.metadata.shift();return e&&e.value}:void 0});case 13:case"end":return e.stop()}}),e)})))),t.forEach((function(e){var t=e.type;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,d),n.statsUploader.startUploadOutboundStats(),t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===PM.LocalAudioTrack?"audio":"video",void 0,i)}));case 27:case"end":return r.stop()}}),r,null,[[9,15]])})))()},n.updateVideoStreamParameter=function(){var e=p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.localTrackMap.get(n))&&this.connection){e.next=3;break}return e.abrupt("return");case 3:if(r.track instanceof mL){e.next=5;break}return e.abrupt("return",Dk.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack"));case 5:if(i=r.track,a=function(e,t){var n={};return e.height&&e.width&&(n.scaleResolutionDownBy=CU(e,t)),n.maxFramerate=e.framerate?mU(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(t,i),i._encoderConfig||(i._encoderConfig={}),n===PM.LocalVideoLowTrack&&(rk("DISABLE_DUAL_STREAM_USE_ENCODING")||!Gk().supportDualStreamEncoding)){e.next=10;break}null!=a.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy),e.next=14;break;case 10:if((o=i._originMediaStreamTrack).canvas){e.next=13;break}return e.abrupt("return",Dk.warn("[".concat(i.getTrackId(),"] no canvas on track")));case 13:!function(e,t){var n=e.canvas;t.width&&(n.width=mU(t.width)),t.height&&(n.height=mU(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=jN((function(){!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),mU(t.framerate)))}(o,t);case 14:return null!=a.maxBitrate&&(i._encoderConfig.bitrateMax=a.maxBitrate/1e3),null!=a.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=a.maxFramerate:i._encoderConfig.frameRate={max:a.maxFramerate}),Dk.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),e.next=19,this.connection.updateRtpSenderEncodings(i);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.publishLowStream=function(e){var t=this;return OI(l().mark((function n(){var r,i,a,o,s;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.connection&&t.state===LM.Connected){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,NI(t.mutex.lock("Locking from P2PChannel.publishLowStream"));case 4:if(r=n.sent,n.prev=5,i=t.localTrackMap.get(PM.LocalVideoTrack)){n.next=9;break}throw new aw(iw.UNEXPECTED_ERROR,"Could not find high stream");case 9:if(!t.localTrackMap.has(PM.LocalVideoLowTrack)){n.next=11;break}throw new aw(iw.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));case 11:return a=[{track:t.getLowVideoTrack(i.track,e),type:PM.LocalVideoLowTrack}],n.delegateYield(DI(_B(t.doPublish(t.connection,a))),"t0",13);case 13:if(!i.track.muted&&i.track.enabled){n.next=19;break}if(s=null===(o=t.localTrackMap.get(PM.LocalVideoLowTrack))||void 0===o?void 0:o.id,n.t1=void 0!==s,!n.t1){n.next=19;break}return n.next=19,NI(t.connection.muteLocal([s]));case 19:return n.prev=19,r(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[5,,19,22]])})))()},n.republish=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.pendingLocalTracks.length>0,!e.t0){e.next=7;break}return Dk.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),e.next=5,xw(this,xM.RequestRePublish,this.pendingLocalTracks);case 5:this.emit(xM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[];case 7:if(e.t1=this.pendingLocalDataChannels.length>0,!e.t1){e.next=13;break}return Dk.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),e.next=12,xw(this,xM.RequestRePublishDataChannel,this.pendingLocalDataChannels);case 12:this.pendingLocalDataChannels=[];case 13:this._isWaitPcToRePub=!1;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reSubscribe=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.pendingRemoteTracks.length-1;n>=0;n--)r=this.pendingRemoteTracks[n],i=r.user,((a=r.kind)!==OM.AUDIO||i._audio_added_&&i._audioSSRC)&&(a!==OM.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1);if(!t){e.next=6;break}return e.next=4,xw(this,xM.RequestReSubscribe,this.pendingRemoteTracks);case 4:e.next=13;break;case 6:o=h(this.pendingRemoteTracks);case 7:if((s=o()).done){e.next=13;break}return c=s.value,u=c.user,d=c.kind,e.next=11,this.subscribe(u,d,d===OM.VIDEO?u._videoSSRC:u._audioSSRC);case 11:e.next=7;break;case 13:this.pendingRemoteTracks.forEach((function(e){var t=e.user;p.emit(xM.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[];case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.unpublish=function(){var e=p(l().mark((function e(t){var n,r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}return e.abrupt("return",void t.forEach((function(e){var t=i.pendingLocalTracks.indexOf(e);-1!==t&&i.pendingLocalTracks.splice(t,1)})));case 2:if(0!==(n=this.filterTobeUnpublishedTracks(t)).length){e.next=5;break}return e.abrupt("return");case 5:return(r=n.find((function(e){return"videoLowTrack"===e[0]})))&&r[1].track.close(),e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.unpublishDataChannel=function(){var e=p(l().mark((function e(t){var n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}return e.abrupt("return",void t.forEach((function(e){var t=r.pendingLocalDataChannels.indexOf(e);-1!==t&&r.pendingLocalDataChannels.splice(t,1)})));case 2:if(0===(n=this.filterTobeUnpublishedDataChannels(t)).length){e.next=12;break}if(n.forEach((function(e){var t=r.localDataChannels.indexOf(e);-1!==t&&r.localDataChannels.splice(t,1)})),e.t1=0===this.localDataChannels.length,!e.t1){e.next=9;break}return e.next=9,this.connection.stopDataChannels(this.store.uid);case 9:e.t0=n.map((function(e){return e.id})),e.next=13;break;case 12:e.t0=void 0;case 13:return e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.unpublishLowStream=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}return e.abrupt("return");case 2:if(t=this.localTrackMap.get(PM.LocalVideoLowTrack)){e.next=5;break}return e.abrupt("return");case 5:return t.track.close(),n=[[PM.LocalVideoLowTrack,t]],e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.doUnpublish=function(){var e=p(l().mark((function e(t,n){var r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createGatewayUnpublishMessage(n),e.next=3,t.stopSending(n.map((function(e){return e[1].id})));case 3:return this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map((function(e){return{type:e[0],track:e[1].track}}))),n.forEach((function(e){var t=e[0];i.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.subscribeDataChannel=function(){var e=p(l().mark((function e(t,n){var r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}throw new aw(iw.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");case 2:if(0===(r=n.filter((function(e){var n;return!(null!==(n=i.remoteDataChannelMap.get(t))&&void 0!==n&&n.get(e.id))}))).length){e.next=8;break}return e.next=6,this.connection.createDataChannels(t.uid,r);case 6:return r.forEach((function(e){var n;i.remoteDataChannelMap.has(t)?null===(n=i.remoteDataChannelMap.get(t))||void 0===n||n.set(e.id,e):i.remoteDataChannelMap.set(t,new Map([[e.id,e]]));var r=i.pendingRemoteDataChannels.findIndex((function(n){var r=n.user,i=n.id;return r.uid===t.uid&&i===e.id}));-1!==r&&i.pendingRemoteDataChannels.splice(r,1)})),e.abrupt("return",r.map((function(e){return e.id})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.subscribe=function(){var e=p(l().mark((function e(t,n,r,i,a){var o,s,c,u,d,p,h,f,_,v,E,m,S,g=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}throw new aw(iw.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");case 2:if(null===(o=this.remoteUserMap.get(t))||void 0===o||!o.has(n)){e.next=4;break}return e.abrupt("return");case 4:if(!(d=this.connection.getPreMedia(r))){e.next=9;break}Dk.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),u=d.transceiver,s=d.track,c=d.id,e.next=23;break;case 9:if(!a){e.next=19;break}if(p=a.find((function(e){return e.stream_type===n}))){e.next=13;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));case 13:return e.next=15,this.connection.receive(n,p.ssrcs,String(t._uintid),p.attributes);case 15:h=e.sent,this.connection instanceof KF&&(u=h.transceiver),s=h.track,c=h.id,e.next=23;break;case 19:return e.next=21,this.connection.receive(n,[{ssrcId:r,rtx:i}],String(t._uintid),void 0);case 21:f=e.sent,this.connection instanceof KF&&(u=f.transceiver),s=f.track,c=f.id;case 23:if(n===OM.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new RL(s,t.uid,t._uintid,this.store),Dk.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new bL(s,t.uid,t._uintid,this.store),Dk.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack)),!u||!rk("ENABLE_ENCODED_TRANSFORM")){e.next=34;break}if(_=lV(),v=_.interceptRemoteVideoFrame,E=_.interceptRemoteAudioFrame,n!=OM.VIDEO){e.next=30;break}return e.next=28,v(u.receiver,{onSei:rk("ENABLE_VIDEO_SEI")&&function(e){var n;return null===(n=t._videoTrack)||void 0===n?void 0:n._onSei(e)}});case 28:e.next=34;break;case 30:if(e.t0=n==OM.AUDIO,!e.t0){e.next=34;break}return e.next=34,E(u.receiver,{enableTopn:!!rk("ENABLE_AUDIO_TOPN"),enableMetadata:!!rk("ENABLE_AUDIO_METADATA"),onMetadata:function(e){g.safeEmit(xM.AudioMetadata,e)}});case 34:(m=this.remoteUserMap.get(t))?m.set(n,c):this.remoteUserMap.set(t,new Map([[n,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),-1!==(S=this.pendingRemoteTracks.findIndex((function(e){var r=e.user,i=e.kind;return r.uid===t.uid&&n===i})))&&(this.pendingRemoteTracks.splice(S,1),this.emit(xM.MediaReconnectEnd,t.uid));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),n.massSubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massSubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.massSubscribeNoLock=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===LM.Connected){e.next=2;break}throw new aw(iw.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");case 2:return t=t.filter((function(e){var t,n=e.user,r=e.mediaType;return!(null!==(t=u.remoteUserMap.get(n))&&void 0!==t&&t.has(r))})),n=[],r=new Map,t.forEach((function(e){if(u.connection){var t=u.connection.getPreMedia(e.ssrcId);t?r.set(e.ssrcId,t):n.push(e)}})),e.next=7,this.connection.batchReceive(n.map((function(e){var t=e.user;return{kind:e.mediaType,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtxSsrcId}],mslabel:String(t._uintid)}})));case 7:i=e.sent,n.forEach((function(e,t){r.set(e.ssrcId,i[t])})),a=l().mark((function e(){var t,n,i,a,o,s,d,p,h,f,_,v,E,m,S,g;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,n=t.user,i=t.mediaType,a=t.ssrcId,o=r.get(a)){e.next=4;break}return e.abrupt("return",{v:void Dk.debug("[".concat(u.store.clientId,"] [").concat(u.store.p2pId,"] cannot find ").concat(n.uid," subscribe data,").concat(i,", ").concat(a))});case 4:if(s=o.track,d=o.id,!(p=o.transceiver)||!rk("ENABLE_ENCODED_TRANSFORM")){e.next=16;break}if(h=lV(),f=h.interceptRemoteVideoFrame,_=h.interceptRemoteAudioFrame,i!=OM.VIDEO){e.next=12;break}return e.next=10,f(p.receiver,{onSei:rk("ENABLE_VIDEO_SEI")&&function(e){var t;return null===(t=n._videoTrack)||void 0===t?void 0:t._onSei(e)}});case 10:e.next=16;break;case 12:if(e.t0=i==OM.AUDIO,!e.t0){e.next=16;break}return e.next=16,_(p.receiver,{enableTopn:!!rk("ENABLE_AUDIO_TOPN"),enableMetadata:!!rk("ENABLE_AUDIO_METADATA"),onMetadata:function(e){u.safeEmit(xM.AudioMetadata,e)}});case 16:if(i===OM.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(s):(n._audioTrack=new RL(s,n.uid,n._uintid,u.store),Dk.info("[".concat(u.store.clientId,"] [").concat(u.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),p&&n._audioTrack._updateRtpTransceiver(p),u.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(s):(n._videoTrack=new bL(s,n.uid,n._uintid,u.store),Dk.info("[".concat(u.store.clientId,"] [").concat(u.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),p&&n._videoTrack._updateRtpTransceiver(p),u.bindRemoteTrackEvents(n,n._videoTrack)),!rk("ENABLE_VIDEO_SEI")||!p){e.next=27;break}if(v=lV(),E=v.interceptRemoteVideoFrame,m=v.interceptRemoteAudioFrame,i!=OM.VIDEO){e.next=23;break}return e.next=21,E(p.receiver,{onSei:function(e){var t;null===(t=n._videoTrack)||void 0===t||t._onSei(e)}});case 21:e.next=27;break;case 23:if(e.t1=i==OM.AUDIO,!e.t1){e.next=27;break}return e.next=27,m(p.receiver);case 27:(S=u.remoteUserMap.get(n))?S.set(i,d):u.remoteUserMap.set(n,new Map([[i,d]])),u.statsCollector.addRemoteStats(n.uid),u.statsUploader.startUploadInboundStats(),-1!==(g=u.pendingRemoteTracks.findIndex((function(e){var t=e.user,r=e.kind;return t.uid===n.uid&&i===r})))&&(u.pendingRemoteTracks.splice(g,1),u.emit(xM.MediaReconnectEnd,n.uid));case 31:case"end":return e.stop()}}),e)})),s=h(t);case 11:if((c=s()).done){e.next=18;break}return e.delegateYield(a(),"t0",13);case 13:if(!(o=e.t0)){e.next=16;break}return e.abrupt("return",o.v);case 16:e.next=11;break;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=this.pendingRemoteTracks.filter((function(e){var r=e.user,i=e.kind;return void 0!==n?r.uid===t.uid&&n===i:r.uid===t.uid}))).forEach((function(e){var t=s.pendingRemoteTracks.indexOf(e);s.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===LM.Connected||r||i.forEach((function(e){var n,r=e.kind;if(r===OM.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(r===OM.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}})),this.connection&&this.state===LM.Connected){e.next=3;break}return e.abrupt("return");case 3:if(0!==(a=this.filterTobeUnSubscribedTracks(t,n)).length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.connection.stopReceiving(a.map((function(e){return e[1].id})));case 8:return o=this.createUnsubscribeMessage(a),e.abrupt("return",(this.withdrawRemoteTracks(a),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),a.forEach((function(e){var t,n,i=e[0],a=e[1].kind;if(a===OM.VIDEO&&i._videoSSRC&&(null===(t=s.connection)||void 0===t||t.setStatsRemoteVideoIsReady(i._videoSSRC,!1)),a===OM.VIDEO)s.unbindRemoteTrackEvents(i._videoTrack),r||(null===(n=i._videoTrack)||void 0===n||n._destroy(),i._videoTrack=void 0);else if(a===OM.AUDIO){var o;s.unbindRemoteTrackEvents(i._audioTrack),r||(null===(o=i._audioTrack)||void 0===o||o._destroy(),i._audioTrack=void 0)}})),o));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.unsubscribeDataChannel=function(){var e=p(l().mark((function e(t,n){var r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.forEach((function(e){var t=a.pendingRemoteDataChannels.findIndex((function(t){return t.id===e.id}));-1!==t&&a.pendingRemoteDataChannels.splice(t,1)})),this.connection){e.next=2;break}return e.abrupt("return");case 2:if(0!==(r=this.filterTobeUnSubscribedDataChannels(t,n)).length){e.next=5;break}return e.abrupt("return");case 5:if(n.forEach((function(e){e._close()})),i=this.remoteDataChannelMap.get(t),r.forEach((function(e){i&&i.delete(e.id)})),e.t0=i&&0===i.size,!e.t0){e.next=13;break}return this.remoteDataChannelMap.delete(t),e.next=13,this.connection.stopDataChannels(t.uid);case 13:return e.abrupt("return",r.map((function(e){return e.id})));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.massUnsubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massUnsubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.massUnsubscribeNoLock=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=l().mark((function e(){var t,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,r=t.user,i=t.mediaType,(o=c.pendingRemoteTracks.filter((function(e){var t=e.user,n=e.kind;return void 0!==i?t.uid===r.uid&&i===n:t.uid===r.uid}))).forEach((function(e){var t=c.pendingRemoteTracks.indexOf(e);c.pendingRemoteTracks.splice(t,1)})),n=n.concat(o);case 3:case"end":return e.stop()}}),e)})),i=h(t);case 3:if((a=i()).done){e.next=7;break}return e.delegateYield(r(),"t0",5);case 5:e.next=3;break;case 7:if(this.connection&&this.state===LM.Connected){e.next=9;break}return e.abrupt("return",void n.forEach((function(e){var t,n=e.user,r=e.kind;if(r===OM.AUDIO)null===(t=n._audioTrack)||void 0===t||t._destroy(),n._audioTrack=void 0;else if(r===OM.VIDEO){var i;null===(i=n._videoTrack)||void 0===i||i._destroy(),n._videoTrack=void 0}})));case 9:if(0!==(o=ui(t).call(t,(function(e,t){var n=t.user,r=t.mediaType,i=c.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[])).length){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this.connection.stopReceiving(o.map((function(e){return e[1].id})));case 14:return s=this.createUnsubscribeAllMessage(o),e.abrupt("return",(this.withdrawRemoteTracks(o),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),o.forEach((function(e){var t,n,r=e[0],i=e[1].kind;if(i===OM.VIDEO&&r._videoSSRC&&(null===(t=c.connection)||void 0===t||t.setStatsRemoteVideoIsReady(r._videoSSRC,!1)),i===OM.VIDEO)c.unbindRemoteTrackEvents(r._videoTrack),null===(n=r._videoTrack)||void 0===n||n._destroy(),r._videoTrack=void 0;else if(i===OM.AUDIO){var a;c.unbindRemoteTrackEvents(r._audioTrack),null===(a=r._audioTrack)||void 0===a||a._destroy(),r._audioTrack=void 0}})),s));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.isPreSubScribe=function(e){return!(!this.connection||this.state!==LM.Connected||!this.connection.getPreMedia(e))},n.muteRemote=function(){var e=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,".")));case 5:if(r.get(n)){e.next=7;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(n,".")));case 7:void 0!==(i=n===OM.VIDEO?t._videoSSRC:t._audioSSRC)&&this.connection.setStatsRemoteVideoIsReady(i,!1);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteRemote=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.unmuteRemoteNoLock(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteRemoteNoLock=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,".")));case 5:r.get(n)||Dk.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(n,"."));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.addAudioMetadata=function(e){var t=this.localTrackMap.get(PM.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)},n.getAllTracks=function(e){var t=this.localTrackMap.get(PM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof EP){var n=t.track;return Array.from(this.localTrackMap.entries()).filter((function(e){return e[0]!==PM.LocalAudioTrack})).filter((function(t){var n=t[0];return!(e&&n===PM.LocalVideoLowTrack)})).map((function(e){return e[1].track})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((function(t){var n=t[0];return!(e&&n===PM.LocalVideoLowTrack)})).map((function(e){return e[1].track}))},n.getAllDataChannels=function(){return this.localDataChannels},n.reportPublishEvent=function(e,t,n,r,i){if(e){var a=this.localTrackMap.get(PM.LocalAudioTrack),o=r?this.localTrackMap.get(PM.LocalVideoLowTrack):this.localTrackMap.get(PM.LocalVideoTrack);Fk.publish(this.store.sessionId,{eventElapse:lF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(sN.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);var c=n.find((function(e){return e instanceof fP})),u=r?null===(s=this.localTrackMap.get(PM.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((function(e){return e instanceof mL}));Fk.publish(this.store.sessionId,{eventElapse:lF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==c?void 0:c.getTrackLabel(),videoName:null==u?void 0:u.getTrackLabel(),screenshare:-1!==(null==u?void 0:u._hints.indexOf(sN.SCREEN_TRACK)),audio:!!c,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}},n.reportSubscribeEvent=function(e,t,n,r){var i=r===OM.VIDEO?n._videoSSRC:n._audioSSRC;i&&Fk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===OM.VIDEO,audio:r===OM.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:lF.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})},n.reset=function(){Dk.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new fO("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=BF(this.store),this.emit(xM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();var e=this.localTrackMap.get(PM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof EP){if(e.track.trackList.length>0){var t=e.track;e.track.trackList.forEach((function(e){t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=LM.Disconnected},n.getStats=function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()},n.getRemoteVideoIsReady=function(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1},n.getLocalAudioVolume=function(){var e=this.localTrackMap.get(PM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()},n.getLocalVideoSize=function(){var e=this.localTrackMap.get(PM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}},n.getEncoderConfig=function(e){var t=this.localTrackMap.get(e);return t&&t.track instanceof mL||t&&t.track instanceof fP?t.track._encoderConfig:void 0},n.getLocalMedia=function(e){return this.localTrackMap.get(e)},n.hasLocalMedia=function(){return this.localTrackMap.size>0},n.hasRemoteMedia=function(e,t){if(!e)return this.remoteUserMap.size>0;var n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))},n.hasRemoteMediaWithLock=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this.remoteUserMap.size>0);case 2:return r=this.remoteUserMap.get(t),e.abrupt("return",!!r&&(!n||r.has(n)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.getRemoteMedia=function(e){var t,n=Array.from(gk(t=this.remoteUserMap).call(t)).find((function(t){return t.uid===e}));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}},n.getAudioLevels=function(){var e=Array.from(this.remoteUserMap.entries()).map((function(e){var t=e[0];return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(PM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Vh(e).call(e,(function(e,t){return e.level-t.level}))},n.disconnectForReconnect=function(){var e=p(l().mark((function e(){var t=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connection&&(Dk.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=LM.Reconnecting,rk("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var t,n=e[0];n._videoTrack&&n._videoTrack._player&&(null===(t=n._videoTrack._player.getVideoElement())||void 0===t||t.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=BF(this.store),this.emit(xM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((function(e){var n,r=e[0],i=e[1].track;switch(r){case PM.LocalVideoTrack:Br(n=i._hints).call(n,sN.LOW_STREAM)?i.close():t.pendingLocalTracks.push(i);break;case PM.LocalAudioTrack:i instanceof EP?t.pendingLocalTracks=t.pendingLocalTracks.concat(i.trackList):t.pendingLocalTracks.push(i);case PM.LocalVideoLowTrack:}})),this.emit(xM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var n=e[0],r=e[1];Array.from(gk(r).call(r)).forEach((function(e){t.setPendingRemoteMedia(n,e)})),t.emit(xM.MediaReconnectStart,n.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((function(e){t.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((function(e){var n=e[0],r=e[1];Array.from(gk(r).call(r)).forEach((function(e){t.setPendingRemoteDataChannel(n,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Dk.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.hasPendingRemoteDataChannel=function(e,t){for(var n,r=h(this.pendingRemoteDataChannels);!(n=r()).done;){var i=n.value,a=i.user,o=i.id;if((e instanceof mF?e.uid:e)===a.uid&&o===t)return!0}return!1},n.setPendingRemoteDataChannel=function(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})},n.hasPendingRemoteMedia=function(e,t){for(var n,r=h(this.pendingRemoteTracks);!(n=r()).done;){var i=n.value,a=i.user,o=i.kind;if((e instanceof mF?e.uid:e)===a.uid&&t===o)return!0}return!1},n.setPendingRemoteMedia=function(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})},n.restartICE=function(e){var t=this;return OI(l().mark((function n(){var r,i,a,o,s,c;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.connection&&t.state===LM.Connected){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,NI(t.mutex.lock("From P2PChannel.restartICE"));case 4:return r=n.sent,n.prev=5,n.next=8,NI(t.connection.restartICE(e));case 8:return i=n.sent,n.next=11,NI(i.next());case 11:if(!(a=n.sent).done){n.next=14;break}return n.abrupt("return");case 14:return o=a.value,n.next=17,o;case 17:s=n.sent,n.t0=(jF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e),n.next=n.t0===kM.UDP_TCP_RELAY?21:n.t0===kM.TCP_RELAY?23:n.t0===kM.RELAY?25:27;break;case 21:return t._pcStatsUploadType=NM.UDP_TCP_RESTART,n.abrupt("break",28);case 23:return t._pcStatsUploadType=NM.TCP_RESTART,n.abrupt("break",28);case 25:return t._pcStatsUploadType=NM.RELAY_RESTART,n.abrupt("break",28);case 27:t._pcStatsUploadType=NM.OLD_RESTART;case 28:t._isTryConnecting=!0,i.next(s),n.next=34;break;case 31:n.prev=31,n.t1=n.catch(5),null===(c=i)||void 0===c||c.throw(n.t1);case 34:return n.prev=34,r(),n.finish(34);case 37:case"end":return n.stop()}}),n,null,[[5,31,34,37]])})))()},n.getUplinkNetworkQuality=function(){if(!this.connection)return 0;var e=this.connection.getStats(),t=this.localTrackMap.get(PM.LocalVideoTrack),n=this.localTrackMap.get(PM.LocalAudioTrack),r=e.videoSend.find((function(e){return e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)})),i=e.audioSend.find((function(e){return e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)}));if(!r||!i)return 1;var a=Uw(this,xM.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,d=100*e.sendPacketLossRate*.7/50+.3*u/1500,p=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,l=null==t?void 0:t.track;if(l&&l._encoderConfig&&-1===l._hints.indexOf(sN.SCREEN_TRACK)){var h=l._encoderConfig.bitrateMax,f=e.bitrate.actualEncoded;if(h&&f){var _=(1e3*h-f)/(1e3*h);return ix[_<.15?0:_<.3?1:_<.45?2:_<.6?3:4][p]}}return p},n.getDownlinkNetworkQuality=function(){var e=this;if(!this.connection)return 0;var t=this.connection.getStats(),n=0;return Array.from(this.remoteUserMap.entries()).forEach((function(r){var i=r[0],a=i._audioSSRC,o=i._videoSSRC,s=t.audioRecv.find((function(e){return e.ssrc===a})),c=t.videoRecv.find((function(e){return e.ssrc===o}));if(s||c){var u=Uw(e,xM.NeedSignalRTT),d=t.rtt,p=(d&&u?(d+u)/2:d||u)||0,l=s?s.jitterMs:void 0,h=t.recvPacketLossRate,f=.7*h*100/50+.3*p/1500;l&&(f=.6*h*100/50+.2*p/1500+.2*l/400),n+=f<.1?1:f<.17?2:f<.36?3:f<.59?4:5}else n+=1})),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n},n.muteLocalTrack=function(){var e=p(l().mark((function e(t){var n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new zl((function(e,r){n.handleMuteLocalTrack(t,e,r)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.replaceTrack=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(n.getTrackId(),"]")),this.connection&&this.state===LM.Connected){e.next=2;break}return e.abrupt("return");case 2:if(i=Array.from(this.localTrackMap.entries()).find((function(e){var n=e[1].track;return t===n}))){e.next=5;break}return e.abrupt("return");case 5:return a=i[0],t!==n&&(this.unbindLocalTrackEvents([{track:t,type:a}]),this.bindLocalTrackEvents([{track:n,type:a}]),i[1].track=n),e.next=9,null===(r=this.connection)||void 0===r?void 0:r.replaceTrack(n,i[1].id);case 9:if(!this.isPlanB){e.next=12;break}(o=i[1]).id=n._mediaStreamTrack.id,this.localTrackMap.set(a,o);case 12:if(a!==PM.LocalVideoTrack||rk("DISABLE_DUAL_STREAM_USE_ENCODING")||!Gk().supportDualStreamEncoding){e.next=21;break}if(!(s=this.localTrackMap.get(PM.LocalVideoLowTrack))){e.next=21;break}return c=t._mediaStreamTrack.clone(),s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,e.next=21,new zl((function(e,t){u.handleReplaceTrack(s.track,e,t,!0)}));case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.filterTobePublishedTracks=function(e,t,n){var r=[],i=this.getAllTracks();e=jw(e=e.filter((function(e){return-1===i.indexOf(e)})));for(var a,o,s=!1,c=this.localTrackMap.get(PM.LocalAudioTrack),u=h(e);!(o=u()).done;){var d=o.value;if(d instanceof mL&&(this.localTrackMap.has(PM.LocalVideoTrack)||s?new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:PM.LocalVideoTrack}),s=!0),t)){var p=this.getLowVideoTrack(d,n);r.push({track:p,type:PM.LocalVideoLowTrack})}if(d instanceof fP)if(c){var l=c.track;if(l instanceof EP)MF([d]),l.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{var f=UF([l,d]);Dk.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),this.replaceTrack(l,f)}}else a instanceof EP?(MF([d]),a.addAudioTrack(d)):a=a||!d._useAudioElement&&Gk().webAudioMediaStreamDest&&!d._bypassWebAudio?UF(a?[d,a]:[d]):d}return a&&(Dk.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),r.push({track:a,type:PM.LocalAudioTrack})),r},n.filterTobeUnpublishedTracks=function(e){for(var t,n=[],r=this.getAllTracks(),i=h(e=jw(e=e.filter((function(e){return-1!==r.indexOf(e)}))));!(t=i()).done;){var a=t.value;if(a instanceof fP){var o=this.localTrackMap.get(PM.LocalAudioTrack);if(!o)continue;o.track instanceof EP?(o.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===o.track.trackList.length&&(n.push([PM.LocalAudioTrack,o]),o.track.close())):n.push([PM.LocalAudioTrack,o])}if(a instanceof mL){var s=this.localTrackMap.get(PM.LocalVideoTrack);if(!s)continue;n.push([PM.LocalVideoTrack,s]);var c=this.localTrackMap.get(PM.LocalVideoLowTrack);c&&n.push([PM.LocalVideoLowTrack,c])}}return n},n.filterTobePublishedDataChannels=function(e){var t=this;return(e=jw(e)).filter((function(e){return-1===t.localDataChannels.findIndex((function(t){return t.id===e.id}))}))},n.filterTobeUnpublishedDataChannels=function(e){var t=this;return(e=(e=jw(e)).filter((function(e){return-1!==t.localDataChannels.indexOf(e)}))).filter((function(e){return e._originDataChannel}))},n.bindLocalTrackEvents=function(e){var t=this;e.forEach((function(e){var n=e.track;switch(e.type){case PM.LocalVideoTrack:n.addListener(oN.GET_STATS,t.handleGetLocalVideoStats),n.addListener(oN.GET_RTC_STATS,t.handleGetRTCStats),n.addListener(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.addListener(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.addListener(oN.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.addListener(oN.NEED_UPDATE_VIDEO_SEND_PARAMETERS,t.handleUpdateVideoSendParameters),n.addListener(oN.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.addListener(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.addListener(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case PM.LocalAudioTrack:t.bindLocalAudioTrackEvents(n);case PM.LocalVideoLowTrack:}}))},n.bindLocalAudioTrackEvents=function(e,t){var n=this;e instanceof EP?e.trackList.forEach((function(e){e.addListener(oN.NEED_DISABLE_TRACK,n.handleMuteLocalTrack),e.addListener(oN.NEED_ENABLE_TRACK,n.handleUnmuteLocalTrack),e.addListener(oN.GET_STATS,n.handleGetLocalAudioStats),e.addListener(oN.NEED_MUTE_TRACK,n.handleMuteLocalTrack),e.addListener(oN.NEED_UNMUTE_TRACK,n.handleUnmuteLocalTrack)})):(e.addListener(oN.GET_STATS,this.handleGetLocalAudioStats),e.addListener(oN.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(oN.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(oN.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(oN.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(oN.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(oN.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))},n.unbindLocalTrackEvents=function(e){var t=this;e||(e=Array.from(this.localTrackMap.entries()).map((function(e){var t=e[0];return{track:e[1].track,type:t}}))),e.forEach((function(e){var n=e.track;switch(e.type){case PM.LocalVideoTrack:n.off(oN.GET_STATS,t.handleGetLocalVideoStats),n.off(oN.GET_RTC_STATS,t.handleGetRTCStats),n.off(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.off(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.off(oN.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.off(oN.NEED_UPDATE_VIDEO_SEND_PARAMETERS,t.handleUpdateVideoSendParameters),n.off(oN.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.off(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.off(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case PM.LocalAudioTrack:t.unbindLocalAudioTrackEvents(n);case PM.LocalVideoLowTrack:}}))},n.unbindLocalAudioTrackEvents=function(e){var t=this;e instanceof EP?e.trackList.forEach((function(e){e.off(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),e.off(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),e.off(oN.GET_STATS,t.handleGetLocalAudioStats),e.off(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),e.off(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack)})):(e.off(oN.GET_STATS,this.handleGetLocalAudioStats),e.off(oN.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(oN.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(oN.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(oN.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(oN.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(oN.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))},n.bindRemoteTrackEvents=function(e,t){var n=this;t instanceof bL&&t.addListener(oN.GET_STATS,(function(t){t(n.handleGetRemoteVideoStats(e))})),t instanceof RL&&t.addListener(oN.GET_STATS,(function(t){t(n.handleGetRemoteAudioStats(e))}))},n.unbindRemoteTrackEvents=function(e){e&&e.removeAllListeners(oN.GET_STATS)},n.unbindAllRemoteTrackEvents=function(){var e=this;Array.from(this.remoteUserMap.entries()).forEach((function(t){var n=t[0],r=t[1];r.has(OM.AUDIO)&&e.unbindRemoteTrackEvents(n._audioTrack),r.has(OM.VIDEO)&&e.unbindRemoteTrackEvents(n._videoTrack)}))},n.createGatewayPublishMessage=function(e,t){var n=this;return e.map((function(e,r){var i,a,o,s=e.track;switch(e.type){case PM.LocalAudioTrack:a=EM.Audio,o={dtx:s instanceof _P&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case PM.LocalVideoTrack:a=Br(i=s._hints).call(i,sN.SCREEN_TRACK)?EM.Screen:EM.High,o=fB(fB({},SU(s)),{},{codec:n.store.codec,svc_mode:IU()});break;case PM.LocalVideoLowTrack:a=EM.Low,o=fB(fB({},SU(s)),{},{codec:n.store.codec,svc_mode:IU()})}return{stream_type:a,attributes:o,ssrcs:t[r]}}))},n.createGatewayUnpublishMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.assignLocalTracks=function(e,t){var n=this;e.forEach((function(e,r){var i=e.track,a=e.type;n.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))},n.withdrawLocalTracks=function(e){var t=this;e.forEach((function(e){var n=e[0];t.localTrackMap.delete(n)}))},n.bindConnectionEvents=function(e){var t=this;e.onConnectionStateChange=p(l().mark((function n(r){var i,a,o,s;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),t.emit(xM.PeerConnectionStateChange,r),"connecting"===r&&e instanceof KF&&!LA()&&rk("FIRST_TCP_CANDIDATE")&&window.setTimeout((function(){"connecting"===r&&e.extendCandidate()}),rk("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==r||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"connected"===r&&(t._restartTimer&&(window.clearTimeout(t._restartTimer),t._restartTimer=void 0),e instanceof KF&&pB(e,!0),t._isTryConnecting&&t.reportPCStats(Date.now(),!0,t._pcStatsUploadType),t._isTryConnecting=!1,t._isStartRestartIce=!1,t._pcStatsUploadType=NM.DISCONNECTED_OR_FAILED,"CONNECTED"===Uw(t,xM.QueryClientConnectionState)&&t._isWaitPcToRePub&&(i=t.pendingLocalTracks.map((function(e){return e.getTrackId()})),a=t.pendingLocalDataChannels.map((function(e){return"dc_".concat(e.id)})),Fk.reportApiInvoke(t.store.sessionId,{name:Rw.REPUB_AFTER_PC_CONNECTED,options:i.concat(a),tag:Cw.TRACER}).onSuccess(),t.republish())),!(rk("NEW_ICE_RESTART")&&e instanceof KF)||LA()||t._forceTurn){n.next=10;break}if(!Br(DM).call(DM,r)){n.next=8;break}if(!t._isStartRestartIce){n.next=5;break}return n.abrupt("return");case 5:return t._isStartRestartIce=!0,o=function(n){jF(e)&&(Dk.debug("[".concat(t.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(n)),"CONNECTED"===Uw(t,xM.QueryClientConnectionState)&&t.emit(xM.RequestRestartICE,n))},s=function(){jF(e)&&(t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),Dk.debug("[".concat(t.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((function(){return t.emit(xM.P2PLost)}),0),t.iceFailedCount+=1,t.requestReconnect())},n.abrupt("return",void(t._restartTimer=window.setTimeout((function(){lB(e,o,s)}),800)));case 8:n.next=20;break;case 10:if("disconnected"!==r||"disconnected"!==e.iceConnectionState){n.next=12;break}return n.abrupt("return",(setTimeout((function(){"disconnected"===e.iceConnectionState&&rk("ICE_RESTART")&&"CONNECTED"===Uw(t,xM.QueryClientConnectionState)&&t.emit(xM.RequestRestartICE)}),800),void setTimeout((function(){"disconnected"===e.peerConnectionState&&(Dk.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),t._isTryConnecting=!1,setTimeout((function(){return t.emit(xM.P2PLost)}),0),t.iceFailedCount+=1,t.requestReconnect())}),4e3)));case 12:if(n.t0="failed"===r,!n.t0){n.next=20;break}return Dk.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection state failed, force reconnect")),t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),setTimeout((function(){return t.emit(xM.P2PLost)}),0),t.iceFailedCount+=1,n.next=20,t.requestReconnect();case 20:case"end":return n.stop()}}),n)}))),e.onICEConnectionStateChange=function(e){"connected"!==e||t.store.keyMetrics.iceConnectionEnd||t.store.iceConnectionEnd(),Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Fk.reportApiInvoke(t.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Cw.TRACER}).onSuccess(),t.emit(xM.IceConnectionStateChange,e)},e.onICETransportStateChange=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=function(e){var n,r,i=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));i&&(t.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(hN.FIRST_FRAME_DECODED),Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_AUDIO_DECODE,Mk.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId}))},e.onFirstAudioReceived=function(e){var n,r=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));r&&Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_AUDIO_RECEIVED,Mk.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onFirstVideoDecoded=function(e,n,r){t.reportVideoFirstFrameDecoded(e,n,r)},e.onFirstVideoReceived=function(e){var n,r=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._videoSSRC===e}));r&&Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_VIDEO_RECEIVED,Mk.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onSelectedLocalCandidateChanged=function(e,n){var r="relay"===e.candidateType,i="relay"===n.candidateType;"unknown"!==n.candidateType&&r===i||t.emit(xM.ConnectionTypeChange,r),Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(yU(n))," -> ").concat(JSON.stringify(yU(e)),")"))},e.onSelectedRemoteCandidateChanged=function(e,n){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(yU(n))," -> ").concat(JSON.stringify(yU(e)),")"))},e.onFirstVideoDecodedTimeout=function(e){t.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=function(){var e=t.statsCollector.getLocalVideoTrackStats(),n=t.statsCollector.getRTCStats();return fB(fB({},e),n)},e.onICECandidateError=function(e){t._iceError=e}},n.resetConnection=function(e){e instanceof KF&&function(e){cB.delete(e.id),pB(e)}(e),e.close(),this.emit(xM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1},n.filterTobeMutedTracks=function(e){var t=[];if(-1===this.getAllTracks().indexOf(e))return t;var n=this.localTrackMap.get(PM.LocalAudioTrack);if(e instanceof fP&&(null==n?void 0:n.track)instanceof EP)return n.track.isActive||t.push([PM.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=t[1].track;return e===n}));if(r&&(t.push(r),r[0]===PM.LocalVideoTrack)){var i=this.localTrackMap.get(PM.LocalVideoLowTrack);i&&t.push([PM.LocalVideoLowTrack,i])}return t},n.filterTobeUnmutedTracks=function(e){var t=[],n=this.localTrackMap.get(PM.LocalAudioTrack);if(e instanceof fP&&(null==n?void 0:n.track)instanceof EP)return n.track.isActive&&t.push([PM.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=t[1].track;return e===n}));if(r)if(r[0]===PM.LocalVideoTrack){t.push(r);var i=this.localTrackMap.get(PM.LocalVideoLowTrack);i&&t.push([PM.LocalVideoLowTrack,i])}else t.push(r);return t},n.createMuteMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.createUnmuteMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.filterTobeUnSubscribedTracks=function(e,t){var n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){var i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((function(t){var r=t[0],i=t[1];n.push([e,{kind:r,id:i}])}));return n},n.filterTobeUnSubscribedDataChannels=function(e,t){var n=this,r=[];return t.forEach((function(t){var i;null!==(i=n.remoteDataChannelMap.get(e))&&void 0!==i&&i.has(t.id)&&r.push(t)})),r},n.createUnsubscribeMessage=function(e){var t=[];return e.forEach((function(e){var n=e[0],r=e[1],i=r.kind;switch(r.id,i){case OM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:OM.VIDEO,ssrcId:n._videoSSRC}));case OM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:OM.AUDIO,ssrcId:n._audioSSRC}))}})),t},n.createUnsubscribeAllMessage=function(e){var t=new Map;return e.forEach((function(e){var n=e[0],r=e[1].kind;if(t.has(n)){var i=t.get(n);r===OM.VIDEO?i|=gM.Video:i|=gM.Audio,t.set(n,i)}else r===OM.VIDEO?t.set(n,gM.Video):t.set(n,gM.Audio)})),{users:Array.from(t.entries()).map((function(e){var t=e[0],n=e[1];return{stream_id:t.uid,stream_type:n}}))}},n.withdrawRemoteTracks=function(e){var t=this;e.forEach((function(e){var n=e[0],r=e[1].kind,i=t.remoteUserMap.get(n);i&&(i.delete(r),0===Array.from(i.entries()).length&&t.remoteUserMap.delete(n))}))},n.updateBitrateLimit=function(){var e=p(l().mark((function e(t){var n,r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.localTrackMap.get(PM.LocalVideoTrack),r=this.localTrackMap.get(PM.LocalVideoLowTrack),e.t0=n,!e.t0){e.next=7;break}return e.next=5,n.track.setBitrateLimit(t.uplink);case 5:return e.next=7,new zl((function(e,t){i.handleUpdateVideoEncoder(n.track,e,t,!0)}));case 7:if(e.t1=r&&t.low_stream_uplink,!e.t1){e.next=13;break}return e.next=11,r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0});case 11:return e.next=13,new zl((function(e,t){i.handleUpdateVideoEncoder(r.track,e,t,!0)}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.isP2PDisconnected=function(){return!this.connection||"connected"!==this.connection.peerConnectionState},n.mapPubResToRemoteConfig=function(e,t,n){return e.map((function(e,r){var i,a=e.stream_type,o=null===(i=t.find((function(e){var t=e.stream_type;return a===t})))||void 0===i?void 0:i.attributes;if(o&&rk("DISABLE_SCREEN_SHARE_REMB")){var s=n[r]._hints;(Br(s).call(s,sN.SCREEN_TRACK)||Br(s).call(s,sN.SCREEN_LOW_TRACK))&&(o.remb=!1,Dk.debug("disable remb for screen share, hints:",s))}return o}))},n.tryToUnmuteAudio=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=15;break}if(!(t[n]instanceof fP)){e.next=12;break}if(0!==(i=this.filterTobeUnmutedTracks(t[n])).length){e.next=6;break}return e.abrupt("continue",12);case 6:return e.next=8,null===(r=this.connection)||void 0===r?void 0:r.unmuteLocal(i.map((function(e){return e[1].id})));case 8:return a=this.createUnmuteMessage(i),e.next=11,Mw(this,xM.RequestUnmuteLocal,a);case 11:return e.abrupt("return",void e.sent);case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.bindStatsUploaderEvents=function(){var e=this;this.statsUploader.requestStats=function(){return e.getStats()},this.statsUploader.requestLocalMedia=function(){return Array.from(e.localTrackMap.entries())},this.statsUploader.requestRemoteMedia=function(){return Array.from(e.remoteUserMap.entries())},this.statsUploader.requestVideoIsReady=function(t){var n;return!(null===(n=e.connection)||void 0===n||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=function(t,n){return e.emit(xM.RequestUpload,t,n)},this.statsUploader.requestUploadStats=function(t){return e.emit(xM.RequestUploadStats,t)},this.statsUploader.requestAllTracks=function(){return e.getAllTracks()},this.statsUploader.requestTransportStats=function(){var t;return{connectState:(null===(t=e.connection)||void 0===t?void 0:t.peerConnectionState)||"closed"}}},n.unbindStatsUploaderEvents=function(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0},n.requestReconnect=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dtlsFailedCount+=1,e.next=3,eO(EO(this.dtlsFailedCount,vO));case 3:this.emit(xM.RequestReconnect);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reconnectP2P=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(t),Array.from(this.remoteUserMap.entries()),e.t0=n.length>0,!e.t0){e.next=6;break}return e.next=6,xw(this,xM.RequestUnpublishForReconnectPC,n);case 6:this.disconnectForReconnect(),this.emit(xM.RequestReconnectPC);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.canPublishLowStream=function(){return this.localTrackMap.has(PM.LocalVideoTrack)||this.pendingLocalTracks.some((function(e){return e instanceof mL}))},n.throwIfTrackTypeNotMatch=function(e){if(e.filter((function(e){return e instanceof mL})).length>1)throw new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((function(e){return e instanceof fP})).length>1&&(e.some((function(e){return e instanceof fP&&e._bypassWebAudio}))||!Gk().webAudioMediaStreamDest))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(var t,n=h(e);!(t=n()).done;){var r=t.value;if(r instanceof mL&&this.pendingLocalTracks.some((function(e){return e instanceof mL})))throw new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof fP&&this.pendingLocalTracks.some((function(e){return e instanceof fP}))&&(!Gk().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((function(e){return e instanceof fP&&e._bypassWebAudio}))))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}},n.getLowVideoTrack=function(e,t){var n,r,i=!rk("DISABLE_DUAL_STREAM_USE_ENCODING")&&Gk().supportDualStreamEncoding,a=fB(fB({},{width:160,height:120,framerate:15,bitrate:50}),t);r=i?e._mediaStreamTrack.clone():qF(e,a);var o=tO(8,"track-low-"),s=new mL(r,fB(fB({},i&&{scaleResolutionDownBy:CU(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,o);return s.on(pN.TRANSCEIVER_UPDATED,(function(t){e._updateRtpTransceiver(t,cN.LOW_STREAM)})),s._hints.push(sN.LOW_STREAM),Br(n=e._hints).call(n,sN.SCREEN_TRACK)&&s._hints.push(sN.SCREEN_LOW_TRACK),e.on("sei-to-send",(function(e){s.emit("sei-to-send",e)})),e.addListener(oN.NEED_CLOSE,(function(){s.close()})),s},n.globalLock=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutex.lock("From P2PChannel.globalLock"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reportPCStats=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p,h,f,_,v,E,m=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.length>3&&void 0!==m[3]?m[3]:null,!(this.connection&&this.connection instanceof KF)){e.next=13;break}return u=this.store.keyMetrics.descriptionStart||0,d=this.connection,p=d.iceConnectionState,h=d.dtlsTransportState,f=d.peerConnectionState,e.next=9,this.connection.getSelectedCandidatePair();case 9:_=e.sent,v=_.local,E=_.remote,Fk.pcStats(this.store.sessionId,{startTime:u,eventElapse:t-u||0,iceconnectionsate:p,dtlsstate:h,connectionstate:f,intSucc:n?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:null!==(a=null==v?void 0:v.protocol)&&void 0!==a?a:"",selectedLocalCandidateType:null!==(o=v.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:null!==(s=E.protocol)&&void 0!==s?s:"",selectedRemoteCandidateType:null!==(c=E.candidateType)&&void 0!==c?c:"",selectedRemoteCandidateAddress:"".concat(E.address,":").concat(E.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.reportVideoFirstFrameDecoded=function(e,t,n,r){var i,a=Array.from(gk(i=this.remoteUserMap).call(i)).find((function(t){return t._videoSSRC===e}));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());var o=this.store.keyMetrics,s=o.subscribe.find((function(e){return e.userId===a.uid&&"video"===e.type}));Fk.firstRemoteVideoDecode(this.store.sessionId,xk.FIRST_VIDEO_DECODE,Mk.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:lF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0,firstFrame:(null==s?void 0:s.firstFrame)||0})}},n.remoteMediaSsrcChanged=function(){var e=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",!1);case 5:if(a=i.get(n)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.connection.getRemoteSSRC(a);case 10:return o=e.sent,e.abrupt("return",void 0!==o&&o!==r);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.unbindRtpTransceiver=function(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((function(e){var t=e[0],n=e[1].track;t===PM.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,cN.LOW_STREAM):n._updateRtpTransceiver(void 0)}))},v(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(xM.StateChange,t,this._state)}}]),t}(gw)).prototype,"startP2PConnection",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"startP2PConnection"),iB.prototype),Wx(iB.prototype,"connect",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"connect"),iB.prototype),Wx(iB.prototype,"updateRemoteRTPCapabilities",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"updateRemoteRTPCapabilities"),iB.prototype),Wx(iB.prototype,"publishDataChannel",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"publishDataChannel"),iB.prototype),Wx(iB.prototype,"unpublish",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unpublish"),iB.prototype),Wx(iB.prototype,"unpublishDataChannel",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unpublishDataChannel"),iB.prototype),Wx(iB.prototype,"unpublishLowStream",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unpublishLowStream"),iB.prototype),Wx(iB.prototype,"subscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"subscribeDataChannel"),iB.prototype),Wx(iB.prototype,"subscribe",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"subscribe"),iB.prototype),Wx(iB.prototype,"massSubscribe",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"massSubscribe"),iB.prototype),Wx(iB.prototype,"unsubscribe",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unsubscribe"),iB.prototype),Wx(iB.prototype,"unsubscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unsubscribeDataChannel"),iB.prototype),Wx(iB.prototype,"massUnsubscribe",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"massUnsubscribe"),iB.prototype),Wx(iB.prototype,"muteRemote",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"muteRemote"),iB.prototype),Wx(iB.prototype,"unmuteRemote",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"unmuteRemote"),iB.prototype),Wx(iB.prototype,"hasRemoteMediaWithLock",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"hasRemoteMediaWithLock"),iB.prototype),Wx(iB.prototype,"disconnectForReconnect",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"disconnectForReconnect"),iB.prototype),Wx(iB.prototype,"updateBitrateLimit",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"updateBitrateLimit"),iB.prototype),Wx(iB.prototype,"remoteMediaSsrcChanged",[mB],Object.getOwnPropertyDescriptor(iB.prototype,"remoteMediaSsrcChanged"),iB.prototype),iB);function mB(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=p(l().mark((function e(){var n,i,a,o,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PChannel.".concat(t));case 3:for(i=e.sent,e.prev=4,a=c.length,o=new Array(a),s=0;s<a;s++)o[s]=c[s];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function SB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SB(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var TB=Date.now(),bB=new Map,RB=new Map;function CB(e){return yB.apply(this,arguments)}function yB(){return(yB=p(l().mark((function e(t){var n,r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=bB.get(t),r=Array.isArray(n)&&n[n.length-1],i=RB.get(t),r){e.next=3;break}return e.abrupt("return",void(i.isSyncing=!1));case 3:a={uid:r.uid,payload:r.payload},0===i.firstRecvTs&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs),o=r.sendTs-i.firstSendTs,(s=o-(Date.now()-i.firstRecvTs))>0&&(i.firstRecvTs=Date.now()-o),(c=r.mediaDelay+s)<=0?(n.pop(),IB(r.context,a),c=0):c=Math.min(c,20),setTimeout((function(){return n.length&&CB(t)}),c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function IB(e,t){e.safeEmit(Nw.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function AB(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return IB(n,{uid:e.uid,payload:e.payload});var r="".concat(n.id,"-").concat(e.uid),i=bB.get(r)||[],a=i.findIndex((function(t){return e.sendTs>=t.sendTs})),o=gB(gB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===a?i.push(o):i.splice(a,0,o),bB.set(r,i);var s,c=!1;RB.has(r)?c=!(null===(s=RB.get(r))||void 0===s||!s.isSyncing):RB.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||CB(r)}var wB=IA().name;function OB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OB(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var NB="websdk_ng_cache_parameter",DB=rk("MAX_PRELOAD_ASYNC_LENGTH"),PB=new Map,LB=[],xB=null,MB=0,UB=0,VB=new Map,FB=function(e,t){var n=[],r=0,i=function(){var e=p(l().mark((function e(){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.shift(),e.t0=a,!e.t0){e.next=5;break}return e.next=5,a();case 5:n.length>0&&r<t?i():r--;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return p(l().mark((function a(){var o,s,c,u=arguments;return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:for(o=u.length,s=new Array(o),c=0;c<o;c++)s[c]=u[c];return a.abrupt("return",new zl(p(l().mark((function a(o,c){return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n.push(p(l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.apply(void 0,s);case 3:n=t.sent,o(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),c(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),r<t&&(r++,i());case 1:case"end":return a.stop()}}),a)})))));case 2:case"end":return a.stop()}}),a)})))}(jB,DB),BB=_A.CancelToken.source();function jB(e,t,n,r,i,a){return GB.apply(this,arguments)}function GB(){return(GB=p(l().mark((function e(t,n,r,i,a,o){var s,c,u,d,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,rk("ENABLE_PRELOAD")){e.next=3;break}return e.abrupt("return");case 3:if(Gk().supportWebCrypto){e.next=5;break}return e.abrupt("return",void Yw((function(){Dk.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported"));case 5:if(r||null===r){e.next=7;break}throw new aw(iw.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));case 7:if(r&&dw(r,"token",1,2047),dw(t,"appid",1,2047),nM(n),i&&rM(i),c=nO(),Dk.debug("preload channel ".concat(n,", uid is ").concat(i)),u={appId:t,cname:n,token:r||t,uid:"string"!=typeof i?i:null,sid:c,proxyServer:a},"string"!=typeof i){e.next=23;break}return u.stringUid=i,e.next=15,zl.all([XV(i,{sid:c,appId:t},BB.token),$V(kB(kB({},u),{},{token:r||t,uid:0}),BB.token)]);case 15:s=e.sent,h=s[0],d=s[1],u.uid=h.uid,d.gatewayInfo.uid=u.uid,d.gatewayInfo.res.uid=u.uid,e.next=27;break;case 23:return o&&(u.stringUid=o),e.next=26,$V(u,BB.token);case 26:d=e.sent;case 27:return f={sid:c,appId:t,cname:n,token:r||t,uid:u.stringUid||i,intUid:u.uid||d.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:h,ap:d},e.next=30,p(l().mark((function e(t){var n,r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.uid&&KB({appId:t.appId,cname:t.cname,token:t.token,uid:t.uid,stringUid:t.stringUid}),i=QB(t),e.next=5,p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.crypto.subtle.importKey("raw",Xw(n),"AES-GCM",!1,["encrypt"]);case 3:return r=e.sent,e.next=6,window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,qw(window.btoa(JSON.stringify(t))));case 6:return i=e.sent,e.abrupt("return",zw(new Uint8Array(i)));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(t,t.token||t.appId);case 5:if(a=e.sent){e.next=8;break}return e.abrupt("return");case 8:n=XB(NB),(o=n?JSON.parse(n):[]).push(((r={})[i]=a,r)),o.length>rk("AP_CACHE_NUM")&&o.shift(),JB(NB,JSON.stringify(o)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),Dk.warn("Error caching server parameters:",e.t0.message),JB(NB,"");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))(f);case 30:MB++,e.next=36;break;case 33:throw e.prev=33,e.t0=e.catch(0),UB++,function(e){xB||(xB=window.setTimeout((function(){var t="";VB.forEach((function(e,n){t+="".concat(n,": ").concat(e," ;")})),Fk.reportApiInvoke(null,{name:Rw.PRELOAD,options:{success:MB,failed:UB,err:t}}).onError(e),MB=0,UB=0,VB.clear(),xB=null}),1e4));var t=VB.get(e.code)||0;VB.set(e.code,t+1)}(e.t0),e.t0;case 36:case"end":return e.stop()}}),e,null,[[0,33]])})))).apply(this,arguments)}function WB(e){return HB.apply(this,arguments)}function HB(){return(HB=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!rk("AP_REQUEST_DETAIL")&&!rk("ENABLE_ROLE_SELECT_EDGE")){e.next=3;break}return e.abrupt("return");case 3:if((n=KB(t))&&"disabled"===t.cloudProxyServer){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.crypto.subtle.importKey("raw",Xw(n),"AES-GCM",!1,["decrypt"]);case 3:return r=e.sent,e.next=6,window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,qw(t));case 6:return i=e.sent,e.abrupt("return",JSON.parse(window.atob(zw(new Uint8Array(i)))));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(n,t.token||t.appId);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return");case 11:if(function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(r,t)){e.next=13;break}return e.abrupt("return");case 13:if(!(r&&Date.now()-r.ts<rk("AP_CACHE_LIFETIME"))){e.next=15;break}return e.abrupt("return",r);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),Dk.warn("Error get preloadInfo",e.t0.message);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function KB(e){var t;try{if(!(t=XB(NB)))return;var n=JSON.parse(t),r=QB(e),i=function(e,t){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(function(e){return r in e}));if(-1===i)return;var a=n.splice(i,1)[0];return JB(NB,JSON.stringify(n)),a[r]}catch(e){Dk.warn("Error delete preload info: ".concat(t),e.message),JB(NB,"")}}function YB(e){if(e){var t=PB.get(e);t&&(window.clearTimeout(t),t=null,PB.delete(e)),Br(LB).call(LB,e)||"disabled"!==e.cloudProxyServer||LB.push(e)}if(PB.size<rk("AP_CACHE_NUM")&&LB.length>0){var n=LB.shift();PB.set(n,window.setTimeout(p(l().mark((function e(){var t,r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.appId,r=n.cname,i=n.token,a=n.stringUid,o=n.uid,s=n.proxyServer,e.prev=1,e.next=4,FB(t,r,i,o,s,a);case 4:PB.has(n)&&YB(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Dk.warn("update preload failed",e.t0.message),qB(n);case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),rk("AP_UPDATE_INTERVAL")))}}function qB(e){var t=LB.indexOf(e);-1!==t&&LB.splice(t,1);var n=PB.get(e);n&&(window.clearTimeout(n),n=null,PB.delete(e),YB())}function zB(e,t){var n=e.sua,r=e.ap;t&&n&&Fk.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Fk.reportResourceTiming(e.ap.url,e.sid),Fk.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((function(e){return e.ip})).join(","),eventType:"disabled",unilbsServerIds:[hU.CHOOSE_SERVER,hU.CLOUD_PROXY_FALLBACK].toString()}),Fk.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((function(e){return e.address})),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[hU.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function XB(e){return window.atob(window.localStorage.getItem(e)||"")}function JB(e,t){window.localStorage.setItem(e,window.btoa(t))}function QB(e){var t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),pO(t)}function ZB(e){var t=function(){var e=nj.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){var n=e.appId;void 0!==n&&(hj(t,10),uj(t,n));var r=e.cid;void 0!==r&&(hj(t,16),hj(t,r));var i=e.cname;void 0!==i&&(hj(t,26),uj(t,i));var a=e.deviceId;void 0!==a&&(hj(t,34),uj(t,a));var o=e.elapse;void 0!==o&&(hj(t,40),_j(t,o));var s=e.fileSize;void 0!==s&&(hj(t,48),_j(t,tj(s)));var c=e.height;void 0!==c&&(hj(t,56),_j(t,tj(c)));var u=e.jpg;void 0!==u&&(hj(t,66),hj(t,u.length),sj(t,u));var d=e.networkType;void 0!==d&&(hj(t,72),_j(t,tj(d)));var p=e.osType;void 0!==p&&(hj(t,80),_j(t,tj(p)));var l=e.requestId;void 0!==l&&(hj(t,90),uj(t,l));var h=e.sdkVersion;void 0!==h&&(hj(t,98),uj(t,h));var f=e.sequence;void 0!==f&&(hj(t,104),_j(t,tj(f)));var _=e.sid;void 0!==_&&(hj(t,114),uj(t,_));var v=e.timestamp;void 0!==v&&(hj(t,120),_j(t,v));var E=e.uid;void 0!==E&&(hj(t,128),hj(t,E));var m=e.vid;void 0!==m&&(hj(t,136),hj(t,m));var S=e.width;void 0!==S&&(hj(t,144),_j(t,tj(S)));var g=e.service;void 0!==g&&(hj(t,152),hj(t,g));var T=e.callbackData;void 0!==T&&(hj(t,162),hj(t,T.length),sj(t,T));var b=e.ticket;void 0!==b&&(hj(t,170),uj(t,b));var R=e.vendorConfigs;void 0!==R&&(hj(t,178),uj(t,R))}(e,t),function(e){var t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function $B(e){return function(e){var t={};e:for(;!ij(e);){var n=lj(e);switch(n>>>3){case 0:break e;case 1:t.code=lj(e);break;case 2:t.msg=cj(e,lj(e));break;case 3:t.requestId=cj(e,lj(e));break;case 4:t.timestamp=fj(e,!1);break;default:ej(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function ej(e,t){switch(t){case 0:for(;128&dj(e););break;case 2:rj(e,lj(e));break;case 5:rj(e,4);break;case 1:rj(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function tj(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var nj=[];function rj(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ij(e){return e.offset>=e.limit}function aj(e,t){var n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){var o=new Uint8Array(2*a);o.set(n),e.bytes=o}return e.offset=a,a>i&&(e.limit=a),r}function oj(e,t){var n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function sj(e,t){var n=aj(e,t.length);e.bytes.set(t,n)}function cj(e,t){for(var n=oj(e,t),r=String.fromCharCode,i=e.bytes,a="�",o="",s=0;s<t;s++){var c=void 0,u=void 0,d=void 0,p=void 0,l=i[s+n];0==(128&l)?o+=r(l):192==(224&l)?s+1>=t||128!=(192&(c=i[s+n+1]))||(p=(31&l)<<6|63&c)<128?o+=a:(o+=r(p),s++):224==(240&l)?s+2>=t||32896!=(49344&((c=i[s+n+1])|(u=i[s+n+2])<<8))||(p=(15&l)<<12|(63&c)<<6|63&u)<2048||p>=55296&&p<=57343?o+=a:(o+=r(p),s+=2):240==(248&l)?s+3>=t||8421504!=(12632256&((c=i[s+n+1])|(u=i[s+n+2])<<8|(d=i[s+n+3])<<16))||(p=(7&l)<<18|(63&c)<<12|(63&u)<<6|63&d)<65536||p>1114111?o+=a:(o+=r(55296+((p-=65536)>>10),56320+(1023&p)),s+=3):o+=a}return o}function uj(e,t){for(var n=t.length,r=0,i=0;i<n;i++){var a=t.charCodeAt(i);a>=55296&&a<=56319&&i+1<n&&(a=(a<<10)+t.charCodeAt(++i)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}hj(e,r);for(var o=aj(e,r),s=e.bytes,c=0;c<n;c++){var u=t.charCodeAt(c);u>=55296&&u<=56319&&c+1<n&&(u=(u<<10)+t.charCodeAt(++c)-56613888),u<128?s[o++]=u:(u<2048?s[o++]=u>>6&31|192:(u<65536?s[o++]=u>>12&15|224:(s[o++]=u>>18&7|240,s[o++]=u>>12&63|128),s[o++]=u>>6&63|128),s[o++]=63&u|128)}}function dj(e){return e.bytes[oj(e,1)]}function pj(e,t){var n=aj(e,1);e.bytes[n]=t}function lj(e){var t,n=0,r=0;do{t=dj(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function hj(e,t){for(t>>>=0;t>=128;)pj(e,127&t|128),t>>>=7;pj(e,t)}function fj(e,t){var n,r=0,i=0,a=0;return r=127&(n=dj(e)),128&n&&(r|=(127&(n=dj(e)))<<7,128&n&&(r|=(127&(n=dj(e)))<<14,128&n&&(r|=(127&(n=dj(e)))<<21,128&n&&(i=127&(n=dj(e)),128&n&&(i|=(127&(n=dj(e)))<<7,128&n&&(i|=(127&(n=dj(e)))<<14,128&n&&(i|=(127&(n=dj(e)))<<21,128&n&&(a=127&(n=dj(e)),128&n&&(a|=(127&(n=dj(e)))<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function _j(e,t){var n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=aj(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}var vj={},Ej={},mj=4294967296,Sj=mj*mj,gj=Sj/2,Tj=Ij(0,!0),bj=Ij(0),Rj=Aj(0,-2147483648,!1),Cj=Aj(-1,2147483647,!1),yj=Aj(-1,-1,!0);function Ij(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=Ej[e])?r:(n=Aj(e,0,!0),i&&(Ej[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=vj[e])?r:(n=Aj(e,e<0?-1:0,!1),i&&(vj[e]=n),n)}function Aj(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function wj(e,t){if(isNaN(e))return t?Tj:bj;if(t){if(e<0)return Tj;if(e>=Sj)return yj}else{if(e<=-gj)return Rj;if(e+1>=gj)return Cj}return e<0?t?Tj:bj:Aj(e%mj|0,e/mj|0,t)}function Oj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var kj=function(e){function t(t){var n,i;return XC(r(n=e.call(this)||this),"name","AgoraRTCImageModeration"),XC(r(n),"_connectionState",jM.CONNECTING),XC(r(n),"_sequence",0),XC(r(n),"_moderationStartTime",void 0),XC(r(n),"_workerConnection",void 0),XC(r(n),"_workerMessageLengthLimit",void 0),XC(r(n),"_qualityRatio",void 0),XC(r(n),"_connectInfo",void 0),XC(r(n),"_cancelTokenSource",_A.CancelToken.source()),XC(r(n),"_retryConfig",void 0),XC(r(n),"_moderationInterval",void 0),XC(r(n),"_moderationTimer",null),XC(r(n),"_moderationMode",1),XC(r(n),"_quality",1),XC(r(n),"_qualityTimer",null),XC(r(n),"_ticket",void 0),XC(r(n),"_moderationIntervalMinimum",void 0),XC(r(n),"_uploadFailedNum",0),XC(r(n),"_uploadNum",0),XC(r(n),"_uploadTimer",null),XC(r(n),"_extraInfo",void 0),XC(r(n),"_vendor",""),XC(r(n),"_encoder",new TextEncoder),XC(r(n),"_moderationId",void 0),XC(r(n),"inspectImage",(function(){if(n.connectionState!==jM.CONNECTED)throw new Bk(iw.OPERATION_ABORTED,"image moderation service connection status is ".concat(n.connectionState));n._moderationTimer&&(window.clearInterval(n._moderationTimer),n._moderationTimer=null),n._moderationTimer=window.setInterval((function(){n.connectionState===jM.CONNECTED?n.requestToInspectImage():Dk.debug("[".concat(n._moderationId,"] Moderation State is not connected , "),n.connectionState)}),n._moderationInterval<n._moderationIntervalMinimum?n._moderationIntervalMinimum:n._moderationInterval),n.requestToInspectImage()})),n._moderationId=tO(5,"image-moderation-"),n._workerMessageLengthLimit=rk("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),n._moderationIntervalMinimum=rk("IMAGE_MODERATION_INTERVAL_MINIMUM"),n._moderationInterval=null!==(i=t.interval)&&void 0!==i?i:1e3,t.extraInfo&&(n._extraInfo=n._encoder.encode(t.extraInfo)),t.vendor&&(n._vendor=t.vendor),n._qualityRatio=rk("IMAGE_MODERATION_QUALITY_RATIO"),n._moderationStartTime=Number(Date.now()),n._workerConnection=new dU("worker-"+n._moderationId,vO),n.on(GM.STATE_CHANGE,(function(e,t){Dk.debug("[".concat(n._moderationId,"] Moderation operation :").concat(WM[e]," ").concat(t||""))})),n.handleWorkerEvents(),n}i(t,e);var n=t.prototype;return n.init=function(){var e=p(l().mark((function e(t,n){var r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(GM.STATE_CHANGE,WM.CONNECT_AP),this._connectInfo=t,r=this._cancelTokenSource.token,e.abrupt("return",(this._retryConfig=n,new zl((function(e,a){i.on(GM.CONNECTION_STATE_CHANGE,(function(t,n){t===jM.CONNECTED&&e()})),i.requestAP(t,r,n).then((function(e){i.connectWorker(e)})).catch((function(e){a(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.updateConfig=function(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),Dk.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===jM.CONNECTED&&this.inspectImage()},n.requestAP=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=rk("WEBCS_DOMAIN").map((function(e){return"https://".concat(e,"/api/v1")})),e.next=3,function(e,t,n,r){var i=t.appId,a=t.areaCode,o=t.cname,s=t.sid,c=t.token,u=t.uid;FV++;var d,h,f="moderation_plugin",_={service_name:f,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:FV,seq:FV,sid:s,appToken:c,ts:Date.now(),uid:u+""})},v=e[0];return mO(p(l().mark((function e(){var t,r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=Date.now(),e.next=3,EV(v,{data:_,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});case 3:if(t=e.sent,h=Date.now()-d,0===t.code){e.next=7;break}throw r=new Bk(iw.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+t.code,{retry:!0,responseTime:h}),Dk.error(r.toString()),r;case 7:if(200===(i=JSON.parse(t.json_body)).code){e.next=11;break}throw a=new Bk(iw.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(i.code,", reason: ").concat(i.reason),{code:i.code,responseTime:h}),Dk.error(a.toString()),a;case 11:if(i.servers&&Array.isArray(i.servers)&&0!==i.servers.length){e.next=14;break}throw o=new Bk(iw.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:i.code,responseTime:h}),Dk.error(o.toString()),o;case 14:if(i.servers.some((function(e){return!!e.wss}))){e.next=17;break}throw s=new Bk(iw.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:i.code,responseTime:h}),Dk.error(s.toString()),s;case 17:return c=rk("IMAGE_MODERATION_WORKER_HOST"),e.abrupt("return",{addressList:i.servers.map((function(e){var t=e.address,n=e.wss;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(c,":").concat(n,"/moderation")})).filter((function(e){return!!e})),workerToken:i.workerToken,vid:i.vid,ticket:i.appTicket,responseTime:h});case 19:case"end":return e.stop()}}),e)}))),(function(t,n){return Fk.apworkerEvent(s,{success:!0,sc:200,serviceName:f,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1}),(function(t,n){return Fk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:f,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==iw.OPERATION_ABORTED&&t.code!==iw.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(v=e[(n+1)%e.length],!0)}),r)}(i,t,n,r);case 3:return a=e.sent,this.emit(GM.STATE_CHANGE,WM.AP_CONNECTED),o=a.addressList,s=a.ticket,e.abrupt("return",(this._ticket=s,o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.connectWorker=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(GM.STATE_CHANGE,WM.CONNECT_WORKER),e.next=3,this._workerConnection.init(t,1e4);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.handleWorkerEvents=function(){var e=this;this._workerConnection.on(tM.CONNECTED,p(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(GM.STATE_CHANGE,WM.WORKER_CONNECTED,e._workerConnection.url),e.connectionState=jM.CONNECTED;case 1:case"end":return t.stop()}}),t)})))),this._workerConnection.on(tM.CLOSED,(function(){e.connectionState=jM.CLOSED})),this._workerConnection.on(tM.FAILED,(function(){e.connectionState=jM.CLOSED})),this._workerConnection.on(tM.RECONNECTING,(function(){e.connectionState=e.connectionState===jM.CONNECTED?jM.RECONNECTING:jM.CONNECTING})),this._workerConnection.on(tM.ON_MESSAGE,p(l().mark((function t(n){var r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.data instanceof ArrayBuffer?(r=$B(new Uint8Array(n.data)),rk("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Dk.debug("[".concat(e._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),e._uploadNum++,void 0===r.code||0===r.code||(e._uploadFailedNum++,Dk.error("[".concat(e._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),e._uploadTimer||(e._uploadTimer=window.setTimeout((function(){Fk.reportApiInvoke(e._connectInfo.sid||null,{name:Rw.IMAGE_MODERATION_UPLOAD,options:[e._uploadFailedNum,e._uploadNum,r.code],tag:Cw.TRACER}).onError(new Bk(iw.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),e._uploadTimer=null}),rk("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))):Dk.error("[".concat(e._moderationId,"] Unexpected message type from worker"));case 1:case"end":return t.stop()}}),t)})))),this._workerConnection.on(tM.WILL_RECONNECT,(function(e,t,n){"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(tM.REQUEST_NEW_URLS,(function(t,n){e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then(t).catch(n)}))},t.intToLong=function(e){return{low:e|=0,high:e>>31,unsigned:e>=0}},n.requestToInspectImage=function(){var e=p(l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Uw(this,GM.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid},!t){e.next=11;break}if(t.isPlaying){e.next=4;break}return e.abrupt("return",void(rk("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Dk.debug("Only the track being played can be inspected")));case 4:return this._sequence++,e.next=7,this.generateRequestData(t,n);case 7:r=e.sent,this._workerConnection.sendMessage(r,!0,!0),e.next=12;break;case 11:rk("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Dk.debug("Only the track being published can be inspected");case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.generateRequestData=function(){var e=p(l().mark((function e(n,r){var i,a,o,s,c,u,d,p,h,f,_,v,E,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.appId,a=r.cname,o=r.cid,s=r.vid,c=r.sid,u=r.uid,d=Date.now(),e.next=4,n.getCurrentFrameImage("image/jpeg",this.quality);case 4:return p=e.sent,e.next=7,pP(p,i,a);case 7:if(h=e.sent,f=this._sequence+"-"+o+"-"+u+"-"+d+"-"+tO(12,""),_={appId:i,cid:o,cname:a,deviceId:"",elapse:t.intToLong(Number(d-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:h,networkType:6,osType:7,requestId:f,sdkVersion:"4.23.4",sequence:this._sequence,sid:c,timestamp:wj(d),uid:u,vid:s,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor},void 0===this._extraInfo&&delete _.callbackData,!((v=ZB(_)).byteLength<this._workerMessageLengthLimit)){e.next=15;break}return rk("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&(delete(E=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oj(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},_)).jpg,Dk.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(E))),e.abrupt("return",v);case 15:return m=this.quality*this._qualityRatio,this.quality=m,e.next=19,this.generateRequestData(n,{appId:i,cname:a,cid:o,vid:s,sid:c,uid:u});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.close=function(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_A.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=jM.CLOSED,this.emit(GM.STATE_CHANGE,WM.CLOSED)},v(t,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){if(this._connectionState!==e){var t=this._connectionState;this._connectionState=e,this.emit(GM.CONNECTION_STATE_CHANGE,e,t)}}},{key:"quality",get:function(){return this._quality},set:function(e){var t=this;this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((function(){t.quality=t._quality/t._qualityRatio}),6e4))}}]),t}(gw);function Nj(e){if(cw(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Bk(iw.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Bk(iw.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var Dj,Pj,Lj,xj,Mj,Uj,Vj,Fj,Bj,jj,Gj,Wj,Hj,Kj,Yj,qj,zj,Xj,Jj,Qj,Zj,$j,eG,tG,nG,rG,iG,aG,oG,sG,cG,uG,dG,pG,lG,hG,fG,_G,vG,EG,mG,SG,gG={name:"ImageModeration",create:function(e){var t=e.config;return Nj(t),new kj(t)}};function TG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TG(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}fO.setLogger(Dk);var RG,CG,yG=(Dj=Vk(),Pj=Vk({argsMap:function(e,t){if(!Array.isArray(t)){if(!(t instanceof LN))return[t];t=[t]}return t.map((function(e){return e?Object(e).toString():"null"}))}}),Lj=Vk({argsMap:function(e,t){return t||(t=[]),Array.isArray(t)||t.trackMediaType!==fN.DATA?(Array.isArray(t)||(t=[t]),t.map((function(e){return e.getTrackId()}))):[t.getChannelId()]}}),xj=Vk({argsMap:function(e,t,n,r){return["object"==typeof t?t.uid:t,n,r]}}),Mj=Vk({argsMap:function(e,t,n){return[t,n]}}),Uj=Vk({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return[null==t?void 0:t.uid,n]}))}}),Vj=Vk({argsMap:function(e,t,n,r){return["object"==typeof t?t.uid:t,n,r]}}),Fj=Vk({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return{uid:null==t?void 0:t.uid,mediaType:n}}))}}),Bj=Vk(),jj=Vk(),Gj=Vk(),Wj=Vk(),Hj=Vk(),Kj=Vk(),Yj=Vk(),qj=Vk(),zj=Vk(),Xj=Vk(),Jj=Vk(),Qj=Vk(),Zj=Vk(),$j=Vk(),eG=Vk(),tG=Vk({argsMap:function(e,t){return[t]}}),nG=Vk(),rG=Vk(),iG=Vk(),aG=Vk(),oG=Vk(),sG=Vk(),cG=Vk(),uG=Vk(),dG=Vk({argsMap:function(e,t){return Array.isArray(t)||(t=[t]),[JSON.stringify(t)]}}),pG=Vk(),lG=Vk(),hG=Vk(),fG=Vk(),_G=Vk(),vG=Vk(),EG=Vk({reportResult:!0}),mG=Vk(),Wx((SG=function(e){function t(t,n){var i,a,o;if(XC(r(i=e.call(this)||this),"store",void 0),XC(r(i),"_uid",void 0),XC(r(i),"_channelName",void 0),XC(r(i),"_uintUid",void 0),XC(r(i),"_users",[]),XC(r(i),"_config",void 0),XC(r(i),"_clientId",void 0),XC(r(i),"_appId",void 0),XC(r(i),"_sessionId",null),XC(r(i),"_key",void 0),XC(r(i),"_rtmConfig",{}),XC(r(i),"_joinInfo",void 0),XC(r(i),"_gateway",void 0),XC(r(i),"_statsCollector",void 0),XC(r(i),"_configDistribute",void 0),XC(r(i),"_leaveMutex",void 0),XC(r(i),"_publishMutex",void 0),XC(r(i),"_renewTokenMutex",void 0),XC(r(i),"_subscribeMutex",void 0),XC(r(i),"_encryptionMode","none"),XC(r(i),"_encryptionSecret",null),XC(r(i),"_encryptionSalt",null),XC(r(i),"_encryptDataStream",!1),XC(r(i),"_encryptDataStreamKey",null),XC(r(i),"_encryptDataStreamIv",null),XC(r(i),"_proxyServer",void 0),XC(r(i),"_turnServer",{servers:[],mode:"auto"}),XC(r(i),"_cloudProxyServerMode","disabled"),XC(r(i),"_isDualStreamEnabled",!1),XC(r(i),"_defaultStreamFallbackType",void 0),XC(r(i),"_lowStreamParameter",void 0),XC(r(i),"_streamFallbackTypeCacheMap",new Map),XC(r(i),"_remoteStreamTypeCacheMap",new Map),XC(r(i),"_axiosCancelSource",_A.CancelToken.source()),XC(r(i),"_audioVolumeIndicationInterval",void 0),XC(r(i),"_networkQualityInterval",void 0),XC(r(i),"_userOfflineTimeout",void 0),XC(r(i),"_streamRemovedTimeout",void 0),XC(r(i),"_liveTranscodeStreamingClient",void 0),XC(r(i),"_liveRawStreamingClient",void 0),XC(r(i),"_channelMediaRelayClient",void 0),XC(r(i),"_networkQualitySensitivity","normal"),XC(r(i),"_p2pChannel",void 0),XC(r(i),"_useLocalAccessPoint",!1),XC(r(i),"_setLocalAPVersion",void 0),XC(r(i),"_joinAndNotLeaveYet",!1),XC(r(i),"_numberOfJoinCount",0),XC(r(i),"_remoteDefaultVideoStreamType",void 0),XC(r(i),"_inspect",void 0),XC(r(i),"_moderation",void 0),XC(r(i),"_license",void 0),XC(r(i),"_pendingPublishedUsers",[]),XC(r(i),"ntpAlignErrorCount",0),XC(r(i),"remoteInboundOffset",0),XC(r(i),"_peerConnectionState",void 0),XC(r(i),"_handleLocalTrackEnable",(function(e,t,n){i.publish(e,!1).then(t).catch(n)})),XC(r(i),"_handleLocalTrackDisable",(function(e,t,n){i.unpublish(e).then(t).catch(n)})),XC(r(i),"_handleUserOnline",(function(e){if(rk("BLOCK_LOCAL_CLIENT")&&sx(e.uid,i.channelName))Dk.debug("[".concat(e.uid,"] will be ignored in local"));else{i.isStringUID&&"string"!=typeof e.uid&&Dk.error("[".concat(i._clientId,"] StringUID is Mixed with UintUID"));var t=i._users.find((function(t){return t.uid===e.uid}));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,i.safeEmit(Nw.USER_JOINED,t));else{var n=new mF(e.uid,e.uint_id||e.uid);i._users.push(n),Dk.debug("[".concat(i._clientId,"] user online"),e.uid),i.safeEmit(Nw.USER_JOINED,n)}}})),XC(r(i),"_handleUserOffline",(function(e){if(!rk("BLOCK_LOCAL_CLIENT")||!sx(e.uid,i.channelName)){var t=i._users.find((function(t){return t.uid===e.uid}));t&&(i._handleRemoveStream(e),i._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:Bw(i._users,t),i._remoteStreamTypeCacheMap.delete(t.uid),i._streamFallbackTypeCacheMap.delete(t.uid),Dk.debug("[".concat(i._clientId,"] user offline"),e.uid,"reason:",e.reason),i.safeEmit(Nw.USER_LEAVED,t,e.reason))}})),XC(r(i),"_handleAddAudioOrVideoStream",(function(e,t,n,r,a,o,s){if(!rk("BLOCK_LOCAL_CLIENT")||!sx(t,i.channelName)){var c=i._users.find((function(e){return e.uid===t}));if(c){Dk.debug("[".concat(i._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),i.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now());var u="audio"===e?c.hasAudio:c.hasVideo;c._uintid||(c._uintid=a||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==r&&(c._cname=r),o&&(c._audioOrtc=o)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==r&&(c._cname=r),void 0!==s&&(c._rtxSsrcId=s),o&&(c._videoOrtc=o)),("audio"===e?c.hasAudio:c.hasVideo)&&!u&&(Dk.info("[".concat(i._clientId,"] remote user ").concat(c.uid," published ").concat(e)),i.safeEmit(Nw.USER_PUBLISHED,c,e)),"video"===e?Fk.onGatewayStream(i._sessionId,xk.ON_ADD_VIDEO_STREAM,Mk.ON_ADD_VIDEO_STREAM,{peer:a||t,ssrc:c._videoSSRC}):Fk.onGatewayStream(i._sessionId,xk.ON_ADD_AUDIO_STREAM,Mk.ON_ADD_AUDIO_STREAM,{peer:a||t,ssrc:c._audioSSRC}),i._p2pChannel.remoteMediaSsrcChanged(c,e,n).then((function(t){if(t&&(Dk.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),i._p2pChannel instanceof EB))return i._p2pChannel.unsubscribe(c,e,!0).then((function(){return i._subscribe(c,e,!0).catch((function(e){Dk.error("[".concat(i._clientId,"] resubscribe error"),e.toString())}))}))})),i._p2pChannel.hasPendingRemoteMedia(c,e)&&(Dk.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),i._subscribe(c,e,!0).catch((function(e){Dk.error("[".concat(i._clientId,"] resubscribe error"),e.toString())})))}else Dk.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)"))}})),XC(r(i),"_handleRemoveStream",(function(e){if(!rk("BLOCK_LOCAL_CLIENT")||!sx(e.uid,i.channelName)){var t=i._users.find((function(t){return t.uid===e.uid}));if(t){Dk.debug("[".concat(i._clientId,"] stream removed with uid ").concat(e.uid));var n=function(){};t.hasAudio&&t.hasVideo?n=function(){Dk.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished audio track")),i.safeEmit(Nw.USER_UNPUBLISHED,t,"audio"),Dk.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished video track")),i.safeEmit(Nw.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=function(){Dk.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished video track")),i.safeEmit(Nw.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=function(){Dk.info("[".concat(i._clientId,"] remote user ").concat(t.uid," unpublished audio track")),i.safeEmit(Nw.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,i._p2pChannel instanceof EB&&i._p2pChannel.unsubscribe(t).then((function(e){if(e)return i._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),Fk.onGatewayStream(i._sessionId,xk.ON_REMOVE_STREAM,Mk.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}else Dk.warning("[".concat(i._clientId,"] can not find target user!(on_remove_stream)"))}})),XC(r(i),"_handleSetStreamLocalEnable",(function(e,t,n){if(!rk("BLOCK_LOCAL_CLIENT")||!sx(t,i.channelName)){var r=i._users.find((function(e){return e.uid===t}));if(r){Dk.debug("[".concat(i._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));var a="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;var o=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===o)return;var s=r._audio_enabled_?"enable-local-audio":"disable-local-audio";Dk.debug("[".concat(i._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(s)),i.safeEmit(Nw.USER_INFO_UPDATED,t,s)}else{r._trust_video_enabled_state_=!0;var c=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===c)return;var u=r._video_enabled_?"enable-local-video":"disable-local-video";Dk.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(u)),i.safeEmit(Nw.USER_INFO_UPDATED,t,u)}var d="audio"===e?r.hasAudio:r.hasVideo;return a!==d?!a&&d?(Dk.info("[".concat(i._clientId,"] remote user ").concat(t," published ").concat(e)),void i.safeEmit(Nw.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,i._p2pChannel.muteRemote(r,e),Dk.info("[".concat(i._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void i.safeEmit(Nw.USER_UNPUBLISHED,r,e)):void 0}Dk.error("[".concat(i._clientId,"] can not find target user!(disable_local)"))}})),XC(r(i),"_handleMuteStream",(function(e,t,n){if(!rk("BLOCK_LOCAL_CLIENT")||!sx(e,i.channelName)){Dk.debug("[".concat(i._clientId,"] receive mute message"),e,t,n);var r=i._users.find((function(t){return t.uid===e}));if(r){var a="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;var o=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===o)return;var s=r._audio_muted_?"mute-audio":"unmute-audio";Dk.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(s)),i.safeEmit(Nw.USER_INFO_UPDATED,e,s)}else{r._trust_video_mute_state_=!0;var c=r._video_muted_;if(r._video_muted_=n,r._video_muted_===c)return;var u=r._video_muted_?"mute-video":"unmute-video";Dk.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(u)),i.safeEmit(Nw.USER_INFO_UPDATED,e,u)}var d="audio"===t?r.hasAudio:r.hasVideo;if(a!==d){if(!a&&d)return("audio"===t?r._audioSSRC:r._videoSSRC)?(Dk.info("[".concat(i._clientId,"] remote user ").concat(e," published ").concat(t)),void i.safeEmit(Nw.USER_PUBLISHED,r,t)):void Dk.warning("[".concat(i._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,i._p2pChannel.muteRemote(r,t),Dk.info("[".concat(i._clientId,"] remote user ").concat(e," unpublished ").concat(t)),i.safeEmit(Nw.USER_UNPUBLISHED,r,t)}}else Dk.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e))}})),XC(r(i),"_handleP2PLost",p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("[".concat(i._clientId,"] receive p2p lost"),t),parseInt(t.p2pid,10)!==i.store.p2pId){e.next=6;break}return e.next=4,i._p2pChannel.requestReconnect();case 4:e.next=7;break;case 6:Dk.warning("[".concat(i._clientId,"] P2PLost stream not found"),t);case 7:case"end":return e.stop()}}),e)})))),XC(r(i),"_handleTokenWillExpire",(function(){Dk.debug("[".concat(i._clientId,"] received message onTokenPrivilegeWillExpire")),i.safeEmit(Nw.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),XC(r(i),"_handleBeforeUnload",(function(e){"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(i.leave(),Dk.info("[".concat(i._clientId,"] auto leave onbeforeunload or pagehide")))})),XC(r(i),"_handleUpdateNetworkQuality",(function(){if("normal"!==i._networkQualitySensitivity)if(!navigator||void 0===navigator.onLine||navigator.onLine){var e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=i._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=i._p2pChannel.getDownlinkNetworkQuality(),i.safeEmit(Nw.NETWORK_QUALITY,e)}else i.safeEmit(Nw.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6})})),XC(r(i),"_handleP2PAddAudioOrVideoStream",(function(e,t,n,r){var a=i._users.find((function(e){return e.uid===t}));if(a){Dk.debug("[".concat(i._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),i.store.subscribe(a.uid,e,void 0,void 0,void 0,Date.now());var o="audio"===e?a.hasAudio:a.hasVideo;"audio"===e?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===e?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==r&&(a._audioMid=r)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==r&&(a._videoMid=r)),("audio"===e?a.hasAudio:a.hasVideo)&&!o&&(Dk.info("[".concat(i._clientId,"] remote user ").concat(a.uid," published ").concat(e)),i.safeEmit(Nw.USER_PUBLISHED,a,e)),i._p2pChannel.hasPendingRemoteMedia(a,e)&&(Dk.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after reconnect.")),i._subscribe(a,e,!0).catch((function(e){Dk.error("[".concat(i._clientId,"] resubscribe error"),e.toString())})))}else Dk.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)"))})),i._config=t,i._clientId=n||tO(5,"client-"),i.store=new(function(){function e(e,t,n,r){tw(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:XO.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}var t=e.prototype;return t.dispatch=function(e){this.state=function(e,t){switch(t.type){case ok.SET_SESSION_ID:return rw(rw({},e),{},{sessionId:t.sessionId});case ok.SET_P2P_ID:return rw(rw({},e),{},{p2pId:t.p2pId});case ok.SET_UID:return rw(rw({},e),{},{uid:t.uid});case ok.SET_INT_UID:return rw(rw({},e),{},{intUid:t.intUid});case ok.SET_PUB_ID:return rw(rw({},e),{},{pubId:t.pubId});case ok.KEY_METRIC_CLIENT_CREATED:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{clientCreated:t.metric})});case ok.KEY_METRIC_JOIN_START:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{joinStart:t.metric})});case ok.KEY_METRIC_JOIN_END:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{joinEnd:t.metric})});case ok.KEY_METRIC_REQUEST_AP_START:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{requestAPStart:t.metric})});case ok.KEY_METRIC_REQUEST_AP_END:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{requestAPEnd:t.metric})});case ok.KEY_METRIC_JOIN_GATEWAY_START:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case ok.KEY_METRIC_JOIN_GATEWAY_END:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case ok.KEY_METRIC_PEER_CONNECTION_START:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case ok.KEY_METRIC_PEER_CONNECTION_END:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case ok.KEY_METRIC_DESCRIPTION_START:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{descriptionStart:t.metric})});case ok.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case ok.KEY_METRIC_ICE_CONNECTION_END:return rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case ok.KEY_METRIC_PUBLISH:var n=e.keyMetrics.publish,r=n.findIndex((function(e){return e.trackId===t.metric.trackId}));return-1!==r?(n[r]=rw(rw({},n[r]),t.metric),rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{publish:[].concat(n)})})):rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{publish:[].concat(e.keyMetrics.publish,[t.metric])})});case ok.KEY_METRIC_SUBSCRIBE:var i=e.keyMetrics.subscribe,a=i.findIndex((function(e){return e.userId===t.metric.userId&&e.type===t.metric.type}));return-1!==a?(i[a]=rw(rw({},i[a]),t.metric),rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{subscribe:[].concat(i)})})):rw(rw({},e),{},{keyMetrics:rw(rw({},e.keyMetrics),{},{subscribe:[].concat(e.keyMetrics.subscribe,[t.metric])})});case ok.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case ok.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[].concat(e.joinChannelServiceRecords,[t.record]):(e.joinChannelServiceRecords[t.index]=rw(rw({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[].concat(e.joinChannelServiceRecords)),e;case ok.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case ok.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case ok.SET_USE_P2P:return rw(rw({},e),{},{useP2P:t.val});case ok.SET_TRANSPORT_TYPE:return rw(rw({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)},t.clientCreated=function(){this.dispatch({type:ok.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})},t.joinStart=function(){this.dispatch({type:ok.KEY_METRIC_JOIN_START,metric:Date.now()})},t.joinEnd=function(){this.dispatch({type:ok.KEY_METRIC_JOIN_END,metric:Date.now()})},t.requestAPStart=function(){this.dispatch({type:ok.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})},t.requestAPEnd=function(){this.dispatch({type:ok.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})},t.joinGatewayStart=function(){this.dispatch({type:ok.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})},t.joinGatewayEnd=function(){this.dispatch({type:ok.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})},t.peerConnectionStart=function(){this.dispatch({type:ok.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})},t.peerConnectionEnd=function(){this.dispatch({type:ok.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})},t.descriptionStart=function(){this.dispatch({type:ok.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})},t.signalChannelOpen=function(){this.dispatch({type:ok.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})},t.iceConnectionEnd=function(){this.dispatch({type:ok.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})},t.publish=function(e,t,n,r){this.dispatch({type:ok.KEY_METRIC_PUBLISH,metric:rw(rw({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})},t.subscribe=function(e,t,n,r,i,a,o){this.dispatch({type:ok.KEY_METRIC_SUBSCRIBE,metric:rw(rw(rw(rw(rw({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),a&&{streamAdded:a}),o&&{firstDecoded:o})})},t.massSubscribe=function(e,t,n,r){var i=this;e.forEach((function(e){i.dispatch({type:ok.KEY_METRIC_SUBSCRIBE,metric:rw(rw(rw({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))},t.recordJoinChannelService=function(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((function(e){return e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")})));try{return"number"!=typeof t?(this.dispatch({type:ok.RECORD_JOIN_CHANNEL_SERVICE,record:rw(rw({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ok.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}},t.resetJoinChannelServiceRecords=function(){this.dispatch({type:ok.RESET_JOIN_CHANNEL_SERVICE_RECORDS})},t.resetKeyMetrics=function(){this.dispatch({type:ok.RESET_KEY_METRICS})},v(e,[{key:"sessionId",get:function(){return this.state.sessionId},set:function(e){this.dispatch({type:ok.SET_SESSION_ID,sessionId:e})}},{key:"cid",get:function(){return this.state.cid},set:function(e){this.state.cid=e}},{key:"codec",get:function(){return this.state.codec},set:function(e){this.state.codec=e}},{key:"mode",get:function(){return this.state.mode}},{key:"audioCodec",get:function(){return this.state.audioCodec}},{key:"clientId",get:function(){return this.state.clientId}},{key:"p2pId",get:function(){return this.state.p2pId},set:function(e){this.dispatch({type:ok.SET_P2P_ID,p2pId:e})}},{key:"dcId",get:function(){return this.state.dcId},set:function(e){this.dispatch({type:ok.SET_DC_ID,dcId:e})}},{key:"uid",get:function(){return this.state.uid},set:function(e){this.dispatch({type:ok.SET_UID,uid:e})}},{key:"intUid",get:function(){return this.state.intUid},set:function(e){this.dispatch({type:ok.SET_INT_UID,intUid:e})}},{key:"pubId",get:function(){return this.state.pubId},set:function(e){this.dispatch({type:ok.SET_PUB_ID,pubId:e})}},{key:"cloudProxyServerMode",get:function(){return this.state.cloudProxyServerMode},set:function(e){this.dispatch({type:ok.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}},{key:"useP2P",get:function(){return this.state.useP2P},set:function(e){this.dispatch({type:ok.SET_USE_P2P,val:e})}},{key:"p2pTransport",get:function(){return this.state.p2pTransport},set:function(e){this.dispatch({type:ok.SET_TRANSPORT_TYPE,val:e})}},{key:"hasStartJoinChannel",get:function(){return this.state.hasStartJoinChannel},set:function(e){this.state.hasStartJoinChannel=e}},{key:"isABTestSuccess",get:function(){return this.state.isABTestSuccess},set:function(e){this.state.isABTestSuccess=e}},{key:"keyMetrics",get:function(){return this.state.keyMetrics}},{key:"joinChannelServiceRecords",get:function(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}]),e}())(t.codec,t.audioCodec,t.mode,i._clientId),i._leaveMutex=new fO("client-leave",i._clientId),i._publishMutex=new fO("client-publish",i._clientId),i._renewTokenMutex=new fO("client-renewtoken",i._clientId),i._subscribeMutex=new fO("client-subscribe",i._clientId),i.store.clientCreated(),t.proxyServer&&i.setProxyServer(t.proxyServer,!0),t.turnServer&&i.setTurnServer(t.turnServer,!0),Dk.info("[".concat(i._clientId,"] Initializing AgoraRTC client v").concat(qO," build: ").concat($O,", mode: ").concat(i.mode,", codec: ").concat(i.codec)),t.clientRoleOptions)try{kw(t.clientRoleOptions),a=Object.assign({},t.clientRoleOptions)}catch(t){Dk.warning("[".concat(i._clientId,"] ").concat(t.toString()))}return i._statsCollector=new _F(i.store),i._statsCollector.onStatsException=function(e,t,n){Dk.warn("[".concat(i._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),i.safeEmit(Nw.EXCEPTION,{code:e,msg:t,uid:n})},i._statsCollector.onUploadPublishDuration=function(e,t,n,r){var a=i._users.find((function(t){return t.uid===e}));a&&Fk.peerPublishStatus(i._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:a._uintid})},i._statsCollector.onVideoCodecChanged=function(e){if(rk("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){var t=i.localTracks.find((function(e){return e instanceof mL}));t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?rk("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},i.store.useP2P="p2p"===t.mode,i._gateway=new vV(i.store,{clientId:i._clientId,mode:i.mode,codec:i.codec,websocketRetryConfig:t.websocketRetryConfig||vO,httpRetryConfig:t.httpRetryConfig||vO,forceWaitGatewayResponse:void 0===t.forceWaitGatewayResponse||t.forceWaitGatewayResponse,statsCollector:i._statsCollector,role:t.role,clientRoleOptions:a}),i._configDistribute=new uF(i._clientId,i.store),i.store.useP2P?(i._p2pChannel=(o={store:i.store,statsCollector:i._statsCollector},dV("P2PChannel").create(o)),i._handleP2PEvents()):i._p2pChannel=new EB(i.store,i._statsCollector),i._handleP2PChannelEvents(),i._handleGatewayEvents(),i._handleGatewaySignalEvents(),r(i)}i(t,e);var n=t.prototype;return n.joinMeta=function(){var e=p(l().mark((function e(t,n,r,i,a){var o,s,c,u=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!(u.length>5&&void 0!==u[5])||u[5],s=u.length>6&&void 0!==u[6]&&u[6],nk("JOIN_GATEWAY_USE_443PORT_ONLY",o),nk("JOIN_GATEWAY_USE_DUAL_DOMAIN",s),c=this._gateway.signal.websocket,e.abrupt("return",(c instanceof uU&&(c.use443PortOnly=o,c.tryDoubleDomain=s),p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mA.get(t)||mA.set(t,[]),SA.get(t)||SA.set(t,n),gA.get(t)||gA.set(t,0),i=mA.get(t),a=SA.get(t),i&&a){e.next=4;break}throw new Error("concurrent: deferQueue or maxConcurrency is null");case 4:if(gA.get(t)!==a){e.next=9;break}return o=EA(),i.push(o),e.next=9,o.promise;case 9:for(gA.set(t,gA.get(t)+1),s=p.length,c=new Array(s>3?s-3:0),u=3;u<s;u++)c[u-3]=p[u];return e.next=13,r.apply(void 0,c);case 13:return d=e.sent,e.abrupt("return",(gA.set(t,gA.get(t)-1),gA.get(t)===a-1&&i.length>0&&(i[0].resolve(),i.shift()),0===gA.get(t)&&(mA.set(t,[]),SA.set(t,0),gA.set(t,0)),d));case 15:case"end":return e.stop()}}),e)})))("client.join",rk("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,n,r,i,a)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),n.join=function(){var e=p(l().mark((function e(t,n,r,i,a){var o,s,c,u,d,h,f,_,v,E,m,S,g,T,b,R,C,y,I,A,w,O,k,N,D=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=++this._numberOfJoinCount,this.store.joinStart(),i&&(this.store.uid=i),s="HTTPS"===(SO||SO||(SO=(window.location.protocol.split(":")[0]||"").toUpperCase())),c=CO()?window.isSecureContext:"Browser Not Support",(CO()||s)&&window.isSecureContext||Dk.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),Fk.setAppId(t),e.prev=5,r||null===r){e.next=8;break}throw new Bk(iw.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));case 8:r&&dw(r,"token",1,2047),dw(t,"appid",1,2047),nM(n),i&&rM(i),a&&dw(a,"optionalInfo",1,2047),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),Fk.reportApiInvoke(nO(),{name:Rw.JOIN,options:[t,n,r,i],states:{isHttps:s,isSecureContext:c},tag:Cw.TRACER}).onError(e.t0),e.t0;case 14:if(!this._leaveMutex.isLocked){e.next=21;break}return Dk.debug("[".concat(this._clientId,"] join: waiting leave operation")),e.next=18,this._leaveMutex.lock();case 18:e.t1=e.sent,(0,e.t1)(),Dk.debug("[".concat(this._clientId,"] join: continue"));case 21:if(this._joinAndNotLeaveYet=!0,"DISCONNECTED"===this.connectionState){e.next=24;break}throw u=new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),Fk.reportApiInvoke(nO(),{name:Rw.JOIN,options:[t,n,r,i],states:{isHttps:s,isSecureContext:c},tag:Cw.TRACER}).onError(u),u;case 24:return this._gateway.state="CONNECTING",e.next=27,WB({appId:t,cname:n,uid:i,stringUid:"string"==typeof i?i:void 0,token:r||t,cloudProxyServer:this._cloudProxyServerMode});case 27:if(d=e.sent,this._joinAndNotLeaveYet){e.next=30;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 30:if(h=(null==d?void 0:d.sid)||nO(),Dk.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(o)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId),f=Fk.reportApiInvoke(h,{id:this._clientId,name:Rw.JOIN,options:[t,n,r,i],states:{isHttps:s,isSecureContext:c},tag:Cw.TRACER}),_=bG(bG(bG({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:n,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:rk("AP_REQUEST_DETAIL")||void 0}),this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),"none"===this._encryptionMode||!this._encryptionSecret){e.next=41;break}return _.aesmode=this._encryptionMode,e.next=37,p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){for(var t=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}(),e.next=3,window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]);case 3:return r=e.sent,i=Ew(t),e.next=7,window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i);case 7:return a=e.sent,e.abrupt("return",function(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(a)));case 9:case"end":return e.stop()}}),e)})))(this._encryptionSecret);case 37:if(_.aespassword=e.sent,this._joinAndNotLeaveYet){e.next=40;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 40:this._encryptionSalt&&(_.aessalt=this._encryptionSalt);case 41:if(!this._encryptDataStream||"aes-128-gcm2"!==this._encryptionMode&&"aes-256-gcm2"!==this._encryptionMode){e.next=57;break}if(!this._encryptionSalt||!this._encryptionSecret){e.next=56;break}if(!window.crypto.subtle){e.next=53;break}return v=new TextEncoder,E=rk("USE_PURE_ENCRYPTION_MASTER_KEY")?v.encode(_.appId+this._encryptionSecret+this._encryptionSecret):v.encode(_.appId+_.cname+this._encryptionSecret),e.next=47,p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits","deriveKey"]);case 2:return i=e.sent,a="aes-128-gcm2"===t?128:256,e.next=6,window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,a+96);case 6:return o=e.sent,e.abrupt("return",new Uint8Array(o).subarray(a/8));case 8:case"end":return e.stop()}}),e)})))(this._encryptionMode,E,qw(this._encryptionSalt));case 47:return this._encryptDataStreamIv=e.sent,e.next=50,p(l().mark((function e(t,n,r){var i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits","deriveKey"]);case 2:return i=e.sent,a="aes-128-gcm2"===t?128:256,e.next=6,window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,{name:"AES-GCM",length:a},!0,["encrypt","decrypt"]);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))(this._encryptionMode,E,qw(this._encryptionSalt));case 50:this._encryptDataStreamKey=e.sent,e.next=54;break;case 53:c?Dk.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):Dk.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;case 54:e.next=57;break;case 56:this._encryptDataStream=!1,Dk.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));case 57:if(this._startSession(this._sessionId,{channel:n,appId:t,stringUid:_.stringUid}),m=this._sessionId,setTimeout((function(){"CONNECTING"===D.connectionState&&m===D._sessionId&&Fk.joinChannelTimeout(D._sessionId,5)}),5e3),e.prev=60,T=_.cloudProxyServer,Br(S=["proxy3","proxy4","proxy5"]).call(S,T)&&(b=rk("PROXY_SERVER_TYPE3"),Array.isArray(b)?_.proxyServer=b[0]:_.proxyServer=b),Fk.setProxyServer(_.proxyServer),Dk.setProxyServer(_.proxyServer),this.store.requestAPStart(),!d){e.next=76;break}if(Dk.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(d.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=d.intUid),g={gatewayInfo:d.ap.gatewayInfo},!rk("JOIN_WITH_FALLBACK_MEDIA_PROXY")||"auto"!==_.turnServer.mode){e.next=73;break}if(0!==d.ap.proxyInfo.addresses.length){e.next=69;break}Dk.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),e.next=73;break;case 69:return e.next=71,bU(d.ap.proxyInfo,d.ap.gatewayInfo.uid);case 71:R=e.sent.map((function(e){return{turnServerURL:e.address,tcpport:e.tcpport||JO.tcpport,udpport:e.udpport||JO.udpport,username:e.username||JO.username,password:e.password||JO.password,forceturn:!1,security:!0}})),_.turnServer={mode:"manual",servers:R};case 73:zB(d,_.stringUid),e.next=93;break;case 76:if(!_.stringUid||_.uid){e.next=88;break}return e.next=79,zl.all([qV(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||vO,this.store),KV(_,this._axiosCancelSource.token,this._config.httpRetryConfig||vO,!0,this.store)]);case 79:C=e.sent,y=C[0],g=C[1],Dk.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(y)),_.uid=y,g.gatewayInfo.uid=y,g.gatewayInfo.res.uid=y,e.next=91;break;case 88:return e.next=90,KV(_,this._axiosCancelSource.token,this._config.httpRetryConfig||vO,!0,this.store);case 90:g=e.sent;case 91:if(this._joinAndNotLeaveYet){e.next=93;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 93:return this.store.requestAPEnd(),setTimeout((function(){D._configDistribute.startGetConfigDistribute(_,D._axiosCancelSource.token),D._configDistribute.on(yM.UPDATE_BITRATE_LIMIT,(function(e){D._p2pChannel.updateBitrateLimit(e)})),D._configDistribute.on(yM.UPDATE_CLIENT_ROLE_OPTIONS,(function(e){D._setClientRoleOptions(e)}))}),0),this._key=r||t,I=g.gatewayInfo,A=_.uid?_.uid:I.uid,this._joinInfo=bG(bG({},_),{},{cid:I.cid,uid:A,vid:I.vid,apResponse:I.res,apGatewayAddress:I.apGatewayAddress,uni_lbs_ip:I.uni_lbs_ip,gatewayAddrs:I.gatewayAddrs}),this.store.intUid=A,this.store.cid=I.cid,e.next=98,this._joinGateway();case 98:if(w=e.sent,this._joinAndNotLeaveYet){e.next=101;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 101:return f.onSuccess(w),this._appId=t,this._channelName=_.cname,this._uid=w,this.store.uid=w,setTimeout((function(){D._networkQualityInterval&&window.clearInterval(D._networkQualityInterval),D._networkQualityInterval=window.setInterval(D._handleUpdateNetworkQuality,2e3),window.addEventListener(DA()?"beforeunload":"pagehide",D._handleBeforeUnload),D._statsCollector.startUpdateStats()}),0),O=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid),e.abrupt("return",(Dk.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(O)),setTimeout((function(){Dk.startUpload()}),5e3),this.store.joinEnd(),N=this,Br(ax).call(ax,N)||ax.push(N),"disabled"===this._cloudProxyServerMode&&Gk().supportWebCrypto&&rk("ENABLE_PRELOAD")&&YB(this._joinInfo),w));case 106:throw e.prev=106,e.t2=e.catch(60),(k=Array.isArray(e.t2)?e.t2[0]:e.t2)&&k.code===iw.OPERATION_ABORTED?Dk.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k):Dk.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k),k.code!==iw.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(k),k;case 110:case"end":return e.stop()}}),e,this,[[5,11],[60,106]])})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),n._joinGateway=function(){if(!this._joinInfo||!this._key)throw new Bk(iw.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!rk("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))},n.leave=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Dk.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(DA()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){var t=ax.indexOf(e);-1!==t&&ax.splice(t,1)}(this),this._statsCollector.stopUpdateStats(),e.next=3,this._leaveMutex.lock();case 3:if(t=e.sent,"DISCONNECTED"!==this.connectionState){e.next=6;break}return e.abrupt("return",(Dk.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t()));case 6:return e.next=8,this._gateway.leave("CONNECTED"!==this.connectionState,Aw.LEAVE);case 8:Dk.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.publish=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c=this,u=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(u.length>1&&void 0!==u[1])||u[1],Array.isArray(t)){e.next=5;break}if(t instanceof LN){e.next=4;break}return e.abrupt("return",this._publishDataChannel(t));case 4:t=[t];case 5:if(0!==t.length){e.next=7;break}throw new Bk(iw.INVALID_PARAMS,"param list is empty");case 7:if(r=t,"audience"!==this._gateway.role){e.next=10;break}throw new Bk(iw.INVALID_OPERATION,"audience can not publish stream");case 10:i=h(r);case 11:if((a=i()).done){e.next=19;break}if((o=a.value)instanceof LN){e.next=15;break}throw new Bk(iw.INVALID_PARAMS,"parameter is not local track");case 15:if(o._enabled||!n){e.next=17;break}throw new Bk(iw.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()));case 17:e.next=11;break;case 19:return Dk.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=22,this._publishMutex.lock();case 22:return s=e.sent,e.next=25,this._configDistribute.awaitConfigDistributeComplete();case 25:return n&&r.forEach((function(e){var t=c._configDistribute.getBitrateLimit();e instanceof mL&&t&&e.setBitrateLimit(t.uplink)})),e.prev=26,e.next=29,this._publishHighStream(r);case 29:Dk.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=35;break;case 32:throw e.prev=32,e.t0=e.catch(26),Dk.error("[".concat(this._clientId,"] publish error"),e.t0.toString()),e.t0;case 35:return e.prev=35,s(),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[26,32,35,38]])})));return function(t){return e.apply(this,arguments)}}(),n._publishDataChannel=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return cw(t.id,"id",0,65535,!0),ow(t.ordered,"ordered"),dw(t.metadata,"metadata",0,512),Dk.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id)),e.next=3,this._publishMutex.lock();case 3:if(n=e.sent,e.prev=4,-1===this._p2pChannel.getAllDataChannels().findIndex((function(e){return e.id===t.id}))){e.next=7;break}throw new Bk(iw.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));case 7:if(this._joinInfo&&void 0!==this._uid){e.next=9;break}throw new Bk(iw.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");case 9:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=11;break}throw new Bk(iw.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));case 11:if("auto"!==this._turnServer.mode||!rk("FORCE_TURN")||rk("TURN_ENABLE_TCP")||rk("TURN_ENABLE_UDP")){e.next=13;break}throw new Bk(iw.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");case 13:return r=function(e){return pV(e,!1)}(t),e.next=16,this._p2pChannel.publishDataChannel([r]);case 16:if(!((i=e.sent).length>0)){e.next=31;break}if("number"==typeof r._originDataChannelId){e.next=20;break}throw Dk.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Bk(iw.CREATE_DATACHANNEL_ERROR);case 20:return e.prev=20,e.next=23,zl.all(i.map((function(e){return a._uid&&a._gateway.publishDataChannel(a._uid,e,!0)})));case 23:return e.next=25,r._waitTillOpen();case 25:e.next=31;break;case 27:if(e.prev=27,e.t0=e.catch(20),e.t0.code===iw.DISCONNECT_P2P){e.next=31;break}throw e.t0;case 31:return e.abrupt("return",(Dk.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r));case 34:throw e.prev=34,e.t1=e.catch(4),Dk.error("[".concat(this._clientId,"] publish datachannels error"),e.t1.toString()),e.t1;case 37:return e.prev=37,n(),e.finish(37);case 40:case"end":return e.stop()}}),e,this,[[4,34,37,40],[20,27]])})));return function(t){return e.apply(this,arguments)}}(),n.unpublish=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");case 2:if(n=[],!t){e.next=13;break}if(!Array.isArray(t)){e.next=8;break}n=t,e.next=11;break;case 8:if(t instanceof LN){e.next=10;break}return e.abrupt("return",this._unpublishDataChannel([t]));case 10:n=[t];case 11:e.next=18;break;case 13:if(e.t0=this.store.useP2P,e.t0){e.next=17;break}return e.next=17,this._unpublishDataChannel();case 17:n=this._p2pChannel.getAllTracks(!0);case 18:return Dk.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map((function(e){return"".concat(e.getTrackId()," ")}))," ")),e.next=21,this._publishMutex.lock();case 21:if(r=e.sent,e.prev=22,!this.store.useP2P){e.next=33;break}return e.next=26,this._p2pChannel.unpublish(n);case 26:if(i=e.sent,e.t1=i,!e.t1){e.next=31;break}return e.next=31,this._gateway.sendExtensionMessage(HM.UNPUBLISH,{unpubMsg:i},!0);case 31:e.next=41;break;case 33:return e.next=35,this._p2pChannel.unpublish(n);case 35:if(a=e.sent,e.t2=a,!e.t2){e.next=40;break}return e.next=40,this._gateway.unpublish(a,this._uid);case 40:Dk.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map((function(e){return"".concat(e.getTrackId())}))));case 41:e.next=46;break;case 43:throw e.prev=43,e.t3=e.catch(22),Dk.error("[".concat(this._clientId,"] unpublish error"),e.t3.toString()),e.t3;case 46:return e.prev=46,r&&r(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[22,43,46,49]])})));return function(t){return e.apply(this,arguments)}}(),n._unpublishDataChannel=function(){var e=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&0!==t.length||(t=this._p2pChannel.getAllDataChannels()),Dk.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map((function(e){return"".concat(e.id," ")}))," ")),e.next=3,this._publishMutex.lock();case 3:return n=e.sent,e.prev=4,e.next=7,this._p2pChannel.unpublishDataChannel(t);case 7:if(r=e.sent,e.t0=r,!e.t0){e.next=12;break}return e.next=12,this._gateway.unpublishDataChannel(r);case 12:Dk.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map((function(e){return"".concat(e.id)})))),e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(4),Dk.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.t1.toString()),e.t1;case 18:return e.prev=18,n&&n(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));return function(t){return e.apply(this,arguments)}}(),n.subscribe=function(){var e=p(l().mark((function e(t,n,r){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof mF){e.next=5;break}if(i=this.remoteUsers.find((function(e){return e.uid===t}))){e.next=4;break}throw new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel");case 4:t=i;case 5:return e.abrupt("return","datachannel"===n?this._subscribeDataChannel(t,r):this._subscribe(t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.presubscribe=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sw(n,"mediaType",["audio","video"]),!this.store.useP2P){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can't presub at p2p mode");case 2:if(this._joinInfo){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"can't presub when not join");case 4:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=6;break}throw new Bk(iw.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));case 6:return r=n===OM.AUDIO,i=n===OM.VIDEO,e.next=10,this._subscribeMutex.lock();case 10:return a=e.sent,e.prev=11,e.next=14,this._gateway.presubscribe(t,n,!0);case 14:if(o=e.sent,s=o.ssrcId,c=o.ortc,u=o.rtxSsrcId,d=o.cname,p=o.uint_id,null!=s){e.next=22;break}throw new Bk(iw.UNEXPECTED_RESPONSE,"no ssrc id");case 22:return(h=this._users.find((function(e){return e.uid===t})))||((h=new mF(t,p||t))._is_pre_created=!0,this._users.push(h)),d&&(h._cname=d),h._uintid||(h._uintid=p||t),r&&(h._audioSSRC=s,h._audio_pre_subscribed=!0,c&&(h._audioOrtc=c)),i&&(h._videoSSRC=s,h._video_pre_subscribed=!0,c&&(h._videoOrtc=c),null!=u&&(h._rtxSsrcId=u)),Dk.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),e.next=31,this._p2pChannel.subscribe(h,n,s,u,c);case 31:if(f=r?h._audioTrack:h._videoTrack){e.next=34;break}throw new Bk(iw.UNEXPECTED_ERROR,"can not find remote track in user");case 34:return e.abrupt("return",(r&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0),i&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0),f));case 37:throw e.prev=37,e.t0=e.catch(11),Dk.error("[".concat(this._clientId,"] presub user ").concat(t," error"),e.t0),e.t0;case 40:return e.prev=40,a(),e.finish(40);case 43:case"end":return e.stop()}}),e,this,[[11,37,40,43]])})));return function(t,n){return e.apply(this,arguments)}}(),n._subscribeDataChannel=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(cw(n,"channelId",0,65535,!0),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe datachannel, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));case 4:if(this._users.find((function(e){return e===t}))){e.next=7;break}throw Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel");case 7:if(t.hasAudio||t.hasVideo||0!==t._dataChannels.length){e.next=9;break}throw Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Bk(iw.INVALID_REMOTE_USER,"user is not published");case 9:if(i=null===(r=t._dataChannels)||void 0===r?void 0:r.find((function(e){return e.id===n}))){e.next=12;break}throw Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Bk(iw.REMOTE_USER_IS_NOT_PUBLISHED);case 12:return e.next=14,this._subscribeMutex.lock();case 14:return a=e.sent,Dk.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel")),e.prev=16,e.next=19,this._p2pChannel.subscribeDataChannel(t,[i]);case 19:if(!(o=e.sent)||!Br(o).call(o,i.id)){e.next=40;break}if(e.prev=21,"number"==typeof i._originDataChannelId){e.next=24;break}throw Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Bk(iw.CREATE_DATACHANNEL_ERROR);case 24:return c={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(s=i.metadata)&&void 0!==s?s:""},e.next=27,this._gateway.subscribeDataChannel(t.uid,c,!0);case 27:return e.next=29,i._waitTillOpen();case 29:e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(21),(null==e.t0?void 0:e.t0.code)===iw.WS_ABORT){e.next=37;break}return e.next=36,this._p2pChannel.unsubscribeDataChannel(t,[i]);case 36:throw e.t0;case 37:return e.next=39,this._p2pChannel.unsubscribeDataChannel(t,[i]);case 39:this._p2pChannel.setPendingRemoteDataChannel(t,i.id);case 40:return e.abrupt("return",(Dk.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i));case 41:return e.prev=41,a(),e.finish(41);case 44:case"end":return e.stop()}}),e,this,[[16,,41,44],[21,31]])})));return function(t,n){return e.apply(this,arguments)}}(),n._p2pSubscribe=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sw(n,"mediaType",["audio","video"]),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:if(this._users.find((function(e){return e===t}))){e.next=8;break}throw i=new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel"),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),i;case 8:if(t.hasAudio||t.hasVideo){e.next=11;break}throw a=new Bk(iw.INVALID_REMOTE_USER,"user is not published"),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a;case 11:if(r||("audio"!==n||t.hasAudio)&&("video"!==n||t.hasVideo)){e.next=14;break}throw o=new Bk(iw.REMOTE_USER_IS_NOT_PUBLISHED),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(n,", remote track is not published")),o;case 14:return e.next=16,this._subscribeMutex.lock();case 16:return s=e.sent,Dk.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(n)),e.prev=18,e.next=21,this._p2pChannel.hasRemoteMediaWithLock(t,n);case 21:if(!e.sent){e.next=26;break}return e.next=24,this._p2pChannel.unmuteRemote(t,n);case 24:e.next=38;break;case 26:if(e.prev=26,c="audio"===n?t._audioSSRC:t._videoSSRC,u="audio"===n?t._audioMid:t._videoMid,this.store.subscribe(t.uid,n,Date.now()),e.t0=this.store.useP2P,!e.t0){e.next=33;break}return e.next=33,this._p2pChannel.subscribe(t,n,c,u);case 33:e.next=38;break;case 35:throw e.prev=35,e.t1=e.catch(26),e.t1;case 38:if(Dk.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((function(e){Dk.warning("[".concat(p._clientId,"] auto set fallback failed"),e)})),d="audio"===n?t._audioTrack:t._videoTrack){e.next=42;break}throw new Bk(iw.UNEXPECTED_ERROR,"can not find remote track in user object");case 42:return e.abrupt("return",d);case 45:throw e.prev=45,e.t2=e.catch(18),Dk.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e.t2),e.t2;case 48:return e.prev=48,s(),e.finish(48);case 51:case"end":return e.stop()}}),e,this,[[18,45,48,51],[26,35]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n._subscribe=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p,h,f,_=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.store.useP2P){e.next=2;break}return e.abrupt("return",this._p2pSubscribe(t,n));case 2:if(sw(n,"mediaType",["audio","video"]),this._joinInfo){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream, not joined");case 4:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=6;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 6:if(this._users.find((function(e){return e===t}))){e.next=10;break}throw i=new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel"),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),i;case 10:if(t.hasAudio||t.hasVideo){e.next=13;break}throw a=new Bk(iw.INVALID_REMOTE_USER,"user is not published"),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a;case 13:if(r||("audio"!==n||t.hasAudio&&void 0!==t._audioSSRC)&&("video"!==n||t.hasVideo&&void 0!==t._videoSSRC)){e.next=16;break}throw o=new Bk(iw.REMOTE_USER_IS_NOT_PUBLISHED),Dk.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(n,", remote track is not published")),o;case 16:return s="audio"===n?t._audioSSRC:t._videoSSRC,c="audio"===n?t._audioOrtc:t._videoOrtc,u="video"===n?t._rtxSsrcId:void 0,d={stream_type:"audio"===n?OM.AUDIO:OM.VIDEO,ssrcId:s},e.next=19,this._subscribeMutex.lock();case 19:return p=e.sent,Dk.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(n)),e.prev=21,e.next=24,this._p2pChannel.hasRemoteMediaWithLock(t,n);case 24:if(!e.sent){e.next=29;break}return e.next=27,this._p2pChannel.unmuteRemote(t,n);case 27:e.next=58;break;case 29:return e.prev=29,void 0!==(h="audio"===n?t._audioSSRC:t._videoSSRC)&&h!==s&&(s=h,c="audio"===n?t._audioOrtc:t._videoOrtc,u="video"===n?t._rtxSsrcId:void 0,d={stream_type:"audio"===n?OM.AUDIO:OM.VIDEO,ssrcId:s}),lF.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,n,Date.now()),e.next=36,this._p2pChannel.subscribe(t,n,s,u,c);case 36:if(e.prev=36,e.t0=this._p2pChannel.isPreSubScribe(s),e.t0){e.next=41;break}return e.next=41,this._gateway.subscribe(t.uid,d,!0);case 41:e.next=52;break;case 43:if(e.prev=43,e.t1=e.catch(36),(null==e.t1?void 0:e.t1.code)===iw.WS_ABORT){e.next=49;break}return e.next=48,this._p2pChannel.unsubscribe(t,n);case 48:throw e.t1;case 49:return e.next=51,this._p2pChannel.unsubscribe(t,n,!0);case 51:this._p2pChannel.setPendingRemoteMedia(t,n);case 52:this.store.subscribe(t.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,n),e.next=58;break;case 55:throw e.prev=55,e.t2=e.catch(29),this._p2pChannel.reportSubscribeEvent(!1,null==e.t2?void 0:e.t2.code,t,n),e.t2;case 58:if(Dk.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((function(e){Dk.warning("[".concat(_._clientId,"] auto set fallback failed"),e)})),f="audio"===n?t._audioTrack:t._videoTrack){e.next=62;break}throw new Bk(iw.UNEXPECTED_ERROR,"can not find remote track in user object");case 62:return e.abrupt("return",f);case 65:throw e.prev=65,e.t3=e.catch(21),Dk.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e.t3),e.t3;case 68:return e.prev=68,p(),e.finish(68);case 71:case"end":return e.stop()}}),e,this,[[21,65,68,71],[29,55],[36,43]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.massSubscribe=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p,f,_,v,E,m,S,g,T,b,R,C,y,I,A,w=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pw(t,"subscribeList"),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:return n=Date.now(),r=new Map,e.next=8,this._subscribeMutex.lock();case 8:return i=e.sent,Dk.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),a=(t=[].concat(t)).map((function(e){return{user:e.user,mediaType:e.mediaType}})),e.next=13,this._p2pChannel.globalLock();case 13:o=e.sent,e.prev=14,c=l().mark((function e(){var n,i,o,s,c,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t[u],i=n.user,sw(o=n.mediaType,"mediaType",["audio","video"]),i){e.next=4;break}throw s=new Bk(iw.INVALID_PARAMS,"user property does not exist in subscribeList item"),Dk.error("[".concat(w._clientId,"] user property does not exist in subscribeList item")),s;case 4:if(w._users.find((function(e){return e===i}))){e.next=9;break}return c=new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel"),Dk.error("[".concat(w._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),a[u].error=c,t.splice(u,1),e.abrupt("return",0);case 9:if(("audio"!==o||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==o||i.hasVideo&&void 0!==i._videoSSRC)){e.next=13;break}return d=new Bk(iw.REMOTE_USER_IS_NOT_PUBLISHED),Dk.error("[".concat(w._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote user is not published")),a[u].error=d,t.splice(u,1),e.abrupt("return",0);case 13:if(p=gM.Video|gM.LwoVideo,!(h=r.get(i))){e.next=21;break}if(!("video"===o?h&p:h&gM.Audio)){e.next=18;break}return t.splice(u,1),Dk.warning("[".concat(w._clientId,"] repeat massSubscribe user:").concat(i.uid,", mediaType:").concat(o," twice")),e.abrupt("return",0);case 18:r.set(i,h|("video"===o?p:gM.Audio)),e.next=22;break;case 21:r.set(i,"video"===o?p:gM.Audio);case 22:case"end":return e.stop()}}),e)})),u=t.length-1;case 17:if(!(u>=0)){e.next=25;break}return e.delegateYield(c(),"t0",19);case 19:if(0!==e.t0){e.next=22;break}return e.abrupt("continue",22);case 22:u--,e.next=17;break;case 25:d=t.length-1;case 26:if(!(d>=0)){e.next=36;break}if(p=t[d],f=p.user,_=p.mediaType,v=gM.Video|gM.LwoVideo,!this._p2pChannel.hasRemoteMedia(f,_)){e.next=33;break}return e.next=31,this._p2pChannel.unmuteRemoteNoLock(f,_);case 31:E=r.get(f),r.set(f,"video"===_?E^v:E^gM.Audio),t.splice(d,1);case 33:d--,e.next=26;break;case 36:if(this.store.massSubscribe(t.map((function(e){return{userId:e.user.uid,type:e.mediaType}})),n),m=ui(s=Array.from(r.entries())).call(s,(function(e,t){var n=t[0],r=t[1];if(0===r)return e;var i={stream_id:n.uid,stream_type:r};return r&gM.Audio&&(i.audio_ssrc=n._audioSSRC),r&gM.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]),e.prev=38,e.t1=t.length>0,!e.t1){e.next=43;break}return e.next=43,this._p2pChannel.massSubscribeNoLock(t.map((function(e){var t=e.user,n=e.mediaType;return{user:t,mediaType:n,ssrcId:n===OM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===OM.VIDEO?t._rtxSsrcId:void 0}})));case 43:if(S=new Map,!((m=m.filter((function(e){return e.video_ssrc&&!w._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!w._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc}))).length>0)){e.next=49;break}return e.next=47,this._gateway.subscribeAll(m,!0);case 47:((null==(g=e.sent)?void 0:g.users)||[]).forEach((function(e){var t=e.stream_id,n=e.video_error_code,r=e.audio_error_code,i=e.error_code;(n||r||i)&&S.set(t,{video_error_code:n,audio_error_code:r,error_code:i})}));case 49:if(!(Array.from(S.entries()).length>0)){e.next=56;break}if(T=[],Array.from(S.entries()).forEach((function(e){var t,n=e[0],r=e[1],i=w.remoteUsers.find((function(e){return e.uid===n}));i&&(r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=OM.VIDEO:r.audio_error_code&&(t=OM.AUDIO),T.push({user:i,mediaType:t}))})),e.t2=T.length>0,!e.t2){e.next=56;break}return e.next=56,this._p2pChannel.massUnsubscribeNoLock(T);case 56:for(b=h(a);!(R=b()).done;)C=R.value,(y=S.get(C.user.uid))&&(I=y.error_code||"audio"===C.mediaType&&y.audio_error_code||"video"===C.mediaType&&y.video_error_code)&&(A=QM(I),Dk.error("user:".concat(C.user.uid," mediaType:").concat(C.mediaType," has massSubscribe error ").concat(A.desc)),C.error=new Bk(iw.SUBSCRIBE_FAILED,"code ".concat(I,": ").concat(A.desc))),C.error||("video"===C.mediaType?C.track=C.user.videoTrack:C.track=C.user.audioTrack);return e.abrupt("return",(this.store.massSubscribe(a.filter((function(e){return!e.error})).map((function(e){return{userId:e.user.uid,type:e.mediaType}})),void 0,Date.now()),a.forEach((function(e){var t;Fk.subscribe(w.store.sessionId,{succ:!!e.error,ec:(null===(t=e.error)||void 0===t?void 0:t.code)||null,video:e.mediaType===OM.VIDEO,audio:e.mediaType===OM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===OM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:w.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:w._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)})),Dk.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),a));case 60:return e.prev=60,e.t3=e.catch(38),e.next=64,this._p2pChannel.massUnsubscribeNoLock(t);case 64:throw e.t3;case 65:return e.prev=65,o(),i(),e.finish(65);case 68:case"end":return e.stop()}}),e,this,[[14,,65,68],[38,60]])})));return function(t){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof mF){e.next=5;break}if(i=this.remoteUsers.find((function(e){return e.uid===t}))){e.next=4;break}throw new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel");case 4:t=i;case 5:if(!n&&!this.store.useP2P){e.next=10;break}if("datachannel"!==n){e.next=8;break}return e.abrupt("return",this._unsubscribeDataChannel(t,r));case 8:e.next=12;break;case 10:return e.next=12,this._unsubscribeDataChannel(t,r);case 12:if(n&&sw(n,"mediaType",["audio","video"]),this._joinInfo){e.next=14;break}throw new Bk(iw.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");case 14:if(this._users.find((function(e){return e===t}))){e.next=18;break}throw a=new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel"),Dk.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),a;case 18:return Dk.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(n)),e.next=21,this._subscribeMutex.lock();case 21:if(o=e.sent,e.prev=22,!this.store.useP2P){e.next=28;break}return e.next=26,this._p2pChannel.unsubscribe(t,n);case 26:e.next=39;break;case 28:return e.next=30,this._p2pChannel.unsubscribe(t,n);case 30:if(s=e.sent,e.t0=s,!e.t0){e.next=35;break}return e.next=35,this._gateway.unsubscribe(s,t.uid);case 35:n&&"audio"!==n||(t._audio_pre_subscribed=!1),n&&"video"!==n||(t._video_pre_subscribed=!1),t._is_pre_created&&Bw(this._users,t),Dk.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(n));case 39:e.next=46;break;case 41:if(e.prev=41,e.t1=e.catch(22),e.t1.code!==iw.DISCONNECT_P2P){e.next=45;break}return e.abrupt("return",void Dk.warning("disconnecting p2p, abort unsubscribe request."));case 45:throw Dk.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.t1.toString()),e.t1;case 46:return e.prev=46,o(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[22,41,46,49]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n._unsubscribeDataChannel=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&cw(n,"id",0,65535,!0),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");case 2:if(this._users.find((function(e){return e===t}))){e.next=6;break}throw r=new Bk(iw.INVALID_REMOTE_USER,"user is not in the channel"),Dk.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r;case 6:if("number"==typeof n?(a=t._dataChannels.find((function(e){return e.id===n})))&&(i=[a]):i=t._dataChannels,void 0!==i){e.next=10;break}throw o=new Bk(iw.REMOTE_USER_IS_NOT_PUBLISHED),Dk.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(n,", remote datachannel is not published")),o;case 10:return Dk.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map((function(e){return e.id})))),e.prev=11,e.next=14,this._p2pChannel.unsubscribeDataChannel(t,i);case 14:if(s=e.sent,e.t0=s,!e.t0){e.next=19;break}return e.next=19,this._gateway.unsubscribeDataChannel(s,t.uid);case 19:Dk.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s)),e.next=27;break;case 22:if(e.prev=22,e.t1=e.catch(11),e.t1.code!==iw.DISCONNECT_P2P){e.next=26;break}return e.abrupt("return",void Dk.warning("disconnecting p2p, abort unsubscribe request."));case 26:throw Dk.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.t1.toString()),e.t1;case 27:case"end":return e.stop()}}),e,this,[[11,22]])})));return function(t,n){return e.apply(this,arguments)}}(),n.massUnsubscribe=function(){var e=p(l().mark((function e(t){var n,r,i,a,o=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pw(t,"unsubscribeList"),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");case 2:Dk.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),t=[].concat(t),n=new Map,r=l().mark((function e(){var r,a,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t[i],a=r.user,s=r.mediaType,a){e.next=4;break}throw c=new Bk(iw.INVALID_PARAMS,"user property does not exist in unsubscribeList item"),Dk.error("[".concat(o._clientId,"] user property does not exist in unsubscribeList item")),c;case 4:if(sw(s,"mediaType",["video","audio",void 0]),o._users.find((function(e){return e===a}))){e.next=9;break}return Dk.warning("[".concat(o._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(i,1),e.abrupt("return",0);case 9:if(u=gM.Video|gM.LwoVideo,!n.has(a)){e.next=26;break}d=n.get(a),e.t0=s,e.next="video"===e.t0?15:"audio"===e.t0?17:19;break;case 15:return p=d&u,e.abrupt("break",20);case 17:return p=d&gM.Audio,e.abrupt("break",20);case 19:p=d&(gM.Audio|u);case 20:if(!p){e.next=23;break}return Dk.warning("[".concat(o._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(s," twice.")),t.splice(i,1),e.abrupt("return",0);case 23:s?"audio"===s?n.set(a,d|gM.Audio):"video"===s&&n.set(a,d|u):n.set(a,d|gM.Audio|u),e.next=27;break;case 26:s?"audio"===s?n.set(a,gM.Audio):"video"===s&&n.set(a,u):n.set(a,gM.Audio|u);case 27:case"end":return e.stop()}}),e)})),i=t.length-1;case 6:if(!(i>=0)){e.next=14;break}return e.delegateYield(r(),"t0",8);case 8:if(0!==e.t0){e.next=11;break}return e.abrupt("continue",11);case 11:i--,e.next=6;break;case 14:return e.prev=14,e.next=17,this._p2pChannel.massUnsubscribe(t);case 17:if(a=e.sent,e.t1=a,!e.t1){e.next=22;break}return e.next=22,this._gateway.massUnsubscribe(a);case 22:Dk.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e.next=30;break;case 25:if(e.prev=25,e.t2=e.catch(14),e.t2.code!==iw.DISCONNECT_P2P){e.next=29;break}return e.abrupt("return",void Dk.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request.")));case 29:throw Dk.error("[".concat(this._clientId,"] massUnsubscribe error"),e.t2.toString()),e.t2;case 30:case"end":return e.stop()}}),e,this,[[14,25]])})));return function(t){return e.apply(this,arguments)}}(),n.setLowStreamParameter=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(function(e){if(!e)throw new aw(iw.INVALID_PARAMS);lw(e.width)||uw(e.width,"streamParameter.width"),lw(e.height)||uw(e.height,"streamParameter.height"),lw(e.framerate)||uw(e.framerate,"streamParameter.framerate"),lw(e.bitrate)||cw(e.bitrate,"streamParameter.bitrate")}(t),(!t.width&&t.height||t.width&&!t.height)&&Dk.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Dk.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t)),(n=this._configDistribute.getLowStreamConfigDistribute())&&n.bitrate&&t.bitrate&&n.bitrate<t.bitrate&&(t.bitrate=n.bitrate),this._lowStreamParameter=t,!this._isDualStreamEnabled){e.next=4;break}return e.abrupt("return",this._p2pChannel.updateVideoStreamParameter(t,PM.LocalVideoLowTrack));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.enableDualStream=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gk().supportDualStream){e.next=2;break}throw Fk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Bk(iw.NOT_SUPPORTED,"Your browser is not support dual stream");case 2:if(!this._isDualStreamEnabled){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"Dual stream is already enabled");case 4:if(!this._p2pChannel.canPublishLowStream()){e.next=13;break}return e.prev=5,e.next=8,this._publishLowStream();case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(5),Fk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e.t0;case 13:this._isDualStreamEnabled=!0,Fk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Dk.info("[".concat(this._clientId,"] enable dual stream"));case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(){return e.apply(this,arguments)}}(),n.disableDualStream=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isDualStreamEnabled){e.next=18;break}if(this._joinInfo){e.next=3;break}throw new Bk(iw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 3:if(!this._p2pChannel.getLocalMedia(PM.LocalVideoLowTrack)){e.next=17;break}return e.prev=4,e.next=7,this._p2pChannel.unpublishLowStream();case 7:if(t=e.sent,e.t0=t,!e.t0){e.next=12;break}return e.next=12,this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid);case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(4),Fk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e.t1;case 17:this._isDualStreamEnabled=!1,Fk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Dk.info("[".concat(this._clientId,"] disable dual stream"));case 18:case"end":return e.stop()}}),e,this,[[4,14]])})));return function(){return e.apply(this,arguments)}}(),n.setClientRole=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(function(e){sw(e,"role",["audience","host"])}(t),n&&kw(n),"rtc"!==this.mode&&"p2p"!==this.mode){e.next=2;break}throw Dk.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Bk(iw.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));case 2:if(!n||!n.level||"host"!==t){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"host mode can not set audience latency level");case 4:if("audience"!==t||!this._p2pChannel.hasLocalMedia()){e.next=6;break}throw new Bk(iw.INVALID_OPERATION,"can not set client role to audience when publishing stream");case 6:if(r=this._config.role,this._joinInfo&&(this._joinInfo.role=t),t===r||!rk("ENABLE_ROLE_SELECT_EDGE")){e.next=12;break}this._gateway.updateClientRole(t,n),this._config.role=t,this._gateway.reconnect("recover",Dw.REGIONAL_DISTRIBUTION),e.next=15;break;case 12:return e.next=14,this._gateway.setClientRole(t,n);case 14:this._config.role=t;case 15:Dk.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(n&&n.level));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n._setClientRoleOptions=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("rtc"!==this.mode&&"p2p"!==this.mode){e.next=2;break}return e.abrupt("return");case 2:if("audience"===this._config.role&&!this._p2pChannel.hasLocalMedia()){e.next=4;break}return e.abrupt("return");case 4:return n=!1,e.prev=5,t&&kw(t),e.next=9,this._gateway.setClientRole(this._config.role,t);case 9:n=!0,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(5);case 14:return e.prev=14,Dk.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(t)),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[5,12,14,17]])})));return function(t){return e.apply(this,arguments)}}(),n.getRemoteInboundOffset=function(){var e,t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;var n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0},n.getNtpWallTimeInMs=function(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset},n.setProxyServer=function(e,t){if(dw(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new Bk(iw.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bk(iw.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Fk.setProxyServer(this._proxyServer),Dk.setProxyServer(this._proxyServer),Dk.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))},n.setTurnServer=function(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new Bk(iw.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bk(iw.INVALID_OPERATION,"You have already set the proxy")}if(ww(e))return this._turnServer={servers:e,mode:"original-manual"},void Dk.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((function(e){return e.urls})).join(","),"."));e.forEach((function(e){return Ow(e)})),this._turnServer={servers:e,mode:"manual"},Dk.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))},n.setLicense=function(e){if("DISCONNECTED"!==this.connectionState)throw new Bk(iw.INVALID_OPERATION,"you should set license before join channel");if(dw(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Bk(iw.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Dk.info("[".concat(this._clientId,"] set license success"),e)},n.startProxyServer=function(e){if("DISCONNECTED"!==this.connectionState)throw new Bk(iw.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new Bk(iw.INVALID_OPERATION,"You have already set the proxy");var t;switch(void 0===e&&(e=3),e){case 1:case 2:throw new Bk(iw.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new Bk(iw.INVALID_PARAMS,"proxy server mode must be ".concat([3,4,5].join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,Dk.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)},n.stopProxyServer=function(){if("DISCONNECTED"!==this.connectionState)throw new Bk(iw.INVALID_OPERATION,"Stop proxy server after leave channel");Fk.setProxyServer(),Dk.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Dk.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}},n.setLocalAccessPointsV2=function(e){if(!e.accessPoints)throw new Bk(iw.INVALID_PARAMS,"accessPoints is required.");pw(e.accessPoints.serverList,"accessPoints.serverList"),dw(e.accessPoints.domain,"accessPoints.domain");var t=function(e,t){cw(e,t,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bk(iw.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");rk("CLOSE_AFB_FOR_LOCAL_AP")&&(nk("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),nk("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));var r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map((function(e){return r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e})),o=a.map((function(e){return"".concat(e,":").concat(n)}));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,nk("WEBCS_DOMAIN",o),nk("WEBCS_DOMAIN_BACKUP_LIST",o),nk("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(pw(e.report.hostname,"report.hostname"),nk("EVENT_REPORT_DOMAIN",e.report.hostname[0]),nk("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(nk("EVENT_REPORT_DOMAIN",a[0]),nk("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));var s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),nk("STATS_COLLECTOR_PORT",s),e.report?nk("ENABLE_EVENT_REPORT",!0):nk("ENABLE_EVENT_REPORT",!1);var c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(pw(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=a[0];var u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),nk("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));var d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(pw(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=a;var p=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),p=e.cds.port),nk("CDS_AP",d.map((function(e){return"".concat(e,":").concat(p)}))),e.cds?nk("ENABLE_CONFIG_DISTRIBUTE",!0):nk("ENABLE_CONFIG_DISTRIBUTE",!1),Dk.info("set local access point v2 success")},n.setLocalAccessPoints=function(e,t){if(pw(e,"serverList"),dw(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bk(iw.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");var n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((function(e){return n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e})),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,nk("WEBCS_DOMAIN",e),nk("WEBCS_DOMAIN_BACKUP_LIST",e),nk("GATEWAY_DOMAINS",[t]),nk("EVENT_REPORT_DOMAIN",e[0]),nk("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),nk("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Dk.info("[".concat(this._clientId,"] set local access point success"))},n.setRemoteDefaultVideoStreamType=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sw(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,!this._joinInfo){e.next=12;break}return e.prev=1,e.next=4,this._gateway.setDefaultRemoteVideoStreamType(t);case 4:this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),Dk.error("[".concat(this._clientId,"] set default remote video stream type error"),e.t0.toString()),e.t0;case 10:e.next=13;break;case 12:Dk.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t));case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),n.setRemoteVideoStreamType=function(){var e=p(l().mark((function e(t,n){var r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sw(n,"streamType",[0,1,4,5,6,7,8,9]),e.prev=1,e.next=4,this._gateway.setRemoteVideoStreamType(t,n);case 4:setTimeout((function(){var e=r._users.find((function(e){return e.uid===t}));e&&e.videoTrack&&e.videoTrack.updateMediaStreamTrackResolution()}),2e3),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),Dk.error("[".concat(this._clientId,"] set remote video stream type error"),e.t0.toString()),e.t0;case 10:Dk.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(t,n);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setStreamFallbackOption=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sw(n,"fallbackType",[0,1,2,3,4,5,6,7,8]),e.prev=1,e.next=4,this._gateway.setStreamFallbackOption(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.error("[".concat(this._clientId,"] set stream fallback option"),e.t0.toString()),e.t0;case 9:Dk.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(t,n);case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setEncryptionConfig=function(e,t,n,r){!function(e){sw(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),dw(t,"secret");var i=["aes-128-gcm2","aes-256-gcm2"];if(Br(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new Bk(iw.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Bk(iw.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(ow(r,"encryptDataStream"),!Br(i).call(i,e))throw new Bk(iw.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||Dk.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=zw(n))},n.renewToken=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dw(t,"token",1,2047),this._key&&this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"renewToken should not be called before user join");case 2:return n=this._key,this._key=t,this._joinInfo&&(this._joinInfo.token=t),e.next=6,this._renewTokenMutex.lock();case 6:if(r=e.sent,e.prev=7,!rk("USE_NEW_TOKEN")){e.next=18;break}return Dk.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs")),e.next=12,aF(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vO);case 12:return i=e.sent,Dk.debug("[".concat(this._clientId,"] get ticket from unilbs success")),e.next=16,this._gateway.renewToken({token:t,ticket:i});case 16:e.next=21;break;case 18:return Dk.debug("[".concat(this._clientId,"] start renew token without ticket")),e.next=21,this._gateway.renewToken({token:t});case 21:Dk.debug("[".concat(this._clientId,"] renewToken success")),e.next=27;break;case 24:throw e.prev=24,e.t0=e.catch(7),this._key=n,this._joinInfo.token=n,Dk.error("[".concat(this._clientId,"] renewToken failed"),e.t0.toString()),e.t0;case 27:return e.prev=27,r(),e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[7,24,27,30]])})));return function(t){return e.apply(this,arguments)}}(),n.enableAudioVolumeIndicator=function(){var e=this;this._audioVolumeIndicationInterval?Dk.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((function(){var t=e._p2pChannel.getAudioLevels();e.safeEmit(Nw.VOLUME_INDICATOR,t)}),rk("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)},n.getRTCStats=function(){var e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e},n.startLiveStreaming=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=5;break}if("h264"===this.codec){e.next=3;break}throw new Bk(iw.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");case 3:if(this._p2pChannel.hasLocalMedia()){e.next=5;break}throw new Bk(iw.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");case 5:if(!(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))){e.next=7;break}throw new Bk(iw.LIVE_STREAMING_TASK_CONFLICT);case 7:return r=n?iM.TRANSCODE:iM.RAW,e.abrupt("return",this._createLiveStreamingClient(r).startLiveStreamingTask(t,r));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setLiveTranscoding=function(e){return this._createLiveStreamingClient(iM.TRANSCODE).setTranscodingConfig(e)},n.stopLiveStreaming=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((function(e){return e&&e.hasUrl(t)}))).length){e.next=3;break}throw new Bk(iw.INVALID_PARAMS,"can not find live streaming url to stop");case 3:return e.next=5,zl.all(n.map((function(e){return e&&e.stopLiveStreamingTask(t)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.startChannelMediaRelay=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EF(t),n=this._createChannelMediaRelayClient(),e.next=4,n.startChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.updateChannelMediaRelay=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EF(t),n=this._createChannelMediaRelayClient(),e.next=4,n.updateChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.stopChannelMediaRelay=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._createChannelMediaRelayClient(),e.next=3,t.stopChannelMediaRelay();case 3:this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.sendAudioMetadata=function(e){this._p2pChannel instanceof EB&&this._p2pChannel.addAudioMetadata(e)},n.sendStreamMessage=function(){var e=p(l().mark((function e(t){var n,r,i,a,o=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],this._joinInfo){e.next=3;break}throw new Bk(iw.INVALID_OPERATION,"can not send data stream, not joined");case 3:if(("string"==typeof t||t instanceof Uint8Array)&&(t={payload:t}),"string"==typeof t.payload&&(i=new TextEncoder,t.payload=i.encode(t.payload)),a=!1,e.t0=this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Br(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode),!e.t0){e.next=11;break}return a=!0,e.next=10,p(l().mark((function e(t,n,r){var i,a,o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=ui(i=Array.from(r)).call(i,(function(e,t){return e+t}),0),o={serverTs:0,seq:uk++,length:r.length,checkSum:a},s=new Uint8Array(cO(a,2)),c=new ArrayBuffer(ck),(u=new DataView(c)).setUint32(0,o.serverTs),u.setUint16(4,o.seq),u.setUint16(6,o.length),u.setUint16(8,o.checkSum),d=16-r.length%16,r=Jw(r,new Uint8Array(d)),e.next=6,window.crypto.subtle.encrypt({name:"AES-GCM",iv:t,tagLength:128,additionalData:s},n,r);case 6:return p=e.sent,e.abrupt("return",Jw(new Uint8Array(c),new Uint8Array(p)));case 8:case"end":return e.stop()}}),e)})))(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload);case 10:t.payload=e.sent;case 11:if(!(new Blob([t.payload]).size>1024)){e.next=13;break}throw new Bk(iw.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");case 13:return e.abrupt("return",this._gateway.signal.request(Qx.DATA_STREAM,{payload:zw(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-TB},!r));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.sendMetadata=function(e){if(!this._joinInfo)throw new Bk(iw.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Bk(iw.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Qx.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:zw(e)})},n.sendCustomReportMessage=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)||(t=[t]),t.forEach(Pk),this._joinInfo){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"can not send custom report, not joined");case 2:return e.next=4,Fk.sendCustomReportMessage(this._joinInfo.sid,t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getLocalAudioStats=function(){return this._statsCollector.getLocalAudioTrackStats()},n.getRemoteAudioStats=function(){return this._statsCollector.getRemoteAudioTrackStats()},n.getLocalVideoStats=function(){return this._statsCollector.getLocalVideoTrackStats()},n.getRemoteVideoStats=function(){return this._statsCollector.getRemoteVideoTrackStats()},n.getRemoteNetworkQuality=function(){return this._statsCollector.getRemoteNetworkQualityStats()},n.pickSVCLayer=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sw(n.spatialLayer,"spatialLayer",[0,1,2,3]),sw(n.temporalLayer,"temporalLayer",[0,1,2,3]),e.prev=1,e.next=4,this._gateway.pickSVCLayer(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),Dk.error("[".concat(this._clientId,"] pick SVC layer failed"),e.t0.toString()),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),n.setRTMConfig=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.apRTM,r=void 0!==n&&n,i=t.rtmFlag,ow(r,"apRTM"),cw(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,Dk.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),"CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState||!this._joinInfo){e.next=3;break}return e.abrupt("return",(this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n._reset=function(){if(Dk.debug("[".concat(this._clientId,"] reset client")),function(e){var t=ox.indexOf(e);-1!==t&&ox.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=_A.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&qB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Fk.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((function(e){e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((function(e){return e._close()})),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new fO("client-publish",this._clientId),this._subscribeMutex=new fO("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}},n._startSession=function(e,t){var n,r=e||nO();e?Dk.debug("[".concat(this._clientId,"] new Session ").concat(r)):Dk.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));var i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Fk.addSid(r);var a={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};Fk.sessionInit(this._sessionId,bG({cname:t.channel,appid:t.appId},a)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)},n._publishHighStream=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:if("auto"!==this._turnServer.mode||!rk("FORCE_TURN")||rk("TURN_ENABLE_TCP")||rk("TURN_ENABLE_UDP")){e.next=6;break}throw new Bk(iw.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");case 6:return Dk.debug("[".concat(this._clientId,"] publish high stream")),e.prev=7,e.next=10,this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);case 10:if(n=e.sent,!this.store.useP2P){e.next=29;break}return e.next=14,n.next();case 14:if(!(r=e.sent.value)){e.next=26;break}return e.prev=16,e.next=19,this._gateway.sendExtensionMessage(HM.PUBLISH,r,!0);case 19:e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(16),n.throw(e.t0),e.t0;case 24:return e.next=26,n.next();case 26:this._p2pChannel.reportPublishEvent(!0,null),e.next=56;break;case 29:return e.next=31,n.next();case 31:if(!(i=e.sent.value)){e.next=45;break}return e.prev=33,e.next=36,this._gateway.publish(this._uid,i,!0);case 36:o=e.sent,e.next=43;break;case 39:if(e.prev=39,e.t1=e.catch(33),e.t1.code===iw.DISCONNECT_P2P){e.next=43;break}throw n.throw(e.t1),e.t1;case 43:return e.next=45,n.next((null===(a=o)||void 0===a?void 0:a.ortc)||[]);case 45:this._p2pChannel.reportPublishEvent(!0,null),s=h(t);case 47:if((c=s()).done){e.next=56;break}if((u=c.value)instanceof mL&&u._encoderConfig&&this._gateway.setVideoProfile(u._encoderConfig).catch((function(e){Dk.debug("[".concat(d._clientId,"] stop setVideoProfile, because websocket is closed"))})),e.t2=!u.muted&&u.enabled,e.t2){e.next=54;break}return e.next=54,this._p2pChannel.muteLocalTrack(u);case 54:e.next=47;break;case 56:e.next=63;break;case 58:if(e.prev=58,e.t3=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t3?void 0:e.t3.code,t),(null==e.t3?void 0:e.t3.code)!==iw.WS_ABORT){e.next=62;break}return e.abrupt("return");case 62:throw e.t3;case 63:case"end":return e.stop()}}),e,this,[[7,58],[16,21],[33,39]])})));return function(t){return e.apply(this,arguments)}}(),n._publishLowStream=function(){var e=p(l().mark((function e(){var t,n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:return Dk.debug("[".concat(this._clientId,"] publish low stream")),(t=this._configDistribute.getLowStreamConfigDistribute())&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate)),e.prev=7,e.next=10,this._p2pChannel.publishLowStream(this._lowStreamParameter);case 10:return n=e.sent,e.next=13,n.next();case 13:if(!(r=e.sent.value)){e.next=26;break}return e.prev=15,e.next=18,this._gateway.publish(this._uid,r,!0);case 18:a=e.sent,e.next=25;break;case 21:if(e.prev=21,e.t0=e.catch(15),e.t0.code===iw.DISCONNECT_P2P){e.next=25;break}throw n.throw(e.t0),e.t0;case 25:n.next((null===(i=a)||void 0===i?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0);case 26:e.next=33;break;case 28:if(e.prev=28,e.t1=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t1?void 0:e.t1.code,void 0,!0),(null==e.t1?void 0:e.t1.code)!==iw.WS_ABORT){e.next=32;break}return e.abrupt("return");case 32:throw e.t1;case 33:case"end":return e.stop()}}),e,this,[[7,28],[15,21]])})));return function(){return e.apply(this,arguments)}}(),n._createLiveStreamingClient=function(e){var t=this,n=function(){if(!t._joinInfo||!t._appId)return new Bk(iw.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();var e,n=(e={joinInfo:t._joinInfo,appId:t._appId,websocketRetryConfig:t._config.websocketRetryConfig,httpRetryConfig:t._config.httpRetryConfig},dV("LiveStreaming").create(e));return n.onLiveStreamError=function(e,n){Fk.reportApiInvoke(t._sessionId,{name:Rw.ON_LIVE_STREAM_ERROR,options:[e,n],tag:Cw.TRACER}).onSuccess(),t.safeEmit(Nw.LIVE_STREAMING_ERROR,e,n)},n.onLiveStreamWarning=function(e,n){Fk.reportApiInvoke(t._sessionId,{name:Rw.ON_LIVE_STREAM_WARNING,options:[e,n],tag:Cw.TRACER}).onSuccess(),t.safeEmit(Nw.LIVE_STREAMING_WARNING,e,n)},n.on(dM.REQUEST_WORKER_MANAGER_LIST,(function(e,n,r){if(!t._joinInfo)return r(new Bk(iw.INVALID_OPERATION,"can not find join info to get worker manager"));p(l().mark((function e(t,n,r,i){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=rk("UAP_AP").slice(0,rk("AJAX_REQUEST_CONCURRENT")).map((function(e){return n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})),e.next=3,kV(a,t,n,r,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))(e,t._joinInfo,t._axiosCancelSource.token,vO).then(n).catch(r)})),n};return e===iM.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)},n._createChannelMediaRelayClient=function(){var e,t=this;if(!this._joinInfo)return new Bk(iw.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){var n=this.getLocalVideoStats(),r=n.sendResolutionWidth,i=n.sendResolutionHeight,a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},dV("ChannelMediaRelay").create(e));a.on("state",(function(e){e===_M.RELAY_STATE_FAILURE&&a&&a.dispose(),t.safeEmit(Nw.CHANNEL_MEDIA_RELAY_STATE,e)})),a.on("event",(function(e){t.safeEmit(Nw.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=function(e,n){var r;"resolution"===e&&(null===(r=t._channelMediaRelayClient)||void 0===r||r.setVideoProfile(n))}}return this._channelMediaRelayClient},n._handleUpdateDataChannel=function(e,t){var n=this,r=e.added,i=e.deleted,a=[];if(t){var o=[];this._users.forEach((function(e){e._dataChannels.forEach((function(t){r.every((function(n){return n.uid!==e._uintid||n.stream_id!==t.id}))&&o.push({uid:e._uintid,stream_id:t.id,ordered:t.ordered,max_retrans_times:t.maxRetransmits,metadata:t.metadata})}))})),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(r)&&r.length>0&&r.forEach((function(e){var r=e.uid,i=e.stream_id,o=e.ordered,s=e.max_retrans_times,c=e.metadata,u=n._users.find((function(e){return e._uintid===r}));if(u){if(Dk.debug("[".concat(n._clientId,"] data_channel added with uid ").concat(r)),Br(a).call(a,u)||a.push(u),u._uintid||(u._uintid=r),-1===u._dataChannels.findIndex((function(t){return t.id===e.stream_id}))){var d={id:i,ordered:!!o,maxRetransmits:s,metadata:c},p=function(e){return pV(e,!0)}(d);u._dataChannels.push(p),Dk.info("[".concat(n._clientId,"] remote user ").concat(u.uid," published datachannel")),t||n.safeEmit(Nw.USER_PUBLISHED,u,"datachannel",d)}n._p2pChannel.hasPendingRemoteDataChannel(u,e.stream_id)&&(Dk.debug("[".concat(n._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),n._subscribeDataChannel(u,e.stream_id).catch((function(e){Dk.error("[".concat(n._clientId,"] resubscribe datachannel error"),e.toString())})))}else Dk.error("[".concat(n._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(Nw.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach((function(e){var t=e.uid,r=(e.stream_id,n._users.find((function(e){return e._uintid===t})));if(r){var i=r._dataChannels.find((function(t){return t.id===e.stream_id}));i&&(Dk.debug("[".concat(n._clientId,"] data_stream delete with uid ").concat(t)),n._p2pChannel.unsubscribeDataChannel(r,[i]).then((function(e){if(r._dataChannels=r._dataChannels.filter((function(e){return e!==i})),e)return n._gateway.unsubscribeDataChannel(e,r.uid)})),Dk.info("[".concat(n._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),n.safeEmit(Nw.USER_UNPUBLISHED,r,"datachannel",i._config))}else Dk.error("[".concat(n._clientId,"] can not find target user!(on_delete_data_channel)"))}))},n._handleRemoveDataChannels=function(e){var t=this,n=this._users.find((function(t){return t.uid===e.uid}));n?void 0!==n._dataChannels&&n._dataChannels.length>0&&(Dk.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid)),this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then((function(e){if(e)return t._gateway.unsubscribeDataChannel(e,n.uid)})),Dk.info("[".concat(t._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach((function(e){t.safeEmit(Nw.USER_UNPUBLISHED,n,"datachannel",e._config)}))):Dk.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))},n._handleGatewayEvents=function(){var e=this;this._gateway.on(mM.UPDATE_GATEWAY_CONFIG,(function(){!function(){var e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void Dk.error("Error loading sdk config",e.message)}if(e)try{var t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((function(e){var r=t[e],i=r.value,a=r.type,o=r.expires;o&&o<=n||a||cx()||!Object.prototype.hasOwnProperty.call(QO,e)||(ak[e]=i,tk[e]=i,Dk.debug("Update gateway parameters from config distribute",e,i))}))}catch(e){Dk.error("Error update config from local cache",e.message)}}()})),this._gateway.on(mM.DISCONNECT_P2P,p(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.disconnectForReconnect();case 2:case"end":return t.stop()}}),t)})))),this._gateway.on(mM.CONNECTION_STATE_CHANGE,(function(t,n,r){var i;if(r!==Aw.FALLBACK){var a=function(){e.safeEmit(Nw.CONNECTION_STATE_CHANGE,t,n,r)};if(Fk.reportApiInvoke(e._sessionId||(null===(i=e._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:Rw.CONNECTION_STATE_CHANGE,options:[t,n,r],tag:Cw.TRACER}).onSuccess(JSON.stringify({cur:t,prev:n,reason:r})),Dk.info("[".concat(e._clientId,"] signal connection state change: ").concat(n," -> ").concat(t)),"DISCONNECTED"===t)return e._reset(),void a();if("RECONNECTING"===t)e._users.forEach((function(e){e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),e._userOfflineTimeout&&window.clearTimeout(e._userOfflineTimeout),e._streamRemovedTimeout&&window.clearTimeout(e._streamRemovedTimeout),e._userOfflineTimeout=void 0,e._streamRemovedTimeout=void 0;else if("CONNECTED"===t){var o;e._streamFallbackTypeCacheMap.forEach((function(t,n){e._gateway.setStreamFallbackOption(n,t).catch((function(t){Dk.warning("[".concat(e._clientId,"] auto set stream fallback option failed"),t)}))})),e._remoteStreamTypeCacheMap.forEach((function(t,n){e._gateway.setRemoteVideoStreamType(n,t).catch((function(t){Dk.warning("[".concat(e._clientId,"] auto set remote stream type failed"),t)}))})),void 0!==e._remoteDefaultVideoStreamType&&void 0===(null===(o=e._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&e.setRemoteDefaultVideoStreamType(e._remoteDefaultVideoStreamType).then((function(){Dk.debug("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((function(t){Dk.error("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(t))})),e.store.useP2P||(e._p2pChannel.republish(),e._userOfflineTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._userOfflineTimeout=void 0,e._users.filter((function(e){return!e._trust_in_room_})).forEach((function(t){Dk.debug("[".concat(e._clientId,"] user offline timeout, emit user offline ").concat(t.uid)),e._handleUserOffline({uid:t.uid})})))}),3e3),e._streamRemovedTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._streamRemovedTimeout=void 0,e._users.forEach((function(t){t._trust_audio_mute_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch audio unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,OM.AUDIO,!1)),t._trust_video_mute_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch video unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,OM.VIDEO,!1)),t._trust_audio_enabled_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch enable local audio ").concat(t.uid)),e._handleSetStreamLocalEnable("audio",t.uid,!0)),t._trust_video_enabled_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch enable local video ").concat(t.uid)),e._handleSetStreamLocalEnable("video",t.uid,!0)),t._trust_video_stream_added_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch reset video stream added ").concat(t.uid)),e._handleResetAddStream(t,"video")),t._trust_audio_stream_added_state_||(Dk.debug("[".concat(e._clientId,"] auto dispatch reset audio stream added ").concat(t.uid)),e._handleResetAddStream(t,"audio")),t._video_added_||t._audio_added_||(Dk.debug("[".concat(e._clientId,"] auto dispatch stream remove ").concat(t.uid)),e._handleRemoveStream({uid:t.uid,uint_id:t._uintid}))})))}),1e3))}a()}})),this._gateway.on(mM.REQUEST_NEW_GATEWAY_LIST,p(l().mark((function t(n,r){var i,a,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._joinInfo){t.next=2;break}return t.abrupt("return",r(new Bk(iw.UNEXPECTED_ERROR,"can not recover, no join info")));case 2:return t.prev=2,t.next=5,WB(bG(bG({},e._joinInfo),{},{uid:e._joinInfo.uid,stringUid:void 0}));case 5:if(!(a=t.sent)){t.next=10;break}i=a.ap,zB(a),e._joinInfo.preload=!0,t.next=14;break;case 10:return t.next=12,WV(e._joinInfo,e._axiosCancelSource.token,e._config.httpRetryConfig||vO,e.store);case 12:i=t.sent,e._joinInfo.preload=!1;case 14:e._joinInfo&&(e._joinInfo.apResponse=i.gatewayInfo.res,e._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,e._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip),o=[],i.gatewayInfo.gatewayAddrs.forEach((function(t){var n=t.address.split(":"),r=n[0],i=n[1];e._joinInfo&&e._joinInfo.proxyServer?o.push({proxy:e._joinInfo.proxyServer,host:r,port:i}):o.push({host:r,port:i})})),n(o),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(2),r(t.t0);case 22:case"end":return t.stop()}}),t,null,[[2,19]])})))),this._gateway.on(mM.NETWORK_QUALITY,(function(t){"normal"===e._networkQualitySensitivity&&e.safeEmit(Nw.NETWORK_QUALITY,t)})),this._gateway.on(mM.STREAM_TYPE_CHANGE,(function(t,n){e.safeEmit(Nw.STREAM_TYPE_CHANGED,t,n),Fk.reportApiInvoke(e._sessionId,{name:Rw.STREAM_TYPE_CHANGE,options:[t,n],tag:Cw.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:n}))})),this._gateway.on(mM.IS_P2P_DISCONNECTED,(function(t){e._p2pChannel.isP2PDisconnected()?t(!0):e._p2pChannel.hasLocalMedia()||e._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(mM.REQUEST_P2P_CONNECTION_PARAMS,p(l().mark((function t(n,r,i){var a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._p2pChannel.getEstablishParams();case 3:if(a=t.sent,t.t0=rk("ENABLE_PREALLOC_PC")&&a,t.t0){t.next=9;break}return t.next=8,e._p2pChannel.startP2PConnection(n);case 8:a=t.sent;case 9:r(a),t.next=15;break;case 12:t.prev=12,t.t1=t.catch(0),i(t.t1);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))),this._gateway.on(mM.JOIN_RESPONSE,(function(t,n){if(!e.store.useP2P){var r;t.attributes?r=t.attributes.userAttributes.preSubSsrcs:Dk.debug("no attributes in joinResponse");var i=UU(t.ortc,n,r);e._p2pChannel.connect(i)}})),this._gateway.on(mM.PRE_CONNECT_PC,p(l().mark((function t(n){var r,i,a,o,s,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.candidates,i=n.fingerprint,!(e._joinInfo&&r.length>0)||e._p2pChannel.isPlanB){t.next=7;break}return t.next=4,e._p2pChannel.startP2PConnection({turnServer:e._joinInfo.turnServer});case 4:return o=e._joinInfo.apResponse,s=o.cert,c=o.cid,t.next=7,e._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(s),icePwd:"".concat(c,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(a=rk("FINGERPRINT"))&&void 0!==a?a:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0});case 7:case"end":return t.stop()}}),t)}))))},n._handleGatewaySignalEvents=function(){var e=this;this._gateway.signal.on($x.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on($x.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on($x.ON_ADD_AUDIO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)})),this._gateway.signal.on($x.ON_ADD_VIDEO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)})),this._gateway.signal.on($x.ON_REMOTE_DATASTREAM_UPDATE,(function(t){e._handleUpdateDataChannel(t)})),this._gateway.signal.on($x.ON_REMOTE_FULL_DATASTREAM_INFO,(function(t){e._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on($x.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on($x.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on($x.MUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,OM.AUDIO,!0)})),this._gateway.signal.on($x.UNMUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,OM.AUDIO,!1)})),this._gateway.signal.on($x.MUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,OM.VIDEO,!0)})),this._gateway.signal.on($x.UNMUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,OM.VIDEO,!1)})),this._gateway.signal.on($x.RECEIVE_METADATA,(function(t){var n=qw(t.metadata);e.safeEmit(Nw.RECEIVE_METADATA,t.uid,n)})),this._gateway.signal.on($x.ON_DATA_STREAM,p(l().mark((function t(n){var r,i,a,o,s,c,u;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(i=qw(n.payload),!(e._encryptDataStream&&e._encryptDataStreamIv&&e._encryptDataStreamKey&&window.crypto.subtle&&Br(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,e._encryptionMode))){t.next=10;break}if(!(n.payload.length<ck)){t.next=6;break}throw new Bk(iw.UNEXPECTED_RESPONSE,"payload length ".concat(n.payload.length," is less than header length ").concat(ck));case 6:return t.next=8,p(l().mark((function e(t,n,r){var i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.subarray(0,ck),a=i.slice(8,ck),o=(a[0]<<8)+a[1],s=(i[6]<<8)+i[7],e.next=6,window.crypto.subtle.decrypt({name:"AES-GCM",iv:t,tagLength:128,additionalData:new Uint8Array(cO(o,2))},n,r.subarray(ck));case 6:return c=e.sent,e.abrupt("return",new Uint8Array(c).subarray(0,s));case 8:case"end":return e.stop()}}),e)})))(e._encryptDataStreamIv,e._encryptDataStreamKey,i);case 8:a=t.sent,i=a;case 10:o=0,(n.ordered||n.syncWithAudio)&&(s=e._p2pChannel.getStats(),c=e.remoteUsers.find((function(e){return e.uid===n.uid})),u=null==s?void 0:s.audioRecv.find((function(e){return e.ssrc===(null==c?void 0:c._audioSSRC)})),o=null==u?void 0:u.jitterBufferMs),(null==o||Number.isNaN(o))&&(o=0),AB(bG(bG({},n),{},{payload:i}),o,{id:e._clientId,onStreamMessage:"function"==typeof e.onStreamMessage?e.onStreamMessage.bind(e):void 0,safeEmit:e.safeEmit.bind(e)});case 13:case"end":return t.stop()}}),t)})))),this._gateway.signal.on($x.ON_CRYPT_ERROR,(function(){Yw((function(){Dk.warning("[".concat(e._clientId,"] on crypt error")),e.safeEmit(Nw.CRYPT_ERROR)}),e._sessionId)})),this._gateway.signal.on($x.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on($x.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){Dk.warning("[".concat(e._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),e._gateway.leave(!0,Aw.TOKEN_EXPIRE),e.safeEmit(Nw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),e._reset()})),this._gateway.signal.on($x.ON_STREAM_FALLBACK_UPDATE,(function(t){Dk.debug("[".concat(e._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),e.safeEmit(Nw.STREAM_FALLBACK,t.stream_id,1===t.stream_type?"fallback":"recover")})),this._gateway.signal.on($x.ON_PUBLISH_STREAM,(function(t){e.uid===e._uid&&(e._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),Dk.info("[".concat(e._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on($x.ENABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on($x.DISABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(Jx.REQUEST_TIMEOUT,(function(t,n){if(e._joinInfo)switch(t){case Qx.PUBLISH:if(!n)return;var r=n.ortc;if(r){var i,a,o=r.some((function(e){return e.stream_type===EM.Audio})),s=r.some((function(e){return e.stream_type!==EM.Audio})),c=r.some((function(e){var t=e.stream_type;return t===EM.Screen||t===EM.ScreenLow}));"offer"===n.state&&Fk.publish(e._joinInfo.sid,{eventElapse:lF.measureFromPublishStart(e.store.clientId,e.store.pubId),succ:!1,ec:iw.TIMEOUT,audio:o,video:s,p2pid:n.p2p_id,publishRequestid:e.store.pubId,screenshare:c,audioName:o?null===(i=r.find((function(e){return e.stream_type===EM.Audio})))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0,videoName:s?null===(a=r.find((function(e){return e.stream_type!==EM.Audio})))||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId.toString():void 0})}break;case Qx.SUBSCRIBE:n&&Fk.subscribe(e._joinInfo.sid,{succ:!1,ec:iw.TIMEOUT,audio:n.stream_type===OM.AUDIO,video:n.stream_type===OM.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:e.store.p2pId,eventElapse:lF.measureFromSubscribeStart(e.store.clientId,n.ssrcId),preSsrc:e._p2pChannel.isPreSubScribe(n.ssrcId)})}})),this._gateway.signal.on($x.ON_P2P_OK,(function(t){e.uid,e._uid})),this._gateway.signal.on($x.ON_PUBLISHED_USER_LIST,(function(t){if(null!=t&&t.users){rk("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((function(t){return!sx(t.string_id||t.stream_id,e.channelName)})));for(var n,r=[],i=[],a=function(){var t=n.value,a=e._users.find((function(e){return e._uintid===t.stream_id}));a?a._trust_in_room_=!0:(a=new mF(t.string_id||t.stream_id,t.stream_id),e._users.push(a),0===e.getListeners(Nw.PUBLISHED_USER_LIST).length&&(Dk.debug("[".concat(e._clientId,"] user online"),t.stream_id),e.safeEmit(Nw.USER_JOINED,a)));var o=gM.Audio&t.stream_type,s=(gM.Video|gM.LwoVideo)&t.stream_type,c=0!=(65280&t.stream_type),u=o&&a.hasAudio,d=s&&a.hasVideo;s&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=t.video_ssrc,a._rtxSsrcId=t.video_rtx),o&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=t.audio_ssrc),o&&!u&&0===e.getListeners(Nw.PUBLISHED_USER_LIST).length&&(Dk.info("[".concat(e._clientId,"] remote user ").concat(a.uid," published audio")),e.safeEmit(Nw.USER_PUBLISHED,a,"audio")),s&&!d&&0===e.getListeners(Nw.PUBLISHED_USER_LIST).length&&(Dk.info("[".concat(e._clientId,"] remote user ").concat(a.uid," published video")),e.safeEmit(Nw.USER_PUBLISHED,a,"video")),(o&&!u||s&&!d||c)&&r.push(a),s&&e._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),o&&e._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})},o=h(t.users);!(n=o()).done;)a();i.length>0&&(Dk.debug("[".concat(e._clientId,"] RE massSubscribe after reconnect ").concat(i.map((function(e){return"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)})).join("; ")," ")),e.massSubscribe(i).catch((function(t){Dk.error("[".concat(e._clientId,"] mass resubscribe error"),t.toString())}))),e.getListeners(Nw.PUBLISHED_USER_LIST).length>0?rk("ENABLE_DATASTREAM_2")?e._pendingPublishedUsers=r:(Dk.info("[".concat(e._clientId,"] client emit user-list event, users: ").concat(r.map((function(e){return e.uid})).join(", "))),e.safeEmit(Nw.PUBLISHED_USER_LIST,r)):Dk.info("[".concat(e._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map((function(e){return e.uid})).join(", ")))}})),this._gateway.signal.on($x.ON_RTP_CAPABILITY_CHANGE,(function(t){var n=t.video_codec;e._p2pChannel instanceof EB&&e._p2pChannel.updateRemoteRTPCapabilities(n.map((function(e){return e.toLowerCase()})).filter((function(e){var t;return Br(t=Object.keys(sk)).call(t,e)})))}))},n._handleP2PEvents=function(){var e=this;this._gateway.signal.on($x.ON_USER_OFFLINE,(function(){e._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(HM.PUBLISH,(function(t,n,r){var i=t.uid;t.forEach((function(t){var a=t.kind,o=t.ssrcs,s=t.mid,c=t.isMuted;e._handleP2PAddAudioOrVideoStream(a,i,o[0].ssrcId,s);var u=e._users.find((function(e){return e.uid===i}));return u&&e.store.useP2P?e._p2pChannel.mockSubscribe(u,a,o[0].ssrcId,s).then((function(){n()})).catch(r):n(),e._handleMuteStream(i,a,!!c)}))})),this._gateway.signal.on(HM.CALL,p(l().mark((function t(n,r,i){var a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.store.useP2P){t.next=12;break}return t.prev=1,t.t0=r,t.next=5,e._p2pChannel.startP2P({turnServer:null===(a=e._joinInfo)||void 0===a?void 0:a.turnServer},n);case 5:t.t1=t.sent,(0,t.t0)(t.t1),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(1),i(t.t2);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))),this._gateway.signal.on(Jx.P2P_CONNECTION,p(l().mark((function t(n){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.store.useP2P,!t.t0){t.next=5;break}return t.next=4,e._p2pChannel;case 4:t.sent.p2pConnect(n);case 5:case"end":return t.stop()}}),t)})))),this._gateway.signal.on(HM.UNPUBLISH,p(l().mark((function t(n,r,i){var a,o,s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.store.useP2P){t.next=5;break}if(a=n.unpubMsg,o=n.uid,s=e._users.find((function(e){return e.uid===o}))){t.next=4;break}return t.abrupt("return",(Dk.warning("[".concat(e._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void r()));case 4:try{a.forEach(p(l().mark((function t(n){var r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.stream_type,i=r===EM.Audio?OM.AUDIO:OM.VIDEO,t.next=4,e._p2pChannel.unsubscribe(s,i);case 4:e._handleMuteStream(o,i,!0);case 5:case"end":return t.stop()}}),t)})))),r()}catch(e){i(e)}case 5:case"end":return t.stop()}}),t)})))),this._gateway.signal.on(HM.CONTROL,p(l().mark((function t(n,r){var i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=n.action,t.t0=i,t.next=t.t0===YM.MUTE_LOCAL_VIDEO?4:t.t0===YM.MUTE_LOCAL_AUDIO?6:t.t0===YM.UNMUTE_LOCAL_VIDEO?8:t.t0===YM.UNMUTE_LOCAL_AUDIO?10:11;break;case 4:return e._handleMuteStream(r,OM.VIDEO,!0),t.abrupt("break",11);case 6:return e._handleMuteStream(r,OM.AUDIO,!0),t.abrupt("break",11);case 8:return e._handleP2PAddAudioOrVideoStream("video",r),e._handleMuteStream(r,OM.VIDEO,!1),t.abrupt("break",11);case 10:e._handleP2PAddAudioOrVideoStream("audio",r),e._handleMuteStream(r,OM.AUDIO,!1);case 11:case"end":return t.stop()}}),t)})))),this._gateway.signal.on(HM.RESTART_ICE,p(l().mark((function t(n,r,i){var a,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.store.useP2P){t.next=17;break}if(t.prev=1,a=n.direction,o=n.iceParameter,a===eM.SEND_ONLY&&!o){t.next=11;break}return t.t0=r,t.next=7,e._p2pChannel.restartICE(a,o);case 7:t.t1=t.sent,(0,t.t0)(t.t1),t.next=12;break;case 11:e._p2pChannel.handleDisconnect(a),r();case 12:t.next=17;break;case 14:t.prev=14,t.t2=t.catch(1),i(t.t2);case 17:case"end":return t.stop()}}),t,null,[[1,14]])})))),this._gateway.signal.on(HM.CANDIDATE,(function(t){if(e.store.useP2P){var n=t.candidate,r=t.direction;e._p2pChannel.addRemoteCandidate(n,r)}})),this._p2pChannel.on(xM.RequestP2PRestartICE,p(l().mark((function t(n,r,i){var a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=n.direction,t.t0=r,t.next=5,e._gateway.sendExtensionMessage(HM.RESTART_ICE,n,a===eM.SEND_ONLY);case 5:t.t1=t.sent,(0,t.t0)(t.t1),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),i(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))),this._p2pChannel.on(xM.LocalCandidate,(function(t){e._gateway.sendExtensionMessage(HM.CANDIDATE,JSON.stringify(t),!0)})),this._p2pChannel.on(xM.RequestP2PMuteLocal,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._gateway.sendExtensionMessage(HM.CONTROL,n,!0);case 3:r(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),i(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))),this._p2pChannel.on(xM.RequestP2PUnmuteRemote,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.unmuteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===iw.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})))),this._p2pChannel.on(xM.RequestP2PMuteRemote,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.muteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===iw.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})))),this._p2pChannel.on(xM.StateChange,(function(t,n){n===LM.Connected&&e._p2pChannel.republish()}))},n._handleP2PChannelEvents=function(){var e=this;this._p2pChannel.on(xM.PeerConnectionStateChange,(function(t){var n=e._peerConnectionState;t!==n&&(e.safeEmit(Nw.PEERCONNECTION_STATE_CHANGE,t,n),e._peerConnectionState=t)})),this._p2pChannel.on(xM.RequestMuteLocal,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.muteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===iw.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})))),this._p2pChannel.on(xM.RequestUnmuteLocal,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.unmuteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===iw.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})))),this._p2pChannel.on(xM.RequestRePublish,(function(t,n,r){e.publish(t,!1).then(n).catch(r)})),this._p2pChannel.on(xM.RequestRePublishDataChannel,(function(t,n,r){zl.all(t.map(p(l().mark((function t(n){var r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.publishDataChannel([n]);case 2:r=t.sent,t.prev=3,r.forEach((function(t){e._uid&&e._gateway.publishDataChannel(e._uid,t,!0)})),t.next=11;break;case 7:if(t.prev=7,t.t0=t.catch(3),t.t0.code===iw.DISCONNECT_P2P){t.next=11;break}throw t.t0;case 11:case"end":return t.stop()}}),t,null,[[3,7]])}))))).then(n).catch(r)})),this._p2pChannel.on(xM.RequestReSubscribe,p(l().mark((function t(n,r,i){var a,o,s,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=h(n);case 2:if((o=a()).done){t.next=13;break}if(s=o.value,c=s.user,s.kind!==OM.VIDEO){t.next=9;break}return t.next=7,e.subscribe(c,"video");case 7:t.next=11;break;case 9:return t.next=11,e.subscribe(c,"audio");case 11:t.next=2;break;case 13:r(),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),i(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))),this._p2pChannel.on(xM.RequestUpload,(function(t,n){e._gateway.upload(t,n)})),this._p2pChannel.on(xM.RequestUploadStats,(function(t){e._gateway.uploadWRTCStats(t)})),this._p2pChannel.on(xM.MediaReconnectStart,(function(t){e.safeEmit(Nw.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(xM.MediaReconnectEnd,(function(t){e.safeEmit(Nw.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(xM.NeedSignalRTT,(function(t){t(e._gateway.getSignalRTT())})),this._p2pChannel.on(xM.RequestRestartICE,p(l().mark((function t(n){var r,i,a,o,s,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.store.useP2P){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e._p2pChannel.restartICE(n);case 4:return r=t.sent,t.next=7,r.next();case 7:if(!(i=t.sent).done){t.next=10;break}return t.abrupt("return");case 10:return a=i.value,t.prev=11,t.next=14,e._gateway.restartICE({iceParameters:a});case 14:o=t.sent,t.next=20;break;case 17:return t.prev=17,t.t0=t.catch(11),t.abrupt("return",void r.throw(t.t0));case 20:return s=function(e){var t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(o),c=s.iceParameters,t.next=23,r.next({remoteIceParameters:c});case 23:case"end":return t.stop()}}),t,null,[[11,17]])})))),this._p2pChannel.on(xM.RequestReconnect,p(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._gateway.reconnect();case 1:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(xM.RequestReconnectPC,p(l().mark((function t(){var n,r,i,a,o,s,c,u,d;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.startP2PConnection({turnServer:null===(n=e._joinInfo)||void 0===n?void 0:n.turnServer});case 2:return r=t.sent,i=r.iceParameters,a=r.dtlsParameters,o=r.rtpCapabilities,t.next=8,e._gateway.reconnectPC({iceParameters:i,dtlsParameters:a,rtpCapabilities:o});case 8:return s=t.sent,c=s.gatewayEstablishParams,u=s.gatewayAddress,d=UU(c,u),t.next=14,e._p2pChannel.connect(d);case 14:return t.next=16,e._p2pChannel.republish();case 16:return t.next=18,e._p2pChannel.reSubscribe();case 18:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(xM.RequestUnpublishForReconnectPC,p(l().mark((function t(n,r,i){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo||void 0===e._uid){t.next=6;break}return t.next=3,e._gateway.unpublish(n,e._uid);case 3:r(),t.next=7;break;case 6:i();case 7:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(xM.P2PLost,(function(){e.safeEmit(Nw.P2P_LOST,e.store.uid)})),this._p2pChannel.on(xM.UpdateVideoEncoder,(function(t){t._encoderConfig&&e._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(xM.ConnectionTypeChange,(function(t){e.safeEmit(Nw.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(xM.RequestLowStreamParameter,(function(t){t(e._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(xM.QueryClientConnectionState,(function(t){t(e.connectionState)})),this._p2pChannel.on(xM.AudioMetadata,(function(t){e.safeEmit(Nw.AUDIO_METADATA,t)}))},n.getKeyMetrics=function(){return this.store.keyMetrics},n.enableContentInspect=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&"CONNECTED"===this.connectionState){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));case 2:if(!this._inspect){e.next=4;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));case 4:return e.prev=4,p={config:t},n=dV("ContentInspect").create(p),this._inspect=n,this.handleVideoInspectEvents(n),r=this._joinInfo,i=r.appId,a=r.cname,o=r.sid,s=r.token,c=r.uid,u=r.cid,d=r.vid,e.next=10,n.init({appId:i,areaCode:"",cname:a,sid:o,token:s,uid:c,cid:u,vid:d?Number(d):0},vO);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(4),Array.isArray(e.t0)?e.t0[0]:e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),n.handleVideoInspectEvents=function(e){var t=this;e.on(VM.CONNECTION_STATE_CHANGE,(function(n,r){if(t.safeEmit(Nw.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,r),r===MM.CONNECTED){if("CONNECTED"!==t.connectionState)return void t.safeEmit(Nw.CONTENT_INSPECT_ERROR,new Bk(iw.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(VM.INSPECT_RESULT,(function(e,n){var r;if((null==n?void 0:n.code)===iw.INVALID_OPERATION&&"DISCONNECTED"===t.connectionState)return Dk.debug("Stop inspect content because that has left channel"),null==t||null===(r=t._inspect)||void 0===r||r.close(),void(t._inspect=void 0);t.safeEmit(Nw.CONTENT_INSPECT_RESULT,e,n)})),e.on(VM.CLIENT_LOCAL_VIDEO_TRACK,(function(e){e(t.localTracks.filter((function(e){return"video"===e.trackMediaType}))[0])}))},n.disableContentInspect=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._inspect){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));case 2:e.prev=2,this._inspect.close(),this._inspect=void 0,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),Array.isArray(e.t0)?e.t0[0]:e.t0;case 9:case"end":return e.stop()}}),e,this,[[2,6]])})));return function(){return e.apply(this,arguments)}}(),n.setImageModeration=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ow(t,"enabled"),!t){e.next=22;break}if(n){e.next=3;break}throw new Bk(iw.INVALID_PARAMS,"config is required");case 3:if(Nj(n),this._joinInfo){e.next=5;break}throw new Bk(iw.INVALID_OPERATION,"can not create image moderation, please join channel first");case 5:if(e.prev=5,!this._moderation){e.next=10;break}this._moderation.updateConfig(n),e.next=15;break;case 10:return h={config:n},r=dV("ImageModeration").create(h),this._moderation=r,this.handleImageModerationEvents(r),i=this._joinInfo,a=i.appId,o=i.cname,s=i.sid,c=i.token,u=i.uid,d=i.cid,p=i.vid,e.next=15,r.init({appId:a,areaCode:"",cname:o,sid:s,token:c,uid:u,cid:d,vid:p?Number(p):0},vO);case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(5),Array.isArray(e.t0)?e.t0[0]:e.t0;case 20:e.next=31;break;case 22:if(this._moderation){e.next=24;break}throw new Bk(iw.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));case 24:e.prev=24,this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0,e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(24),Array.isArray(e.t1)?e.t1[0]:e.t1;case 31:case"end":return e.stop()}}),e,this,[[5,17],[24,28]])})));return function(t,n){return e.apply(this,arguments)}}(),n.handleImageModerationEvents=function(e){var t=this;e.on(GM.CONNECTION_STATE_CHANGE,(function(n,r){if(t.safeEmit(Nw.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,r),n===jM.CONNECTED){if("CONNECTED"!==t.connectionState)throw t.setImageModeration(!1),new Bk(iw.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(GM.CLIENT_LOCAL_VIDEO_TRACK,(function(e){e(t.localTracks.filter((function(e){return"video"===e.trackMediaType}))[0])}))},n.setP2PTransport=function(e){if(function(e){sw(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new Bk(iw.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,Dk.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))},n.getJoinChannelServiceRecords=function(){return Dk.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords},n.setPublishAudioFilterEnabled=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ow(t,"enabled"),nk("ENABLE_PUBLISH_AUDIO_FILTER",t),e.t0=this._joinInfo,!e.t0){e.next=6;break}return e.next=6,this._gateway.setPublishAudioFilterEnabled(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n._handleResetAddStream=function(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}},v(t,[{key:"connectionState",get:function(){return this._gateway.state}},{key:"remoteUsers",get:function(){return this._users}},{key:"localTracks",get:function(){return this._p2pChannel.getAllTracks(!0)}},{key:"uid",get:function(){return this._uid}},{key:"channelName",get:function(){return this._channelName}},{key:"localDataChannels",get:function(){return this._p2pChannel.getAllDataChannels()}},{key:"mode",get:function(){return this._config.mode}},{key:"role",get:function(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}},{key:"codec",get:function(){return this._config.codec}},{key:"audioCodec",get:function(){return this._config.audioCodec||"opus"}},{key:"isStringUID",get:function(){return!!this._joinInfo&&!!this._joinInfo.stringUid}},{key:"__className__",get:function(){return"Client"}}]),t}(gw)).prototype,"leave",[Dj],Object.getOwnPropertyDescriptor(SG.prototype,"leave"),SG.prototype),Wx(SG.prototype,"publish",[Pj],Object.getOwnPropertyDescriptor(SG.prototype,"publish"),SG.prototype),Wx(SG.prototype,"unpublish",[Lj],Object.getOwnPropertyDescriptor(SG.prototype,"unpublish"),SG.prototype),Wx(SG.prototype,"subscribe",[xj],Object.getOwnPropertyDescriptor(SG.prototype,"subscribe"),SG.prototype),Wx(SG.prototype,"presubscribe",[Mj],Object.getOwnPropertyDescriptor(SG.prototype,"presubscribe"),SG.prototype),Wx(SG.prototype,"massSubscribe",[Uj],Object.getOwnPropertyDescriptor(SG.prototype,"massSubscribe"),SG.prototype),Wx(SG.prototype,"unsubscribe",[Vj],Object.getOwnPropertyDescriptor(SG.prototype,"unsubscribe"),SG.prototype),Wx(SG.prototype,"massUnsubscribe",[Fj],Object.getOwnPropertyDescriptor(SG.prototype,"massUnsubscribe"),SG.prototype),Wx(SG.prototype,"setLowStreamParameter",[Bj],Object.getOwnPropertyDescriptor(SG.prototype,"setLowStreamParameter"),SG.prototype),Wx(SG.prototype,"enableDualStream",[jj],Object.getOwnPropertyDescriptor(SG.prototype,"enableDualStream"),SG.prototype),Wx(SG.prototype,"disableDualStream",[Gj],Object.getOwnPropertyDescriptor(SG.prototype,"disableDualStream"),SG.prototype),Wx(SG.prototype,"setClientRole",[Wj],Object.getOwnPropertyDescriptor(SG.prototype,"setClientRole"),SG.prototype),Wx(SG.prototype,"_setClientRoleOptions",[Hj],Object.getOwnPropertyDescriptor(SG.prototype,"_setClientRoleOptions"),SG.prototype),Wx(SG.prototype,"setProxyServer",[Kj],Object.getOwnPropertyDescriptor(SG.prototype,"setProxyServer"),SG.prototype),Wx(SG.prototype,"setTurnServer",[Yj],Object.getOwnPropertyDescriptor(SG.prototype,"setTurnServer"),SG.prototype),Wx(SG.prototype,"setLicense",[qj],Object.getOwnPropertyDescriptor(SG.prototype,"setLicense"),SG.prototype),Wx(SG.prototype,"startProxyServer",[zj],Object.getOwnPropertyDescriptor(SG.prototype,"startProxyServer"),SG.prototype),Wx(SG.prototype,"stopProxyServer",[Xj],Object.getOwnPropertyDescriptor(SG.prototype,"stopProxyServer"),SG.prototype),Wx(SG.prototype,"setLocalAccessPointsV2",[Jj],Object.getOwnPropertyDescriptor(SG.prototype,"setLocalAccessPointsV2"),SG.prototype),Wx(SG.prototype,"setLocalAccessPoints",[Qj],Object.getOwnPropertyDescriptor(SG.prototype,"setLocalAccessPoints"),SG.prototype),Wx(SG.prototype,"setRemoteDefaultVideoStreamType",[Zj],Object.getOwnPropertyDescriptor(SG.prototype,"setRemoteDefaultVideoStreamType"),SG.prototype),Wx(SG.prototype,"setRemoteVideoStreamType",[$j],Object.getOwnPropertyDescriptor(SG.prototype,"setRemoteVideoStreamType"),SG.prototype),Wx(SG.prototype,"setStreamFallbackOption",[eG],Object.getOwnPropertyDescriptor(SG.prototype,"setStreamFallbackOption"),SG.prototype),Wx(SG.prototype,"setEncryptionConfig",[tG],Object.getOwnPropertyDescriptor(SG.prototype,"setEncryptionConfig"),SG.prototype),Wx(SG.prototype,"renewToken",[nG],Object.getOwnPropertyDescriptor(SG.prototype,"renewToken"),SG.prototype),Wx(SG.prototype,"enableAudioVolumeIndicator",[rG],Object.getOwnPropertyDescriptor(SG.prototype,"enableAudioVolumeIndicator"),SG.prototype),Wx(SG.prototype,"startLiveStreaming",[iG],Object.getOwnPropertyDescriptor(SG.prototype,"startLiveStreaming"),SG.prototype),Wx(SG.prototype,"setLiveTranscoding",[aG],Object.getOwnPropertyDescriptor(SG.prototype,"setLiveTranscoding"),SG.prototype),Wx(SG.prototype,"stopLiveStreaming",[oG],Object.getOwnPropertyDescriptor(SG.prototype,"stopLiveStreaming"),SG.prototype),Wx(SG.prototype,"startChannelMediaRelay",[sG],Object.getOwnPropertyDescriptor(SG.prototype,"startChannelMediaRelay"),SG.prototype),Wx(SG.prototype,"updateChannelMediaRelay",[cG],Object.getOwnPropertyDescriptor(SG.prototype,"updateChannelMediaRelay"),SG.prototype),Wx(SG.prototype,"stopChannelMediaRelay",[uG],Object.getOwnPropertyDescriptor(SG.prototype,"stopChannelMediaRelay"),SG.prototype),Wx(SG.prototype,"sendCustomReportMessage",[dG],Object.getOwnPropertyDescriptor(SG.prototype,"sendCustomReportMessage"),SG.prototype),Wx(SG.prototype,"pickSVCLayer",[pG],Object.getOwnPropertyDescriptor(SG.prototype,"pickSVCLayer"),SG.prototype),Wx(SG.prototype,"setRTMConfig",[lG],Object.getOwnPropertyDescriptor(SG.prototype,"setRTMConfig"),SG.prototype),Wx(SG.prototype,"enableContentInspect",[hG],Object.getOwnPropertyDescriptor(SG.prototype,"enableContentInspect"),SG.prototype),Wx(SG.prototype,"disableContentInspect",[fG],Object.getOwnPropertyDescriptor(SG.prototype,"disableContentInspect"),SG.prototype),Wx(SG.prototype,"setImageModeration",[_G],Object.getOwnPropertyDescriptor(SG.prototype,"setImageModeration"),SG.prototype),Wx(SG.prototype,"setP2PTransport",[vG],Object.getOwnPropertyDescriptor(SG.prototype,"setP2PTransport"),SG.prototype),Wx(SG.prototype,"getJoinChannelServiceRecords",[EG],Object.getOwnPropertyDescriptor(SG.prototype,"getJoinChannelServiceRecords"),SG.prototype),Wx(SG.prototype,"setPublishAudioFilterEnabled",[mG],Object.getOwnPropertyDescriptor(SG.prototype,"setPublishAudioFilterEnabled"),SG.prototype),SG),IG=function(){function e(t,n){XC(this,"id",0),XC(this,"element",void 0),XC(this,"peerPair",void 0),XC(this,"context",void 0),XC(this,"audioPlayerElement",void 0),XC(this,"audioTrack",void 0),e.count+=1,this.id=e.count,this.element=t,this.context=n}var t=e.prototype;return t.initPeers=function(){var e=this;this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=function(t){var n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),e.audioPlayerElement=n}},t.switchSdp=function(){var e=p(l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerPair){e.next=2;break}return e.abrupt("return");case 2:return t=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("offer"!==n){e.next=6;break}return e.next=3,t.createOffer();case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.createAnswer();case 8:e.t0=e.sent;case 9:return r=e.t0,e.next=12,t.setLocalDescription(r);case 12:return e.abrupt("return","complete"===t.iceGatheringState?t.localDescription:new zl((function(e){t.onicegatheringstatechange=function(){"complete"===t.iceGatheringState&&e(t.localDescription)}})));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setRemoteDescription(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,t(this.peerPair[0],"offer");case 6:return r=e.sent,e.next=9,n(this.peerPair[1],r);case 9:return e.next=11,t(this.peerPair[1],"answer");case 11:return i=e.sent,e.next=14,n(this.peerPair[0],i);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(3),new Bk(iw.LOCAL_AEC_ERROR,e.t0.toString()).print();case 19:case"end":return e.stop()}}),e,this,[[3,16]])})));return function(){return e.apply(this,arguments)}}(),t.getTracksFromMediaElement=function(){var e=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioTrack){e.next=2;break}return e.abrupt("return",this.audioTrack);case 2:e.prev=2,t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new Bk(iw.LOCAL_AEC_ERROR,e.t0.toString()).print();case 10:if(n){e.next=12;break}throw new Bk(iw.LOCAL_AEC_ERROR,"no dest node when local aec").print();case 12:return r=n.stream.getAudioTracks()[0],e.abrupt("return",(this.audioTrack=r,r));case 14:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),t.getElement=function(){return this.element},t.startEchoCancellation=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.context.resume(),this.peerPair&&this.close(),this.initPeers(),t=this.element,e.next=4,this.getTracksFromMediaElement(t);case 4:return n=e.sent,this.peerPair&&this.peerPair[0].addTrack(n),e.next=8,this.switchSdp();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.close=function(){Dk.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((function(e){e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0},e}();XC(IG,"count",0);var AG=window.AudioContext||window.webkitAudioContext,wG=new(RG=Vk({report:Fk}),Wx((CG=function(){function e(){XC(this,"units",[]),XC(this,"context",void 0)}var t=e.prototype;return t.processExternalMediaAEC=function(e){if(!this._doesEnvironmentNeedAEC())return Dk.debug("the system does not need to process local aec"),-1;this.context||(this.context=new AG);var t=this.units.find((function(t){return t&&t.getElement()===e}));return t||(t=new IG(e,this.context),this.units.push(t)),t.startEchoCancellation(),Dk.debug("start processing local audio echo cancellation, id is",t.id),t.id},t._doesEnvironmentNeedAEC=function(){return IA().name!==bA.SAFARI},e}()).prototype,"processExternalMediaAEC",[RG],Object.getOwnPropertyDescriptor(CG.prototype,"processExternalMediaAEC"),CG.prototype),CG);function OG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OG(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var NG=window||document;function DG(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(NG){var n=Zq._cspEventHandlerPointer;if(n&&t)console.error(n,t);else{var r=function(e){if(e&&e.blockedURI&&(Zq.onSecurityPolicyViolation||Zq.getListeners(BM.SECURITY_POLICY_VIOLATION).length>0)){var t=e.blockedURI;rk("CSP_DETECTED_HOSTNAME_LIST").some((function(e){return Br(t).call(t,e)}))&&(Zq.onSecurityPolicyViolation&&"function"==typeof Zq.onSecurityPolicyViolation&&Zq.onSecurityPolicyViolation(e),Zq.getListeners(BM.SECURITY_POLICY_VIOLATION).length>0&&Zq.safeEmit(BM.SECURITY_POLICY_VIOLATION,e))}};n&&NG.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||Zq.getListeners(BM.SECURITY_POLICY_VIOLATION).length>0)&&NG.addEventListener("securitypolicyviolation",r),Zq._cspEventHandlerPointer=r}}}var PG=b,LG=ly,xG=RegExp.prototype,MG=d((function(e){return e===xG||PG(xG,e)?LG(e):e.flags}));function UG(e){for(var t=e.length;--t>=0;)e[t]=0}var VG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),FG=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),BG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GG=new Array(576);UG(GG);var WG=new Array(60);UG(WG);var HG=new Array(512);UG(HG);var KG=new Array(256);UG(KG);var YG=new Array(29);UG(YG);var qG,zG,XG,JG=new Array(30);function QG(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function ZG(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}UG(JG);var $G=function(e){return e<256?HG[e]:HG[256+(e>>>7)]},eW=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},tW=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,eW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},nW=function(e,t,n){tW(e,n[2*t],n[2*t+1])},rW=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},iW=function(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)o=o+n[r-1]<<1,a[r]=o;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=rW(a[s]++,s))}},aW=function(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},oW=function(e){e.bi_valid>8?eW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},sW=function(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},cW=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&sW(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!sW(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},uW=function(e,t,n){var r,i,a,o,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?nW(e,i,t):(a=KG[i],nW(e,a+256+1,t),0!==(o=VG[a])&&(i-=YG[a],tW(e,i,o)),r--,a=$G(r),nW(e,a,n),0!==(o=FG[a])&&(r-=JG[a],tW(e,r,o)))}while(s<e.sym_next);nW(e,256,t)},dW=function(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)cW(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],cW(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,cW(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,c=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,p=t.stat_desc.has_stree,l=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,_=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=c[2*c[2*(r=e.heap[n])+1]+1]+1)>f&&(a=f,_++),c[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=h&&(o=l[r-h]),s=c[2*r],e.opt_len+=s*(a+o),p&&(e.static_len+=s*(d[2*r+1]+o)));if(0!==_){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,_-=2}while(_>0);for(a=f;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}}(e,t),iW(a,u,e.bl_count)},pW=function(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))},lW=function(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<u)do{nW(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(nW(e,i,e.bl_tree),s--),nW(e,16,e.bl_tree),tW(e,s-3,2)):s<=10?(nW(e,17,e.bl_tree),tW(e,s-3,3)):(nW(e,18,e.bl_tree),tW(e,s-11,7));s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}},hW=!1,fW=function(e,t,n,r){tW(e,0+(r?1:0),3),oW(e),eW(e,n),eW(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},_W=function(e){hW||(function(){var e,t,n,r,i,a=new Array(16);for(n=0,r=0;r<28;r++)for(YG[r]=n,e=0;e<1<<VG[r];e++)KG[n++]=r;for(KG[n-1]=r,i=0,r=0;r<16;r++)for(JG[r]=i,e=0;e<1<<FG[r];e++)HG[i++]=r;for(i>>=7;r<30;r++)for(JG[r]=i<<7,e=0;e<1<<FG[r]-7;e++)HG[256+i++]=r;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)GG[2*e+1]=8,e++,a[8]++;for(;e<=255;)GG[2*e+1]=9,e++,a[9]++;for(;e<=279;)GG[2*e+1]=7,e++,a[7]++;for(;e<=287;)GG[2*e+1]=8,e++,a[8]++;for(iW(GG,287,a),e=0;e<30;e++)WG[2*e+1]=5,WG[2*e]=rW(e,5);qG=new QG(GG,VG,257,286,15),zG=new QG(WG,FG,0,30,15),XG=new QG(new Array(0),BG,0,19,7)}(),hW=!0),e.l_desc=new ZG(e.dyn_ltree,qG),e.d_desc=new ZG(e.dyn_dtree,zG),e.bl_desc=new ZG(e.bl_tree,XG),e.bi_buf=0,e.bi_valid=0,aW(e)},vW=fW,EW=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),dW(e,e.l_desc),dW(e,e.d_desc),o=function(e){var t;for(pW(e,e.dyn_ltree,e.l_desc.max_code),pW(e,e.dyn_dtree,e.d_desc.max_code),dW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*jG[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?fW(e,t,n,r):4===e.strategy||a===i?(tW(e,2+(r?1:0),3),uW(e,GG,WG)):(tW(e,4+(r?1:0),3),function(e,t,n,r){var i;for(tW(e,t-257,5),tW(e,n-1,5),tW(e,r-4,4),i=0;i<r;i++)tW(e,e.bl_tree[2*jG[i]+1],3);lW(e,e.dyn_ltree,t-1),lW(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),uW(e,e.dyn_ltree,e.dyn_dtree)),aW(e),r&&oW(e)},mW=function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(KG[n]+256+1)]++,e.dyn_dtree[2*$G(t)]++),e.sym_next===e.sym_end},SW=function(e){tW(e,2,3),nW(e,256,GG),function(e){16===e.bi_valid?(eW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},gW=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0},TW=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),bW=function(e,t,n,r){var i=TW,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},RW={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},CW={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},yW=_W,IW=vW,AW=EW,wW=mW,OW=SW,kW=CW.Z_NO_FLUSH,NW=CW.Z_PARTIAL_FLUSH,DW=CW.Z_FULL_FLUSH,PW=CW.Z_FINISH,LW=CW.Z_BLOCK,xW=CW.Z_OK,MW=CW.Z_STREAM_END,UW=CW.Z_STREAM_ERROR,VW=CW.Z_DATA_ERROR,FW=CW.Z_BUF_ERROR,BW=CW.Z_DEFAULT_COMPRESSION,jW=CW.Z_FILTERED,GW=CW.Z_HUFFMAN_ONLY,WW=CW.Z_RLE,HW=CW.Z_FIXED,KW=CW.Z_UNKNOWN,YW=CW.Z_DEFLATED,qW=258,zW=262,XW=42,JW=113,QW=666,ZW=function(e,t){return e.msg=RW[t],t},$W=function(e){return 2*e-(e>4?9:0)},eH=function(e){for(var t=e.length;--t>=0;)e[t]=0},tH=function(e){var t,n,r,i=e.w_size;r=t=e.hash_size;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);r=t=i;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},nH=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},rH=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},iH=function(e,t){AW(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,rH(e.strm)},aH=function(e,t){e.pending_buf[e.pending++]=t},oH=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},sH=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=gW(e.adler,t,i,n):2===e.state.wrap&&(e.adler=bW(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},cH=function(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-zW?e.strstart-(e.w_size-zW):0,u=e.window,d=e.w_mask,p=e.prev,l=e.strstart+qW,h=u[a+o-1],f=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===f&&u[n+o-1]===h&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<l);if(r=qW-(l-a),a=l-qW,r>o){if(e.match_start=t,o=r,r>=s)break;h=u[a+o-1],f=u[a+o]}}}while((t=p[t&d])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead},uH=function(e){var t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-zW)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),tH(e),n+=i),0===e.strm.avail_in)break;if(t=sH(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=nH(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=nH(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<zW&&0!==e.strm.avail_in)},dH=function(e,t){var n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n>(r=e.strstart-e.block_start)+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==PW||t===kW||n!==r+e.strm.avail_in))break;o=t===PW&&n===r+e.strm.avail_in?1:0,IW(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,rH(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(sH(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return(s-=e.strm.avail_in)&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==kW&&t!==PW&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(sH(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,a=(i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=a||(r||t===PW)&&t!==kW&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=t===PW&&0===e.strm.avail_in&&n===r?1:0,IW(e,e.block_start,n,o),e.block_start+=n,rH(e.strm)),o?3:1)},pH=function(e,t){for(var n,r;;){if(e.lookahead<zW){if(uH(e),e.lookahead<zW&&t===kW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=nH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-zW&&(e.match_length=cH(e,n)),e.match_length>=3)if(r=wW(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=nH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=nH(e,e.ins_h,e.window[e.strstart+1]);else r=wW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(iH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===PW?(iH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(iH(e,!1),0===e.strm.avail_out)?1:2},lH=function(e,t){for(var n,r,i;;){if(e.lookahead<zW){if(uH(e),e.lookahead<zW&&t===kW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=nH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-zW&&(e.match_length=cH(e,n),e.match_length<=5&&(e.strategy===jW||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=wW(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=nH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(iH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=wW(e,0,e.window[e.strstart-1]))&&iH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=wW(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===PW?(iH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(iH(e,!1),0===e.strm.avail_out)?1:2};function hH(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var fH=[new hH(0,0,0,0,dH),new hH(4,4,8,4,pH),new hH(4,5,16,8,pH),new hH(4,6,32,32,pH),new hH(4,4,16,16,lH),new hH(8,16,32,32,lH),new hH(8,16,128,128,lH),new hH(8,32,128,256,lH),new hH(32,128,258,1024,lH),new hH(32,258,258,4096,lH)];function _H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=YW,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),eH(this.dyn_ltree),eH(this.dyn_dtree),eH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),eH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),eH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var vH=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.status!==XW&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==JW&&t.status!==QW?1:0},EH=function(e){if(vH(e))return ZW(e,UW);e.total_in=e.total_out=0,e.data_type=KW;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?XW:JW,e.adler=2===t.wrap?0:1,t.last_flush=-2,yW(t),xW},mH=function(e){var t=EH(e);return t===xW&&function(e){e.window_size=2*e.w_size,eH(e.head),e.max_lazy_match=fH[e.level].max_lazy,e.good_match=fH[e.level].good_length,e.nice_match=fH[e.level].nice_length,e.max_chain_length=fH[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t},SH=function(e,t,n,r,i,a){if(!e)return UW;var o=1;if(t===BW&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==YW||r<8||r>15||t<0||t>9||a<0||a>HW||8===r&&1!==o)return ZW(e,UW);8===r&&(r=9);var s=new _H;return e.state=s,s.strm=e,s.status=XW,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=a,s.method=n,mH(e)},gH=SH,TH=function(e,t){return vH(e)||2!==e.state.wrap?UW:(e.state.gzhead=t,xW)},bH=function(e,t){if(vH(e)||t>LW||t<0)return e?ZW(e,UW):UW;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===QW&&t!==PW)return ZW(e,0===e.avail_out?FW:UW);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(rH(e),0===e.avail_out)return n.last_flush=-1,xW}else if(0===e.avail_in&&$W(t)<=$W(r)&&t!==PW)return ZW(e,FW);if(n.status===QW&&0!==e.avail_in)return ZW(e,FW);if(n.status===XW&&0===n.wrap&&(n.status=JW),n.status===XW){var i=YW+(n.w_bits-8<<4)<<8;if(i|=(n.strategy>=GW||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(i|=32),oH(n,i+=31-i%31),0!==n.strstart&&(oH(n,e.adler>>>16),oH(n,65535&e.adler)),e.adler=1,n.status=JW,rH(e),0!==n.pending)return n.last_flush=-1,xW}if(57===n.status)if(e.adler=0,aH(n,31),aH(n,139),aH(n,8),n.gzhead)aH(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),aH(n,255&n.gzhead.time),aH(n,n.gzhead.time>>8&255),aH(n,n.gzhead.time>>16&255),aH(n,n.gzhead.time>>24&255),aH(n,9===n.level?2:n.strategy>=GW||n.level<2?4:0),aH(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(aH(n,255&n.gzhead.extra.length),aH(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=bW(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(aH(n,0),aH(n,0),aH(n,0),aH(n,0),aH(n,0),aH(n,9===n.level?2:n.strategy>=GW||n.level<2?4:0),aH(n,3),n.status=JW,rH(e),0!==n.pending)return n.last_flush=-1,xW;if(69===n.status){if(n.gzhead.extra){for(var a=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+o>n.pending_buf_size;){var s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=bW(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=s,rH(e),0!==n.pending)return n.last_flush=-1,xW;a=0,o-=s}var c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>a&&(e.adler=bW(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var u,d=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>d&&(e.adler=bW(e.adler,n.pending_buf,n.pending-d,d)),rH(e),0!==n.pending)return n.last_flush=-1,xW;d=0}u=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,aH(n,u)}while(0!==u);n.gzhead.hcrc&&n.pending>d&&(e.adler=bW(e.adler,n.pending_buf,n.pending-d,d)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var p,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=bW(e.adler,n.pending_buf,n.pending-l,l)),rH(e),0!==n.pending)return n.last_flush=-1,xW;l=0}p=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,aH(n,p)}while(0!==p);n.gzhead.hcrc&&n.pending>l&&(e.adler=bW(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(rH(e),0!==n.pending))return n.last_flush=-1,xW;aH(n,255&e.adler),aH(n,e.adler>>8&255),e.adler=0}if(n.status=JW,rH(e),0!==n.pending)return n.last_flush=-1,xW}if(0!==e.avail_in||0!==n.lookahead||t!==kW&&n.status!==QW){var h=0===n.level?dH(n,t):n.strategy===GW?function(e,t){for(var n;;){if(0===e.lookahead&&(uH(e),0===e.lookahead)){if(t===kW)return 1;break}if(e.match_length=0,n=wW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(iH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===PW?(iH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(iH(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===WW?function(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=qW){if(uH(e),e.lookahead<=qW&&t===kW)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+qW;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=qW-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=wW(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=wW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(iH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===PW?(iH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(iH(e,!1),0===e.strm.avail_out)?1:2}(n,t):fH[n.level].func(n,t);if(3!==h&&4!==h||(n.status=QW),1===h||3===h)return 0===e.avail_out&&(n.last_flush=-1),xW;if(2===h&&(t===NW?OW(n):t!==LW&&(IW(n,0,0,!1),t===DW&&(eH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rH(e),0===e.avail_out))return n.last_flush=-1,xW}return t!==PW?xW:n.wrap<=0?MW:(2===n.wrap?(aH(n,255&e.adler),aH(n,e.adler>>8&255),aH(n,e.adler>>16&255),aH(n,e.adler>>24&255),aH(n,255&e.total_in),aH(n,e.total_in>>8&255),aH(n,e.total_in>>16&255),aH(n,e.total_in>>24&255)):(oH(n,e.adler>>>16),oH(n,65535&e.adler)),rH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?xW:MW)},RH=function(e){if(vH(e))return UW;var t=e.state.status;return e.state=null,t===JW?ZW(e,VW):xW},CH=function(e,t){var n=t.length;if(vH(e))return UW;var r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==XW||r.lookahead)return UW;if(1===i&&(e.adler=gW(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(eH(r.head),r.strstart=0,r.block_start=0,r.insert=0);var a=new Uint8Array(r.w_size);a.set(t.subarray(n-r.w_size,n),0),t=a,n=r.w_size}var o=e.avail_in,s=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,uH(r);r.lookahead>=3;){var u=r.strstart,d=r.lookahead-2;do{r.ins_h=nH(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++}while(--d);r.strstart=u,r.lookahead=2,uH(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=o,r.wrap=i,xW},yH=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},IH=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)yH(n,r)&&(e[r]=n[r])}}return e},AH=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),a=0,o=0,s=e.length;a<s;a++){var c=e[a];i.set(c,o),o+=c.length}return i},wH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){wH=!1}for(var OH=new Uint8Array(256),kH=0;kH<256;kH++)OH[kH]=kH>=252?6:kH>=248?5:kH>=240?4:kH>=224?3:kH>=192?2:1;OH[254]=OH[254]=1;var NH=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},DH=function(e,t){var n,r,i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(r=0,n=0;n<i;){var o=e[n++];if(o<128)a[r++]=o;else{var s=OH[o];if(s>4)a[r++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<i;)o=o<<6|63&e[n++],s--;s>1?a[r++]=65533:o<65536?a[r++]=o:(o-=65536,a[r++]=55296|o>>10&1023,a[r++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&wH)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(a,r)},PH=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+OH[e[n]]>t?n:t},LH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},xH=Object.prototype.toString,MH=CW.Z_NO_FLUSH,UH=CW.Z_SYNC_FLUSH,VH=CW.Z_FULL_FLUSH,FH=CW.Z_FINISH,BH=CW.Z_OK,jH=CW.Z_STREAM_END,GH=CW.Z_DEFAULT_COMPRESSION,WH=CW.Z_DEFAULT_STRATEGY,HH=CW.Z_DEFLATED;function KH(e){this.options=IH({level:GH,method:HH,chunkSize:16384,windowBits:15,memLevel:8,strategy:WH},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LH,this.strm.avail_out=0;var n=gH(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==BH)throw new Error(RW[n]);if(t.header&&TH(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?NH(t.dictionary):"[object ArrayBuffer]"===xH.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=CH(this.strm,r))!==BH)throw new Error(RW[n]);this._dict_set=!0}}function YH(e,t){var n=new KH(t);if(n.push(e,!0),n.err)throw n.msg||RW[n.err];return n.result}KH.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?FH:MH,"string"==typeof e?i.input=NH(e):"[object ArrayBuffer]"===xH.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===UH||r===VH)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((n=bH(i,r))===jH)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=RH(this.strm),this.onEnd(n),this.ended=!0,n===BH;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},KH.prototype.onData=function(e){this.chunks.push(e)},KH.prototype.onEnd=function(e){e===BH&&(this.result=AH(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qH=YH,zH=16209,XH=function(e,t){var n,r,i,a,o,s,c,u,d,p,l,h,f,_,v,E,m,S,g,T,b,R,C,y,I=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),i=e.next_out,y=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=I.dmax,c=I.wsize,u=I.whave,d=I.wnext,p=I.window,l=I.hold,h=I.bits,f=I.lencode,_=I.distcode,v=(1<<I.lenbits)-1,E=(1<<I.distbits)-1;e:do{h<15&&(l+=C[n++]<<h,h+=8,l+=C[n++]<<h,h+=8),m=f[l&v];t:for(;;){if(l>>>=S=m>>>24,h-=S,0==(S=m>>>16&255))y[i++]=65535&m;else{if(!(16&S)){if(0==(64&S)){m=f[(65535&m)+(l&(1<<S)-1)];continue t}if(32&S){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=zH;break e}g=65535&m,(S&=15)&&(h<S&&(l+=C[n++]<<h,h+=8),g+=l&(1<<S)-1,l>>>=S,h-=S),h<15&&(l+=C[n++]<<h,h+=8,l+=C[n++]<<h,h+=8),m=_[l&E];n:for(;;){if(l>>>=S=m>>>24,h-=S,!(16&(S=m>>>16&255))){if(0==(64&S)){m=_[(65535&m)+(l&(1<<S)-1)];continue n}e.msg="invalid distance code",I.mode=zH;break e}if(T=65535&m,h<(S&=15)&&(l+=C[n++]<<h,(h+=8)<S&&(l+=C[n++]<<h,h+=8)),(T+=l&(1<<S)-1)>s){e.msg="invalid distance too far back",I.mode=zH;break e}if(l>>>=S,h-=S,T>(S=i-a)){if((S=T-S)>u&&I.sane){e.msg="invalid distance too far back",I.mode=zH;break e}if(b=0,R=p,0===d){if(b+=c-S,S<g){g-=S;do{y[i++]=p[b++]}while(--S);b=i-T,R=y}}else if(d<S){if(b+=c+d-S,(S-=d)<g){g-=S;do{y[i++]=p[b++]}while(--S);if(b=0,d<g){g-=S=d;do{y[i++]=p[b++]}while(--S);b=i-T,R=y}}}else if(b+=d-S,S<g){g-=S;do{y[i++]=p[b++]}while(--S);b=i-T,R=y}for(;g>2;)y[i++]=R[b++],y[i++]=R[b++],y[i++]=R[b++],g-=3;g&&(y[i++]=R[b++],g>1&&(y[i++]=R[b++]))}else{b=i-T;do{y[i++]=y[b++],y[i++]=y[b++],y[i++]=y[b++],g-=3}while(g>2);g&&(y[i++]=y[b++],g>1&&(y[i++]=y[b++]))}break}}break}}while(n<r&&i<o);n-=g=h>>3,l&=(1<<(h-=g<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),I.hold=l,I.bits=h},JH=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),QH=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ZH=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$H=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),eK=function(e,t,n,r,i,a,o,s){var c,u,d,p,l,h,f,_,v,E=s.bits,m=0,S=0,g=0,T=0,b=0,R=0,C=0,y=0,I=0,A=0,w=null,O=new Uint16Array(16),k=new Uint16Array(16),N=null;for(m=0;m<=15;m++)O[m]=0;for(S=0;S<r;S++)O[t[n+S]]++;for(b=E,T=15;T>=1&&0===O[T];T--);if(b>T&&(b=T),0===T)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(g=1;g<T&&0===O[g];g++);for(b<g&&(b=g),y=1,m=1;m<=15;m++)if(y<<=1,(y-=O[m])<0)return-1;if(y>0&&(0===e||1!==T))return-1;for(k[1]=0,m=1;m<15;m++)k[m+1]=k[m]+O[m];for(S=0;S<r;S++)0!==t[n+S]&&(o[k[t[n+S]]++]=S);if(0===e?(w=N=o,h=20):1===e?(w=JH,N=QH,h=257):(w=ZH,N=$H,h=0),A=0,S=0,m=g,l=a,R=b,C=0,d=-1,p=(I=1<<b)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){f=m-C,o[S]+1<h?(_=0,v=o[S]):o[S]>=h?(_=N[o[S]-h],v=w[o[S]-h]):(_=96,v=0),c=1<<m-C,g=u=1<<R;do{i[l+(A>>C)+(u-=c)]=f<<24|_<<16|v|0}while(0!==u);for(c=1<<m-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,S++,0==--O[m]){if(m===T)break;m=t[n+o[S]]}if(m>b&&(A&p)!==d){for(0===C&&(C=b),l+=g,y=1<<(R=m-C);R+C<T&&!((y-=O[R+C])<=0);)R++,y<<=1;if(I+=1<<R,1===e&&I>852||2===e&&I>592)return 1;i[d=A&p]=b<<24|R<<16|l-a|0}}return 0!==A&&(i[l+A]=m-C<<24|64<<16|0),s.bits=b,0},tK=CW.Z_FINISH,nK=CW.Z_BLOCK,rK=CW.Z_TREES,iK=CW.Z_OK,aK=CW.Z_STREAM_END,oK=CW.Z_NEED_DICT,sK=CW.Z_STREAM_ERROR,cK=CW.Z_DATA_ERROR,uK=CW.Z_MEM_ERROR,dK=CW.Z_BUF_ERROR,pK=CW.Z_DEFLATED,lK=16180,hK=16190,fK=16191,_K=16192,vK=16194,EK=16199,mK=16200,SK=16206,gK=16209,TK=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function bK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var RK,CK,yK=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<lK||t.mode>16211?1:0},IK=function(e){if(yK(e))return sK;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=lK,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,iK},AK=function(e){if(yK(e))return sK;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,IK(e)},wK=function(e,t){var n;if(yK(e))return sK;var r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?sK:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,AK(e))},OK=function(e,t){if(!e)return sK;var n=new bK;e.state=n,n.strm=e,n.window=null,n.mode=lK;var r=wK(e,t);return r!==iK&&(e.state=null),r},kK=!0,NK=function(e){if(kK){RK=new Int32Array(512),CK=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(eK(1,e.lens,0,288,RK,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;eK(2,e.lens,0,32,CK,0,e.work,{bits:5}),kK=!1}e.lencode=RK,e.lenbits=9,e.distcode=CK,e.distbits=5},DK=function(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},PK=AK,LK=OK,xK=function(e,t){var n,r,i,a,o,s,c,u,d,p,l,h,f,_,v,E,m,S,g,T,b,R,C,y,I=0,A=new Uint8Array(4),w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yK(e)||!e.output||!e.input&&0!==e.avail_in)return sK;(n=e.state).mode===fK&&(n.mode=_K),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,d=n.bits,p=s,l=c,R=iK;e:for(;;)switch(n.mode){case lK:if(0===n.wrap){n.mode=_K;break}for(;d<16;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,A[0]=255&u,A[1]=u>>>8&255,n.check=bW(n.check,A,2,0),u=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=gK;break}if((15&u)!==pK){e.msg="unknown compression method",n.mode=gK;break}if(d-=4,b=8+(15&(u>>>=4)),0===n.wbits&&(n.wbits=b),b>15||b>n.wbits){e.msg="invalid window size",n.mode=gK;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:fK,u=0,d=0;break;case 16181:for(;d<16;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(n.flags=u,(255&MG(n))!==pK){e.msg="unknown compression method",n.mode=gK;break}if(57344&MG(n)){e.msg="unknown header flags set",n.mode=gK;break}n.head&&(n.head.text=u>>8&1),512&MG(n)&&4&n.wrap&&(A[0]=255&u,A[1]=u>>>8&255,n.check=bW(n.check,A,2,0)),u=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.head&&(n.head.time=u),512&MG(n)&&4&n.wrap&&(A[0]=255&u,A[1]=u>>>8&255,A[2]=u>>>16&255,A[3]=u>>>24&255,n.check=bW(n.check,A,4,0)),u=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&MG(n)&&4&n.wrap&&(A[0]=255&u,A[1]=u>>>8&255,n.check=bW(n.check,A,2,0)),u=0,d=0,n.mode=16184;case 16184:if(1024&MG(n)){for(;d<16;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.length=u,n.head&&(n.head.extra_len=u),512&MG(n)&&4&n.wrap&&(A[0]=255&u,A[1]=u>>>8&255,n.check=bW(n.check,A,2,0)),u=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&MG(n)&&((h=n.length)>s&&(h=s),h&&(n.head&&(b=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+h),b)),512&MG(n)&&4&n.wrap&&(n.check=bW(n.check,r,h,a)),s-=h,a+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&MG(n)){if(0===s)break e;h=0;do{b=r[a+h++],n.head&&b&&n.length<65536&&(n.head.name+=String.fromCharCode(b))}while(b&&h<s);if(512&MG(n)&&4&n.wrap&&(n.check=bW(n.check,r,h,a)),s-=h,a+=h,b)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&MG(n)){if(0===s)break e;h=0;do{b=r[a+h++],n.head&&b&&n.length<65536&&(n.head.comment+=String.fromCharCode(b))}while(b&&h<s);if(512&MG(n)&&4&n.wrap&&(n.check=bW(n.check,r,h,a)),s-=h,a+=h,b)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&MG(n)){for(;d<16;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=gK;break}u=0,d=0}n.head&&(n.head.hcrc=MG(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=fK;break;case 16189:for(;d<32;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}e.adler=n.check=TK(u),u=0,d=0,n.mode=hK;case hK:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=d,oK;e.adler=n.check=1,n.mode=fK;case fK:if(t===nK||t===rK)break e;case _K:if(n.last){u>>>=7&d,d-=7&d,n.mode=SK;break}for(;d<3;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}switch(n.last=1&u,d-=1,3&(u>>>=1)){case 0:n.mode=16193;break;case 1:if(NK(n),n.mode=EK,t===rK){u>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=gK}u>>>=2,d-=2;break;case 16193:for(u>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=gK;break}if(n.length=65535&u,u=0,d=0,n.mode=vK,t===rK)break e;case vK:n.mode=16195;case 16195:if(h=n.length){if(h>s&&(h=s),h>c&&(h=c),0===h)break e;i.set(r.subarray(a,a+h),o),s-=h,a+=h,c-=h,o+=h,n.length-=h;break}n.mode=fK;break;case 16196:for(;d<14;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(n.nlen=257+(31&u),u>>>=5,d-=5,n.ndist=1+(31&u),u>>>=5,d-=5,n.ncode=4+(15&u),u>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=gK;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.lens[w[n.have++]]=7&u,u>>>=3,d-=3}for(;n.have<19;)n.lens[w[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},R=eK(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,R){e.msg="invalid code lengths set",n.mode=gK;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;E=(I=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&I,!((v=I>>>24)<=d);){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(m<16)u>>>=v,d-=v,n.lens[n.have++]=m;else{if(16===m){for(y=v+2;d<y;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(u>>>=v,d-=v,0===n.have){e.msg="invalid bit length repeat",n.mode=gK;break}b=n.lens[n.have-1],h=3+(3&u),u>>>=2,d-=2}else if(17===m){for(y=v+3;d<y;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}d-=v,b=0,h=3+(7&(u>>>=v)),u>>>=3,d-=3}else{for(y=v+7;d<y;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}d-=v,b=0,h=11+(127&(u>>>=v)),u>>>=7,d-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=gK;break}for(;h--;)n.lens[n.have++]=b}}if(n.mode===gK)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=gK;break}if(n.lenbits=9,C={bits:n.lenbits},R=eK(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,R){e.msg="invalid literal/lengths set",n.mode=gK;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},R=eK(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,R){e.msg="invalid distances set",n.mode=gK;break}if(n.mode=EK,t===rK)break e;case EK:n.mode=mK;case mK:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=d,XH(e,l),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,d=n.bits,n.mode===fK&&(n.back=-1);break}for(n.back=0;E=(I=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&I,!((v=I>>>24)<=d);){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(E&&0==(240&E)){for(S=v,g=E,T=m;E=(I=n.lencode[T+((u&(1<<S+g)-1)>>S)])>>>16&255,m=65535&I,!(S+(v=I>>>24)<=d);){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}u>>>=S,d-=S,n.back+=S}if(u>>>=v,d-=v,n.back+=v,n.length=m,0===E){n.mode=16205;break}if(32&E){n.back=-1,n.mode=fK;break}if(64&E){e.msg="invalid literal/length code",n.mode=gK;break}n.extra=15&E,n.mode=16201;case 16201:if(n.extra){for(y=n.extra;d<y;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;E=(I=n.distcode[u&(1<<n.distbits)-1])>>>16&255,m=65535&I,!((v=I>>>24)<=d);){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(0==(240&E)){for(S=v,g=E,T=m;E=(I=n.distcode[T+((u&(1<<S+g)-1)>>S)])>>>16&255,m=65535&I,!(S+(v=I>>>24)<=d);){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}u>>>=S,d-=S,n.back+=S}if(u>>>=v,d-=v,n.back+=v,64&E){e.msg="invalid distance code",n.mode=gK;break}n.offset=m,n.extra=15&E,n.mode=16203;case 16203:if(n.extra){for(y=n.extra;d<y;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=gK;break}n.mode=16204;case 16204:if(0===c)break e;if(h=l-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=gK;break}h>n.wnext?(h-=n.wnext,f=n.wsize-h):f=n.wnext-h,h>n.length&&(h=n.length),_=n.window}else _=i,f=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{i[o++]=_[f++]}while(--h);0===n.length&&(n.mode=mK);break;case 16205:if(0===c)break e;i[o++]=n.length,c--,n.mode=mK;break;case SK:if(n.wrap){for(;d<32;){if(0===s)break e;s--,u|=r[a++]<<d,d+=8}if(l-=c,e.total_out+=l,n.total+=l,4&n.wrap&&l&&(e.adler=n.check=MG(n)?bW(n.check,i,l,o-l):gW(n.check,i,l,o-l)),l=c,4&n.wrap&&(MG(n)?u:TK(u))!==n.check){e.msg="incorrect data check",n.mode=gK;break}u=0,d=0}n.mode=16207;case 16207:if(n.wrap&&MG(n)){for(;d<32;){if(0===s)break e;s--,u+=r[a++]<<d,d+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=gK;break}u=0,d=0}n.mode=16208;case 16208:R=aK;break e;case gK:R=cK;break e;case 16210:return uK;default:return sK}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=d,(n.wsize||l!==e.avail_out&&n.mode<gK&&(n.mode<SK||t!==tK))&&DK(e,e.output,e.next_out,l-e.avail_out),p-=e.avail_in,l-=e.avail_out,e.total_in+=p,e.total_out+=l,n.total+=l,4&n.wrap&&l&&(e.adler=n.check=MG(n)?bW(n.check,i,l,e.next_out-l):gW(n.check,i,l,e.next_out-l)),e.data_type=n.bits+(n.last?64:0)+(n.mode===fK?128:0)+(n.mode===EK||n.mode===vK?256:0),(0===p&&0===l||t===tK)&&R===iK&&(R=dK),R},MK=function(e){if(yK(e))return sK;var t=e.state;return t.window&&(t.window=null),e.state=null,iK},UK=function(e,t){if(yK(e))return sK;var n=e.state;return 0==(2&n.wrap)?sK:(n.head=t,t.done=!1,iK)},VK=function(e,t){var n,r=t.length;return yK(e)||0!==(n=e.state).wrap&&n.mode!==hK?sK:n.mode===hK&&gW(1,t,r,0)!==n.check?cK:DK(e,t,r,r)?(n.mode=16210,uK):(n.havedict=1,iK)},FK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},BK=Object.prototype.toString,jK=CW.Z_NO_FLUSH,GK=CW.Z_FINISH,WK=CW.Z_OK,HK=CW.Z_STREAM_END,KK=CW.Z_NEED_DICT,YK=CW.Z_STREAM_ERROR,qK=CW.Z_DATA_ERROR,zK=CW.Z_MEM_ERROR;function XK(e){this.options=IH({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LH,this.strm.avail_out=0;var n=LK(this.strm,t.windowBits);if(n!==WK)throw new Error(RW[n]);if(this.header=new FK,UK(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=NH(t.dictionary):"[object ArrayBuffer]"===BK.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=VK(this.strm,t.dictionary))!==WK))throw new Error(RW[n])}function JK(e,t){var n=new XK(t);if(n.push(e),n.err)throw n.msg||RW[n.err];return n.result}XK.prototype.push=function(e,t){var n,r,i,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?GK:jK,"[object ArrayBuffer]"===BK.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(n=xK(a,r))===KK&&s&&((n=VK(a,s))===WK?n=xK(a,r):n===qK&&(n=KK));a.avail_in>0&&n===HK&&a.state.wrap>0&&0!==e[a.next_in];)PK(a),n=xK(a,r);switch(n){case YK:case qK:case KK:case zK:return this.onEnd(n),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||n===HK))if("string"===this.options.to){var c=PH(a.output,a.next_out),u=a.next_out-c,d=DH(a.output,c);a.next_out=u,a.avail_out=o-u,u&&a.output.set(a.output.subarray(c,c+u),0),this.onData(d)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==WK||0!==i){if(n===HK)return n=MK(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},XK.prototype.onData=function(e){this.chunks.push(e)},XK.prototype.onEnd=function(e){e===WK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=AH(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var QK=qH,ZK=JK,$K=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}($K||{}),eY=function(){function e(){XC(this,"_sequence",0),XC(this,"_startTime",Date.now()),XC(this,"isUseOneByte",!0)}var t=e.prototype;return t.serialize=function(e){var t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){var n=new Uint8Array(4);n.set([1,0,0,0]);var r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;rk("SHOW_DATASTREAM2_LOG")&&Dk.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));var a=new ArrayBuffer(t.commonPacketHeader.length),o=new Uint8Array(a),s=new DataView(a),c=0;if(s.setUint16(c,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),c+=2,s.setUint32(c,t.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,t.commonStreamHeader,!0),c+=2,t.extension){var u=this.serializeExtension(t.extension);o.set(new Uint8Array(u),c),c+=u.byteLength}if(o.set(new Uint8Array(t.payload),c),(c+=t.payload.byteLength)!==t.commonPacketHeader.length)throw Error("serialize error!");return a},t.deserialize=function(e){if(e.byteLength<4)return new ArrayBuffer(0);var t=new DataView(e),n=0,r=t.getUint16(n,!0);n+=2;var i,a,o={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};if(n+=4,rk("SHOW_DATASTREAM2_LOG")&&Dk.debug("receive data header: ".concat(JSON.stringify(o))),t.getUint16(n,!0),n+=2,o.extension){n+=2+(a=this.deserializeExtension(e.slice(n))).length,i=e.slice(n);var s=!1;if(a.datas.length>0){var c=a.datas.find((function(e){return 0===e.id}));c&&(s=1==(1&new DataView(c.data).getUint32(0,!0)))}i=s?this.decompress(i):i}else i=e.slice(8);return i},t.serializeExtension=function(e){var t=e.profile,n=e.length,r=e.datas,i=new ArrayBuffer(n+2),a=new Uint8Array(i),o=new DataView(i),s=0;if(o.setUint8(s++,t),o.setUint8(s++,n),r.forEach((function(e){t?(o.setUint8(s++,e.id),o.setUint8(s++,e.length),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(o.setUint8(s++,e.id|e.length<<4),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i},t.deserializeExtension=function(e){var t=new DataView(e),n=0,r=t.getUint8(n);n++;var i=t.getUint8(n);n++;for(var a=r===$K.TWO_BYTE,o=[],s=new DataView(e,2),c=0;c<i;){var u=0,d=0,p=new ArrayBuffer(0);a?(u=s.getUint8(c),c++,d=s.getUint8(c),c++):(u=15&s.getUint8(c),d=s.getUint8(c)>>4,c++),d>0&&(c+=(p=s.buffer.slice(c+2,c+2+d)).byteLength),o.push({id:u,length:d,data:p})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:o}},t.decompress=function(e){return ZK(new Uint8Array(e))},t.compress=function(e){return QK(new Uint8Array(e))},v(e,[{key:"startTime",get:function(){var e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}},{key:"sequence",get:function(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}}]),e}(),tY={name:"DataStream",create:function(e,t){var n=t?new IL(e):new AL(e);return n.useDataStream(new eY),n}},nY=function(e){function t(t,n,i){var a;return XC(r(a=e.call(this)||this),"ws",void 0),XC(r(a),"requestId",1),XC(r(a),"heartBeatTimer",void 0),XC(r(a),"joinInfo",void 0),XC(r(a),"clientId",void 0),XC(r(a),"onOpen",(function(){a.emit("open"),a.startHeartBeatCheck()})),XC(r(a),"onClose",(function(e){a.emit("close"),a.dispose()})),XC(r(a),"onMessage",(function(e){var t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(a.emit("status",t.serverStatus),void a.emit(t.serverStatus.command,t.serverStatus)):void 0;a.emit("req_".concat(t.requestId),t)})),a.joinInfo=t,a.clientId=n,a.ws=new dU("cross-channel-".concat(a.clientId),i),a.ws.on(tM.RECONNECTING,(function(){a.ws.reconnectMode="retry",a.emit("reconnecting")})),a.ws.on(tM.CONNECTED,a.onOpen),a.ws.on(tM.ON_MESSAGE,a.onMessage),a.ws.on(tM.CLOSED,a.onClose),a}i(t,e);var n=t.prototype;return n.isConnect=function(){return"connected"===this.ws.state},n.sendMessage=function(e){var t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t},n.waitStatus=function(e){var t=this;return new zl((function(n,r){var i=window.setTimeout((function(){r(new Bk(iw.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);t.once(e,(function(t){window.clearTimeout(i),t.state&&0!==t.state?r(new Bk(iw.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)})),t.once("dispose",(function(){window.clearTimeout(i),r(new Bk(iw.WS_ABORT))}))}))},n.request=function(){var e=p(l().mark((function e(t){var n,r,i,a,o=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("closed"!==this.ws.state){e.next=2;break}throw new Bk(iw.WS_DISCONNECT);case 2:if(n=function(){return new zl((function(e,t){o.ws.once(tM.CLOSED,(function(){return t(new Bk(iw.WS_ABORT))})),o.ws.once(tM.CONNECTED,e)}))},e.t0="connected"!==this.ws.state,!e.t0){e.next=7;break}return e.next=7,n();case 7:return r=this.sendMessage(t),i=new zl((function(e,t){var n=function(){t(new Bk(iw.WS_ABORT))};o.ws.once(tM.RECONNECTING,n),o.ws.once(tM.CLOSED,n),o.once("req_".concat(r),e),eO(3e3).then((function(){o.removeAllListeners("req_".concat(r)),o.ws.off(tM.RECONNECTING,n),o.ws.off(tM.CLOSED,n),t(new Bk(iw.TIMEOUT,"cross channel ws request timeout"))}))})),e.next=11,i;case 11:if((a=e.sent)&&200===a.code){e.next=14;break}throw new Bk(iw.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ws.removeAllListeners(tM.REQUEST_NEW_URLS),this.ws.on(tM.REQUEST_NEW_URLS,(function(e){e(t)})),e.next=4,this.ws.init(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.dispose=function(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()},n.sendPing=function(e){var t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t},n.startHeartBeatCheck=function(){var e=this;this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((function(){e.sendPing({command:"ping",appId:e.joinInfo.appId,cname:e.joinInfo.cname,uid:e.joinInfo.uid.toString(),sid:e.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)},n.clearHeartBeatCheck=function(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0},t}(gw),rY=function(e){function t(t,n,i,a,o){var s;return XC(r(s=e.call(this)||this),"joinInfo",void 0),XC(r(s),"sid",void 0),XC(r(s),"clientId",void 0),XC(r(s),"cancelToken",_A.CancelToken.source()),XC(r(s),"workerToken",void 0),XC(r(s),"requestId",0),XC(r(s),"signal",void 0),XC(r(s),"prevChannelMediaConfig",void 0),XC(r(s),"httpRetryConfig",void 0),XC(r(s),"_resolution",void 0),XC(r(s),"_state",_M.RELAY_STATE_IDLE),XC(r(s),"errorCode",vM.RELAY_OK),XC(r(s),"onStatus",(function(e){Dk.debug("[".concat(s.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&s.emit("event",fM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&s.emit("event",fM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(s.errorCode=vM.SRC_TOKEN_EXPIRED,s.state=_M.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(s.errorCode=vM.DEST_TOKEN_EXPIRED,s.state=_M.RELAY_STATE_FAILURE))})),XC(r(s),"onReconnect",p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Dk.debug("[".concat(s.clientId,"] ChannelMediaSocket disconnect, reconnecting")),s.emit("event",fM.NETWORK_DISCONNECTED),s.state=_M.RELAY_STATE_IDLE,s.prevChannelMediaConfig&&s.sendStartRelayMessage(s.prevChannelMediaConfig).catch((function(e){s.state!==_M.RELAY_STATE_IDLE&&(Dk.error("auto restart channel media relay failed",e.toString()),s.errorCode=vM.SERVER_CONNECTION_LOST,s.state=_M.RELAY_STATE_FAILURE)}));case 1:case"end":return e.stop()}}),e)})))),s.joinInfo=t,s.clientId=n,s.sid=nO(),s.signal=new nY(s.joinInfo,s.clientId,i),s.httpRetryConfig=a,s._resolution=o,s}i(t,e);var n=t.prototype;return n.startChannelMediaRelay=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===_M.RELAY_STATE_IDLE){e.next=2;break}throw new Bk(iw.INVALID_OPERATION);case 2:return this.state=_M.RELAY_STATE_CONNECTING,e.next=5,this.connect();case 5:return Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success")),e.prev=6,e.next=9,this.sendStartRelayMessage(t);case 9:e.next=20;break;case 11:if(e.prev=11,e.t0=e.catch(6),!e.t0.data||!e.t0.data.serverResponse||"SetSourceChannel"!==e.t0.data.serverResponse.command){e.next=15;break}throw new Bk(iw.CROSS_CHANNEL_FAILED_JOIN_SRC);case 15:if(!e.t0.data||!e.t0.data.serverResponse||"SetDestChannelStatus"!==e.t0.serverResponse.command){e.next=17;break}throw new Bk(iw.CROSS_CHANNEL_FAILED_JOIN_DEST);case 17:if(!e.t0.data||!e.t0.data.serverResponse||"StartPacketTransfer"!==e.t0.serverResponse.command){e.next=19;break}throw new Bk(iw.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);case 19:throw e.t0;case 20:this.prevChannelMediaConfig=t;case 21:case"end":return e.stop()}}),e,this,[[6,11]])})));return function(t){return e.apply(this,arguments)}}(),n.updateChannelMediaRelay=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===_M.RELAY_STATE_RUNNING){e.next=2;break}throw new Bk(iw.INVALID_OPERATION);case 2:return e.next=4,this.sendUpdateMessage(t);case 4:this.prevChannelMediaConfig=t;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setVideoProfile=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resolution=t,this.state===_M.RELAY_STATE_RUNNING){e.next=2;break}throw new Bk(iw.INVALID_OPERATION);case 2:return n=this.genMessage(hM.SetVideoProfile),e.next=5,this.signal.request(n);case 5:Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.stopChannelMediaRelay=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendStopRelayMessage();case 2:Dk.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=_M.RELAY_STATE_IDLE,this.dispose();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.dispose=function(){Dk.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=_A.CancelToken.source(),this.state=_M.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0},n.connect=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rF(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);case 2:return t=e.sent,this.workerToken=t.workerToken,e.next=6,this.signal.connect(t.addressList);case 6:this.emit("event",fM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.sendStartRelayMessage=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(hM.StopPacketTransfer),e.next=3,this.signal.request(n);case 3:return e.next=5,this.signal.waitStatus("Normal Quit");case 5:return Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),r=this.genMessage(hM.SetSdkProfile,t),e.next=9,this.signal.request(r);case 9:return Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),i=this.genMessage(hM.SetSourceChannel,t),e.next=13,this.signal.request(i);case 13:return e.next=15,this.signal.waitStatus("SetSourceChannelStatus");case 15:return this.emit("event",fM.PACKET_JOINED_SRC_CHANNEL),Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),a=this.genMessage(hM.SetSourceUserId,t),e.next=20,this.signal.request(a);case 20:return Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),o=this.genMessage(hM.SetDestChannel,t),e.next=24,this.signal.request(o);case 24:return e.next=26,this.signal.waitStatus("SetDestChannelStatus");case 26:return this.emit("event",fM.PACKET_JOINED_DEST_CHANNEL),Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),s=this.genMessage(hM.StartPacketTransfer,t),e.next=31,this.signal.request(s);case 31:this.emit("event",fM.PACKET_SENT_TO_DEST_CHANNEL),this.state=_M.RELAY_STATE_RUNNING,Dk.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution);case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.sendUpdateMessage=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(hM.UpdateDestChannel,t),e.next=3,this.signal.request(n);case 3:this.emit("event",fM.PACKET_UPDATE_DEST_CHANNEL),Dk.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.sendStopRelayMessage=function(){var e=p(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.genMessage(hM.StopPacketTransfer),e.next=3,this.signal.request(t);case 3:Dk.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.genMessage=function(e,t){var n=this,r=[],i=[],a=[];this.requestId+=1;var o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:qO,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.23.4"===o.sdkVersion&&(o.sdkVersion="0.0.1");var s=null,c=null;switch(e){case hM.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case hM.SetSourceChannel:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new Bk(iw.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},o;case hM.SetSourceUserId:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new Bk(iw.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:c.uid+""},o;case hM.SetDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new Bk(iw.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),a.push(e.token||n.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:a},o;case hM.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case hM.Reconnect:return o.clientRequest={command:"Reconnect"},o;case hM.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case hM.UpdateDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new Bk(iw.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),a.push(e.token||n.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:a},o;case hM.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o},v(t,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(e!==_M.RELAY_STATE_FAILURE&&(this.errorCode=vM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}}]),t}(gw),iY={name:"ChannelMediaRelay",create:function(e){return new rY(e.joinInfo,e.clientId,e.websocketRetryConfig||vO,e.httpRetryConfig||vO,e.resolution)}};function aY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aY(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sY=function(e){function t(t,n,i,a){var o;return XC(r(o=e.call(this)||this),"spec",void 0),XC(r(o),"token",void 0),XC(r(o),"websocket",void 0),XC(r(o),"pingpongTimer",void 0),XC(r(o),"reconnectMode","retry"),XC(r(o),"serviceMode",void 0),XC(r(o),"reqId",0),XC(r(o),"commandReqId",0),XC(r(o),"handleWebSocketOpen",(function(){o.reconnectMode="retry",o.startPingPong()})),XC(r(o),"handleWebSocketMessage",(function(e){if(e.data){var t=JSON.parse(e.data);t.requestId?o.emit("@".concat(t.requestId,"-").concat(t.sid),t):(Fk.workerEvent(o.spec.sid,{actionType:"status",serverCode:t.code,workerType:o.serviceMode===iM.TRANSCODE?1:2}),o.emit(uM.PUBLISH_STREAM_STATUS,t))}})),o.spec=n,o.token=t,o.serviceMode=a,o.websocket=new dU("live-streaming",i),o.websocket.on(tM.CONNECTED,o.handleWebSocketOpen),o.websocket.on(tM.ON_MESSAGE,o.handleWebSocketMessage),o.websocket.on(tM.REQUEST_NEW_URLS,(function(e,t){xw(r(o),uM.REQUEST_NEW_ADDRESS).then(e).catch(t)})),o.websocket.on(tM.RECONNECTING,(function(){o.websocket.reconnectMode=o.reconnectMode})),o}i(t,e);var n=t.prototype;return n.init=function(e){return this.websocket.init(e)},n.request=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p,h=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reqId+=1,"request"===t&&(this.commandReqId+=1),a=this.commandReqId,(o=this.reqId)&&this.websocket){e.next=4;break}throw new Bk(iw.UNEXPECTED_ERROR);case 4:if(s=oY({command:t,sdkVersion:"4.23.4"===qO?"0.0.1":qO,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n),"closed"!==this.websocket.state){e.next=7;break}throw new Bk(iw.WS_DISCONNECT);case 7:if(c=function(){return new zl((function(e,t){h.websocket.once(tM.CLOSED,(function(){return t(new Bk(iw.WS_ABORT))})),h.websocket.once(tM.CONNECTED,e)}))},e.t0="connected"!==this.websocket.state,!e.t0){e.next=12;break}return e.next=12,c();case 12:return s.clientRequest&&(s.clientRequest.workerToken=this.token),u=new zl((function(e,t){var n=function(){t(new Bk(iw.WS_ABORT))};h.websocket.once(tM.RECONNECTING,n),h.websocket.once(tM.CLOSED,n),h.once("@".concat(o,"-").concat(h.spec.sid),(function(t){e(t)}))})),i&&Fk.workerEvent(this.spec.sid,oY(oY({},i),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0})),d=Date.now(),this.websocket.sendMessage(s),p=null,e.prev=18,e.next=21,u;case 21:p=e.sent,e.next=33;break;case 24:if(e.prev=24,e.t1=e.catch(18),"closed"!==this.websocket.state){e.next=28;break}throw e.t1;case 28:return e.next=30,c();case 30:return e.next=32,this.request(t,n,r);case 32:return e.abrupt("return",e.sent);case 33:return e.abrupt("return",(i&&Fk.workerEvent(this.spec.sid,oY(oY({},i),{},{requestId:a,actionType:"response",payload:JSON.stringify(p.serverResponse),serverCode:p.code,success:200===p.code,responseTime:Date.now()-d})),200!==p.code&&this.handleResponseError(p),p));case 34:case"end":return e.stop()}}),e,this,[[18,24]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},n.close=function(){var e="4.23.4"===qO?"0.0.1":qO;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},n.handleResponseError=function(e){switch(e.code){case pM.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Dk.warning("live stream response already exists stream");case pM.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case pM.LIVE_STREAM_RESPONSE_BAD_STREAM:case pM.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Bk(iw.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case pM.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case pM.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Bk(iw.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case pM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new Bk(iw.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(uM.WARNING,t,e.serverResponse.url);case pM.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:var n=new Bk(iw.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(uM.WARNING,n,e.serverResponse.url);case pM.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case pM.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Bk(iw.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case pM.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:var r=new Bk(iw.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(uM.WARNING,r,e.serverResponse.url);case pM.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case pM.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case pM.LIVE_STREAM_RESPONSE_WORKER_LOST:case pM.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case pM.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case pM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Bk(iw.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}},n.startPingPong=function(){var e=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((function(){"connected"===e.websocket.state&&e.request("ping",{}).catch(rO)}),6e3)},t}(gw);function cY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cY(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dY=function(e){function t(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vO,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vO;return XC(r(n=e.call(this)||this),"onLiveStreamWarning",void 0),XC(r(n),"onLiveStreamError",void 0),XC(r(n),"spec",void 0),XC(r(n),"retryTimeout",1e4),XC(r(n),"connection",void 0),XC(r(n),"httpRetryConfig",void 0),XC(r(n),"wsRetryConfig",void 0),XC(r(n),"streamingTasks",new Map),XC(r(n),"isStartingStreamingTask",!1),XC(r(n),"taskMutex",new fO("live-streaming")),XC(r(n),"cancelToken",_A.CancelToken.source()),XC(r(n),"transcodingConfig",void 0),XC(r(n),"uapResponse",void 0),XC(r(n),"lastTaskId",1),XC(r(n),"statusError",new Map),n.spec=t,n.httpRetryConfig=a,n.wsRetryConfig=i,n}i(t,e);var n=t.prototype;return n.setTranscodingConfig=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 66!==(n=uY(uY({},cM),t)).videoCodecProfile&&77!==n.videoCodecProfile&&100!==n.videoCodecProfile&&(Dk.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((function(e){return uY(uY(uY({},aM),e),{},{zOrder:e.zOrder?e.zOrder+1:1})}))),function(e){lw(e.width)||cw(e.width,"config.width",0,1e4),lw(e.height)||cw(e.height,"config.height",0,1e4),lw(e.videoBitrate)||cw(e.videoBitrate,"config.videoBitrate",1,1e6),lw(e.videoFrameRate)||cw(e.videoFrameRate,"config.videoFrameRate"),lw(e.lowLatency)||ow(e.lowLatency,"config.lowLatency"),lw(e.audioSampleRate)||sw(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),lw(e.audioBitrate)||cw(e.audioBitrate,"config.audioBitrate",1,128),lw(e.audioChannels)||sw(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),lw(e.videoGop)||cw(e.videoGop,"config.videoGop"),lw(e.videoCodecProfile)||sw(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),lw(e.userCount)||cw(e.userCount,"config.userCount",0,17),lw(e.backgroundColor)||cw(e.backgroundColor,"config.backgroundColor",0,16777215),lw(e.userConfigExtraInfo)||dw(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!lw(e.transcodingUsers)&&(pw(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((function(e,t){rM(e.uid),lw(e.x)||cw(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),lw(e.y)||cw(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),lw(e.width)||cw(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),lw(e.height)||cw(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),lw(e.zOrder)||cw(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),lw(e.alpha)||cw(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),lw(e.watermark)||sM(e.watermark,"watermark"),lw(e.backgroundImage)||sM(e.backgroundImage,"backgroundImage"),e.images&&!lw(e.images)&&(pw(e.images,"config.images"),e.images.forEach((function(e,t){sM(e,"images[".concat(t,"]"))})))}(n),r=[],n.images&&r.push.apply(r,n.images.map((function(e){return uY(uY(uY({},oM),e),{},{zOrder:255})}))),n.backgroundImage&&(r.push(uY(uY(uY({},oM),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(uY(uY(uY({},oM),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((function(e){return uY({},e)})),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers),i=(n.userConfigs||[]).map((function(e){return"number"==typeof e.uid?zl.resolve(e.uid):qV(e.uid,s.spec,s.cancelToken.token,s.httpRetryConfig)})),e.next=7,zl.all(i);case 7:if(e.sent.forEach((function(e,t){n.userConfigs&&n.userConfigs[t]&&(n.userConfigs[t].uid=e)})),this.transcodingConfig=n,!this.connection){e.next=22;break}return e.prev=10,e.next=13,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(nh(a=this.streamingTasks).call(a)).map((function(e){return e.taskId})).join("#")});case 13:o=e.sent,Dk.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig)),e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(10),e.t0.data&&e.t0.data.retry){e.next=21;break}throw e.t0;case 21:e.t0.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((function(t){Dk.warning("[".concat(s.spec.clientId,"] live streaming receive error"),e.t0.toString(),"try to republish",t.url),s.startLiveStreamingTask(t.url,t.mode,e.t0).then((function(){Dk.debug("[".concat(s.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((function(e){Dk.error("[".concat(s.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),s.onLiveStreamError&&s.onLiveStreamError(t.url,e)}))}));case 22:case"end":return e.stop()}}),e,this,[[10,17]])})));return function(t){return e.apply(this,arguments)}}(),n.startLiveStreamingTask=function(){var e=p(l().mark((function e(t,n,r){var i,a,o,s,c,u=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transcodingConfig||n!==iM.TRANSCODE){e.next=2;break}throw new Bk(iw.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");case 2:return i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},Dk.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n)),e.next=6,this.taskMutex.lock();case 6:if(a=e.sent,this.connection||!r){e.next=9;break}return e.abrupt("return",void a());case 9:if(!this.streamingTasks.get(t)||r){e.next=11;break}return e.abrupt("return",(a(),new Bk(iw.LIVE_STREAMING_TASK_CONFLICT).throw()));case 11:if(e.prev=11,e.t0=this.connection,e.t0){e.next=17;break}return e.next=16,this.connect(n);case 16:this.connection=e.sent;case 17:e.next=22;break;case 19:throw e.prev=19,e.t1=e.catch(11),a(),e.t1;case 22:switch(n){case iM.TRANSCODE:i.transcodingConfig=uY({},this.transcodingConfig);case iM.RAW:}return this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,o=this.lastTaskId++,e.prev=25,s=new zl((function(e,n){eO(u.retryTimeout).then((function(){if(r)return n(r);var e=u.statusError.get(t);return e?(u.statusError.delete(t),n(e)):void 0}))})),e.next=29,zl.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===iM.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),s]);case 29:c=e.sent,this.isStartingStreamingTask=!1,Dk.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),a(),e.next=48;break;case 33:if(e.prev=33,e.t2=e.catch(25),a(),this.isStartingStreamingTask=!1,e.t2.data&&e.t2.data.retry&&!r){e.next=37;break}throw e.t2;case 37:if(!e.t2.data.changeAddress){e.next=44;break}return this.connection.tryNextAddress(),e.next=41,this.startLiveStreamingTask(t,n,e.t2);case 41:e.t3=e.sent,e.next=47;break;case 44:return e.next=46,this.startLiveStreamingTask(t,n,e.t2);case 46:e.t3=e.sent;case 47:return e.abrupt("return",e.t3);case 48:case"end":return e.stop()}}),e,this,[[11,19],[25,33]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n.stopLiveStreamingTask=function(e){var t=this;return new zl((function(n,r){var i=t.streamingTasks.get(e);if(!i||!t.connection)return new Bk(iw.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var a=i.mode;i.abortTask=function(){Dk.debug("[".concat(t.spec.clientId,"] stop live streaming success(worker exception)")),t.streamingTasks.delete(e),n()},t.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:a===iM.TRANSCODE?1:2,requestByUser:!0,tid:(t.lastTaskId++).toString()}).then((function(r){Dk.debug("[".concat(t.spec.clientId,"] stop live streaming success, code: ").concat(r.code)),t.streamingTasks.delete(e),0===t.streamingTasks.size&&(t.connection&&t.connection.close(),t.connection=void 0),n()})).catch(r)}))},n.resetAllTask=function(){var e,t=this,n=Array.from(nh(e=this.streamingTasks).call(e));this.terminate();for(var r=function(){var e=a[i];t.startLiveStreamingTask(e.url,e.mode).catch((function(n){t.onLiveStreamError&&t.onLiveStreamError(e.url,n)}))},i=0,a=n;i<a.length;i++)r()},n.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=_A.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},n.connect=function(){var e=p(l().mark((function e(t){var n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connection){e.next=2;break}throw new Bk(iw.UNEXPECTED_ERROR,"live streaming connection has already connected");case 2:return e.next=4,xw(this,dM.REQUEST_WORKER_MANAGER_LIST,t);case 4:return n=e.sent,this.uapResponse=n,this.connection=new sY(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(uM.WARNING,(function(e,t){return r.onLiveStreamWarning&&r.onLiveStreamWarning(t,e)})),this.connection.on(uM.PUBLISH_STREAM_STATUS,(function(e){return r.handlePublishStreamServer(e)})),this.connection.on(uM.REQUEST_NEW_ADDRESS,(function(e,n){if(!r.connection)return n(new Bk(iw.UNEXPECTED_ERROR,"can not get new live streaming address list"));xw(r,dM.REQUEST_WORKER_MANAGER_LIST,t).then((function(t){r.uapResponse=t,e(t.addressList)})).catch(n)})),e.next=12,this.connection.init(n.addressList);case 12:return e.abrupt("return",this.connection);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.handlePublishStreamServer=function(e){var t=this,n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case pM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case pM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var a=new Bk(iw.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return Dk.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,a);if(!this.isStartingStreamingTask)return;this.statusError.set(n,a);case pM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var o=new Bk(iw.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o);case pM.LIVE_STREAM_RESPONSE_WORKER_LOST:case pM.LIVE_STREAM_RESPONSE_WORKER_QUIT:var s;if(!this.connection)return;this.connection.tryNextAddress();for(var c=Array.from(nh(s=this.streamingTasks).call(s)),u=function(){var n=p[d];n.abortTask?n.abortTask():(Dk.warning("[".concat(t.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),t.startLiveStreamingTask(n.url,n.mode,new Bk(iw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((function(){Dk.debug("[".concat(t.spec.clientId,"] republish live stream success"),n.url)})).catch((function(e){Dk.error(e.toString()),t.onLiveStreamError&&t.onLiveStreamError(n.url,e)})))},d=0,p=c;d<p.length;d++)u();return}},n.hasUrl=function(e){return this.streamingTasks.has(e)},t}(gw),pY={name:"LiveStreaming",create:function(e){return new dY(e.joinInfo,e.websocketRetryConfig||vO,e.httpRetryConfig||vO)}};function lY(e){var t=bY();return function(e,t){var n=e.appId;void 0!==n&&(MY(t,10),OY(t,n));var r=e.cid;void 0!==r&&(MY(t,16),MY(t,r));var i=e.cname;void 0!==i&&(MY(t,26),OY(t,i));var a=e.deviceId;void 0!==a&&(MY(t,34),OY(t,a));var o=e.elapse;void 0!==o&&(MY(t,40),UY(t,o));var s=e.fileSize;void 0!==s&&(MY(t,48),UY(t,gY(s)));var c=e.height;void 0!==c&&(MY(t,56),UY(t,gY(c)));var u=e.jpg;void 0!==u&&(MY(t,66),MY(t,u.length),function(e,t){var n=IY(e,t.length);e.bytes.set(t,n)}(t,u));var d=e.networkType;void 0!==d&&(MY(t,72),UY(t,gY(d)));var p=e.osType;void 0!==p&&(MY(t,80),UY(t,gY(p)));var l=e.requestId;void 0!==l&&(MY(t,90),OY(t,l));var f=e.sdkVersion;void 0!==f&&(MY(t,98),OY(t,f));var _=e.sequence;void 0!==_&&(MY(t,104),UY(t,gY(_)));var v=e.sid;void 0!==v&&(MY(t,114),OY(t,v));var E=e.timestamp;void 0!==E&&(MY(t,120),UY(t,E));var m=e.uid;void 0!==m&&(MY(t,128),MY(t,m));var S=e.vid;void 0!==S&&(MY(t,136),MY(t,S));var g=e.width;void 0!==g&&(MY(t,144),UY(t,gY(g)));var T=e.service;void 0!==T&&(MY(t,152),MY(t,T));var b=e.callbackData;void 0!==b&&(MY(t,162),OY(t,b));var R=e.jpgEncryption;void 0!==R&&(MY(t,168),MY(t,R));var C=e.requestType;void 0!==C&&(MY(t,176),MY(t,C));var y=e.scorePorn;void 0!==y&&(MY(t,185),LY(t,y));var I=e.scoreSexy;void 0!==I&&(MY(t,193),LY(t,I));var A=e.scoreNeutral;void 0!==A&&(MY(t,201),LY(t,A));var w=e.scene;void 0!==w&&(MY(t,208),MY(t,w));var O=e.ossFilePrefix;void 0!==O&&(MY(t,218),OY(t,O));var k=e.serviceVendor;if(void 0!==k)for(var N,D=h(k);!(N=D()).done;){var P=N.value;MY(t,226);var L=bY();_Y(P,L),MY(t,L.limit),kY(t,L),RY(L)}}(e,t),function(e){var t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function hY(e){return function(e){var t={};e:for(;!yY(e);){var n=xY(e);switch(n>>>3){case 0:break e;case 1:t.code=xY(e);break;case 2:t.msg=wY(e,xY(e));break;case 3:var r=vY(e);t.data=fY(e),e.limit=r;break;default:EY(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function fY(e){var t={};e:for(;!yY(e);){var n=xY(e);switch(n>>>3){case 0:break e;case 1:t.requestId=wY(e,xY(e));break;case 2:t.requestType=xY(e)>>>0;break;case 3:t.scorePorn=PY(e);break;case 4:t.scoreSexy=PY(e);break;case 5:t.scoreNeutral=PY(e);break;case 6:t.requestScene=xY(e)>>>0;break;case 7:t.scene=xY(e)>>>0;break;default:EY(e,7&n)}}return t}function _Y(e,t){var n=e.service;void 0!==n&&(MY(t,8),MY(t,n));var r=e.vendor;void 0!==r&&(MY(t,16),MY(t,r));var i=e.token;void 0!==i&&(MY(t,26),OY(t,i));var a=e.callbackUrl;void 0!==a&&(MY(t,34),OY(t,a))}function vY(e){var t=xY(e),n=e.limit;return e.limit=e.offset+t,n}function EY(e,t){switch(t){case 0:for(;128&NY(e););break;case 2:CY(e,xY(e));break;case 5:CY(e,4);break;case 1:CY(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var mY=new Float64Array(1),SY=new Uint8Array(mY.buffer);function gY(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var TY=[];function bY(){var e=TY.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function RY(e){TY.push(e)}function CY(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function yY(e){return e.offset>=e.limit}function IY(e,t){var n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){var o=new Uint8Array(2*a);o.set(n),e.bytes=o}return e.offset=a,a>i&&(e.limit=a),r}function AY(e,t){var n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function wY(e,t){for(var n=AY(e,t),r=String.fromCharCode,i=e.bytes,a="�",o="",s=0;s<t;s++){var c=void 0,u=void 0,d=void 0,p=void 0,l=i[s+n];0==(128&l)?o+=r(l):192==(224&l)?s+1>=t||128!=(192&(c=i[s+n+1]))||(p=(31&l)<<6|63&c)<128?o+=a:(o+=r(p),s++):224==(240&l)?s+2>=t||32896!=(49344&((c=i[s+n+1])|(u=i[s+n+2])<<8))||(p=(15&l)<<12|(63&c)<<6|63&u)<2048||p>=55296&&p<=57343?o+=a:(o+=r(p),s+=2):240==(248&l)?s+3>=t||8421504!=(12632256&((c=i[s+n+1])|(u=i[s+n+2])<<8|(d=i[s+n+3])<<16))||(p=(7&l)<<18|(63&c)<<12|(63&u)<<6|63&d)<65536||p>1114111?o+=a:(o+=r(55296+((p-=65536)>>10),56320+(1023&p)),s+=3):o+=a}return o}function OY(e,t){for(var n=t.length,r=0,i=0;i<n;i++){var a=t.charCodeAt(i);a>=55296&&a<=56319&&i+1<n&&(a=(a<<10)+t.charCodeAt(++i)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}MY(e,r);for(var o=IY(e,r),s=e.bytes,c=0;c<n;c++){var u=t.charCodeAt(c);u>=55296&&u<=56319&&c+1<n&&(u=(u<<10)+t.charCodeAt(++c)-56613888),u<128?s[o++]=u:(u<2048?s[o++]=u>>6&31|192:(u<65536?s[o++]=u>>12&15|224:(s[o++]=u>>18&7|240,s[o++]=u>>12&63|128),s[o++]=u>>6&63|128),s[o++]=63&u|128)}}function kY(e,t){for(var n=IY(e,t.limit),r=e.bytes,i=t.bytes,a=0,o=t.limit;a<o;a++)r[a+n]=i[a]}function NY(e){return e.bytes[AY(e,1)]}function DY(e,t){var n=IY(e,1);e.bytes[n]=t}function PY(e){var t=AY(e,8),n=e.bytes;return SY[0]=n[t++],SY[1]=n[t++],SY[2]=n[t++],SY[3]=n[t++],SY[4]=n[t++],SY[5]=n[t++],SY[6]=n[t++],SY[7]=n[t++],mY[0]}function LY(e,t){var n=IY(e,8),r=e.bytes;mY[0]=t,r[n++]=SY[0],r[n++]=SY[1],r[n++]=SY[2],r[n++]=SY[3],r[n++]=SY[4],r[n++]=SY[5],r[n++]=SY[6],r[n++]=SY[7]}function xY(e){var t,n=0,r=0;do{t=NY(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function MY(e,t){for(t>>>=0;t>=128;)DY(e,127&t|128),t>>>=7;DY(e,t)}function UY(e,t){var n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=IY(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}function VY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var FY=new Map([["moderation",1],["supervise",2]]),BY=function(e){function t(t){var n;return XC(r(n=e.call(this)||this),"name","AgoraRTCVideoContentInspect"),XC(r(n),"_connectionState",MM.CONNECTING),XC(r(n),"_innerConnectionState",void 0),XC(r(n),"sequence",0),XC(r(n),"inspectStartTime",void 0),XC(r(n),"workerManagerConnection",void 0),XC(r(n),"workerConnection",void 0),XC(r(n),"workerMessageLengthLimit",void 0),XC(r(n),"inspectIntervalMinimum",void 0),XC(r(n),"qualityRatio",void 0),XC(r(n),"_connectInfo",void 0),XC(r(n),"_cancelTokenSource",_A.CancelToken.source()),XC(r(n),"_retryConfig",void 0),XC(r(n),"wmSequence",0),XC(r(n),"inspectInterval",void 0),XC(r(n),"inspectTimer",null),XC(r(n),"ossFilePrefix",void 0),XC(r(n),"extraInfo",void 0),XC(r(n),"_inspectType",void 0),XC(r(n),"_inspectMode",void 0),XC(r(n),"_quality",1),XC(r(n),"qualityTimer",null),XC(r(n),"_inspectId",void 0),XC(r(n),"_needWorkUrlOnly",!1),XC(r(n),"inspectImage",(function(){if(n.connectionState!==MM.CONNECTED)throw new Bk(iw.OPERATION_ABORTED,"content inspect service connection status is ".concat(n.connectionState));n.inspectTimer&&(window.clearInterval(n.inspectTimer),n.inspectTimer=null),n.inspectTimer=window.setInterval((function(){n.connectionState===MM.CONNECTED?n.requestToInspectImage():Dk.debug("[".concat(n._inspectId,"] Inspect State is not connected , "),n.connectionState)}),n.inspectInterval<n.inspectIntervalMinimum?n.inspectIntervalMinimum:n.inspectInterval),n.requestToInspectImage()})),n._inspectId=tO(5,"inspect-"),n.workerMessageLengthLimit=rk("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),n.inspectIntervalMinimum=rk("VIDEO_INSPECT_INTERVAL_MINIMUM"),n.qualityRatio=rk("VIDEO_INSPECT_QUALITY_RATIO"),n.inspectInterval=t.interval,n.ossFilePrefix=t.ossFilePrefix,n.extraInfo=t.extraInfo,n.inspectType=t.inspectType,n.inspectStartTime=Number(Date.now()),n.workerManagerConnection=new dU("worker-manager-"+n._inspectId,vO),n.on(VM.STATE_CHANGE,(function(e,t){n._innerConnectionState=e,Dk.debug("[".concat(n._inspectId,"] Inspect operation :").concat(UM[e]," ").concat(t||""))})),n.handleWorkerManagerEvents(),n.workerConnection=new dU("worker-"+n._inspectId,vO),n.handleWorkerEvents(),n}i(t,e);var n=t.prototype;return n.init=function(){var e=p(l().mark((function e(t,n){var r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(VM.STATE_CHANGE,UM.CONNECT_AP),this._connectInfo=t,r=this._cancelTokenSource.token,e.abrupt("return",(this._retryConfig=n,new zl((function(e,a){i.on(VM.CONNECTION_STATE_CHANGE,(function(t,n){n===MM.CONNECTED&&e()})),i.requestAP(t,r,n).then((function(e){i.connectWorkerManager(e)})).catch((function(e){a(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.requestAP=function(){var e=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=rk("WEBCS_DOMAIN").map((function(e){return"https://".concat(e,"/api/v1")})),e.next=3,function(e,t,n,r){var i=t.appId,a=t.areaCode,o=t.cname,s=t.sid,c=t.token,u=t.uid;FV++;var d,h,f="image_moderation_api",_={service_name:f,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:FV,seq:FV,sid:s,token:c,ts:Date.now(),uid:u+""})},v=e[0];return mO(p(l().mark((function e(){var t,r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=Date.now(),e.next=3,EV(v,{data:_,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});case 3:if(t=e.sent,h=Date.now()-d,0===t.code){e.next=7;break}throw r=new Bk(iw.UNEXPECTED_RESPONSE,"image inspect ap error, code"+t.code,{retry:!0,responseTime:h}),Dk.error(r.toString()),r;case 7:if(200===(i=JSON.parse(t.json_body)).code){e.next=11;break}throw a=new Bk(iw.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(i.code,", reason: ").concat(i.reason),{code:i.code,responseTime:h}),Dk.error(a.toString()),a;case 11:if(i.servers&&Array.isArray(i.servers)&&0!==i.servers.length){e.next=14;break}throw o=new Bk(iw.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:i.code,responseTime:h}),Dk.error(o.toString()),o;case 14:return s=rk("VIDEO_INSPECT_WORKER_MANAGER_HOST"),c=rk("VIDEO_INSPECT_WORKER_MANAGER_PORT"),e.abrupt("return",{addressList:i.servers.map((function(e){var t=e.address,n=e.wss;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(s,":").concat(c||n)})).filter((function(e){return!!e})),workerToken:i.workerToken,vid:i.vid,responseTime:h});case 16:case"end":return e.stop()}}),e)}))),(function(t,n){return Fk.apworkerEvent(s,{success:!0,sc:200,serviceName:f,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1}),(function(t,n){return Fk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:f,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==iw.OPERATION_ABORTED&&t.code!==iw.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(v=e[(n+1)%e.length],!0)}),r)}(i,t,n,r);case 3:return a=e.sent,this.emit(VM.STATE_CHANGE,UM.AP_CONNECTED),o=a.addressList,e.abrupt("return",(this.wmSequence++,o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.connectWorkerManager=function(){var e=p(l().mark((function e(t){var n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],this._needWorkUrlOnly=n,this.emit(VM.STATE_CHANGE,UM.CONNECT_WORKER_MANAGER),e.next=5,this.workerManagerConnection.init(t,1e4);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.connectWorker=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.workerConnection.init([t]);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.handleWorkerManagerEvents=function(){var e=this;this.workerManagerConnection.on(tM.CONNECTED,p(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(VM.STATE_CHANGE,UM.WORKER_MANAGER_CONNECTED,e.workerManagerConnection.url),e.workerManagerConnection.sendMessage({appId:e._connectInfo.appId,cname:e._connectInfo.cname,uid:e._connectInfo.uid+"",sdkVersion:"4.23.4",sid:e._connectInfo.sid,seq:e.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0);case 1:case"end":return t.stop()}}),t)})))),this.workerManagerConnection.on(tM.CLOSED,(function(){e._innerConnectionState<UM.GET_WORKER_MANAGER_RESPONSE&&Dk.debug("[".concat(e._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(tM.FAILED,(function(){e._innerConnectionState<UM.GET_WORKER_MANAGER_RESPONSE&&Dk.debug("[".concat(e._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(tM.RECONNECTING,(function(){e._innerConnectionState<UM.GET_WORKER_MANAGER_RESPONSE&&Dk.debug("[".concat(e._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(tM.ON_MESSAGE,p(l().mark((function t(n){var r,i,a,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit(VM.STATE_CHANGE,UM.GET_WORKER_MANAGER_RESPONSE),r=e.workerManagerConnection.url,e.workerManagerConnection.close(),200===(i=JSON.parse(n.data)).code){t.next=6;break}throw Dk.error("[".concat(e._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Bk(iw.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);case 6:if(i.serverResponse&&i.serverResponse.portWss&&r){t.next=8;break}throw Dk.error("[".concat(e._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Bk(iw.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);case 8:if(a=rk("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=r.replace(/:\d+\/?$/,":".concat(a)),e.emit(VM.STATE_CHANGE,UM.CONNECT_WORKER,o),!e._needWorkUrlOnly){t.next=14;break}e.emit(VM.REQUEST_NEW_WORKER_URL,o),t.next=16;break;case 14:return t.next=16,e.connectWorker(o);case 16:case"end":return t.stop()}}),t)})))),this.workerManagerConnection.on(tM.WILL_RECONNECT,(function(e,t,n){n(e)})),this.workerManagerConnection.on(tM.REQUEST_NEW_URLS,(function(t,n){e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then(t).catch(n)}))},n.handleWorkerEvents=function(){var e=this;this.workerConnection.on(tM.CONNECTED,p(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(VM.STATE_CHANGE,UM.WORKER_CONNECTED,e.workerConnection.url),e.connectionState=MM.CONNECTED;case 1:case"end":return t.stop()}}),t)})))),this.workerConnection.on(tM.ON_MESSAGE,p(l().mark((function t(n){var r,i,a,o,s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.data instanceof ArrayBuffer)){t.next=11;break}if(r=hY(new Uint8Array(n.data)),rk("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Dk.debug("[".concat(e._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),200!==r.code){t.next=8;break}if(!Array.isArray(e.inspectType)||1!==e.inspectType.length||"supervise"!==e.inspectType[0]){t.next=5;break}return t.abrupt("return",void e.emit(VM.INSPECT_RESULT,void 0,void 0));case 5:r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral?(a={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},o=ui(i=Object.keys(a)).call(i,(function(e,t){return a[e]>a[t]?e:t}),"porn"),s=Object.keys(a).find((function(e){return e===o})),e.emit(VM.INSPECT_RESULT,s)):e.emit(VM.INSPECT_RESULT,void 0,new Bk(iw.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message")),t.next=9;break;case 8:e.emit(VM.INSPECT_RESULT,void 0,new Bk(iw.UNEXPECTED_RESPONSE,r.code+"",r.msg));case 9:t.next=12;break;case 11:Dk.error("[".concat(e._inspectId,"] Unexpected message type from worker")),e.emit(VM.INSPECT_RESULT,void 0,new Bk(iw.UNEXPECTED_RESPONSE,"invalid worker message type"));case 12:case"end":return t.stop()}}),t)})))),this.workerConnection.on(tM.CLOSED,(function(){e.connectionState=MM.CLOSED})),this.workerConnection.on(tM.FAILED,(function(){e.connectionState=MM.CLOSED})),this.workerConnection.on(tM.RECONNECTING,(function(){e.connectionState=e.connectionState===MM.CONNECTED?MM.RECONNECTING:MM.CONNECTING})),this.workerConnection.on(tM.WILL_RECONNECT,(function(e,t,n){"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(tM.REQUEST_NEW_URLS,(function(t,n){e.workerManagerConnection.close(),e.once(VM.REQUEST_NEW_WORKER_URL,(function(e){t([e])})),e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then((function(t){e.connectWorkerManager(t,!0)})).catch((function(e){n(e)}))}))},n.requestToInspectImage=function(){var e=p(l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sequence++,t=Uw(this,VM.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid},!t){e.next=11;break}if(t.isPlaying){e.next=5;break}return e.abrupt("return",void this.emit(VM.INSPECT_RESULT,void 0,new Bk(iw.INVALID_OPERATION,"Only the track being played can be inspected")));case 5:return e.next=7,this.generateRequestData(t,n);case 7:r=e.sent,this.workerConnection.sendMessage(r,!0,!0),e.next=12;break;case 11:this.emit(VM.INSPECT_RESULT,void 0,new Bk(iw.INVALID_OPERATION,"Only the track being published can be inspected"));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.generateRequestData=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f,_,v,E,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.appId,i=n.cname,a=n.cid,o=n.vid,s=n.sid,c=n.uid,u=Date.now(),e.next=4,t.getCurrentFrameImage("image/jpeg",this.quality);case 4:return d=e.sent,e.next=7,pP(d,r,i);case 7:if(p=e.sent,h=this.sequence+"-"+a+"-"+c+"-"+u+"-"+tO(12,""),f={appId:r,cid:a,cname:i,deviceId:"",elapse:(_=Number(u-this.inspectStartTime),{low:_|=0,high:_>>31,unsigned:_>=0}),fileSize:p.byteLength,jpgEncryption:2,height:d.height,width:d.width,jpg:p,networkType:6,osType:7,requestId:h,sdkVersion:"4.23.4",sequence:this.sequence,sid:s,timestamp:wj(u),uid:c,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix},void 0===this.extraInfo&&delete f.callbackData,void 0===this.ossFilePrefix&&delete f.ossFilePrefix,!((v=lY(f)).byteLength<this.workerMessageLengthLimit)){e.next=15;break}return rk("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&(delete(E=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VY(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f)).jpg,Dk.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(E))),e.abrupt("return",v);case 15:return m=this.quality*this.qualityRatio,this.quality=m,e.next=19,this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:o,sid:s,uid:c});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.close=function(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_A.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=MM.CLOSED,this.emit(VM.STATE_CHANGE,UM.CLOSED)},v(t,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){if(this._connectionState!==e){var t=this._connectionState;this._connectionState=e,this.emit(VM.CONNECTION_STATE_CHANGE,t,e)}}},{key:"inspectType",get:function(){return this._inspectType},set:function(e){var t;this._inspectMode=ui(t=e.map((function(e){return FY.get(e)||0}))).call(t,(function(e,t){return e+t})),this._inspectType=e}},{key:"quality",get:function(){return this._quality},set:function(e){var t=this;this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((function(){t.quality=t._quality/t.qualityRatio}),6e4))}}]),t}(gw),jY={name:"ContentInspect",create:function(e){var t=e.config;return function(e){if(!e)throw new Bk(iw.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new Bk(iw.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");var t=[].concat(new Set(e.inspectType));if(t.forEach((function(e){var t;if(!Br(t=["supervise","moderation"]).call(t,e))throw new Bk(iw.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))})),e.inspectType=t,e&&e.extraInfo&&e.extraInfo.length>1024)throw new Bk(iw.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new BY(t)}},GY=d(pe.Object.getOwnPropertySymbols),WY=Bn,HY=ir.indexOf,KY=Jr,YY=M([].indexOf),qY=!!YY&&1/YY([1],1,-0)<0;WY({target:"Array",proto:!0,forced:qY||!KY("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return qY?YY(this,e,t)||0:HY(this,e,t)}});var zY=cr("Array","indexOf"),XY=b,JY=zY,QY=Array.prototype,ZY=d((function(e){var t=e.indexOf;return e===QY||XY(QY,e)&&t===QY.indexOf?JY:t}));function $Y(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==ZY(t).call(t,r))continue;n[r]=e[r]}return n}(e,t);if(GY){var a=GY(e);for(r=0;r<a.length;r++)n=a[r],-1===ZY(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var eq,tq=function(){function e(e){XC(this,"sessionDesc",void 0),XC(this,"_localCapabilities",void 0),XC(this,"_rtpCapabilities",void 0),XC(this,"_candidates",void 0),XC(this,"_iceParameters",void 0),XC(this,"_dtlsParameters",void 0),XC(this,"setup",void 0),XC(this,"currentMidIndex",void 0),XC(this,"cname","o/i14u9pJrxRKAsu"),XC(this,"firefoxSsrcMidMap",new Map);var t,n=e=Ww(e),r=n.remoteIceParameters,i=n.remoteDtlsParameters,a=n.candidates,o=n.remoteRTPCapabilities,s=n.localCapabilities,c=n.direction,u=n.setup,d=n.videoCodec,p=n.audioCodec;this.setup=u,t=c===eM.RECEIVE_ONLY?pk("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):pk("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=o,this._candidates=a,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=s;for(var l,f=c===eM.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=c===eM.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,v=c===eM.RECEIVE_ONLY?o.send.videoCodecs:ZU(OM.VIDEO,f,_,d),E=c===eM.RECEIVE_ONLY?o.send.audioCodecs:ZU(OM.AUDIO,f,_,p),m=h(t.mediaDescriptions);!(l=m()).done;){var S=l.value;S.attributes.iceUfrag=r.iceUfrag,S.attributes.icePwd=r.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=a,S.attributes.setup=this.setup,"application"===S.media.mediaType&&(S.attributes.sctpPort="5000"),"video"===S.media.mediaType&&(S.media.fmts=v.map((function(e){return e.payloadType.toString(10)})),S.attributes.payloads=v,S.attributes.extmaps=f.videoExtensions),"audio"===S.media.mediaType&&(S.media.fmts=E.map((function(e){return e.payloadType.toString(10)})),S.attributes.payloads=E,S.attributes.extmaps=f.audioExtensions,QU(S))}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}var t=e.prototype;return t.toString=function(){return lk(this.sessionDesc)},t.hasMid=function(e){var t=this;return Array.isArray(e)?e.every((function(e){return t.hasMid(e)})):this.sessionDesc.mediaDescriptions.some((function(t){return t.attributes.mid===e}))},t.send=function(e,t,n,r,i){n=n.replace(/ /g,"-");var a=FU(t,this.cname,rk("SYNC_GROUP")?n:void 0),o=a.ssrcs,s=a.ssrcGroups,c=this.findPreloadMediaDesc(o);if(c){if(LA()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){var u=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}var d,p=this.findAvailableMediaIndex(e,o,r);return-1===p?(d=this.createOrRecycleSendMedia(e,o,s,"sendonly",r,i),this.updateBundleMids()):((d=Ww(this.sessionDesc.mediaDescriptions[p])).attributes.direction="sendonly",d.attributes.ssrcs=o,d.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(d,i)),LA()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),{needExchangeSDP:!0,mid:d.attributes.mid}},t.stopSending=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){e.attributes.ssrcs=[]})),this.updateBundleMids()},t.receive=function(e,t,n){var r=this,i=[];return e.forEach((function(e){var a,o=e._mediaStreamTrack.kind,s=r.findAvailableRecvMediaIndex(o),c=!1;-1===s?(c=!0,a=r.createOrRecycleRecvMedia(e,[],"recvonly",t,n),r.updateBundleMids()):(a=Ww(r.sessionDesc.mediaDescriptions[s])).attributes.direction="recvonly",i.push({mid:a.attributes.mid,needCreateTransceiver:c})})),i},t.stopReceiving=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()},t.addRemoteCandidate=function(e){var t=this,n=new RTCIceCandidate(e),r=n.foundation,i=n.protocol,a=n.address,o=n.port,s=n.type,c=n.relatedAddress,u=n.relatedPort,d=n.priority,p={foundation:null!=r?r:"",componentId:"1",transport:null!=i?i:"",priority:d?d+"":"",connectionAddress:null!=a?a:"",port:o?o+"":"",type:s?s+"":"",relAddr:null!=c?c:"",relPort:u?u+"":"",extension:{}};this.candidates.some((function(e){return e.priority===p.priority&&e.connectionAddress===p.connectionAddress&&e.port===p.port}))||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach((function(e){e.attributes.candidates=t.candidates})))},t.clearRemoteCandidate=function(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates},t.createOrRecycleRecvMedia=function(e,t,n,r,i){var a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,s=ZU(a,o,this.localCapabilities.send,a===OM.AUDIO?i:r),c=a===OM.VIDEO?o.videoExtensions:o.audioExtensions,u="".concat(++this.currentMidIndex),d={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,e);var p=this.findFirstClosedMedia(a);if(p){var l=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[l]=d}else this.sessionDesc.mediaDescriptions.push(d);return d},t.muteRemote=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return Br(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))},t.unmuteRemote=function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return Br(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))},t.findAvailableMediaIndex=function(e,t,n){var r=this;return this.sessionDesc.mediaDescriptions.findIndex((function(i){var a=i.media.mediaType===e&&"0"!==i.media.port&&("sendonly"===i.attributes.direction||"sendrecv"===i.attributes.direction)&&0===i.attributes.ssrcs.length;if(LA()){if(a){var o=r.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||"0"!==i.attributes.mid&&"1"!==i.attributes.mid)||!(!o||o!==i.attributes.mid)}return!1}return a&&i.attributes.mid===n}))},t.findAvailableRecvMediaIndex=function(e){return this.sessionDesc.mediaDescriptions.findIndex((function(t){var n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))},t.predictReceivingMids=function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t},t.restartICE=function(e){e=Ww(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))},t.createOrRecycleSendMedia=function(e,t,n,r,i,a){var o=this.rtpCapabilities.send,s=e===OM.VIDEO?o.videoCodecs:o.audioCodecs,c=e===OM.VIDEO?o.videoExtensions:o.audioExtensions;LA()&&(i="".concat(++this.currentMidIndex));var u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,a);var d=this.findFirstClosedMedia(e);if(d){var p=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[p]=u}else this.sessionDesc.mediaDescriptions.push(u);return u},t.mungRecvMediaDsec=function(e,t,n){var r=Ww(e);return jU(r),BU(r,t),GU(r,t),WU(r),HU(r,n,this.localCapabilities.send),r},t.mungSendMediaDesc=function(e,t){var n=Ww(e);return HU(n,t,this.localCapabilities.recv),QU(n),n},t.updateRecvMedia=function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}},t.updateBundleMids=function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))},t.findPreloadMediaDesc=function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))},t.findFirstClosedMedia=function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return LA()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))},v(e,[{key:"localCapabilities",get:function(){return Ww(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return Ww(this._rtpCapabilities)}},{key:"candidates",get:function(){return Ww(this._candidates)}},{key:"iceParameters",get:function(){return Ww(this._iceParameters)}},{key:"dtlsParameters",get:function(){return Ww(this._dtlsParameters)}}]),e}(),nq=["sdp"];function rq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rq(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var aq=(Wx((eq=function(e){function t(n,i,a){var o;return XC(r(o=e.call(this,n,i)||this),"direction",void 0),XC(r(o),"name",void 0),XC(r(o),"store",void 0),XC(r(o),"spec",void 0),XC(r(o),"peerConnection",void 0),XC(r(o),"initialOffer",void 0),XC(r(o),"transport",void 0),XC(r(o),"statsFilter",void 0),XC(r(o),"localCandidateCount",0),XC(r(o),"_isInRestartIce",!1),XC(r(o),"mutex",void 0),XC(r(o),"onLocalCandidate",void 0),XC(r(o),"remoteSDP",void 0),XC(r(o),"pendingCandidates",[]),XC(r(o),"localCapabilities",void 0),XC(r(o),"isReady",!1),XC(r(o),"restartCnt",0),XC(r(o),"curTurnServerIndex",0),o.store=i,o.spec=n,o.mutex=new fO("P2PConnection-mutex",i.clientId),o.peerConnection=new RTCPeerConnection(t.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),o.direction=null!=a?a:eM.SEND_ONLY,o.name=o.direction===eM.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",o.statsFilter=HO(o.peerConnection,rk("STATS_UPDATE_INTERVAL"),void 0,LA()?1200:void 0),o.bindPCEvents(),o.bindStatsEvents(),o.store.p2pId=o.store.p2pId+1,o}i(t,e);var n=t.prototype;return n.establish=function(){var e=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,YU();case 3:if(n=e.sent,this.localCapabilities=JU(n),!t){e.next=24;break}return r=t.sdp,i=$Y(t,nq),a=function(){var e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=LU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(XU(t,e,"videoExtensions",n,r,i),XU(t,e,"videoCodecs",n,r,i),XU(t,e,"audioExtensions",n,r,i),XU(t,e,"audioCodecs",n,r,i),rk("RAISE_H264_BASELINE_PRIORITY")){var a=i.videoCodecs.findIndex((function(e){return e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]}));if(-1!==a){var o=i.videoCodecs.findIndex((function(e){return e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()}));if(o<a){Dk.debug("raising H264 baseline profile priority");var s=i.videoCodecs[a];i.videoCodecs.splice(a,1),i.videoCodecs.splice(o,0,s)}-1!==o&&rk("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((function(e){return!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])})))}}return{send:n,recv:r,sendrecv:i}}({},{},r),this.remoteSDP=new tq({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),e.next=9,this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});case 9:return this.isReady=!0,e.next=12,this.peerConnection.createAnswer();case 12:if((o=e.sent).sdp){e.next=15;break}throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");case 15:return s=xU(o.sdp),e.next=18,this.peerConnection.setLocalDescription(o);case 18:return e.next=20,zU({},{},o.sdp);case 20:return c=e.sent,this.localCapabilities=JU(c),u=this.peerConnection.getTransceivers()[0],e.abrupt("return",(null!=u&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),iq(iq({},s),{},{sdp:o.sdp})));case 24:return this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"}),e.next=27,this.peerConnection.createOffer();case 27:if((d=e.sent).sdp){e.next=30;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 30:return p=xU(d.sdp),e.abrupt("return",(this.initialOffer=d,iq(iq({},p),{},{sdp:d.sdp})));case 34:throw e.prev=34,e.t0=e.catch(0),new aw(iw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 37:case"end":return e.stop()}}),e,this,[[0,34]])})));return function(t){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){var n,r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return e.next=5,this.peerConnection.setLocalDescription(this.initialOffer);case 5:return n=t.sdp,r=t.iceParameters,i=t.dtlsParameters,e.next=10,zU({},{},n);case 10:return a=e.sent,this.remoteSDP=new tq({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),e.next=14,this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});case 14:null!=(o=this.peerConnection.getTransceivers()[0])&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),n.addRemoteCandidate=function(){var e=p(l().mark((function e(t){var n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((function(e){n.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[]),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new aw(iw.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.t0.toString()));case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}(),n.send=function(e,t,n){var r=this;return OI(l().mark((function i(){var a,o,s,c,u,d,p,h,f,_,v,E;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,NI(r.mutex.lock("From P2PConnection.send"));case 2:if(a=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:if(o=[],s=r.remoteSDP.receive(e,t,n),e.forEach((function(e,t){if(s[t].needCreateTransceiver){var n=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(n),e._updateRtpTransceiver(n)}else{var i=r.peerConnection.getTransceivers().find((function(e){return e.mid===s[t].mid}));if(!i)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(s[t].mid));o.push(i),e._updateRtpTransceiver(i)}})),i.t0=LA()&&!0===rk("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,NI(r.applySimulcastForFirefox(o,e));case 12:return c=s.map((function(e){return e.mid})),i.next=15,NI(r.peerConnection.createOffer());case 15:return u=i.sent,d=r.mungSendOfferSDP(u.sdp,e,c),p=pk(d),h=c.map((function(e){var t=p.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return MU(t,rk("USE_PUB_RTX"))})),f=o.map((function(e,t){var n=c[t];return{localSSRC:h[t],id:n}})),i.next=22,NI(r.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 22:return i.prev=22,i.next=25,f;case 25:i.next=37;break;case 27:return i.prev=27,i.t1=i.catch(22),_=r.remoteSDP.toString(),i.next=32,NI(r.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 32:return i.next=34,NI(r.peerConnection.setRemoteDescription({type:"answer",sdp:_}));case 34:return i.next=36,NI(r.stopSending(c,!0));case 36:throw i.t1;case 37:return i.next=39,NI(r.applySimulcastEncodings(o,e));case 39:return i.next=41,NI(r.applySendEncodings(o,e));case 41:return v=r.remoteSDP.toString(),null==(E=r.logSDPExchange(d,"offer","local","send"))||E(v),i.next=45,NI(r.setRemoteDescription({type:"answer",sdp:v}));case 45:return i.abrupt("return",o.map((function(e,t){var n=c[t];return{localSSRC:h[t],id:n}})));case 48:throw i.prev=48,i.t2=i.catch(3),i.t2 instanceof aw?i.t2:new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(i.t2.toString()));case 51:return i.prev=51,a(),i.finish(51);case 54:case"end":return i.stop()}}),i,null,[[3,48,51,54],[22,27]])})))()},n.stopSending=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From P2PConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 11:if((i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)}))).length===t.length){e.next=14;break}throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));case 14:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return a=e.sent,o=this.logSDPExchange(a.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(a);case 21:return this.remoteSDP.stopReceiving(t),s=this.remoteSDP.toString(),null==o||o(s),e.next=26,this.setRemoteDescription({type:"answer",sdp:s});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));return function(t,n){return e.apply(this,arguments)}}(),n.receive=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:if(a=this.remoteSDP.send(t,n,r,i),o=a.mid,!a.needExchangeSDP){e.next=18;break}return s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive"),e.next=8,this.setRemoteDescription({type:"offer",sdp:s});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return u=e.sent,d=this.mungReceiveAnswerSDP(u.sdp,o,t),null==c||c(d||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:d});case 15:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")),e.next=19;break;case 18:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));case 19:if((p=this.peerConnection.getTransceivers().find((function(e){return e.mid===o})))&&null!==p.mid){e.next=22;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 22:return e.abrupt("return",{track:p.receiver.track,mid:p.mid,transceiver:p});case 25:throw e.prev=25,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.mockReceive=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:if(a=this.remoteSDP.send(t,n,r,i),o=a.mid,!a.needExchangeSDP){e.next=18;break}return s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","receive"),e.next=8,this.setRemoteDescription({type:"offer",sdp:s});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return u=e.sent,d=this.mungReceiveAnswerSDP(u.sdp,o,t),null==c||c(d||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:d});case 15:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")),e.next=19;break;case 18:Dk.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));case 19:e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.stopReceiving=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),n.restartICE=function(){var e=p(l().mark((function e(n){var r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.store.p2pTransport===XO.Auto&&(this.store.p2pTransport=XO.SdRtn,Gk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(t.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Gk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(t.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),n){e.next=15;break}return this.restartCnt++,this.isReady=!1,e.next=5,this.peerConnection.createOffer({iceRestart:!0});case 5:if((r=e.sent).sdp){e.next=8;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 8:if(i=xU(r.sdp),a=i.iceParameters,this.store.descriptionStart(),e.t0=this.direction===eM.SEND_ONLY,!e.t0){e.next=14;break}return e.next=14,this.peerConnection.setLocalDescription(r);case 14:return e.abrupt("return",a);case 15:if(this.remoteSDP){e.next=17;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 17:if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction!==eM.RECEIVE_ONLY){e.next=30;break}return this.restartCnt++,e.next=21,this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});case 21:return e.next=23,this.peerConnection.createAnswer();case 23:if((o=e.sent).sdp){e.next=26;break}throw new Error("Cannot get answer sdp when trying to iceRestart.");case 26:return s=xU(o.sdp),c=s.iceParameters,e.next=29,this.peerConnection.setLocalDescription(o);case 29:return e.abrupt("return",c);case 30:return e.next=32,this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});case 32:this.isReady=!0,e.next=38;break;case 35:throw e.prev=35,e.t1=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t1.toString()));case 38:case"end":return e.stop()}}),e,this,[[0,35]])})));return function(t){return e.apply(this,arguments)}}(),n.close=function(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()},n.getStats=function(){return this.statsFilter.getStats()},n.getRemoteVideoIsReady=function(e){return this.statsFilter.getVideoIsReady(e)},n.updateEncoderConfig=function(){var e=p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),a=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==o||o(a),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),n.updateSendParameters=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=LA(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setStatsRemoteVideoIsReady=function(e,t){this.statsFilter.setVideoIsReady2(e,t)},n.replaceTrack=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.getSelectedCandidatePair=function(){var e=p(l().mark((function e(){var t,n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.peerConnection.getReceivers()).length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair())){e.next=4;break}return n=t[0].transport.iceTransport,r=n.getSelectedCandidatePair(),i=r.local,a=r.remote,e.abrupt("return",{local:iq(iq({},wO),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:iq(iq({},wO),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})});case 4:return e.abrupt("return",this.statsFilter.getSelectedCandidatePair());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.bindPCEvents=function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t,n;Br(t=["connected","completed"]).call(t,e.peerConnection.iceConnectionState)&&(e.isReady=!1),null===(n=e.onICEConnectionStateChange)||void 0===n||n.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;"connected"===e.peerConnection.connectionState&&(e.restartCnt=0),null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.startICECandidate()},n.startICECandidate=function(){var e=this;this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=function(t){var n;t.candidate?(t.candidate.candidate&&(null===(n=e.onLocalCandidate)||void 0===n||n.call(e,t.candidate.toJSON())),e.localCandidateCount+=1):Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount)})},n.unbindPCEvents=function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null},t.resolvePCConfiguration=function(e,n){var r,i,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s={iceServers:[]};return e.iceServers?s.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(ww(e.turnServer.servers)?s.iceServers=e.turnServer.servers:(s.iceServers&&(r=s.iceServers).push.apply(r,t.turnServerConfigToIceServers(e.turnServer.servers,n,o)),rk("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&e.turnServer.serversFromGateway&&(i=s.iceServers).push.apply(i,t.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,o)),Br(a=[XO.Relay,XO.SdRtn]).call(a,n)&&(s.iceTransportPolicy="relay"),rk("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(s.iceTransportPolicy="relay")})))),rk("ENABLE_ENCODED_TRANSFORM")&&Gk().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),Dk.debug("P2PConnection p2pTransport is ".concat(n)),s},t.turnServerConfigToIceServers=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],i=e.filter((function(e){return e.tcpport}));Dk.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));var a=i.length>n?i[n]:i[0];switch(t){case XO.SdRtn:var o=e.filter((function(e){var t;return Br(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),s=o.length>n?o[n]:o[0];s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(vU(s.turnServerURL),":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(vU(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;case XO.Relay:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(vU(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(vU(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return r},n.tryBindTransportEvents=function(e){var t=this;if(e){this.transport=e,e.onstatechange=function(){var n;null!=e&&e.state&&(null===(n=t.onDTLSTransportStateChange)||void 0===n||n.call(t,e.state))},e.onerror=function(e){var n;null===(n=t.onDTLSTransportError)||void 0===n||n.call(t,"error"in e?e.error:e)};var n=e.iceTransport;n&&(n.onstatechange=function(){var n,r=null==e?void 0:e.iceTransport.state;r&&(null===(n=t.onICETransportStateChange)||void 0===n||n.call(t,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=function(){if(n.getSelectedCandidatePair()){var e=n.getSelectedCandidatePair(),r=e.local,i=e.remote;Dk.info("[".concat(t.store.clientId,"] [pc-").concat(t.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}},n.tryUnbindTransportEvents=function(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))},n.updateRtpSenderEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f,_;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.peerConnection.getSenders().find((function(e){return e.track===t._mediaStreamTrack}))),n){e.next=3;break}return e.abrupt("return",Dk.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(!this.isVP8Simulcast(t)){e.next=5;break}return e.abrupt("return",Dk.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings"));case 5:if(Gk().supportSetRtpSenderParameters){e.next=7;break}return e.abrupt("return",Dk.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters"));case 7:i={},a={},e.t0=t._optimizationMode,e.next="motion"===e.t0?11:"detail"===e.t0?13:15;break;case 11:return i.degradationPreference="maintain-framerate",e.abrupt("break",16);case 13:return i.degradationPreference="maintain-resolution",e.abrupt("break",16);case 15:i.degradationPreference="balanced";case 16:return t._encoderConfig&&(s=t._encoderConfig,c=s.bitrateMax,u=s.frameRate,d=s.scaleResolutionDownBy,c&&(a.maxBitrate=1e3*c),Br(o=t._hints).call(o,sN.LOW_STREAM)&&(u&&(a.maxFramerate=mU(u)),d&&d>=1&&(a.scaleResolutionDownBy=d))),rk("DSCP_TYPE")&&ZA()&&(h=rk("DSCP_TYPE"),Br(p=["very-low","low","medium","high"]).call(p,h)&&(a.networkPriority=h)),f=n.getParameters(),_=null===(r=f.encodings)||void 0===r?void 0:r[0],LA()&&!_&&(i.encodings=[a]),_&&Object.assign(_,a),Object.assign(f,i),Dk.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),e.next=25,n.setParameters(f);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.applySendEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Gk().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=a instanceof mL&&!this.isVP8Simulcast(a),!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i.sender);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),Dk.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t,n){return e.apply(this,arguments)}}(),n.mungSendOfferSDP=function(e,t,n){var r=this,i=pk(e);return t.forEach((function(e,t){var a=n[t],o=i.mediaDescriptions.find((function(e){return e.attributes.mid===a}));o&&(BU(o,e),KU(o,e,r.store.codec))})),lk(i)},n.bindStatsEvents=function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}},n.unbindStatsEvents=function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0},n.applySimulcastForFirefox=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d,p,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(u=t[r],!((d=n[r])instanceof mL&&!Br(i=d._hints).call(i,sN.LOW_STREAM)&&null!==(a=d._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(o=d._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(s=d._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(c=d._scalabilityMode)||void 0===c?void 0:c.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return p={},h={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4},p.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}],f=u.sender.getParameters(),e.next=10,u.sender.setParameters(Object.assign(f,p));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.applySimulcastEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(LA()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof mL&&this.isVP8Simulcast(i))){e.next=10;break}return a=t[r],o={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}],c=a.sender.getParameters(),e.next=10,a.sender.setParameters(Object.assign(c,o));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.isVP8Simulcast=function(e){var t,n,r,i,a;return!!(e instanceof mL&&rk("SIMULCAST")&&"vp8"===this.store.codec&&!Br(t=e._hints).call(t,sN.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)},n.logSDPExchange=function(e,t,n,r){var i=this;if(rk("SDP_LOGGING"))return Dk.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0},n.muteLocal=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),n.unmuteLocal=function(){var e=p(l().mark((function e(t){var n,r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})))),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),n.getRemoteSSRC=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=null!=n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp)){e.next=3;break}return a=null===(i=pk(n).mediaDescriptions.find((function(e){return e.attributes.mid===t})))||void 0===i?void 0:i.attributes.ssrcs,e.abrupt("return",null==a?void 0:a[0].ssrcId);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setRemoteDescription=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.setRemoteDescription(t);case 2:Br(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.mungReceiveAnswerSDP=function(e,t,n){var r=pk(e),i=r.mediaDescriptions.find((function(e){return e.attributes.mid===t}));return i&&n===OM.AUDIO&&"audio"===i.media.mediaType&&QU(i),lk(r)},v(t,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"dtlsTransportState",get:function(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}},{key:"localCodecs",get:function(){return[]}},{key:"isInRestartIce",get:function(){return this._isInRestartIce},set:function(e){this._isInRestartIce=e}}]),t}(AM)).prototype,"establish",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"establish"),eq.prototype),Wx(eq.prototype,"connect",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"connect"),eq.prototype),Wx(eq.prototype,"receive",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"receive"),eq.prototype),Wx(eq.prototype,"mockReceive",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"mockReceive"),eq.prototype),Wx(eq.prototype,"stopReceiving",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"stopReceiving"),eq.prototype),Wx(eq.prototype,"restartICE",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"restartICE"),eq.prototype),Wx(eq.prototype,"close",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"close"),eq.prototype),Wx(eq.prototype,"updateEncoderConfig",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"updateEncoderConfig"),eq.prototype),Wx(eq.prototype,"updateSendParameters",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"updateSendParameters"),eq.prototype),Wx(eq.prototype,"replaceTrack",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"replaceTrack"),eq.prototype),Wx(eq.prototype,"muteLocal",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"muteLocal"),eq.prototype),Wx(eq.prototype,"unmuteLocal",[oq],Object.getOwnPropertyDescriptor(eq.prototype,"unmuteLocal"),eq.prototype),eq);function oq(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=p(l().mark((function e(){var n,i,a,o,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=c.length,o=new Array(a),s=0;s<a;s++)o[s]=c[s];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}var sq,cq,uq,dq,pq,lq,hq,fq,_q,vq,Eq,mq,Sq=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function gq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gq(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bq=(sq=Rq(Sq.SEND_ONLY),cq=Rq(Sq.SEND_ONLY),uq=Rq(),dq=Rq(Sq.RECEIVE_ONLY),pq=Rq(Sq.RECEIVE_ONLY),lq=Rq(Sq.RECEIVE_ONLY),hq=Rq(Sq.RECEIVE_ONLY),fq=Rq(Sq.RECEIVE_ONLY),_q=Rq(Sq.RECEIVE_ONLY),vq=Rq(),Eq=Rq(Sq.RECEIVE_ONLY),Wx((mq=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"isPlanB",!1),XC(r(i),"store",void 0),XC(r(i),"statsUploader",void 0),XC(r(i),"sendConnection",void 0),XC(r(i),"recvConnection",void 0),XC(r(i),"localTrackMap",new Map),XC(r(i),"remoteUserMap",new Map),XC(r(i),"localDataChannels",[]),XC(r(i),"pendingLocalTracks",[]),XC(r(i),"pendingRemoteTracks",[]),XC(r(i),"statsCollector",void 0),XC(r(i),"dtlsFailedCount",0),XC(r(i),"sendMutex",void 0),XC(r(i),"recvMutex",void 0),XC(r(i),"_state",LM.Disconnected),XC(r(i),"_restartStates",["disconnected","failed"]),XC(r(i),"reconnectInterval",void 0),XC(r(i),"uploadUnplinkStarted",!1),XC(r(i),"uploadDownlinkStarted",!1),XC(r(i),"uplinkStateUploadInterval",void 0),XC(r(i),"downlinkStatsUploadInterval",void 0),XC(r(i),"handleMuteLocalTrack",p(l().mark((function e(t,n,a){var o,s,c,u,d,p,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.sendConnection&&i.state===LM.Connected){e.next=6;break}return e.abrupt("return",void a(new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.")));case 6:if(0!==(s=i.filterTobeMutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return(c=s.find((function(e){return"videoLowTrack"===e[0]})))&&c[1].track._originMediaStreamTrack.stop(),e.next=13,i.sendConnection.muteLocal(s.map((function(e){return e[1].id})));case 13:return u=!1,u="video"===t.trackMediaType?!(null===(d=i.localTrackMap.get(PM.LocalAudioTrack))||void 0===d||!d.track._muted):void 0===(null===(p=i.localTrackMap.get(PM.LocalVideoTrack))||void 0===p?void 0:p.id),h=i.createMuteMessage(s),e.next=18,Mw(r(i),xM.RequestMuteLocal,h);case 18:return f="video"===t.trackMediaType?YM.MUTE_LOCAL_VIDEO:YM.MUTE_LOCAL_AUDIO,e.next=21,Mw(r(i),xM.RequestP2PMuteLocal,{action:f,message:h,isMuteAll:u});case 21:n(),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(3),a(e.t0);case 27:return e.prev=27,o(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[3,24,27,30]])})))),XC(r(i),"handleUnmuteLocalTrack",p(l().mark((function e(t,n,a){var o,s,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");case 2:if(o=e.sent,e.prev=3,i.sendConnection&&i.state===LM.Connected){e.next=6;break}return e.abrupt("return",void a(new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established.")));case 6:if(0!==(s=i.filterTobeUnmutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return e.next=11,i.sendConnection.unmuteLocal(s.map((function(e){return e[1].id})));case 11:return c=i.createUnmuteMessage(s),u="video"===t.trackMediaType?YM.UNMUTE_LOCAL_VIDEO:YM.UNMUTE_LOCAL_AUDIO,e.next=14,Mw(r(i),xM.RequestP2PMuteLocal,{action:u,message:c});case 14:n(),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),a(e.t0);case 20:return e.prev=20,o(),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[3,17,20,23]])})))),XC(r(i),"handleUpdateVideoEncoder",p(l().mark((function e(t,n,r,a){var o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="boolean"==typeof a&&a,e.t0){e.next=5;break}return e.next=4,i.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder");case 4:o=e.sent;case 5:if(e.prev=5,s=i.localTrackMap.get(PM.LocalVideoTrack),i.sendConnection&&s&&s.track===t&&i.state===LM.Connected){e.next=9;break}return e.abrupt("return",void n());case 9:if(c=s.id,u=s.track,e.t1=c,!e.t1){e.next=17;break}return e.next=14,i.sendConnection.updateSendParameters(c,u);case 14:return e.next=16,i.sendConnection.updateEncoderConfig(c,u);case 16:i.emit(xM.UpdateVideoEncoder,u);case 17:n(),e.next=23;break;case 20:e.prev=20,e.t2=e.catch(5),r(e.t2);case 23:return e.prev=23,null===(d=o)||void 0===d||d(),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[5,20,23,26]])})))),XC(r(i),"handleUpdateVideoSendParameters",p(l().mark((function e(t,n,r){var a,o,s,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(PM.LocalVideoTrack),i.sendConnection&&o&&o.track===t&&i.state===LM.Connected){e.next=7;break}return e.abrupt("return",void n());case 7:if(s=o.id,c=o.track,e.t0=s,!e.t0){e.next=12;break}return e.next=12,i.sendConnection.updateSendParameters(s,c);case 12:n(),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(3),r(e.t1);case 18:return e.prev=18,a(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))),XC(r(i),"handleReplaceTrack",p(l().mark((function e(t,n,r,a){var o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dk.debug("[".concat(i.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),e.t0="boolean"==typeof a&&a,e.t0){e.next=6;break}return e.next=5,i.sendMutex.lock("From P2PChannel2.handleReplaceTrack");case 5:o=e.sent;case 6:if(e.prev=6,c=Array.from(i.localTrackMap.entries()).find((function(e){var n=e[1].track;return t===n})),i.sendConnection&&c&&void 0!==c[1].id&&i.state===LM.Connected){e.next=10;break}return e.abrupt("return",void n());case 10:return e.next=12,null===(s=i.sendConnection)||void 0===s?void 0:s.replaceTrack(t,c[1].id);case 12:if(c[0]!==PM.LocalVideoTrack||!Gk().supportDualStreamEncoding){e.next=21;break}if(!(u=i.localTrackMap.get(PM.LocalVideoLowTrack))){e.next=21;break}return d=t._mediaStreamTrack.clone(),u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d,e.next=21,new zl((function(e,t){i.handleReplaceTrack(u.track,e,t,!0)}));case 21:n(),e.next=27;break;case 24:e.prev=24,e.t1=e.catch(6),r(e.t1);case 27:return e.prev=27,null===(p=o)||void 0===p||p(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[6,24,27,30]])})))),XC(r(i),"handleGetLocalVideoStats",(function(e){e(i.statsCollector.getLocalVideoTrackStats())})),XC(r(i),"handleGetLocalAudioStats",(function(e){e(i.statsCollector.getLocalAudioTrackStats())})),XC(r(i),"handleGetRemoteVideoStats",(function(e){return i.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]})),XC(r(i),"handleGetRemoteAudioStats",(function(e){return i.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]})),i.store=t,i.statsCollector=n,i.statsCollector.addP2PChannel(r(i)),i.statsUploader=new aB(t),i.bindStatsUploaderEvents(),i.sendMutex=new fO("P2PChannel2-send-mutex",t.clientId),i.recvMutex=new fO("P2PChannel2-recv-mutex",t.clientId),i.reconnectInterval=window.setInterval((function(){[i.sendConnection,i.recvConnection].forEach((function(e){e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||i.handleDisconnect(e.direction))}))}),rk("ICE_RESTART_INTERVAL")),i}i(t,e);var n=t.prototype;return n.startP2PConnection=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.");case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support connect.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.startP2P=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n){e.next=12;break}return this.recvConnection&&(Dk.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),e.next=5,this.recvMutex.lock("From P2PChannel.startP2P");case 5:return r=e.sent,this.recvConnection=new aq(t,this.store,eM.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),e.next=10,this.recvConnection.establish(n);case 10:return i=e.sent,e.abrupt("return",{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp});case 12:return this.state=LM.New,this.sendConnection&&(Dk.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),e.next=16,this.sendMutex.lock("From P2PChannel.startP2P");case 16:return r=e.sent,this.sendConnection=new aq(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection),e.next=22,this.sendConnection.establish();case 22:return a=e.sent,e.abrupt("return",{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp});case 24:return e.prev=24,r&&r(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[0,,24,27]])})));return function(t,n){return e.apply(this,arguments)}}(),n.p2pConnect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection){e.next=2;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");case 2:return this.store.peerConnectionStart(),e.next=5,this.sendConnection.connect(t);case 5:this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=LM.Connected;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.addRemoteCandidate=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==eM.RECEIVE_ONLY){e.next=7;break}if(this.sendConnection){e.next=3;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");case 3:return e.next=5,this.sendConnection.addRemoteCandidate(t);case 5:e.next=11;break;case 7:if(this.recvConnection){e.next=9;break}throw new aw(iw.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");case 9:return e.next=11,this.recvConnection.addRemoteCandidate(t);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.publish=function(e,t,n){var r=this;return OI(l().mark((function i(){var a,o,s,c,u,d;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,NI(r.sendMutex.lock("From P2PChannel.publish"));case 2:if(a=i.sent,i.prev=3,r.sendConnection&&r.state===LM.Connected){i.next=8;break}return r.throwIfTrackTypeNotMatch(e),o=e.filter((function(e){return-1===r.pendingLocalTracks.indexOf(e)})),i.abrupt("return",void(r.pendingLocalTracks=r.pendingLocalTracks.concat(o)));case 8:if(r.store.pubId=r.store.pubId+1,lF.markPublishStart(r.store.clientId,r.store.pubId),0!==(s=r.filterTobePublishedTracks(e,t,n)).length){i.next=14;break}return i.next=13,NI(r.tryToUnmuteAudio(e));case 13:return i.abrupt("return",void i.sent);case 14:return s.forEach((function(e){var t=e.track,n=e.type,i=Date.now();r.store.publish(t.getTrackId(),n===PM.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(s),i.next=17,NI(r.sendConnection.send(s.map((function(e){return e.track})),r.store.codec,r.store.audioCodec));case 17:return c=i.sent,i.next=20,NI(c.next());case 20:return u=i.sent.value,d=r.createGatewayPublishMessage(s,u),i.prev=22,i.next=25,d;case 25:i.next=30;break;case 27:throw i.prev=27,i.t0=i.catch(22),c.throw(i.t0),(null==i.t0?void 0:i.t0.code)===iw.WS_ABORT&&s.forEach((function(e){var t=e.track;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(s),i.t0;case 30:return i.next=32,NI(c.next());case 32:s.forEach((function(e){var t=e.type;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,u),s.forEach((function(e){var t=e.track,n=e.type,i=Date.now();r.store.publish(t.getTrackId(),n===PM.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState();case 37:return i.prev=37,a(),i.finish(37);case 40:case"end":return i.stop()}}),i,null,[[3,,37,40],[22,27]])})))()},n.unpublish=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.state===LM.Connected){e.next=2;break}return e.abrupt("return",void(0===t.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((function(e){return!Br(t).call(t,e)}))));case 2:if(0!==(n=this.filterTobeUnpublishedTracks(t)).length){e.next=5;break}return e.abrupt("return");case 5:return(r=n.find((function(e){return"videoLowTrack"===e[0]})))&&r[1].track.close(),i=this.createGatewayUnpublishMessage(n),e.next=10,this.sendConnection.stopSending(n.map((function(e){return e[1].id})));case 10:if(this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map((function(e){return{type:e[0],track:e[1].track}}))),n.forEach((function(e){var t=e[0];a.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),!this.sendConnection||this.state!==LM.Connected){e.next=17;break}return r&&r[1].track.close(),e.abrupt("return",i);case 17:t.forEach((function(e){var t=a.pendingLocalTracks.indexOf(e);-1!==t&&a.pendingLocalTracks.splice(t,1)}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.startUploadUplinkState=function(){var e=this;if(!this.uploadUnplinkStarted){this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);var t=function(){var t=[],n=[];Array.from(e.localTrackMap.entries()).forEach((function(e){var r=e[0],i=e[1],a=i.track,o=i.ssrcs,s={stream_type:xF(a,r),ssrcs:o};a._muted||!a._enabled?t.push(s):n.push(s)})),t.length>0&&t.forEach((function(t){Mw(e,xM.RequestMuteLocal,[t])})),n.length>0&&n.forEach((function(t){Mw(e,xM.RequestUnmuteLocal,[t])}))};t(),this.uplinkStateUploadInterval=window.setInterval((function(){t()}),3e3)}},n.stopUploadUplinkState=function(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))},n.publishLowStream=function(e){return OI(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support publishLowStream.");case 1:case"end":return e.stop()}}),e)})))()},n.republish=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.pendingLocalTracks.length>0,!e.t0){e.next=7;break}return Dk.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),e.next=5,xw(this,xM.RequestRePublish,this.pendingLocalTracks);case 5:this.emit(xM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[];case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.unpublishLowStream=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n.subscribe=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}throw new aw(iw.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");case 2:if(null===(a=this.remoteUserMap.get(t))||void 0===a||!a.has(n)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.recvConnection.receive(n,[{ssrcId:r}],String(t.uid),i);case 6:o=e.sent,s=o.track,c=o.mid,u=o.transceiver,n===OM.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new RL(s,t.uid,t._uintid,this.store),Dk.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=r,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new bL(s,t.uid,t._uintid,this.store),Dk.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack)),(d=this.remoteUserMap.get(t))?d.set(n,c):this.remoteUserMap.set(t,new Map([[n,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState(),-1!==(p=this.pendingRemoteTracks.findIndex((function(e){var r=e.user,i=e.kind;return r.uid===t.uid&&n===i})))&&(this.pendingRemoteTracks.splice(p,1),this.emit(xM.MediaReconnectEnd,t.uid));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.mockSubscribe=function(){var e=p(l().mark((function e(t,n,r,i){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}throw new aw(iw.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");case 2:return e.next=4,this.recvConnection.mockReceive(n,[{ssrcId:r}],String(t.uid),i);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.unsubscribe=function(){var e=p(l().mark((function e(t,n,r){var i,a,o=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=this.pendingRemoteTracks.filter((function(e){var r=e.user,i=e.kind;return void 0!==n?r.uid===t.uid&&n===i:r.uid===t.uid}))).forEach((function(e){var t=o.pendingRemoteTracks.indexOf(e);o.pendingRemoteTracks.splice(t,1)})),this.recvConnection||r||i.forEach((function(e){var n,r=e.kind;if(r===OM.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(r===OM.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}})),this.recvConnection){e.next=3;break}return e.abrupt("return");case 3:if(a=this.filterTobeUnSubscribedTracks(t,n),e.t0=0!==a.length,!e.t0){e.next=12;break}return e.next=8,this.recvConnection.stopReceiving(a.map((function(e){return e[1].id})));case 8:this.withdrawRemoteTracks(a),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach((function(e){var t,n,i=e[0],a=e[1].kind;if(a===OM.VIDEO&&i._videoSSRC&&(null===(t=o.recvConnection)||void 0===t||t.setStatsRemoteVideoIsReady(i._videoSSRC,!1)),a===OM.VIDEO)o.unbindRemoteTrackEvents(i._videoTrack),r||(null===(n=i._videoTrack)||void 0===n||n._destroy(),i._videoTrack=void 0);else if(a===OM.AUDIO){var s;o.unbindRemoteTrackEvents(i._audioTrack),r||(null===(s=i._audioTrack)||void 0===s||s._destroy(),i._audioTrack=void 0)}})),a.forEach((function(e){var t=e[1].kind;Mw(o,xM.RequestP2PMuteRemote,t)}));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.startUploadDownlinkState=function(){var e=this;if(!this.uploadDownlinkStarted){this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);var t=function(){return Array.from(e.remoteUserMap.entries()).forEach((function(t){var n=t[1];[OM.VIDEO,OM.AUDIO].forEach((function(t){n.has(t)?Mw(e,xM.RequestP2PUnmuteRemote,t):Mw(e,xM.RequestP2PMuteRemote,t)}))}))};t(),this.downlinkStatsUploadInterval=window.setInterval((function(){t()}),3e3)}},n.stopUploadDownlinkState=function(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))},n.getAllDataChannels=function(){return this.localDataChannels},n.massSubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support massSubscribe.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.massSubscribeNoLock=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.massUnsubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.massUnsubscribeNoLock=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.muteRemote=function(){var e=p(l().mark((function e(t,n){var r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,".")));case 5:if(r.get(n)){e.next=7;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(n,".")));case 7:void 0!==(i=n===OM.VIDEO?t._videoSSRC:t._audioSSRC)&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteRemote=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.unmuteRemoteNoLock(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.unmuteRemoteNoLock=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void Dk.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,".")));case 5:r.get(n)||Dk.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(n,"."));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.getAllTracks=function(e){var t=this.localTrackMap.get(PM.LocalAudioTrack);if((null==t?void 0:t.track)instanceof EP){var n=t.track;return Array.from(this.localTrackMap.entries()).filter((function(e){return e[0]!==PM.LocalAudioTrack})).filter((function(t){var n=t[0];return!(e&&n===PM.LocalVideoLowTrack)})).map((function(e){return e[1].track})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((function(t){var n=t[0];return!(e&&n===PM.LocalVideoLowTrack)})).map((function(e){return e[1].track}))},n.reportPublishEvent=function(e,t,n,r,i){if(e){var a=this.localTrackMap.get(PM.LocalAudioTrack),o=r?this.localTrackMap.get(PM.LocalVideoLowTrack):this.localTrackMap.get(PM.LocalVideoTrack);Fk.publish(this.store.sessionId,{eventElapse:lF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(sN.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);var c=n.find((function(e){return e instanceof fP})),u=r?null===(s=this.localTrackMap.get(PM.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((function(e){return e instanceof mL}));Fk.publish(this.store.sessionId,{eventElapse:lF.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==c?void 0:c.getTrackLabel(),videoName:null==u?void 0:u.getTrackLabel(),screenshare:-1!==(null==u?void 0:u._hints.indexOf(sN.SCREEN_TRACK)),audio:!!c,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}},n.reportSubscribeEvent=function(e,t,n,r){var i=r===OM.VIDEO?n._videoSSRC:n._audioSSRC;i&&Fk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===OM.VIDEO,audio:r===OM.AUDIO,peerid:n.uid,subscribeRequestid:r===OM.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:lF.measureFromSubscribeStart(this.store.clientId,i)})},n.reset=function(){Dk.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new fO("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new fO("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();var e=this.localTrackMap.get(PM.LocalAudioTrack);if((null==e?void 0:e.track)instanceof EP){if(e.track.trackList.length>0){var t=e.track;e.track.trackList.forEach((function(e){t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=LM.Disconnected},n.getStats=function(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()},n.getRemoteVideoIsReady=function(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1},n.getLocalAudioVolume=function(){var e=this.localTrackMap.get(PM.LocalAudioTrack);if(e)return e.track.getVolumeLevel()},n.getLocalVideoSize=function(){var e=this.localTrackMap.get(PM.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}},n.getEncoderConfig=function(e){var t=this.localTrackMap.get(e);return t&&t.track instanceof mL||t&&t.track instanceof fP?t.track._encoderConfig:void 0},n.getLocalMedia=function(e){return this.localTrackMap.get(e)},n.hasLocalMedia=function(){return this.localTrackMap.size>0},n.hasRemoteMedia=function(e,t){if(!e)return this.remoteUserMap.size>0;var n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))},n.hasRemoteMediaWithLock=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this.remoteUserMap.size>0);case 2:return r=this.remoteUserMap.get(t),e.abrupt("return",!!r&&(!n||r.has(n)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.getRemoteMedia=function(e){var t,n=Array.from(gk(t=this.remoteUserMap).call(t)).find((function(t){return t.uid===e}));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}},n.getAudioLevels=function(){var e=Array.from(this.remoteUserMap.entries()).map((function(e){var t=e[0];return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(PM.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Vh(e).call(e,(function(e,t){return e.level-t.level}))},n.disconnectForReconnect=function(){var e=p(l().mark((function e(){var t=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sendConnection&&this.recvConnection&&(Dk.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=LM.Reconnecting,rk("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var t,n=e[0];n._videoTrack&&n._videoTrack._player&&(null===(t=n._videoTrack._player.getVideoElement())||void 0===t||t.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((function(e){var n,r=e[0],i=e[1].track;switch(r){case PM.LocalVideoTrack:Br(n=i._hints).call(n,sN.LOW_STREAM)?i.close():t.pendingLocalTracks.push(i);break;case PM.LocalAudioTrack:i instanceof EP?t.pendingLocalTracks=t.pendingLocalTracks.concat(i.trackList):t.pendingLocalTracks.push(i);case PM.LocalVideoLowTrack:}})),this.emit(xM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var n=e[0],r=e[1];Array.from(gk(r).call(r)).forEach((function(e){t.setPendingRemoteMedia(n,e)})),t.emit(xM.MediaReconnectStart,n.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Dk.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.hasPendingRemoteMedia=function(e,t){for(var n,r=h(this.pendingRemoteTracks);!(n=r()).done;){var i=n.value,a=i.user,o=i.kind;if((e instanceof mF?e.uid:e)===a.uid&&t===o)return!0}return!1},n.setPendingRemoteMedia=function(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})},n.restartICE=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==eM.SEND_ONLY){e.next=9;break}if(this.sendConnection){e.next=3;break}throw new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");case 3:return e.next=5,this.sendMutex.lock("From P2PChannel.restartICE");case 5:r=e.sent,i=this.sendConnection,e.next=15;break;case 9:if(this.recvConnection){e.next=11;break}throw new aw(iw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");case 11:return e.next=13,this.recvMutex.lock("From P2PChannel.restartICE");case 13:r=e.sent,i=this.recvConnection;case 15:if(e.prev=15,!n){e.next=21;break}return e.next=19,i.restartICE(n);case 19:return a=e.sent,e.abrupt("return",(i.isInRestartIce=!1,a));case 21:return e.next=23,i.restartICE();case 23:if(!(o=e.sent)){e.next=31;break}return e.next=27,xw(this,xM.RequestP2PRestartICE,{direction:eM.RECEIVE_ONLY,iceParameter:o});case 27:return s=e.sent,e.next=30,i.restartICE(s);case 30:i.isInRestartIce=!1;case 31:return e.prev=31,r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[15,,31,34]])})));return function(t,n){return e.apply(this,arguments)}}(),n.getUplinkNetworkQuality=function(){if(!this.sendConnection)return 0;var e=this.sendConnection.getStats(),t=this.localTrackMap.get(PM.LocalVideoTrack),n=this.localTrackMap.get(PM.LocalAudioTrack),r=e.videoSend.find((function(e){var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((function(e){var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;var a=Uw(this,xM.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,d=100*e.sendPacketLossRate*.7/50+.3*u/1500,p=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,l=null==t?void 0:t.track;if(l&&l._encoderConfig&&-1===l._hints.indexOf(sN.SCREEN_TRACK)){var h=l._encoderConfig.bitrateMax,f=e.bitrate.actualEncoded;if(h&&f){var _=(1e3*h-f)/(1e3*h);return ix[_<.15?0:_<.3?1:_<.45?2:_<.6?3:4][p]}}return p},n.getDownlinkNetworkQuality=function(){var e=this;if(!this.recvConnection)return 0;var t=this.recvConnection.getStats(),n=0;return Array.from(this.remoteUserMap.entries()).forEach((function(r){var i=r[0],a=i._audioSSRC,o=i._videoSSRC,s=t.audioRecv.find((function(e){return e.ssrc===a})),c=t.videoRecv.find((function(e){return e.ssrc===o}));if(s||c){var u=Uw(e,xM.NeedSignalRTT),d=t.rtt,p=(d&&u?(d+u)/2:d||u)||0,l=s?s.jitterMs:void 0,h=t.recvPacketLossRate,f=.7*h*100/50+.3*p/1500;l&&(f=.6*h*100/50+.2*p/1500+.2*l/400),n+=f<.1?1:f<.17?2:f<.36?3:f<.59?4:5}else n+=1})),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n},n.muteLocalTrack=function(){var e=p(l().mark((function e(t){var n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new zl((function(e,r){n.handleMuteLocalTrack(t,e,r)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.filterTobePublishedTracks=function(e,t,n){for(var r,i=[],a=Gk(),o=this.getAllTracks(),s=!1,c=!1,u=h(e=jw(e=e.filter((function(e){return-1===o.indexOf(e)}))));!(r=u()).done;){var d=r.value;if(d instanceof mL&&(this.localTrackMap.has(PM.LocalVideoTrack)||s?new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:PM.LocalVideoTrack}),s=!0),t)){var p=this.getLowVideoTrack(d,n);i.push({track:p,type:PM.LocalVideoLowTrack})}if(d instanceof fP){var l=this.localTrackMap.get(PM.LocalAudioTrack);if(l){if(!(l.track instanceof EP))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(c){var f=i.find((function(e){return e.type===PM.LocalAudioTrack}));if(!(f.track instanceof EP))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(d)}else{if(!a.webAudioMediaStreamDest||d instanceof EP||d._bypassWebAudio)i.push({track:d,type:PM.LocalAudioTrack});else{var _=new EP;_.addAudioTrack(d),i.push({track:_,type:PM.LocalAudioTrack})}c=!0}}}return i},n.filterTobeUnpublishedTracks=function(e){for(var t,n=[],r=this.getAllTracks(),i=h(e=jw(e=e.filter((function(e){return-1!==r.indexOf(e)}))));!(t=i()).done;){var a=t.value;if(a instanceof fP){var o=this.localTrackMap.get(PM.LocalAudioTrack);if(!o)continue;o.track instanceof EP?(o.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===o.track.trackList.length&&(n.push([PM.LocalAudioTrack,o]),o.track.close())):n.push([PM.LocalAudioTrack,o])}if(a instanceof mL){var s=this.localTrackMap.get(PM.LocalVideoTrack);if(!s)continue;n.push([PM.LocalVideoTrack,s]);var c=this.localTrackMap.get(PM.LocalVideoLowTrack);c&&n.push([PM.LocalVideoLowTrack,c])}}return n},n.bindLocalTrackEvents=function(e){var t=this;e.forEach((function(e){var n=e.track;switch(e.type){case PM.LocalVideoTrack:n.addListener(oN.GET_STATS,t.handleGetLocalVideoStats),n.addListener(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.addListener(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.addListener(oN.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.addListener(oN.NEED_UPDATE_VIDEO_SEND_PARAMETERS,t.handleUpdateVideoSendParameters),n.addListener(oN.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.addListener(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.addListener(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case PM.LocalAudioTrack:t.bindLocalAudioTrackEvents(n);case PM.LocalVideoLowTrack:}}))},n.bindLocalAudioTrackEvents=function(e,t){var n=this;e instanceof EP?e.trackList.forEach((function(e){e.addListener(oN.NEED_DISABLE_TRACK,n.handleMuteLocalTrack),e.addListener(oN.NEED_ENABLE_TRACK,n.handleUnmuteLocalTrack),e.addListener(oN.GET_STATS,n.handleGetLocalAudioStats),e.addListener(oN.NEED_MUTE_TRACK,n.handleMuteLocalTrack),e.addListener(oN.NEED_UNMUTE_TRACK,n.handleUnmuteLocalTrack)})):(e.addListener(oN.GET_STATS,this.handleGetLocalAudioStats),e.addListener(oN.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(oN.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(oN.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(oN.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(oN.NEED_REPLACE_TRACK,this.handleReplaceTrack))},n.unbindLocalTrackEvents=function(e){var t=this;e||(e=Array.from(this.localTrackMap.entries()).map((function(e){var t=e[0];return{track:e[1].track,type:t}}))),e.forEach((function(e){var n=e.track;switch(e.type){case PM.LocalVideoTrack:n.off(oN.GET_STATS,t.handleGetLocalVideoStats),n.off(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.off(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.off(oN.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.off(oN.NEED_UPDATE_VIDEO_SEND_PARAMETERS,t.handleUpdateVideoSendParameters),n.off(oN.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.off(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.off(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case PM.LocalAudioTrack:t.unbindLocalAudioTrackEvents(n);case PM.LocalVideoLowTrack:}}))},n.unbindLocalAudioTrackEvents=function(e){var t=this;e instanceof EP?e.trackList.forEach((function(e){e.off(oN.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),e.off(oN.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),e.off(oN.GET_STATS,t.handleGetLocalAudioStats),e.off(oN.NEED_MUTE_TRACK,t.handleMuteLocalTrack),e.off(oN.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack)})):(e.off(oN.GET_STATS,this.handleGetLocalAudioStats),e.off(oN.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(oN.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(oN.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(oN.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(oN.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))},n.bindRemoteTrackEvents=function(e,t){var n=this;t instanceof bL&&t.addListener(oN.GET_STATS,(function(t){t(n.handleGetRemoteVideoStats(e))})),t instanceof RL&&t.addListener(oN.GET_STATS,(function(t){t(n.handleGetRemoteAudioStats(e))}))},n.unbindRemoteTrackEvents=function(e){e&&e.removeAllListeners(oN.GET_STATS)},n.unbindAllRemoteTrackEvents=function(){var e=this;Array.from(this.remoteUserMap.entries()).forEach((function(t){var n=t[0],r=t[1];r.has(OM.AUDIO)&&e.unbindRemoteTrackEvents(n._audioTrack),r.has(OM.VIDEO)&&e.unbindRemoteTrackEvents(n._videoTrack)}))},n.createGatewayPublishMessage=function(e,t){return e.map((function(e,n){var r,i,a=e.track,o=e.type;switch(o){case PM.LocalAudioTrack:i=EM.Audio;break;case PM.LocalVideoTrack:i=Br(r=a._hints).call(r,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:i=EM.Low}return{kind:o===PM.LocalAudioTrack?OM.AUDIO:OM.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:a.muted||!a.enabled}}))},n.createGatewayUnpublishMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.assignLocalTracks=function(e,t){var n=this;e.forEach((function(e,r){var i=e.track,a=e.type;n.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))},n.withdrawLocalTracks=function(e){var t=this;e.forEach((function(e){var n=e[0];t.localTrackMap.delete(n)}))},n.bindConnectionEvents=function(e){var t=this;e.onConnectionStateChange=p(l().mark((function n(r){var i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),t.emit(xM.PeerConnectionStateChange,r),"connected"!==r||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"connected"===r&&(e.isInRestartIce=!1),n.t0=Br(i=t._restartStates).call(i,r)&&!e.isInRestartIce,!n.t0){n.next=11;break}if(n.t1="disconnected"===r,!n.t1){n.next=10;break}return n.next=10,eO(800);case 10:"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||t.handleDisconnect(e.direction);case 11:case"end":return n.stop()}}),n)}))),e.onICEConnectionStateChange=function(e){"connected"!==e||t.store.keyMetrics.iceConnectionEnd||t.store.iceConnectionEnd(),Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Fk.reportApiInvoke(t.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Cw.TRACER}).onSuccess(),t.emit(xM.IceConnectionStateChange,e)},e.onICETransportStateChange=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=function(e){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=function(e){var n,r,i=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));i&&(t.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(hN.FIRST_FRAME_DECODED),Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_AUDIO_DECODE,Mk.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId}))},e.onFirstAudioReceived=function(e){var n,r=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));r&&Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_AUDIO_RECEIVED,Mk.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onFirstVideoDecoded=function(e,n,r){t.reportVideoFirstFrameDecoded(e,n,r)},e.onFirstVideoReceived=function(e){var n,r=Array.from(gk(n=t.remoteUserMap).call(n)).find((function(t){return t._videoSSRC===e}));r&&Fk.firstRemoteFrame(t.store.sessionId,xk.FIRST_VIDEO_RECEIVED,Mk.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:lF.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onSelectedLocalCandidateChanged=function(e,n){var r="relay"===e.candidateType,i="relay"===n.candidateType;"unknown"!==n.candidateType&&r===i||t.emit(xM.ConnectionTypeChange,r),Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(yU(n))," -> ").concat(JSON.stringify(yU(e)),")"))},e.onSelectedRemoteCandidateChanged=function(e,n){Dk.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(yU(n))," -> ").concat(JSON.stringify(yU(e)),")"))},e.onFirstVideoDecodedTimeout=function(e){t.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=function(n){t.emit(xM.LocalCandidate,{candidate:n,direction:e.direction})}},n.unbindConnectionEvents=function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0},n.handleDisconnect=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=t===eM.SEND_ONLY?this.sendConnection:this.recvConnection)&&!n.isInRestartIce&&(n.isInRestartIce=!0,Dk.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),t===eM.SEND_ONLY?this.restartICE(t):xw(this,xM.RequestP2PRestartICE,{direction:eM.SEND_ONLY}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.filterTobeMutedTracks=function(e){var t=[];if(-1===this.getAllTracks().indexOf(e))return t;var n=this.localTrackMap.get(PM.LocalAudioTrack);if(e instanceof fP&&(null==n?void 0:n.track)instanceof EP)return n.track.isActive||t.push([PM.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=t[1].track;return e===n}));if(r&&(t.push(r),r[0]===PM.LocalVideoTrack)){var i=this.localTrackMap.get(PM.LocalVideoLowTrack);i&&t.push([PM.LocalVideoLowTrack,i])}return t},n.filterTobeUnmutedTracks=function(e){var t=[],n=this.localTrackMap.get(PM.LocalAudioTrack);if(e instanceof fP&&(null==n?void 0:n.track)instanceof EP)return n.track.isActive&&t.push([PM.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=t[1].track;return e===n}));if(r)if(r[0]===PM.LocalVideoTrack){t.push(r);var i=this.localTrackMap.get(PM.LocalVideoLowTrack);i&&t.push([PM.LocalVideoLowTrack,i])}else t.push(r);return t},n.createMuteMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.createUnmuteMessage=function(e){return e.map((function(e){var t,n,r=e[0],i=e[1],a=i.track,o=i.ssrcs,s=i.id;switch(r){case PM.LocalAudioTrack:n=EM.Audio;break;case PM.LocalVideoTrack:n=Br(t=a._hints).call(t,sN.SCREEN_TRACK)?EM.Screen:EM.High;break;case PM.LocalVideoLowTrack:n=EM.Low}return{stream_type:n,ssrcs:o,mid:s}}))},n.filterTobeUnSubscribedTracks=function(e,t){var n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){var i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((function(t){var r=t[0],i=t[1];n.push([e,{kind:r,id:i}])}));return n},n.createUnsubscribeMessage=function(e){var t=[];return e.forEach((function(e){var n=e[0],r=e[1],i=r.kind;switch(r.id,i){case OM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:OM.VIDEO,ssrcId:n._videoSSRC}));case OM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:OM.AUDIO,ssrcId:n._audioSSRC}))}})),t},n.withdrawRemoteTracks=function(e){var t=this;e.forEach((function(e){var n=e[0],r=e[1].kind,i=t.remoteUserMap.get(n);i&&(i.delete(r),0===Array.from(i.entries()).length&&t.remoteUserMap.delete(n))}))},n.updateBitrateLimit=function(){var e=p(l().mark((function e(t){var n,r,i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.localTrackMap.get(PM.LocalVideoTrack),r=this.localTrackMap.get(PM.LocalVideoLowTrack),e.t0=n,!e.t0){e.next=7;break}return e.next=5,n.track.setBitrateLimit(t.uplink);case 5:return e.next=7,new zl((function(e,t){i.handleUpdateVideoEncoder(n.track,e,t,!0)}));case 7:if(e.t1=r&&t.low_stream_uplink,!e.t1){e.next=13;break}return e.next=11,r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0});case 11:return e.next=13,new zl((function(e,t){i.handleUpdateVideoEncoder(r.track,e,t,!0)}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.isP2PDisconnected=function(){if(this.sendConnection&&this.recvConnection){var e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0},n.tryToUnmuteAudio=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=13;break}if(!(t[n]instanceof fP)){e.next=10;break}if(0!==(r=this.filterTobeUnmutedTracks(t[n])).length){e.next=6;break}return e.abrupt("continue",10);case 6:return i=this.createUnmuteMessage(r),e.next=9,Mw(this,xM.RequestUnmuteLocal,i);case 9:return e.abrupt("return",void e.sent);case 10:n++,e.next=1;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.bindStatsUploaderEvents=function(){var e=this;this.statsUploader.requestStats=function(t){return e.getStats(t)},this.statsUploader.requestLocalMedia=function(){return Array.from(e.localTrackMap.entries()).filter((function(e){return!!e[1].ssrcs}))},this.statsUploader.requestRemoteMedia=function(){return Array.from(e.remoteUserMap.entries())},this.statsUploader.requestVideoIsReady=function(t){var n;return!(null===(n=e.recvConnection)||void 0===n||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=function(t,n){return e.emit(xM.RequestUpload,t,n)},this.statsUploader.requestUploadStats=function(t){return e.emit(xM.RequestUploadStats,t)},this.statsUploader.requestAllTracks=function(){return e.getAllTracks()}},n.unbindStatsUploaderEvents=function(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0},n.requestReconnect=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dtlsFailedCount+=1,e.next=3,eO(EO(this.dtlsFailedCount,vO));case 3:this.emit(xM.RequestReconnect);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reconnectP2P=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n.canPublishLowStream=function(){return this.localTrackMap.has(PM.LocalVideoTrack)||this.pendingLocalTracks.some((function(e){return e instanceof mL}))},n.throwIfTrackTypeNotMatch=function(e){if(e.filter((function(e){return e instanceof mL})).length>1)throw new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((function(e){return e instanceof fP})).length>1&&(e.some((function(e){return e instanceof fP&&e._bypassWebAudio}))||!Gk().webAudioMediaStreamDest))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(var t,n=h(e);!(t=n()).done;){var r=t.value;if(r instanceof mL&&this.pendingLocalTracks.some((function(e){return e instanceof mL})))throw new aw(iw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof fP&&this.pendingLocalTracks.some((function(e){return e instanceof fP}))&&(!Gk().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((function(e){return e instanceof fP&&e._bypassWebAudio}))))throw new aw(iw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}},n.getLowVideoTrack=function(e,t){var n,r=!rk("DISABLE_DUAL_STREAM_USE_ENCODING")&&Gk().supportDualStreamEncoding,i=Tq(Tq({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():qF(e,i);var a=tO(8,"track-low-"),o=new mL(n,Tq(Tq({},r&&{scaleResolutionDownBy:CU(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(pN.TRANSCEIVER_UPDATED,(function(t){e._updateRtpTransceiver(t,cN.LOW_STREAM)})),o._hints.push(sN.LOW_STREAM),e.addListener(oN.NEED_CLOSE,(function(){o.close()})),o},n.globalLock=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.recvMutex.lock("From P2PChannel2.globalLock"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reportVideoFirstFrameDecoded=function(e,t,n,r){var i,a=Array.from(gk(i=this.remoteUserMap).call(i)).find((function(t){return t._videoSSRC===e}));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());var o=this.store.keyMetrics,s=o.subscribe.find((function(e){return e.userId===a.uid&&"video"===e.type}));Fk.firstRemoteVideoDecode(this.store.sessionId,xk.FIRST_VIDEO_DECODE,Mk.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:lF.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}},n.remoteMediaSsrcChanged=function(){var e=p(l().mark((function e(t,n,r){var i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",!1);case 5:if(a=i.get(n)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.recvConnection.getRemoteSSRC(a);case 10:return o=e.sent,e.abrupt("return",void 0!==o&&o!==r);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.isPreSubScribe=function(e){return!1},n.publishDataChannel=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.unpublishDataChannel=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.subscribeDataChannel=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.unsubscribeDataChannel=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.hasPendingRemoteDataChannel=function(e,t){throw new aw(iw.NOT_SUPPORTED)},n.setPendingRemoteDataChannel=function(e,t){throw new aw(iw.NOT_SUPPORTED)},n.preConnect=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.getEstablishParams=function(){throw new aw(iw.NOT_SUPPORTED)},n.reSubscribe=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.updateVideoStreamParameter=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.unbindRtpTransceiver=function(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((function(e){var t=e[0],n=e[1].track;t===PM.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,cN.LOW_STREAM):n._updateRtpTransceiver(void 0)}))},v(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(xM.StateChange,t,this._state)}}]),t}(gw)).prototype,"p2pConnect",[sq],Object.getOwnPropertyDescriptor(mq.prototype,"p2pConnect"),mq.prototype),Wx(mq.prototype,"unpublish",[cq],Object.getOwnPropertyDescriptor(mq.prototype,"unpublish"),mq.prototype),Wx(mq.prototype,"unpublishLowStream",[uq],Object.getOwnPropertyDescriptor(mq.prototype,"unpublishLowStream"),mq.prototype),Wx(mq.prototype,"subscribe",[dq],Object.getOwnPropertyDescriptor(mq.prototype,"subscribe"),mq.prototype),Wx(mq.prototype,"mockSubscribe",[pq],Object.getOwnPropertyDescriptor(mq.prototype,"mockSubscribe"),mq.prototype),Wx(mq.prototype,"unsubscribe",[lq],Object.getOwnPropertyDescriptor(mq.prototype,"unsubscribe"),mq.prototype),Wx(mq.prototype,"muteRemote",[hq],Object.getOwnPropertyDescriptor(mq.prototype,"muteRemote"),mq.prototype),Wx(mq.prototype,"unmuteRemote",[fq],Object.getOwnPropertyDescriptor(mq.prototype,"unmuteRemote"),mq.prototype),Wx(mq.prototype,"hasRemoteMediaWithLock",[_q],Object.getOwnPropertyDescriptor(mq.prototype,"hasRemoteMediaWithLock"),mq.prototype),Wx(mq.prototype,"disconnectForReconnect",[vq],Object.getOwnPropertyDescriptor(mq.prototype,"disconnectForReconnect"),mq.prototype),Wx(mq.prototype,"remoteMediaSsrcChanged",[Eq],Object.getOwnPropertyDescriptor(mq.prototype,"remoteMediaSsrcChanged"),mq.prototype),mq);function Rq(e){return function(t,n,r){var i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=p(l().mark((function t(){var r,a,o,s,c,u,d,p=arguments;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=p.length,a=new Array(r),o=0;o<r;o++)a[o]=p[o];t.t0=e,t.next=t.t0===Sq.SEND_ONLY?4:t.t0===Sq.RECEIVE_ONLY?14:24;break;case 4:return t.next=6,this.sendMutex.lock("From P2PChannel2.".concat(n));case 6:return s=t.sent,t.prev=7,t.next=10,i.apply(this,a);case 10:return t.abrupt("return",t.sent);case 11:return t.prev=11,s(),t.finish(11);case 14:return t.next=16,this.recvMutex.lock("From P2PChannel2.".concat(n));case 16:return c=t.sent,t.prev=17,t.next=20,i.apply(this,a);case 20:return t.abrupt("return",t.sent);case 21:return t.prev=21,c(),t.finish(21);case 24:return t.next=26,this.sendMutex.lock("From P2PChannel2.".concat(n));case 26:return u=t.sent,t.next=29,this.recvMutex.lock("From P2PChannel2.".concat(n));case 29:return d=t.sent,t.prev=30,t.next=33,i.apply(this,a);case 33:return t.abrupt("return",t.sent);case 34:return t.prev=34,u(),d(),t.finish(34);case 37:case"end":return t.stop()}}),t,this,[[7,,11,14],[17,,21,24],[30,,34,37]])}))),r}}var Cq=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"signal",void 0),XC(r(i),"token",void 0),XC(r(i),"tokenTimeout",void 0),XC(r(i),"tokenInterval",void 0),XC(r(i),"_sequence",0),XC(r(i),"userMap",new Map),XC(r(i),"encoder",new TextEncoder),i.signal=t,i.token=n,function e(){i.signal.connectionState===Xx.CONNECTED&&i.check(),0===i.userMap.size?i.tokenInterval=window.setTimeout(e,1e3):i.tokenInterval=window.setTimeout(e,3*rk("P2P_TOKEN_INTERVAL"))}(),i}i(t,e);var n=t.prototype;return n.send=function(){var e=p(l().mark((function e(t,n,r,i,a){var o,s,c,u,d=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.userMap.size){e.next=2;break}return e.abrupt("return");case 2:return s=Array.from(nh(o=this.userMap).call(o))[0].token,"string"!=typeof n&&(n=JSON.stringify(n)),i=null!=i?i:tO(6,""),a=null!=a?a:this._sequence++,c={_id:i,_type:t,_seq:a,_message:n,token:"".concat(this.token,"_").concat(s)},rk("SHOW_P2P_LOG")&&Dk.debug("send message",c,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(c)).forEach((function(e){d.signal.request(Qx.DATA_STREAM,{payload:zw(d.encoder.encode(e))})})),u=new zl((function(e,n){var a=window.setTimeout((function(){d.off("res-@".concat(i,"_ack"),o),d.off("res-@".concat(i),u),d.off(KM.ABORT,s),Dk.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),0===d.userMap.size?n(new aw(iw.INVALID_REMOTE_USER)):n(new aw(iw.TIMEOUT))}),rk("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),o=function(){a&&window.clearTimeout(a),d.off(KM.ABORT,s),r&&e()},s=function(){a&&window.clearTimeout(a),d.off("res-@".concat(i,"_ack"),o),d.off("res-@".concat(i),u),n(new aw(iw.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};d.once(KM.ABORT,s),d.once("res-@".concat(i,"_ack"),o);var u=function(r,c){p=!0,a&&window.clearTimeout(a),d.off("res-@".concat(i,"_ack"),o),d.off(KM.ABORT,s),"success"===r?e(c):n(new aw(iw.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))},p=!1;r||(d.once("res-@".concat(i),u),eO(rk("SIGNAL_REQUEST_TIMEOUT")).then((function(){p||Dk.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(c))})))})),e.prev=8,e.next=11,u;case 11:return e.abrupt("return",e.sent);case 14:if(e.prev=14,e.t0=e.catch(8),e.t0.code!==iw.TIMEOUT){e.next=20;break}return e.next=19,this.send(t,n,r,i,a);case 19:return e.abrupt("return",e.sent);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),n.onMessage=function(e){var t,n,r=e._uid,i=this.userMap.get(r);if(i)n=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==HM.CHECK)return;i={uid:r,isStart:!0,token:e.token,splitMessageMap:n=new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,i),this.signal.emit($x.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var a,o=e,s=o.id,c=o.total,u=null!==(a=n.get(s))&&void 0!==a?a:[];if(u.push(e),n.has(s)||n.set(s,u),u.length!==c)return;var d=Vh(u).call(u,(function(e,t){return e.index-t.index})).map((function(e){return e.payload})).join("");n.delete(s),(e=JSON.parse(d))._uid=r}var p=e,l=p._type,h=p.token;if(Br(t=[HM.ACK,HM.CHECK]).call(t,l))return l===HM.CHECK&&this.handleCheckToken(i,h),void this.receiveMessage(e);h==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):Dk.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(i.token,"_").concat(this.token),e)},n.check=function(){var e={_id:tO(6,""),token:this.token,_type:HM.CHECK};rk("SHOW_P2P_LOG")&&Dk.debug("send message",e),this.signal.request(Qx.DATA_STREAM,{payload:zw(this.encoder.encode(JSON.stringify(e)))})},n.ack=function(e){var t={_id:e,_type:HM.ACK,token:this.token};rk("SHOW_P2P_LOG")&&Dk.debug("send message",t),this.signal.request(Qx.DATA_STREAM,{payload:zw(this.encoder.encode(JSON.stringify(t)))})},n.response=function(e,t,n){this.send(HM.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)},n.handleReceivedMessage=function(e){var t=this,n=function(){t.userMap.forEach((function(e){for(var n=e.receivedMessagesMap,r=e.nextExpectedSequenceNumber;n.has(r);){var i=n.get(r);n.delete(r),t.receiveMessage(i),e.nextExpectedSequenceNumber++}}))};if(e){var r=e._uid,i=e._seq,a=this.userMap.get(r),o=a.receivedMessagesMap,s=a.isStart,c=a.nextExpectedSequenceNumber;if(i<c)return this.ack(e._id),void Dk.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));o.set(i,e),s&&i===c&&(this.receiveMessage(e),o.delete(c),a.nextExpectedSequenceNumber++,n())}else n()},n.receiveMessage=function(e){var t,n=this,r=e._id,i=e._type,a=e._message,o=e._uid;if(rk("SHOW_P2P_LOG")&&Dk.debug("receive message",e),r)switch(e._type!==HM.ACK&&(a&&(t=JSON.parse(a)),this.ack(e._id)),e._type){case HM.CANDIDATE:case HM.CONTROL:this.signal.emit(i,t,o);break;case HM.PUBLISH:case HM.UNPUBLISH:case HM.RESTART_ICE:case HM.CALL:t.uid=o,xw(this.signal,i,t).then((function(t){n.response(e._id,t)})).catch((function(){n.response(e._id,void 0,!0)}));break;case HM.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case HM.RESPONSE:var s=t,c=s.success,u=s.message;this.emit("res-@".concat(r),c?"success":"failed",u)}},n.splitMessage=function(e){if(e.length<t.MAX_MESSAGE_SIZE)return[e];for(var n=[],r=JSON.parse(e).remoteToken,i=tO(6,""),a=0,o=800,s=Math.ceil(e.length/o);e.length>0;){var c={id:i,index:++a,total:s,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(c).length>t.MAX_MESSAGE_SIZE?o-=50:(n.push(c),e=e.slice(o))}return n.map((function(e){return JSON.stringify(e)}))},n.handleCheckToken=function(e,t){var n=this;return e.token!==t?(Dk.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((function(){Dk.debug("token timeout, ".concat(t)),n.reset(e.uid)}),rk("MAX_P2P_TIMEOUT")),!0)},n.handleUserOnline=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xw(this.signal,HM.CALL,void 0);case 2:return t=e.sent,e.next=5,this.send(HM.CALL,t);case 5:n=e.sent,this.signal.emit(Jx.P2P_CONNECTION,n,!0);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reset=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=this.userMap.get(t))&&(this.emit(KM.ABORT),this.signal.emit($x.ON_USER_OFFLINE,{uid:r.uid,reason:qM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(Dk.debug("change local token from ".concat(n," to ").concat(n)),this.token=tO(6,"")));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.clear=function(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(KM.ABORT)},t}(gw);XC(Cq,"MAX_SIZE",1),XC(Cq,"MAX_MESSAGE_SIZE",1024);var yq=function(e){function t(t,n){var i;return XC(r(i=e.call(this)||this),"_disconnectedReason",void 0),XC(r(i),"_websocketReconnectReason",void 0),XC(r(i),"_connectionState",Xx.CLOSED),XC(r(i),"reconnectToken",void 0),XC(r(i),"p2pToken",void 0),XC(r(i),"websocket",void 0),XC(r(i),"openConnectionTime",void 0),XC(r(i),"clientId",void 0),XC(r(i),"lastMsgTime",Date.now()),XC(r(i),"uploadCache",[]),XC(r(i),"uploadCacheInterval",void 0),XC(r(i),"rttRolling",new gO(5)),XC(r(i),"pingpongTimer",void 0),XC(r(i),"pingpongTimeoutCount",0),XC(r(i),"joinResponse",void 0),XC(r(i),"multiIpOption",void 0),XC(r(i),"initError",void 0),XC(r(i),"spec",void 0),XC(r(i),"store",void 0),XC(r(i),"_external_signal",void 0),XC(r(i),"onWebsocketMessage",(function(e){if(e.data instanceof ArrayBuffer)i.emit(Jx.ON_BINARY_DATA,e.data);else{var t=JSON.parse(e.data);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case $x.ON_DATA_STREAM:return void i.handleDataStream(t._message);case $x.MUTE_AUDIO:case $x.MUTE_VIDEO:case $x.ON_P2P_LOST:case $x.ON_USER_ONLINE:return;case $x.ON_USER_OFFLINE:var r=t._message.uid;return Dk.debug("[".concat(i.clientId,"] user-offline uid: ").concat(r)),void i._external_signal.reset(r)}if(i.emit(t._type,t._message),t._type===$x.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===$x.ON_USER_BANNED)switch(t._message.error_code){case 14:i.close(Aw.UID_BANNED);break;case 15:i.close(Aw.IP_BANNED);break;case 16:i.close(Aw.CHANNEL_BANNED)}if(t._type===$x.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case zx.ERR_LICENSE_MISSING:i.close(Aw.LICENSE_MISSING);break;case zx.ERR_LICENSE_EXPIRED:i.close(Aw.LICENSE_EXPIRED);break;case zx.ERR_LICENSE_MINUTES_EXCEEDED:i.close(Aw.LICENSE_MINUTES_EXCEEDED);break;case zx.ERR_LICENSE_PERIOD_INVALID:i.close(Aw.LICENSE_PERIOD_INVALID);break;case zx.ERR_LICENSE_MULTIPLE_SDK_SERVICE:i.close(Aw.LICENSE_MULTIPLE_SDK_SERVICE);break;case zx.ERR_LICENSE_ILLEGAL:i.close(Aw.LICENSE_ILLEGAL);break;default:i.close()}}}})),i.clientId=t.clientId,i.spec=t,i.store=n,i.websocket=new uU("gateway-".concat(i.clientId),i.spec.retryConfig,!0,rk("JOIN_GATEWAY_USE_DUAL_DOMAIN"),rk("JOIN_GATEWAY_USE_443PORT_ONLY"),n),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===Xx.CONNECTED&&i.reconnect("retry",Dw.OFFLINE)})),i.p2pToken=tO(6,""),i._external_signal=new Cq(r(i),i.p2pToken),i}i(t,e);var n=t.prototype;return n.request=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p,h,f,_=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=tO(6,""),o={_id:a,_type:t,_message:n},s=this.websocket.connectionID,c=function(){return new zl((function(e,t){if(_.connectionState===Xx.CONNECTED)return e();var n=function(){_.off(Jx.WS_CLOSED,r),e()},r=function(){_.off(Jx.WS_CONNECTED,n),t(new aw(iw.WS_ABORT))};_.once(Jx.WS_CONNECTED,n),_.once(Jx.WS_CLOSED,r)}))},e.t0=this.connectionState!==Xx.CONNECTING&&this.connectionState!==Xx.RECONNECTING||t===Qx.JOIN||t===Qx.REJOIN,e.t0){e.next=5;break}return e.next=5,c();case 5:if(this.websocket.sendMessage(o,!0),!i){e.next=8;break}return e.abrupt("return");case 8:return u=new zl((function(e,r){var i=!1,o=function(r,a){i=!0,e({isSuccess:"success"===r,message:a||{}}),_.off(Jx.WS_CLOSED,c),_.off(Jx.WS_RECONNECTING,c),_.emit(Jx.REQUEST_SUCCESS,t,n)};_.once("res-@".concat(a),o);var c=function e(){r(new aw(iw.WS_ABORT,"type: ".concat(t))),_.off(Jx.WS_CLOSED,e),_.off(Jx.WS_RECONNECTING,e),_.off("res-@".concat(a),o)};_.once(Jx.WS_CLOSED,c),_.once(Jx.WS_RECONNECTING,c),eO(rk("SIGNAL_REQUEST_TIMEOUT")).then((function(){_.websocket.connectionID!==s||i||(Dk.warning("[".concat(_.clientId,"] ws request timeout, type: ").concat(t)),_.emit(Jx.REQUEST_TIMEOUT,t,n))}))})),d=null,e.prev=10,e.next=13,u;case 13:d=e.sent,e.next=35;break;case 16:if(e.prev=16,e.t1=e.catch(10),this.connectionState!==Xx.CLOSED&&t!==Qx.LEAVE){e.next=20;break}throw new aw(iw.WS_ABORT);case 20:if(this.spec.forceWaitGatewayResponse&&!r){e.next=24;break}e.t2=e.t1.throw(),e.next=34;break;case 24:if(t!==Qx.JOIN&&t!==Qx.REJOIN){e.next=28;break}e.t3=null,e.next=33;break;case 28:return e.next=30,c();case 30:return e.next=32,this.request(t,n);case 32:e.t3=e.sent;case 33:e.t2=e.t3;case 34:return e.abrupt("return",e.t2);case 35:if(!d.isSuccess){e.next=37;break}return e.abrupt("return",d.message);case 37:if(p=Number(d.message.error_code||d.message.code),h=QM(p),f=new aw(iw.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(d.message.error_str),{code:p,data:d.message,desc:h.desc}),"success"!==h.action){e.next=42;break}e.t4=d.message,e.next=67;break;case 42:if(Dk.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(p,", message: ").concat(h.desc,", action: ").concat(h.action)),p!==zx.ERR_TOO_MANY_BROADCASTERS){e.next=47;break}e.t5=t===Qx.JOIN||t===Qx.REJOIN?(this.initError=f,this.close(),f.throw()):f.throw(),e.next=66;break;case 47:if("failed"!==h.action){e.next=51;break}e.t6=f.throw(),e.next=65;break;case 51:if("quit"!==h.action){e.next=55;break}e.t7=(this.initError=f,this.close(),f.throw()),e.next=64;break;case 55:if(p===zx.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,Dk.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Dw.MULTI_IP)):this.reconnect(h.action,Dw.SERVER_ERROR),t!==Qx.JOIN&&t!==Qx.REJOIN){e.next=60;break}e.t8=null,e.next=63;break;case 60:return e.next=62,this.request(t,n);case 62:e.t8=e.sent;case 63:e.t7=e.t8;case 64:e.t6=e.t7;case 65:e.t5=e.t6;case 66:e.t4=e.t5;case 67:return e.abrupt("return",e.t4);case 68:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.waitMessage=function(e,t){var n=this;return new zl((function(r){n.on(e,(function i(a){(!t||t(a))&&(n.off(e,i),r(a))}))}))},n.uploadWRTCStats=function(e){if(this.store.sessionId){var t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Zx.WRTC_STATS,t)}else Dk.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"))},n.upload=function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=rk("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===Xx.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),rk("UPLOAD_CACHE_INTERVAL")||2e3))}},n.send=function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)},n.sendExtensionMessage=function(){var e=p(l().mark((function e(t,n,r){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._external_signal.send(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.init=function(e){var t=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new zl((function(n,r){t.once(Jx.WS_CONNECTED,(function(){return n(t.joinResponse)})),t.once(Jx.WS_CLOSED,(function(){return r(t.initError||new aw(iw.WS_ABORT))})),t.connectionState=Xx.CONNECTING,t.websocket.init(e).catch(r)}))},n.close=function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Aw.LEAVE,this.connectionState=Xx.CLOSED,Dk.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=tO(6,""),this._external_signal.clear(),this._external_signal=new Cq(this,this.p2pToken)},n.join=function(){var e=p(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(Jx.ABORT_P2P_EXECUTION),e.next=4,xw(this,Jx.REQUEST_JOIN_INFO);case 4:return t=e.sent,e.next=7,this.request(Qx.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(Jx.REPORT_JOIN_GATEWAY,iw.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(Jx.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=Xx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.reconnect=function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)},n.handleDataStream=function(e){try{var t,n=qw(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Br(t=Object.values(HM)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit($x.ON_DATA_STREAM,e)}catch(t){this.emit($x.ON_DATA_STREAM,e)}},n.handleNotification=function(e){Dk.debug("[".concat(this.clientId,"] receive notification: "),e);var t=QM(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Aw.UID_BANNED),void this.close()):void this.reconnect(t.action,Dw.SERVER_ERROR);Dk.error("[".concat(this.clientId,"] ignore error: "),t.desc)}},n.handlePingPong=function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=rk("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(Dk.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>rk("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Dw.TIMEOUT):this.request(Qx.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),rk("REPORT_STATS")&&e.send(Qx.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}},n.handleWebsocketEvents=function(){var e=this;this.websocket.on(tM.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(Jx.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(tM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tM.CLOSED,(function(){e.connectionState=Xx.CLOSED})),this.websocket.on(tM.FAILED,(function(){e._disconnectedReason=Aw.NETWORK_ERROR,e.connectionState=Xx.CLOSED})),this.websocket.on(tM.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===Xx.CONNECTED?e.connectionState=Xx.RECONNECTING:e.connectionState=Xx.CONNECTING})),this.websocket.on(tM.WILL_RECONNECT,(function(t,n,r){"retry"!==t?(Dk.debug("".concat(e.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),e.reconnectToken=void 0):Dk.debug("".concat(e.clientId," reconnect mode is retry, no need to renew session")),r(t)})),this.websocket.on(tM.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.join().catch((function(t){if(e.emit(Jx.REPORT_JOIN_GATEWAY,t,e.url||""),t instanceof aw&&t.code===iw.UNEXPECTED_RESPONSE&&t.data.code===zx.ERR_NO_AUTHORIZED)return Dk.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",Dw.SERVER_ERROR);Dk.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",Dw.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(tM.REQUEST_NEW_URLS,(function(t,n){xw(e,Jx.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(tM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit($x.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))},v(t,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===Xx.CONNECTED?this.emit(Jx.WS_CONNECTED):e===Xx.RECONNECTING?this.emit(Jx.WS_RECONNECTING,this._websocketReconnectReason):e===Xx.CLOSED&&this.emit(Jx.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket&&this.websocket.url||null}},{key:"rtt",get:function(){return this.rttRolling.mean()}}]),t}(gw),Iq={name:"P2PChannel",create:function(e){var t=e.store,n=e.statsCollector;return new bq(t,n)},createSubmodule:function(e){var t=e.store,n=e.spec;return new yq(n,t)}};function Aq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Aq(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oq,kq=function(){function e(e){XC(this,"sessionDesc",void 0),XC(this,"localCapabilities",void 0),XC(this,"rtpCapabilities",void 0),XC(this,"candidates",void 0),XC(this,"_originCandidates",void 0),XC(this,"iceParameters",void 0),XC(this,"dtlsParameters",void 0),XC(this,"setup",void 0),XC(this,"currentMidIndex",void 0),XC(this,"cname",void 0);var t=e=Ww(e),n=t.iceParameters,r=t.dtlsParameters,i=t.candidates,a=t.rtpCapabilities,o=t.setup,s=t.localCapabilities,c=t.sdkCodec,u=t.cname,d=pk("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=a,this.candidates=i,this._originCandidates=Ww(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=s,this.cname=u;for(var p=0;p<d.mediaDescriptions.length;p++){var l=d.mediaDescriptions[p];if(l.attributes.iceUfrag=n.iceUfrag,l.attributes.icePwd=n.icePwd,l.attributes.fingerprints=r.fingerprints,l.attributes.candidates=i,l.attributes.setup=o,"video"===l.media.mediaType){l.media.fmts=a.videoCodecs.map((function(e){return e.payloadType.toString(10)}));var h=a.videoCodecs.filter((function(e){var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Br(n=t.encodingName.toLowerCase()).call(n,c)}));0===h.length&&(h=a.videoCodecs),l.attributes.payloads=h,l.attributes.extmaps=a.videoExtensions}"audio"===l.media.mediaType&&(l.media.fmts=a.audioCodecs.map((function(e){return e.payloadType.toString(10)})),l.attributes.payloads=a.audioCodecs,l.attributes.extmaps=a.audioExtensions),d.mediaDescriptions[p]=this.mungMediaDesc(l)}this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}var t=e.prototype;return t.toString=function(){return lk(this.sessionDesc)},t.send=function(e,t,n){var r=FU(t,this.cname),i=r.ssrcs,a=r.ssrcGroups,o=this.sessionDesc.mediaDescriptions.find((function(t){return e===OM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType})),s=i[0].attributes.label,c=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(a),{id:s,mslabel:c}},t.batchSend=function(e){var t=this;return e.map((function(e){var n=e.kind,r=e.ssrcMsg;return t.send(n,r,void 0)}))},t.stopSending=function(e){this.sessionDesc.mediaDescriptions.forEach((function(t){var n=[],r=[],i=[];t.attributes.ssrcs.forEach((function(t){Br(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((function(e){var t;Br(t=i.map((function(e){return e.ssrcId}))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))},t.mute=function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"},t.unmute=function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"},t.receive=function(e,t,n){var r=this;e.forEach((function(e,t){var n=e._mediaStreamTrack,i=r.sessionDesc.mediaDescriptions.findIndex((function(e){return e.attributes.mid===n.kind})),a=r.mungRecvMediaDsec(r.sessionDesc.mediaDescriptions[i],e);r.sessionDesc.mediaDescriptions[i]=a}))},t.stopReceiving=function(e){},t.updateCandidates=function(e){var t=this._originCandidates.filter((function(e){return"udp"===e.transport})),n=[];if(t.forEach((function(e){n.push(wq(wq({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case kM.TCP_RELAY:this.candidates=n;break;case kM.UDP_TCP_RELAY:case kM.RELAY:this.candidates=[].concat(t,n);break;default:this.candidates=t}for(var r,i=h(this.sessionDesc.mediaDescriptions);!(r=i()).done;)r.value.attributes.candidates=this.candidates}},t.restartICE=function(e){e=Ww(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))},t.predictReceivingMids=function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t},t.mungRecvMediaDsec=function(e,t){var n=Ww(e);return BU(n,t),GU(n,t),n},t.updateRecvMedia=function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}},t.bumpMid=function(e){this.currentMidIndex+=e},t.updateTrackLabel=function(e,t,n){var r=this.sessionDesc.mediaDescriptions.find((function(t){return e===OM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid}));if(r){var i,a=r.attributes.ssrcs.find((function(e){return e.attributes.label===t}));a&&(a.attributes.label=n,null===(i=a.attributes.msid)||void 0===i||i.replace(t,n))}},t.mungMediaDesc=function(e){var t=Ww(e);return jU(t),function(e){var t=e.attributes.extmaps.find((function(e){return NU(e.extensionName)}));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t},t.getSSRC=function(e){for(var t,n=h(this.sessionDesc.mediaDescriptions);!(t=n()).done;)for(var r,i=h(t.value.attributes.ssrcs);!(r=i()).done;){var a=r.value;if(a.attributes.label===e)return[a]}},e}();function Nq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nq(Object(n),!0).forEach((function(t){XC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pq=(Wx((Oq=function(e){function t(n,i){var a;return XC(r(a=e.call(this,n,i)||this),"store",void 0),XC(r(a),"peerConnection",void 0),XC(r(a),"remoteSDP",void 0),XC(r(a),"initialOffer",void 0),XC(r(a),"statsFilter",void 0),XC(r(a),"useRTX",!1),XC(r(a),"localCapabilities",void 0),XC(r(a),"localCandidateCount",0),XC(r(a),"allCandidatesReceived",!1),XC(r(a),"establishPromise",void 0),XC(r(a),"mutex",void 0),a.store=i,a.mutex=new fO("P2PConnection-mutex",i.clientId),a.peerConnection=new RTCPeerConnection(t.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),a.statsFilter=HO(a.peerConnection,rk("STATS_UPDATE_INTERVAL"),void 0,LA()?1200:void 0),a.bindPCEvents(),a.bindStatsEvents(),a.store.p2pId=a.store.p2pId+1,a.establishPromise=a.establish(),a}i(t,e);var n=t.prototype;return n.establish=function(){var e=p(l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:if((t=e.sent).sdp){e.next=6;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 6:return n=xU(t.sdp),r=LU(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:rk("FILTER_VIDEO_FEC"),filterAudioFec:rk("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]}),e.abrupt("return",(this.localCapabilities=r,this.initialOffer=t,Dq(Dq({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})));case 10:throw e.prev=10,e.t0=e.catch(0),new aw(iw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),n.updateRemoteConnect=function(){var e=p(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n.connect=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.remoteSDP=new kq(Dq(Dq({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec})),n=this.remoteSDP.toString(),e.next=7,this.peerConnection.setLocalDescription(this.initialOffer);case 7:return e.next=9,this.peerConnection.setRemoteDescription({type:"answer",sdp:n});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),n.updateRemoteRTPCapabilities=function(){var e=p(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new aw(iw.NOT_SUPPORTED,"Planb mode does not support createDataChannels.");case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.getPreMedia=function(e){},n.send=function(e,t){var n=this;return OI(l().mark((function r(){var i,a,o,s,c,u,d,p;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,NI(n.mutex.lock());case 2:if(i=r.sent,r.prev=3,n.remoteSDP){r.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:return a=e.map((function(e){return n.peerConnection.addTrack(e._mediaStreamTrack)})),r.next=9,NI(n.peerConnection.createOffer());case 9:return o=r.sent,s=pk(o.sdp),c=e.map((function(e){var t=e._mediaStreamTrack,r=s.mediaDescriptions.find((function(e){return e.attributes.mid===t.kind}));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){var r=e.attributes.ssrcs.filter((function(e){return e.attributes.label===t})),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){var a=i.find((function(e){return-1!==e.ssrcIds.indexOf(r[0].ssrcId)}));return a?[{ssrcId:a.ssrcIds[0],rtx:n?a.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)})),r.prev=12,r.next=15,c;case 15:u=r.sent,r.next=21;break;case 18:throw r.prev=18,r.t0=r.catch(12),a.forEach((function(e){DA()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),r.t0;case 21:return d=n.mungSendOfferSDP(o.sdp,e),n.remoteSDP.receive(e,t,u),p=n.remoteSDP.toString(),r.next=26,NI(n.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 26:return r.next=28,NI(n.applySendEncodings(a,e));case 28:return r.next=30,NI(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}));case 30:return r.abrupt("return",e.map((function(e,t){var n=e._mediaStreamTrack.id;return{localSSRC:c[t],id:n}})));case 33:throw r.prev=33,r.t1=r.catch(3),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(r.t1.toString()));case 36:return r.prev=36,i(),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[3,33,36,39],[12,18]])})))()},n.stopSending=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 3:if((n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}))).length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 6:return n.map((function(e){DA()&&e.replaceTrack(null),a.peerConnection.removeTrack(e)})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return this.remoteSDP.stopReceiving(t),i=this.remoteSDP.toString(),e.next=16,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t0.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}(),n.receive=function(){var e=p(l().mark((function e(t,n,r,i){var a,o,s,c,u,d,p=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:return a=this.remoteSDP.send(t,n,i),o=a.id,s=a.mslabel,c=new zl((function(e,n){var r=setTimeout((function(){n(new Error("Cannot receive track, id: ".concat(o)))}),1e4);p.peerConnection.addEventListener("track",(function n(i){var a=IA();if(("Safari"===a.name&&11===Number(a.version)||xA())&&i.track.id!==o&&i.streams[0].id===s){var c,u=i.streams[0].getTracks()[0];return null===(c=p.remoteSDP)||void 0===c||c.updateTrackLabel(t,o,i.track.id),p.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(u)}if(i.track.id===o)return p.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(i.track)}))})),u=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:u});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return d=e.sent,e.next=11,this.peerConnection.setLocalDescription(d);case 11:return e.next=13,c;case 13:return e.t0=e.sent,e.t1=o,e.abrupt("return",{track:e.t0,id:e.t1});case 18:throw e.prev=18,e.t2=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t2.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.stopReceiving=function(){var e=p(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),n.muteRemote=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.unmuteRemote=function(){var e=p(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.muteLocal=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}))).length===t.length){e.next=6;break}throw new Error("sender' length doesn't match mids' length.");case 6:n.map((function(e){if(DA()&&e.track)e.track.enabled=!1;else{var t=e.getParameters();t.encodings.forEach((function(e){return e.active=!1})),e.setParameters(t)}})),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),n.unmuteLocal=function(){var e=p(l().mark((function e(t){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if((n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}))).length===t.length){e.next=6;break}throw new Error("Senders' length doesn't match mids' length.");case 6:return n.map(p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!DA()||!t.track){e.next=4;break}t.track.enabled=!0,e.next=8;break;case 4:return(n=t.getParameters()).encodings.forEach((function(e){return e.active=!0})),e.next=8,t.setParameters(n);case 8:case"end":return e.stop()}}),e)})))),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return i=this.remoteSDP.toString(),e.next=15,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),n.restartICE=function(e){var t=this;return OI(l().mark((function n(){var r,i,a,o,s,c,u,d,p;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,NI(t.mutex.lock("From P2PConnection.restartICE"));case 2:if(r=n.sent,n.prev=3,t.remoteSDP){n.next=6;break}throw new Error("Cannot restartICE before remoteSDP created.");case 6:if(i=Gk().supportPCSetConfiguration,e!==kM.RELAY||i){n.next=9;break}return n.abrupt("return");case 9:return i&&(a=t.peerConnection.getConfiguration(),o=e===kM.RELAY?"relay":"all",a.iceTransportPolicy!==o&&(Dk.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(a.iceTransportPolicy,"] to [").concat(o,"]")),a.iceTransportPolicy=o,t.peerConnection.setConfiguration(a))),e!==kM.RELAY&&t.remoteSDP.updateCandidates(e),n.next=13,NI(t.peerConnection.createOffer({iceRestart:!0}));case 13:if((s=n.sent).sdp){n.next=16;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 16:return c=xU(s.sdp),n.next=19,c.iceParameters;case 19:return u=n.sent,d=u.remoteIceParameters,t.remoteSDP.restartICE(d),p=t.remoteSDP.toString(),n.next=25,NI(t.peerConnection.setLocalDescription(s));case 25:return n.next=27,NI(t.peerConnection.setRemoteDescription({type:"answer",sdp:p}));case 27:n.next=32;break;case 29:n.prev=29,n.t0=n.catch(3),Dk.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),n.t0);case 32:return n.prev=32,r(),n.finish(32);case 35:case"end":return n.stop()}}),n,null,[[3,29,32,35]])})))()},n.close=function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()},n.getStats=function(){return this.statsFilter.getStats()},n.getRemoteVideoIsReady=function(e){return this.statsFilter.getVideoIsReady(e)},n.updateEncoderConfig=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n]),this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n),a=this.remoteSDP.toString(),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return e.next=13,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,e.t0.toString());case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),n.updateSendParameters=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().filter((function(e){var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t})),e.t0=1===r.length,!e.t0){e.next=5;break}return e.next=5,this.applySendEncodings(r,[n]);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.setStatsRemoteVideoIsReady=function(e,t){this.statsFilter.setVideoIsReady2(e,t)},n.replaceTrack=function(){var e=p(l().mark((function e(t,n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.id)===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.createDataChannels=function(e,t){throw new aw(iw.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")},n.stopDataChannels=function(e){throw new aw(iw.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")},n.bindPCEvents=function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,Dk.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),rk("CANDIDATE_TIMEOUT"))},n.unbindPCEvents=function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null},t.resolvePCConfiguration=function(e){var n,r,i={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(ww(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(n=i.iceServers).push.apply(n,t.turnServerConfigToIceServers(e.turnServer.servers)),rk("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,t.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i},t.turnServerConfigToIceServers=function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t},n.updateRtpSenderEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a,o,s,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.peerConnection.getSenders().find((function(e){var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t._mediaStreamTrack.id}))),n){e.next=3;break}return e.abrupt("return",Dk.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(Gk().supportSetRtpSenderParameters){e.next=5;break}return e.abrupt("return",Dk.warn("Browser not support set rtp-sender parameters"));case 5:if(i={},a={},!(t instanceof mL)){e.next=15;break}e.t0=t._optimizationMode,e.next="motion"===e.t0?10:"detail"===e.t0?12:14;break;case 10:return i.degradationPreference="maintain-framerate",e.abrupt("break",15);case 12:return i.degradationPreference="maintain-resolution",e.abrupt("break",15);case 14:i.degradationPreference="balanced";case 15:return rk("DSCP_TYPE")&&ZA()&&(s=rk("DSCP_TYPE"),Br(o=["very-low","low","medium","high"]).call(o,s)&&(a.networkPriority=s)),c=n.getParameters(),(u=null===(r=c.encodings)||void 0===r?void 0:r[0])&&Object.assign(u,a),Object.assign(c,i),Dk.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),e.next=22,n.setParameters(c);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.applySendEncodings=function(){var e=p(l().mark((function e(t,n){var r,i,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Gk().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=i&&a,!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),Dk.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t,n){return e.apply(this,arguments)}}(),n.mungSendOfferSDP=function(e,t){var n=pk(e);return t.forEach((function(e,t){var r=e._mediaStreamTrack,i=n.mediaDescriptions.find((function(e){return e.attributes.mid===r.kind}));i&&BU(i,e)})),lk(n)},n.bindStatsEvents=function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)}},n.unbindStatsEvents=function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0},n.batchReceive=function(){var e=p(l().mark((function e(t){var n,r,i,a=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:return n=this.remoteSDP.batchSend(t).map((function(e,n){var r=e.id,i=e.mslabel,o=t[n].kind;return new zl((function(e,t){var n=setTimeout((function(){t(new Error("Cannot receive track, id: ".concat(r)))}),1e4);a.peerConnection.addEventListener("track",(function t(s){var c=IA();if("Safari"===c.name&&11===Number(c.version)&&s.track.id!==r&&s.streams[0].id===i){var u,d=s.streams[0].getTracks()[0];return null===(u=a.remoteSDP)||void 0===u||u.updateTrackLabel(o,r,s.track.id),a.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:d,id:r})}if(s.track.id===r)return a.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:s.track,id:r})}))}))})),r=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:r});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return i=e.sent,e.next=11,this.peerConnection.setLocalDescription(i);case 11:return e.next=13,zl.all(n);case 13:return e.abrupt("return",e.sent);case 16:throw e.prev=16,e.t0=e.catch(0),new aw(iw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),n.getRemoteSSRC=function(){var e=p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setConfiguration=function(e){if(Gk().supportPCSetConfiguration){var n=t.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}},v(t,[{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"localCodecs",get:function(){return[].concat(new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((function(e){return e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""})).filter((function(e){var t;return Br(t=Object.keys(sk)).call(t,e)}))))}}]),t}(wM)).prototype,"connect",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"connect"),Oq.prototype),Wx(Oq.prototype,"stopSending",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"stopSending"),Oq.prototype),Wx(Oq.prototype,"receive",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"receive"),Oq.prototype),Wx(Oq.prototype,"stopReceiving",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"stopReceiving"),Oq.prototype),Wx(Oq.prototype,"muteRemote",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"muteRemote"),Oq.prototype),Wx(Oq.prototype,"unmuteRemote",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"unmuteRemote"),Oq.prototype),Wx(Oq.prototype,"muteLocal",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"muteLocal"),Oq.prototype),Wx(Oq.prototype,"unmuteLocal",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"unmuteLocal"),Oq.prototype),Wx(Oq.prototype,"close",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"close"),Oq.prototype),Wx(Oq.prototype,"updateEncoderConfig",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"updateEncoderConfig"),Oq.prototype),Wx(Oq.prototype,"updateSendParameters",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"updateSendParameters"),Oq.prototype),Wx(Oq.prototype,"replaceTrack",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"replaceTrack"),Oq.prototype),Wx(Oq.prototype,"getRemoteSSRC",[Lq],Object.getOwnPropertyDescriptor(Oq.prototype,"getRemoteSSRC"),Oq.prototype),Oq);function Lq(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=p(l().mark((function e(){var n,i,a,o,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("Locking from P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=c.length,o=new Array(a),s=0;s<a;s++)o[s]=c[s];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}var xq,Mq,Uq,Vq,Fq={name:"PlanBConnection",create:function(e){var t=e.store,n=e.spec;return new Pq(n,t)}},Bq={interceptLocalAudioFrame:(Vq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",u)}var e=NL.get(t);if(e){NL.delete(t);try{var n,r;null===(n=e.controller)||void 0===n||n.terminate(),null===(r=e.worker)||void 0===r||r.terminate()}catch(e){Dk.warning(e&&e.message)}}},n=d.length>1&&void 0!==d[1]?d[1]:{},Gk().supportWebRTCEncodedTransform){e.next=4;break}return e.abrupt("return",void Dk.warning("browser not support audio encoded transform"));case 4:if(!NL.has(t)){e.next=6;break}return e.abrupt("return");case 6:if(t.track){e.next=8;break}return e.abrupt("return");case 8:if(r={track:t.track},!NA()){e.next=24;break}if(t.createEncodedStreams){e.next=12;break}return e.abrupt("return",void Dk.warning("browser not support createEncodedStreams() API"));case 12:i=null,e.prev=13,i=t.createEncodedStreams(),e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(13),e.abrupt("return",void Dk.error("create audio-encoded-streams error",e.t0&&e.t0.message));case 20:a=new TransformStream({transform:function(e,i){r.controller||(r.controller=i),t.track&&t.track.id!==r.track.id&&(Dk.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",u),r.track=t.track,r.track.addEventListener("ended",u));var a=n.metadata&&n.metadata();a?function(e,t){var n=t.chunk,r=t.controller,i=rk("ENABLE_AUDIO_PTS_METADATA")?OL.AUDIO_64_BIT_PTS:OL.METADATA;n.data=function(e,t,n){var r=n.byteLength,i=r+1+2,a=3+i,o=new ArrayBuffer(e.byteLength+a),s=new DataView(o);s.setUint8(0,71),s.setUint16(1,i),s.setUint8(3,t),s.setUint16(4,r);for(var c=0;c<r;c++)s.setUint8(6+c,n[c]);var u=new Uint8Array(s.buffer);return u.set(new Uint8Array(e),a),u.buffer}(n.data,i,e),r.enqueue(n)}(a,{sender:t,chunk:e,controller:i}):i.enqueue(e)}}),i.readable.pipeThrough(a).pipeTo(i.writable),e.next=36;break;case 24:if(!DA()){e.next=36;break}if("undefined"!=typeof RTCRtpScriptTransform){e.next=27;break}return e.abrupt("return",void Dk.warning("browser not support RTCRtpScriptTransform"));case 27:return o=wL(),s=new MessageChannel,e.next=30,new zl((function(e){return o.onmessage=function(t){"registered"===t.data&&e(void 0)}}));case 30:return c=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:s.port2},[s.port2]),t.transform=c,e.next=34,new zl((function(e){return o.onmessage=function(t){"started"===t.data&&e(void 0)}}));case 34:s.port1.onmessage=function(e){var i;if(e.data.transformed&&t.track&&(null===(i=t.track)||void 0===i?void 0:i.id)!==r.track.id)Dk.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",u),r.track=t.track,r.track.addEventListener("ended",u);else if(e.data.getMetadata){var a=n.metadata&&n.metadata();a&&s.port1.postMessage({metadata:a})}},r.worker=o;case 36:NL.set(t,r),t.track.addEventListener("ended",u);case 37:case"end":return e.stop()}}),e,null,[[13,17]])}))),function(e){return Vq.apply(this,arguments)}),interceptRemoteAudioFrame:(Uq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(){t.track.removeEventListener("ended",u),function(e){var t=ZL.get(e);if(t){!function(e){var t=HL.get(e);t&&(HL.delete(e),KL&&(KL.removeSpeakers([t]),0===HL.size&&(KL.destroy(),KL=null)))}(e),QL(e.track.id),ZL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){Dk.warning(e&&e.message)}}}(t)},n=d.length>1&&void 0!==d[1]?d[1]:{},Gk().supportWebRTCEncodedTransform){e.next=4;break}return e.abrupt("return",void Dk.warning("browser not support audio encoded transform"));case 4:if(!ZL.has(t)){e.next=6;break}return e.abrupt("return");case 6:if(r={track:t.track,onMetadata:n.onMetadata},!NA()){e.next=23;break}if(t.createEncodedStreams){e.next=10;break}return e.abrupt("return",void Dk.warning("browser not support createEncodedStreams() API"));case 10:VA(bA.CHROME,87,116)||(n.enableTopn=!1),i=null,e.prev=12,i=t.createEncodedStreams(),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(12),e.abrupt("return",void Dk.error("create audio-encoded-streams error",e.t0&&e.t0.message));case 19:a=new TransformStream({transform:function(e,i){r.controller||(r.controller=i),t.track&&t.track.id!==r.track.id&&(Dk.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",u),r.track=t.track,r.track.addEventListener("ended",u)),n.enableTopn?function(e,t,n){var r,i=kL(new DataView(t.data));if(!i)return n.enqueue(t);var a=e.track.id;$L.set(a,e.track);var o=null===(r=i.tlv.find((function(e){return e.tag===OL.AUDIO_LEVEL})))||void 0===r?void 0:r.value,s=0;"number"==typeof o&&(s=127-o);var c=function(e,t){var n=HL.get(e);if(n||(n=function(e){var t=new BL;return HL.set(e,t),KL||(KL=new WL(rk("TOPN_SILENCE_THRESHOLD")||500)).on("ActiveSpeakerChanged",(function(e){null!=e&&(YL=e)})),KL.addSpeakers([t]),t}(e)),HL.size<=3)return{selected:!0,speaker:n};if(!KL)throw new Error("no active speaker detector");return KL.levelChanged(n.id,t),qL=KL.loudest.map((function(e){return e.id})),YL&&!Br(qL).call(qL,YL)&&qL.length>=3&&qL.pop(),{selected:Br(qL).call(qL,n.id)||n.id===YL,speaker:n}}(e,Math.round(Math.pow(10,s/60)-1)),u=c.selected,d=c.speaker,p=function(e,t,n){var r=zL.get(e)||new JL(e,t);return r.score=n,zL.set(e,r),function(e){if(XL.set(e,!0),VL){var t=Date.now();t-VL>1e3&&(XL.get(e)?XL.set(e,!1):(QL(e),XL.delete(e)),VL=t)}else VL=Date.now()}(e),r}(a,e.track,d.energyScore);p.addSample(u),p.active&&(t.data=i.frame.buffer,n.enqueue(t))}(t,e,i):n.enableMetadata?function(e,t,n){var r=kL(new DataView(e.data));if(!r)return t.enqueue(e);var i=r.tlv.find((function(e){return e.tag===OL.METADATA||e.tag===OL.AUDIO_64_BIT_PTS}));i&&n&&i.value instanceof Uint8Array&&n(i.value),e.data=r.frame.buffer,t.enqueue(e)}(e,i,n.onMetadata):i.enqueue(e)}}),i.readable.pipeThrough(a).pipeTo(i.writable),e.next=35;break;case 23:if(!DA()){e.next=35;break}if("undefined"!=typeof RTCRtpScriptTransform){e.next=26;break}return e.abrupt("return",void Dk.warning("browser not support RTCRtpScriptTransform"));case 26:return o=wL(),s=new MessageChannel,e.next=29,new zl((function(e){return o.onmessage=function(t){"registered"===t.data&&e(void 0)}}));case 29:return c=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:s.port2},[s.port2]),t.transform=c,e.next=33,new zl((function(e){return o.onmessage=function(t){"started"===t.data&&e(void 0)}}));case 33:s.port1.onmessage=function(e){var n;e.data.transformed&&t.track&&(null===(n=t.track)||void 0===n?void 0:n.id)!==r.track.id?(Dk.debug("audio track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",u),r.track=t.track,r.track.addEventListener("ended",u)):e.data.metadata&&r.onMetadata&&r.onMetadata(e.data.metadata)},r.worker=o;case 35:ZL.set(t,r),t.track.addEventListener("ended",u);case 36:case"end":return e.stop()}}),e,null,[[12,16]])}))),function(e){return Uq.apply(this,arguments)}),interceptLocalVideoFrame:(Mq=p(l().mark((function e(t,n){var r,i,a,o,s,c,u,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=function(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",d)}var e=tx.get(t);if(e){tx.delete(t);try{var n,r;null===(n=e.controller)||void 0===n||n.terminate(),null===(r=e.worker)||void 0===r||r.terminate()}catch(e){Dk.warning(e&&e.message)}}},Gk().supportWebRTCEncodedTransform){e.next=3;break}return e.abrupt("return",void Dk.warning("browser not support video encoded transform"));case 3:if(!tx.has(t)){e.next=5;break}return e.abrupt("return");case 5:if(t.track){e.next=7;break}return e.abrupt("return");case 7:if(r={track:t.track},!NA()){e.next=25;break}if(t.createEncodedStreams){e.next=11;break}return e.abrupt("return",void Dk.warning("browser not support createEncodedStreams() API"));case 11:i=null,e.prev=12,i=t.createEncodedStreams(),e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(12),e.abrupt("return",void Dk.error("create video-encoded-streams error",e.t0&&e.t0.message));case 19:a=[],n.on("sei-to-send",(function(e){a.push(e)})),o=new TransformStream({transform:function(e,n){r.controller||(r.controller=n),t.track&&t.track.id!==r.track.id&&(Dk.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",d),r.track=t.track,r.track.addEventListener("ended",d));var i=a.shift();i&&(e.data=function(e,t){var n=function(e){for(var t=e.length,n=[],r=0;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),a=r%255,o=new Uint8Array(6+i+1+r+e.byteLength);o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=6,o[5]=101;for(var s=0;s<i;)o[6+s]=255,s++;return o[6+s]=a,s++,o.set(n,6+s),o.set(new Uint8Array(e),6+s+r),o.buffer}(e.data,i)),n.enqueue(e)}}),i.readable.pipeThrough(o).pipeTo(i.writable),e.next=39;break;case 25:if(DA()){e.next=27;break}return e.abrupt("return");case 27:if("undefined"!=typeof RTCRtpScriptTransform){e.next=29;break}return e.abrupt("return",void Dk.warning("browser not support RTCRtpScriptTransform"));case 29:return s=wL(),c=new MessageChannel,e.next=32,new zl((function(e){return s.onmessage=function(t){"registered"===t.data&&e(void 0)}}));case 32:return u=new RTCRtpScriptTransform(s,{name:"sei-tx",port:c.port2},[c.port2]),t.transform=u,e.next=36,new zl((function(e){return s.onmessage=function(t){"started"===t.data&&e(void 0)}}));case 36:n.on("sei-to-send",(function(e){c.port1.postMessage({sei:e})})),c.port1.onmessage=function(e){var n;e.data.transformed&&t.track&&(null===(n=t.track)||void 0===n?void 0:n.id)!==r.track.id&&(Dk.debug("video track changed: ".concat(r.track.id," => ").concat(t.track.id)),r.track.removeEventListener("ended",d),r.track=t.track,r.track.addEventListener("ended",d))},r.worker=s;case 39:tx.set(t,r),t.track.addEventListener("ended",d);case 40:case"end":return e.stop()}}),e,null,[[12,16]])}))),function(e,t){return Mq.apply(this,arguments)}),interceptRemoteVideoFrame:(xq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=function(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",d)}!function(e){var t=nx.get(e);if(t){nx.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){Dk.warning(e&&e.message)}}}(t)},n=p.length>1&&void 0!==p[1]?p[1]:{},Gk().supportWebRTCEncodedTransform){e.next=4;break}return e.abrupt("return",void Dk.warning("browser not support video encoded transform"));case 4:if(t.track){e.next=6;break}return e.abrupt("return");case 6:if(!nx.has(t)){e.next=9;break}return r=nx.get(t),e.abrupt("return",void(r&&(r.onSei=n.onSei)));case 9:if(i={track:t.track,onSei:n.onSei},!NA()){e.next=25;break}if(t.createEncodedStreams){e.next=13;break}return e.abrupt("return",void Dk.warning("browser not support createEncodedStreams() API"));case 13:a=null,e.prev=14,a=t.createEncodedStreams(),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(14),e.abrupt("return",void Dk.error("create video-encoded-streams error",e.t0&&e.t0.message));case 21:o=new TransformStream({transform:function(e,n){i.controller||(i.controller=n),t.track&&t.track.id!==i.track.id&&(Dk.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",d),i.track=t.track,i.track.addEventListener("ended",d));var r=function(e){for(var t=new DataView(e.data),n=0;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){for(var r=n+6,i=0,a=0;255===(a=t.getUint8(r++));)i+=255;i+=a;var o=ex(e.data,r,i);return new Uint8Array(o)}n++}return null}(e);r&&i.onSei&&i.onSei(r),n.enqueue(e)}}),a.readable.pipeThrough(o).pipeTo(a.writable),e.next=37;break;case 25:if(!DA()){e.next=37;break}if("undefined"!=typeof RTCRtpScriptTransform){e.next=28;break}return e.abrupt("return",void Dk.warning("browser not support RTCRtpScriptTransform"));case 28:return s=wL(),c=new MessageChannel,e.next=31,new zl((function(e){return s.onmessage=function(t){"registered"===t.data&&e(void 0)}}));case 31:return u=new RTCRtpScriptTransform(s,{name:"sei-rx",port:c.port2},[c.port2]),t.transform=u,e.next=35,new zl((function(e){return s.onmessage=function(t){"started"===t.data&&e(void 0)}}));case 35:c.port1.onmessage=function(e){var n;e.data.transformed&&t.track&&(null===(n=t.track)||void 0===n?void 0:n.id)!==i.track.id?(Dk.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",d),i.track=t.track,i.track.addEventListener("ended",d)):e.data.sei&&i.onSei&&i.onSei(e.data.sei)},i.worker=s;case 37:nx.set(t,i),t.track.addEventListener("ended",d);case 38:case"end":return e.stop()}}),e,null,[[14,18]])}))),function(e){return xq.apply(this,arguments)})},jq={name:"InterceptFrame",create:function(){return Bq}};YO(),nk("PROCESS_ID","process-".concat(tO(8,""),"-").concat(tO(4,""),"-").concat(tO(4,""),"-").concat(tO(4,""),"-").concat(tO(12,""))),function(){var e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void Dk.error("Error loading sdk config",e.message)}if(e)try{var t=JSON.parse(window.atob(e)),n=Date.now();Dk.debug("Loading global parameters from cache",t),Object.keys(t).forEach((function(e){if(Object.prototype.hasOwnProperty.call(tk,e)){var r=t[e],i=r.value,a=r.expires;if(a&&a<=n)return;ak[e]=i,tk[e]=i}}))}catch(t){Dk.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ak.AREAS)&&ak.AREAS.length>0&&IV(ak.AREAS,!0);var Gq=function(e,t,n){Dk.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),nk(e,t,n)};uV(iY,!1),uV(pY,!1),uV(gG,!1),uV(jY,!1),uV(tY,!1),uV(Iq,!1),uV(Fq,!1),uV(jq,!1);var Wq,Hq,Kq,Yq,qq,zq,Xq,Jq,Qq,Zq=function(e){var t=new gw,n=e,r={getListeners:t.getListeners.bind(t),on:function(e,n){return function(e,t){e===BM.SECURITY_POLICY_VIOLATION&&DG(t,!0)}(e,n),t.on.bind(t)(e,n)},addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return kG(kG({},n),r)}({__TRACK_LIST__:iN,VERSION:qO,BUILD:$O,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Gq,getParameter:rk,getSupportedCodec:(Qq=p(l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={audio:[],video:[]},e.prev=1,n=new RTCPeerConnection,e.next=5,p(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Gk().supportUnifiedPlan){e.next=8;break}return t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}),e.next=5,t.createOffer();case 5:n=e.sent.sdp,e.next=11;break;case 8:return e.next=10,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 10:n=e.sent.sdp;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})))(n);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",t);case 8:n.close(),n=null,t=function(e){var t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(r),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),new Bk(iw.CREATE_OFFER_FAILED,e.t0.toString&&e.t0.toString()).print();case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,null,[[1,11]])}))),function(){return Qq.apply(this,arguments)}),checkSystemRequirements:function(){var e=Fk.reportApiInvoke(null,{name:Rw.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Cw.TRACER}),t=!1;try{var n=window.RTCPeerConnection,r=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;(t=!!(n&&r&&i))&&QA()&&UA(75)&&(new n).close()}catch(e){return Dk.error("check system requirement failed: ",e),!1}var a=!1,o=IA();o.name===bA.CHROME&&Number(o.version)>=58&&("WebKit"!==CA.engine.name||function(){var e=IA();if(kA()){if(e.os===TA.MAC_OS)return!0;if(e.os===TA.IOS){var t=CA.os.version&&CA.os.version.split(".");if(t&&14===Number(t[0])&&t[1]&&Number(t[1])>=3)return!0;if(t&&Number(t[0])>14)return!0}}return!1}())&&(a=!0),(o.name===bA.FIREFOX&&Number(o.version)>=56||o.name===bA.OPERA&&Number(o.version)>=45||o.name===bA.SAFARI&&Number(o.version)>=11||"WebKit"===o.name&&(xA()||zA())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||XA()||IA().name===bA.QQ)&&(a=!0),Dk.debug("checkSystemRequirements, api:",t,"browser",a);var s=t&&a;return e.onSuccess(s),s},getDevices:function(e){return oD.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return oD.getRecordingDevices(e)},getCameras:function(e){return oD.getCamerasDevices(e)},getElectronScreenSources:XN,getPlaybackDevices:function(e){return oD.getSpeakers(e)},createClient:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=tO(5,"client-"),r=Fk.reportApiInvoke(null,{id:n,name:Rw.CREATE_CLIENT,options:[t],tag:Cw.TRACER});try{!function(e){sw(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),sw(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&sw(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&dw(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Ow(e.turnServer),void 0!==e.httpRetryConfig&&yw(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&yw(e.websocketRetryConfig)}(t)}catch(e){throw r.onError(e),e}return(jA(16,0,!0)||GA(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",Dk.debug("browser not support vp9, force use vp8")),nk("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),r.onSuccess(),new yG(bG(bG({forceWaitGatewayResponse:!0},t),{},{role:Br(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:(Jq=p(l().mark((function e(){var t,n,r,i,a,o,s,c,u,d=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:{},n=rk("CAMERA_CAPTURE_CONFIG"),r=tO(8,"track-cam-"),i=Fk.reportApiInvoke(null,{id:r,tag:Cw.TRACER,name:Rw.CREATE_CAM_VIDEO_TRACK,options:[DN({},t),n]}),n&&(t.encoderConfig=n),a=TD(t),o=null,Dk.info("start create camera video track with config",JSON.stringify(t),"trackId",r),e.prev=6,e.next=9,eD({video:a},r);case 9:if(e.t0=e.sent.getVideoTracks()[0],e.t0){e.next=12;break}e.t0=null;case 12:o=e.t0,e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(6),i.onError(e.t1),e.t1;case 18:if(o){e.next=21;break}return s=new aw(iw.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(i.onError(s),s.throw(Dk)));case 21:return t.optimizationMode&&gL(r,o,t,$k(t.encoderConfig)),rk("USE_STANDARD_BITRATE_DEFAULT")&&(c=$k(t.encoderConfig),t.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin),u=new SL(o,t,a,t.scalabiltyMode?tN(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r),e.abrupt("return",(i.onSuccess(u.getTrackId()),Dk.info("create camera video success, trackId:",r),u));case 24:case"end":return e.stop()}}),e,null,[[6,15]])}))),function(){return Jq.apply(this,arguments)}),createCustomVideoTrack:function(e){var t=tO(8,"track-cus-"),n=Fk.reportApiInvoke(null,{id:t,tag:Cw.TRACER,name:Rw.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});rk("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);var r=new mL(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?tN(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[sN.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),Dk.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:(Xq=p(l().mark((function e(){var t,n,r,i,a,o,s,c,u,d,p,h,f,_,v,E,m=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:{},n=m.length>1&&void 0!==m[1]?m[1]:"disable",(r="object"==typeof n?function(e){return bD(e)}(n):void 0)&&(n="auto"),i=tO(8,"track-scr-v-"),a=Fk.reportApiInvoke(null,{id:i,tag:Cw.TRACER,name:Rw.CREATE_SCREEN_VIDEO_TRACK,options:[DN({},t),n]}),t.encoderConfig?"string"==typeof t.encoderConfig||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2",o=function(e){var t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&NA()&&(t.extensionId=e.extensionId);var n=e.displaySurface,r=e.selfBrowserSurface,i=e.surfaceSwitching,a=e.systemAudio,o=e.preferCurrentTab;(MA(107)||FA(107)||WA(93))&&(n&&(sw(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(sw(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(sw(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(MA(105)||FA(105)||WA(91))&&a&&(sw(a,"systemAudio",["exclude","include"]),t.systemAudio=a),(MA(94)||FA(94)||WA(80))&&o&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);var s=e.encoderConfig?eN(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(t),s=null,c=null,(u=Gk()).supportShareAudio||"enable"!==n){e.next=11;break}return d=new aw(iw.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),e.abrupt("return",(a.onError(d),d.throw(Dk)));case 11:return Dk.info("start create screen video track with config",t,"withAudio",n,"trackId",i),p=u.supportShareAudio&&"disable"!==n,e.prev=13,e.next=16,eD({screen:o,screenAudio:p?r||!0:void 0},i);case 16:h=e.sent,s=h.getVideoTracks()[0]||null,c=h.getAudioTracks()[0]||null,e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(13),a.onError(e.t0),e.t0;case 23:if(s){e.next=26;break}return f=new aw(iw.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(a.onError(f),f.throw(Dk)));case 26:if(c||"enable"!==n){e.next=30;break}return s&&s.stop(),_=new aw(iw.SHARE_AUDIO_NOT_ALLOWED),e.abrupt("return",(a.onError(_),_.throw(Dk)));case 30:if(t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(gL(i,s,t,t.encoderConfig&&eN(t.encoderConfig)||void 0),t.encoderConfig&&"string"!=typeof t.encoderConfig&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax)),v=new mL(s,t.encoderConfig?eN(t.encoderConfig):{},t.scalabiltyMode?tN(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[sN.SCREEN_TRACK]),c){e.next=34;break}return e.abrupt("return",(a.onSuccess(v.getTrackId()),Dk.info("create screen video track success","video:",v.getTrackId()),v));case 34:return E=new fP(c,void 0,tO(8,"track-scr-a-"),!1),e.abrupt("return",(a.onSuccess([v.getTrackId(),E.getTrackId()]),Dk.info("create screen video track success","video:",v.getTrackId(),"audio:",E.getTrackId()),[v,E]));case 36:case"end":return e.stop()}}),e,null,[[13,20]])}))),function(){return Xq.apply(this,arguments)}),createMicrophoneAndCameraTracks:(zq=p(l().mark((function e(){var t,n,r,i,a,o,s,c,u,d,p,h,f,_,v,E=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&void 0!==E[0]?E[0]:{},n=E.length>1&&void 0!==E[1]?E[1]:{},r=rk("CAMERA_CAPTURE_CONFIG"),i=tO(8,"track-mic-"),a=tO(8,"track-cam-"),o=Fk.reportApiInvoke(null,{id:"".concat(i,"-").concat(a),tag:Cw.TRACER,name:Rw.CREATE_MIC_AND_CAM_TRACKS,options:[t,n,r]}),r&&(n.encoderConfig=r),s=TD(n),c=RD(t),u=null,d=null,Dk.info("start create camera video track(".concat(a,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(n))),e.prev=6,e.next=9,eD({audio:c,video:s},"".concat(i,"-").concat(a));case 9:p=e.sent,u=p.getAudioTracks()[0],d=p.getVideoTracks()[0],e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(6),o.onError(e.t0),e.t0;case 16:if(u&&d){e.next=19;break}return h=new aw(iw.UNEXPECTED_ERROR,"can not find tracks in media stream"),e.abrupt("return",(o.onError(h),h.throw(Dk)));case 19:return n.optimizationMode&&gL(a,d,n,$k(n.encoderConfig)),rk("USE_STANDARD_BITRATE_DEFAULT")&&(f=$k(n.encoderConfig),n.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin),_=new _P(u,t,c,i),v=new SL(d,n,s,n.scalabiltyMode?tN(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,a),e.abrupt("return",(o.onSuccess([_.getTrackId(),v.getTrackId()]),Dk.info("create camera video track(".concat(a,") and microphone audio track(").concat(i,") success")),[_,v]));case 22:case"end":return e.stop()}}),e,null,[[6,13]])}))),function(){return zq.apply(this,arguments)}),createMicrophoneAudioTrack:(qq=p(l().mark((function e(){var t,n,r,i,a,o,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=tO(8,"track-mic-"),r=Fk.reportApiInvoke(null,{id:n,tag:Cw.TRACER,name:Rw.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=RD(t),a=null,Dk.info("start create microphone audio track with config",JSON.stringify(t),"trackId",n),e.prev=4,e.next=7,eD({audio:i},n);case 7:if(e.t0=e.sent.getAudioTracks()[0],e.t0){e.next=10;break}e.t0=null;case 10:a=e.t0,e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(4),r.onError(e.t1),e.t1;case 16:if(a){e.next=19;break}return o=new aw(iw.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(r.onError(o),o.throw(Dk)));case 19:return s=new _P(a,t,i,n),e.abrupt("return",(r.onSuccess(s.getTrackId()),Dk.info("create microphone audio track success, trackId:",n),s));case 21:case"end":return e.stop()}}),e,null,[[4,13]])}))),function(){return qq.apply(this,arguments)}),createCustomAudioTrack:function(e){var t=tO(8,"track-cus-"),n=Fk.reportApiInvoke(null,{id:t,tag:Cw.TRACER,name:Rw.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new fP(e.mediaStreamTrack,e.encoderConfig?rN(e.encoderConfig):{},t,!1);return Dk.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:(Yq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.cacheOnlineFile,i=t.encoderConfig,a=t.source,o={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?null!==(n=File.name)&&void 0!==n?n:"File":a,cacheOnlineFile:r,encoderConfig:i},s=tO(8,"track-buf-"),c=Fk.reportApiInvoke(null,{id:s,tag:Cw.TRACER,name:Rw.CREATE_BUFFER_AUDIO_TRACK,options:[o]}),!rk("DISABLE_WEBAUDIO")){e.next=5;break}throw new aw(iw.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");case 5:if(Dk.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s),u=a,a instanceof AudioBuffer){e.next=17;break}return e.prev=8,e.next=11,p(l().mark((function e(t,n){var r,i,a,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,"string"!=typeof t){e.next=16;break}if(!(i=SP.get(t))){e.next=5;break}return e.abrupt("return",(Dk.debug("use cached audio resource: ",t),i));case 5:return e.prev=5,e.next=8,mO((function(){return _A.get(t,{responseType:"arraybuffer"})}),void 0,void 0,{maxRetryCount:3});case 8:r=e.sent.data,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),new aw(iw.FETCH_AUDIO_FILE_FAILED,e.t0.toString());case 14:e.next=20;break;case 16:return a=new zl((function(e,n){var r=new FileReader;r.onload=function(t){t.target?e(t.target.result):n(new aw(iw.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=function(){n(new aw(iw.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(t)})),e.next=19,a;case 19:r=e.sent;case 20:return e.next=22,function(e){var t=VN();return new zl((function(n,r){t.decodeAudioData(e,(function(e){n(e)}),(function(e){r(new aw(iw.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(r);case 22:return o=e.sent,e.abrupt("return",("string"==typeof t&&n&&SP.set(t,o),o));case 24:case"end":return e.stop()}}),e,null,[[5,11]])})))(a,r);case 11:a=e.sent,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(8),e.abrupt("return",(c.onError(e.t0),e.t0.throw(Dk)));case 17:return d=new mP(a),h=new vP(u,d,i?rN(i):{},s),e.abrupt("return",(Dk.info("create buffer source audio track success, trackId:",s),c.onSuccess(h.getTrackId()),h));case 19:case"end":return e.stop()}}),e,null,[[8,14]])}))),function(e){return Yq.apply(this,arguments)}),setAppType:function(e){if(Dk.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Dk.debug("Invalid appType"),new Bk(iw.INVALID_PARAMS,"invalid app type",e);nk("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Dk.setLogLevel(e)},enableLogUpload:function(){rk("USE_NEW_LOG")?nk("UPLOAD_LOG",!0):Dk.enableLogUpload()},disableLogUpload:function(){rk("USE_NEW_LOG")?nk("UPLOAD_LOG",!1):Dk.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new vF},checkAudioTrackIsActive:(Kq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:5e3,r=Fk.reportApiInvoke(null,{tag:Cw.TRACER,name:Rw.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]}),t instanceof fP||t instanceof RL){e.next=5;break}return i=new Bk(iw.INVALID_TRACK,"the parameter is not a audio track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return n&&n<1e3&&(n=1e3),a=t instanceof fP?t.getTrackLabel():"remote_track",o=t.getVolumeLevel(),s=o,c=o,u=Date.now(),e.abrupt("return",new zl((function(e){var i=setInterval((function(){var o=t.getVolumeLevel(),d=(s=o>s?o:s)-(c=o<c?o:c)>1e-4,p=Date.now()-u;if(d||p>n){clearInterval(i);var l=d,h={duration:p,deviceLabel:a,maxVolumeLevel:s,result:l};Dk.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(h))),r.onSuccess(h),e(l)}}),200)})));case 10:case"end":return e.stop()}}),e)}))),function(e){return Kq.apply(this,arguments)}),checkVideoTrackIsActive:(Hq=p(l().mark((function e(t){var n,r,i,a,o,s,c,u,d,p,h,f,_=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_.length>1&&void 0!==_[1]?_[1]:5e3,r=Fk.reportApiInvoke(null,{tag:Cw.TRACER,name:Rw.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]}),t instanceof mL||t instanceof bL){e.next=5;break}return i=new Bk(iw.INVALID_TRACK,"the parameter is not a video track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return n&&n<1e3&&(n=1e3),a=t instanceof mL?t.getTrackLabel():"remote_track",o=t.getMediaStreamTrack(!0),(s=document.createElement("video")).style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(DA()||kA())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([o]),s.play(),(c=document.createElement("canvas")).width=160,c.height=120,u=0,d=0,e.prev=11,p=Date.now(),e.next=15,function(e,t,n,r){var i,a=0,o=null;return new zl((function(r,s){setTimeout((function(){i&&(i(),r(a))}),t),i=jN((function(){!function(){a>4&&i&&(i(),r(a));var t=n.getContext("2d");if(!t){var c=new Bk(iw.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Dk.error(c.toString()),void s(c)}t.drawImage(e,0,0,160,120);var u=t.getImageData(0,0,n.width,n.height),d=Math.floor(u.data.length/3);if(o){for(var p=0;p<d;p+=3)if(u.data[p]!==o[p])return a+=1,void(o=u.data);o=u.data}else o=u.data}()}),30)}))}(s,n,c);case 15:u=e.sent,d=Date.now()-p,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(11),r.onError(e.t0),e.t0;case 22:return wB===bA.SAFARI&&(s.pause(),s.remove()),s.srcObject=null,f={duration:d,changedPicNum:u,deviceLabel:a,result:h=u>4},e.abrupt("return",(Dk.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(f))),r.onSuccess(f),h));case 25:case"end":return e.stop()}}),e,null,[[11,19]])}))),function(e){return Hq.apply(this,arguments)}),setArea:IV,audioElementPlayCenter:lD,resumeAudioContext:function(){lD.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){wG.processExternalMediaAEC(e)},registerExtensions:function(e){var t=rk("PLUGIN_INFO")||[];e.forEach((function(e){"name"in e&&!Br(t).call(t,e.name)&&t.push(e.name);var n=e;n.__registered__=!0,n.logger.hookLog=Dk.extLog,n.reporter.hookApiInvoke=Fk.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((function(e){n.parameters[e]=rk(e)}))})),Gq("PLUGIN_INFO",t)},ChannelMediaRelayError:vM,ChannelMediaRelayEvent:fM,ChannelMediaRelayState:_M,RemoteStreamFallbackType:dN,RemoteStreamType:uN,ConnectionDisconnectedReason:Aw,AudienceLatencyLevelType:Iw,AREAS:TM,preload:(Wq=p(l().mark((function e(t,n,r,i){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",jB(t,n,r,i));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return Wq.apply(this,arguments)})});return Object.defineProperties(Zq,{onAudioAutoplayFailed:{get:function(){return cD.onAudioAutoplayFailed},set:function(e){cD.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:function(){return cD.onAutoplayFailed},set:function(e){cD.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:function(){return Zq._onSecurityPolicyViolation},set:function(e){Zq._onSecurityPolicyViolation=e,DG(e)}},__CLIENT_LIST__:{get:function(){return rk("SHOW_GLOBAL_CLIENT_LIST")?ax:[]}}}),oD.on(CN.CAMERA_DEVICE_CHANGED,(function(e){Dk.info("camera device changed",JSON.stringify(e)),Zq.onCameraChanged&&Zq.onCameraChanged(e),Zq.safeEmit(BM.CAMERA_CHANGED,e)})),oD.on(CN.RECORDING_DEVICE_CHANGED,(function(e){Dk.info("microphone device changed",JSON.stringify(e)),Zq.onMicrophoneChanged&&Zq.onMicrophoneChanged(e),Zq.safeEmit(BM.MICROPHONE_CHANGED,e)})),oD.on(CN.PLAYOUT_DEVICE_CHANGED,(function(e){Dk.debug("playout device changed",JSON.stringify(e)),Zq.onPlaybackDeviceChanged&&Zq.onPlaybackDeviceChanged(e),Zq.safeEmit(BM.PLAYBACK_DEVICE_CHANGED,e)})),lD.onAutoplayFailed=function(){Dk.info("detect audio element autoplay failed"),cD.onAudioAutoplayFailed&&cD.onAudioAutoplayFailed()},UN.on("autoplay-failed",(function(){Dk.info("detect webaudio autoplay failed"),cD.onAudioAutoplayFailed&&cD.onAudioAutoplayFailed(),Zq.safeEmit(BM.AUTOPLAY_FAILED)})),UN.on(Kk.STATE_CHANGE,(function(e,t){Dk.info("audio context state changed: ".concat(t," => ").concat(e)),Zq.onAudioContextStateChanged&&Zq.onAudioContextStateChanged(e,t),Zq.safeEmit(BM.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Fw.on(Lw.NETWORK_STATE_CHANGE,(function(e,t){Dk.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=Zq),Zq},"object"==typeof t&&void 0!==o?o.exports=d():"function"==typeof define&&define.amd?define(d):(u="undefined"!=typeof globalThis?globalThis:u||self).AgoraRTC=d(),e("default",o.exports)}),{})}}}));

System.register("chunks:///_virtual/AgoraRTC_N-production.mjs_cjs=&original=.js",["./AgoraRTC_N-production.js","./cjs-loader.mjs"],(function(r,t){var e,a;return{setters:[function(t){e=t.__cjsMetaURL;var a={};a.__cjsMetaURL=t.__cjsMetaURL,a.default=t.default,r(a)},function(r){a=r.default}],execute:function(){e||a.throwInvalidWrapper("./AgoraRTC_N-production.js",t.meta.url),a.require(e)}}}));

System.register("chunks:///_virtual/cjs-loader.mjs",[],(function(e){return{execute:function(){e("default",new(function(){function e(){this._registry={},this._moduleCache={}}var r=e.prototype;return r.define=function(e,r,t){this._registry[e]={factory:r,resolveMap:t}},r.require=function(e){return this._require(e)},r.throwInvalidWrapper=function(e,r){throw new Error("Module '"+e+"' imported from '"+r+"' is expected be an ESM-wrapped CommonJS module but it doesn't.")},r._require=function(e,r){var t=this._moduleCache[e];if(t)return t.exports;var o={id:e,exports:{}};return this._moduleCache[e]=o,this._tryModuleLoad(o,e),o.exports},r._resolve=function(e,r){return this._resolveFromInfos(e,r)||this._throwUnresolved(e,r)},r._resolveFromInfos=function(e,r){var t,o;return e in cjsInfos?e:r&&null!=(t=null==(o=cjsInfos[r])?void 0:o.resolveCache[e])?t:void 0},r._tryModuleLoad=function(e,r){var t=!0;try{this._load(e,r),t=!1}finally{t&&delete this._moduleCache[r]}},r._load=function(e,r){var t=this._loadWrapper(r),o=t.factory,n=t.resolveMap,i=this._createRequire(e),u=n?this._createRequireWithResolveMap("function"==typeof n?n():n,i):i;o(e.exports,u,e)},r._loadWrapper=function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)},r._loadHostProvidedModules=function(e){return{factory:function(r,t,o){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '"+e+"'.");try{o.exports=require(e)}catch(r){throw new Error("Exception thrown when calling host defined require('"+e+"').",{cause:r})}}}},r._createRequire=function(e){var r=this;return function(t){return r._require(t,e)}},r._createRequireWithResolveMap=function(e,r){return function(t){var o=e[t];if(o)return r(o);throw new Error("Unresolved specifier "+t)}},r._throwUnresolved=function(e,r){throw new Error("Unable to resolve "+e+" from "+parent+".")},e}()))}}}));

System.register("chunks:///_virtual/env",[],(function(e){return{execute:function(){e("PREVIEW",!1),e("DEBUG",!1)}}}));

System.register("chunks:///_virtual/rollupPluginModLoBabelHelpers.js",[],(function(t){return{execute:function(){function e(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function n(){return(n=t("extends",Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t})).apply(this,arguments)}function o(e){return(o=t("getPrototypeOf",Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)}))(e)}function i(e,r){return(i=t("setPrototypeOf",Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t}))(e,r)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function u(e,r,n){return(u=a()?t("construct",Reflect.construct.bind()):t("construct",(function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&i(o,r.prototype),o}))).apply(null,arguments)}function c(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function l(e){var r="function"==typeof Map?new Map:void 0;return(l=t("wrapNativeSuper",(function(t){if(null===t||!c(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return u(t,arguments,o(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i(e,t)})))(e)}function f(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function h(t){var e=p(t,"string");return"symbol"==typeof e?e:String(e)}t({applyDecoratedDescriptor:function(t,e,r,n,o){var i={};Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0);i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0);void 0===i.initializer&&(Object.defineProperty(t,e,i),i=null);return i},arrayLikeToArray:s,assertThisInitialized:function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},asyncToGenerator:function(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=t.apply(r,n);function u(t){e(a,o,i,u,c,"next",t)}function c(t){e(a,o,i,u,c,"throw",t)}u(void 0)}))}},construct:u,createClass:function(t,e,n){e&&r(t.prototype,e);n&&r(t,n);return Object.defineProperty(t,"prototype",{writable:!1}),t},createForOfIteratorHelperLoose:function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=f(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},extends:n,getPrototypeOf:o,inheritsLoose:function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)},initializerDefineProperty:function(t,e,r,n){if(!r)return;Object.defineProperty(t,e,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})},isNativeFunction:c,isNativeReflectConstruct:a,regeneratorRuntime:function(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t("regeneratorRuntime",(function(){return r}));var e,r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(e){f=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var o=e&&e.prototype instanceof g?e:g,a=Object.create(o.prototype),u=new T(n||[]);return i(a,"_invoke",{value:E(t,r,u)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=s;var h="suspendedStart",y="executing",v="completed",d={};function g(){}function b(){}function m(){}var w={};f(w,u,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(k([])));j&&j!==n&&o.call(j,u)&&(w=j);var x=m.prototype=g.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(n,i,a,u){var c=p(t[n],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&o.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var n;i(this,"_invoke",{value:function(t,o){function i(){return new e((function(e,n){r(t,o,e,n)}))}return n=n?n.then(i,i):i()}})}function E(t,r,n){var o=h;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=_(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function _(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,_(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function k(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=m,i(x,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:b,configurable:!0}),b.displayName=f(m,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,f(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},r.awrap=function(t){return{__await:t}},L(P.prototype),f(P.prototype,c,(function(){return this})),r.AsyncIterator=P,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new P(s(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(x),f(x,l,"Generator"),f(x,u,(function(){return this})),f(x,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:k(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),d}},r},setPrototypeOf:i,toPrimitive:p,toPropertyKey:h,unsupportedIterableToArray:f,wrapNativeSuper:l})}}}));

} }; });